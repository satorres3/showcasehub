(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/let g={};const ge=()=>{g.root=document.getElementById("root"),g.appRoot=document.getElementById("app-root"),g.pageViews={login:document.getElementById("login-page"),hub:document.getElementById("hub-page"),settingsHub:document.getElementById("settings-hub-page"),containerManagement:document.getElementById("container-management-page"),globalSettings:document.getElementById("global-settings-page"),settingsDetail:document.getElementById("settings-detail-page"),department:document.getElementById("container-page"),knowledge:document.getElementById("knowledge-page")},g.modals={addContainer:document.getElementById("add-container-modal"),functionRunner:document.getElementById("function-runner-modal"),deleteConfirm:document.getElementById("delete-confirm-modal"),sharepointPicker:document.getElementById("sharepoint-picker-modal")},g.buttons={googleLogin:document.getElementById("google-login"),microsoftLogin:document.getElementById("microsoft-login"),settings:document.getElementById("settings-btn"),addContainer:document.getElementById("add-container-btn"),backToHub:document.querySelectorAll(".back-to-hub-btn"),backToSettingsHub1:document.getElementById("back-to-settings-hub-btn-1"),backToSettingsHub2:document.getElementById("back-to-settings-hub-btn-2"),backToContainerManagement:document.getElementById("back-to-container-management-btn"),backToAssistant:document.getElementById("back-to-assistant-btn"),sidebarToggle:document.getElementById("sidebar-toggle-btn"),attachment:document.getElementById("attachment-btn"),uploadComputer:document.getElementById("upload-computer-btn"),uploadSharepoint:document.getElementById("upload-sharepoint-btn"),removeAttachment:document.getElementById("remove-attachment-btn"),suggestQuestions:document.getElementById("suggest-questions-btn"),suggestPersonas:document.getElementById("suggest-personas-btn"),generateFunction:document.getElementById("generate-function-btn"),generateAi:document.getElementById("generate-ai-btn"),closeModal:document.getElementById("close-modal-btn"),cancelContainer:document.getElementById("cancel-container-btn"),createContainer:document.getElementById("create-container-btn"),closeFunctionRunner:document.getElementById("close-function-runner-btn"),cancelFunctionRunner:document.getElementById("cancel-function-runner-btn"),deleteContainer:document.getElementById("delete-container-btn"),closeDeleteModal:document.getElementById("close-delete-modal-btn"),cancelDelete:document.getElementById("cancel-delete-btn"),confirmDelete:document.getElementById("confirm-delete-btn"),newChat:document.getElementById("new-chat-btn"),sendChat:document.getElementById("send-chat-btn"),manageKnowledge:document.getElementById("manage-knowledge-btn"),knowledgeUpload:document.getElementById("knowledge-upload-btn"),knowledgeAddSharepoint:document.getElementById("knowledge-add-sharepoint-btn"),saveSettings:document.getElementById("save-settings-btn"),cancelSettings:document.getElementById("cancel-settings-btn"),saveGlobalSettings:document.getElementById("save-global-settings-btn"),cancelGlobalSettings:document.getElementById("cancel-global-settings-btn"),addCustomIcon:document.getElementById("add-custom-icon-btn"),editCustomIcon:document.getElementById("edit-custom-icon-btn"),editGlobalLogo:document.getElementById("edit-global-logo-btn"),acceptCookies:document.getElementById("accept-cookies-btn"),editCardImage:document.getElementById("edit-card-image-btn")},g.forms={chat:document.getElementById("chat-form"),addContainer:document.getElementById("add-container-form"),addQuickQuestion:document.getElementById("add-quick-question-form"),addPersona:document.getElementById("add-persona-form"),addAccessor:document.getElementById("add-accessor-form"),addFunction:document.getElementById("add-function-form"),addModel:document.getElementById("add-model-form"),functionRunner:document.getElementById("function-runner-form"),settingsContainer:document.getElementById("settings-form-container"),globalSettings:document.getElementById("global-settings-form")},g.inputs={chat:document.getElementById("chat-input"),fileUpload:document.getElementById("file-upload-input"),containerName:document.getElementById("container-name-input"),containerDesc:document.getElementById("container-desc-input"),containerType:document.getElementById("container-type-select"),containerWebsite:document.getElementById("container-website-input"),editContainerName:document.getElementById("edit-container-name"),editContainerDesc:document.getElementById("edit-container-desc"),newQuickQuestion:document.getElementById("new-quick-question-input"),newPersona:document.getElementById("new-persona-input"),newAccessor:document.getElementById("new-accessor-input"),newFunction:document.getElementById("new-function-input"),newModelId:document.getElementById("new-model-id"),newModelApi:document.getElementById("new-model-api"),newModelIcon:document.getElementById("new-model-icon"),knowledgeFile:document.getElementById("knowledge-file-input"),userBgColor:document.getElementById("user-bg-color"),userTextColor:document.getElementById("user-text-color"),botBgColor:document.getElementById("bot-bg-color"),botTextColor:document.getElementById("bot-text-color"),bgGradientStartColor:document.getElementById("bg-gradient-start-color"),bgGradientEndColor:document.getElementById("bg-gradient-end-color"),sidebarBgColor:document.getElementById("sidebar-bg-color"),sidebarTextColor:document.getElementById("sidebar-text-color"),sidebarHighlightBgColor:document.getElementById("sidebar-highlight-bg-color"),addCustomIconUpload:document.getElementById("add-custom-icon-upload"),editCustomIconUpload:document.getElementById("edit-custom-icon-upload"),editCardImageUpload:document.getElementById("edit-card-image-upload"),editLoginTitle:document.getElementById("edit-login-title"),editLoginSubtitle:document.getElementById("edit-login-subtitle"),editHubHeaderTitle:document.getElementById("edit-hub-header-title"),editHubTitle:document.getElementById("edit-hub-title"),editHubSubtitle:document.getElementById("edit-hub-subtitle"),editGlobalLogoUpload:document.getElementById("edit-global-logo-upload"),enableGoogleLogin:document.getElementById("enable-google-login"),googleClientId:document.getElementById("google-client-id"),googleClientSecret:document.getElementById("google-client-secret"),enableMicrosoftLogin:document.getElementById("enable-microsoft-login"),microsoftClientId:document.getElementById("microsoft-client-id"),microsoftClientSecret:document.getElementById("microsoft-client-secret"),enableCookieBanner:document.getElementById("enable-cookie-banner"),privacyPolicyUrl:document.getElementById("privacy-policy-url"),isKnowledgePublic:document.getElementById("is-knowledge-public")},g.containers={containerGrid:document.getElementById("container-grid"),containerManagementGrid:document.getElementById("container-management-grid"),chatMessages:document.getElementById("chat-messages"),chatWelcome:document.getElementById("chat-welcome"),welcomeIcon:document.getElementById("welcome-icon"),welcomeQuestions:document.getElementById("welcome-questions"),sidebarAppsSection:document.getElementById("sidebar-apps-section"),sidebarIntegrationsSection:document.getElementById("sidebar-integrations-section"),sidebarHistoryList:document.getElementById("sidebar-history-list"),sidebarAssistantLink:document.getElementById("sidebar-assistant-link"),sidebarKnowledgeLink:document.getElementById("sidebar-knowledge-link"),attachmentOptions:document.getElementById("attachment-options"),attachmentPreview:document.getElementById("attachment-preview"),containerIconSelector:document.getElementById("container-icon-selector"),editContainerIconSelector:document.getElementById("edit-container-icon-selector"),quickQuestionsList:document.getElementById("quick-questions-list"),personasList:document.getElementById("personas-list"),accessControlList:document.getElementById("access-control-list"),availableModelsList:document.getElementById("available-models-list"),modelManagementList:document.getElementById("model-management-list"),functionsList:document.getElementById("functions-list"),functionRunnerBody:document.getElementById("function-runner-body"),settingsTabs:document.getElementById("settings-tabs"),settingsPanels:document.querySelectorAll("#settings-detail-page .tab-panel"),globalSettingsTabs:document.getElementById("global-settings-tabs"),globalSettingsPanels:document.querySelectorAll("#global-settings-page .tab-panel"),modelSelect:document.getElementById("model-select-container"),personaSelect:document.getElementById("persona-select-container"),fileDropzone:document.getElementById("file-dropzone"),knowledgeFileList:document.getElementById("knowledge-file-list"),aiSuggestions:document.getElementById("ai-suggestions-container"),suggestedQuestions:document.getElementById("suggested-questions-list"),suggestedPersonas:document.getElementById("suggested-personas-list"),suggestedApps:document.getElementById("suggested-apps-list"),addContainerThemePreview:document.getElementById("add-container-theme-preview"),toast:document.getElementById("toast-notification"),containerWebsiteGroup:document.getElementById("container-website-group"),appearancePreview:document.getElementById("appearance-preview"),sidebarPreview:document.getElementById("sidebar-preview"),brandingPreview:document.getElementById("branding-preview"),loginAppLogo:document.getElementById("login-app-logo"),hubAppLogo:document.getElementById("hub-app-logo"),cookieBanner:document.getElementById("cookie-consent-banner"),containerManagementCard:document.getElementById("container-management-card"),globalSettingsCard:document.getElementById("global-settings-card"),integrationsGrid:document.getElementById("integrations-grid"),containerIntegrationsList:document.getElementById("container-integrations-list"),cardImageOptionsList:document.getElementById("card-image-options-list")},g.textElements={containerPageTitle:document.getElementById("container-page-title"),sidebarContainerTitle:document.getElementById("sidebar-container-title"),attachmentFilename:document.getElementById("attachment-filename"),settingsHubTitle:document.getElementById("settings-hub-title"),containerManagementTitle:document.getElementById("container-management-title"),globalSettingsTitle:document.getElementById("global-settings-title"),settingsDetailTitle:document.getElementById("settings-detail-title"),functionRunnerTitle:document.getElementById("function-runner-title"),deleteItemName:document.getElementById("delete-item-name"),deleteConfirmDescription:document.getElementById("delete-confirm-description"),aiStatusText:document.getElementById("ai-status-text"),aiStatusSpinner:document.getElementById("ai-status-spinner"),welcomeTitle:document.getElementById("welcome-title"),knowledgePageTitle:document.getElementById("knowledge-page-title"),knowledgeTitle:document.getElementById("knowledge-title"),knowledgeSubtitle:document.getElementById("knowledge-subtitle"),loginTitle:document.getElementById("login-title-text"),loginSubtitle:document.getElementById("login-subtitle-text"),hubHeaderTitle:document.getElementById("hub-header-title"),hubTitle:document.getElementById("hub-title-text"),hubSubtitle:document.getElementById("hub-subtitle-text"),brandingPreviewTitle:document.getElementById("branding-preview-title"),brandingPreviewSubtitle:document.getElementById("branding-preview-subtitle"),privacyPolicyLink:document.getElementById("privacy-policy-link")},g.loaders={sendChat:document.querySelector("#send-chat-btn .thinking-loader"),aiGenerate:document.querySelector("#generate-ai-btn .thinking-loader")},g.previews={addCustomIcon:document.getElementById("add-custom-icon-preview"),editCustomIcon:document.getElementById("edit-custom-icon-preview"),editCardImage:document.getElementById("edit-card-image-preview"),addContainerTheme:document.querySelector("#add-container-theme-preview .appearance-preview"),brandingLogo:document.getElementById("branding-preview-logo")}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const wn={userBg:"#0077b6",userText:"#ffffff",botBg:"#1a1a2e",botText:"#f0f0f0",bgGradientStart:"#0f0c29",bgGradientEnd:"#24243e",sidebarBg:"#0f0c29",sidebarText:"#a9a9b3",sidebarHighlightBg:"rgba(0, 191, 255, 0.1)"},Dt={loginTitle:"The Future of Tech",loginSubtitle:"Sign in to continue",hubTitle:"Welcome to the Hub",hubSubtitle:"Select a container to get started",hubHeaderTitle:"The Hub",appLogo:"",enableGoogleLogin:!0,googleClientId:"",googleClientSecret:"",enableMicrosoftLogin:!0,microsoftClientId:"",microsoftClientSecret:"",enableCookieBanner:!1,privacyPolicyUrl:"",integrations:{sharepoint:!1,brevo:!1,hubspot:!1,docusign:!1,outlook:!0}},Je=[{id:"gemini-2.5-flash",api:"google",icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12.75 4.75L10.25 9.25L5.75 11.75L10.25 14.25L12.75 18.75L15.25 14.25L19.75 11.75L15.25 9.25L12.75 4.75Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M12.75 4.75L10.25 9.25L5.75 11.75L10.25 14.25L12.75 18.75L15.25 14.25L19.75 11.75L15.25 9.25L12.75 4.75Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>'},{id:"openai/gpt-4o",api:"openai",icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 21a9 9 0 1 0 0-18 9 9 0 0 0 0 18Z" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10"></path><path d="M12 12a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10"></path></svg>'},{id:"anthropic/claude-3-opus",api:"anthropic",icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M12 16V12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M12 8H12.01" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>'},{id:"meta/llama-3-70b",api:"meta",icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 15.5562C2 15.5562 5.33333 16.6671 8 15.5562C10.6667 14.4454 10.6667 11.1116 13.3333 10.0007C16 8.88989 18.6667 11.1116 22 10.0007" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M2 8.88889C2 8.88889 5.33333 9.99978 8 8.88889C10.6667 7.77805 10.6667 4.44426 13.3333 3.33337C16 2.22249 18.6667 4.44426 22 3.33337" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>'},{id:"groq/llama3-8b-8192",api:"groq",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>'}],dc=[{name:"Data Security",description:"Protecting our digital assets and infrastructure.",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>',cardImageUrl:"https://images.unsplash.com/photo-1550751827-4138d04d405b?q=80&w=1280&auto=format&fit=crop",quickQuestions:["What is phishing?","Latest security threats?","Recommend a password manager.","How to secure my home Wi-Fi?"],availableModels:Je.map(n=>n.id),availablePersonas:["Helpful Assistant","Security Expert","Strict Enforcer"],selectedModel:"gemini-2.5-flash",selectedPersona:"Helpful Assistant",functions:[],enabledIntegrations:[],knowledgeBase:[],accessControl:["admin@company.com","security-team"],theme:{userBg:"#0077b6",userText:"#ffffff",botBg:"#1a1a2e",botText:"#f0f0f0",bgGradientStart:"#0d1b2a",bgGradientEnd:"#1b263b",sidebarBg:"#0d1b2a",sidebarText:"#a9a9b3",sidebarHighlightBg:"rgba(0, 191, 255, 0.1)"},isKnowledgeBasePublic:!1},{name:"Sales",description:"Driving growth, strategy, and revenue generation.",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20V10"></path><path d="M18 20V4"></path><path d="M6 20V16"></path></svg>',cardImageUrl:"https://images.unsplash.com/photo-1520607162513-77705c0f0d4a?q=80&w=1280&auto=format&fit=crop",quickQuestions:["Summarize last week's leads.","Who is our biggest competitor?","Draft a follow-up email.","Give me a sales pitch for Product X."],availableModels:Je.map(n=>n.id),availablePersonas:["Helpful Assistant","Sales Coach","Data Analyst","Brazilian Deal Closer"],selectedModel:"gemini-2.5-flash",selectedPersona:"Helpful Assistant",functions:[{id:"func-sales-deal-intel-1",name:"Deal Intelligence",description:"Analyzes tender documents to provide insights on the client, market, and solution fit.",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>',parameters:[{name:"tenderText",type:"textarea",description:"Paste the full text from the tender document or email."}],promptTemplate:`As a senior B2B sales analyst based in Germany, analyze the following tender document. Provide a concise, structured report in Markdown format covering these key areas:

1.  **Company Profile**: Identify the company issuing the tender. What is their industry, size, and potential strategic importance?
2.  **Core Requirements**: Summarize the top 3-5 technical and business requirements from the tender.
3.  **Solution Fit Analysis**: Briefly explain how our solutions could meet their requirements. Mention specific product strengths that are relevant.
4.  **Competitive Landscape**: Who are the likely competitors for this deal in the German market?
5.  **Next Steps**: Recommend the immediate next steps for the sales team to take.

Tender Text:
---
{tenderText}
---`,enabled:!0}],enabledIntegrations:["outlook"],knowledgeBase:[],accessControl:["admin@company.com","sales-team"],theme:{userBg:"#0077b6",userText:"#ffffff",botBg:"#1a1a2e",botText:"#f0f0f0",bgGradientStart:"#142b27",bgGradientEnd:"#2b413c",sidebarBg:"#142b27",sidebarText:"#a9a9b3",sidebarHighlightBg:"rgba(0, 191, 255, 0.1)"},isKnowledgeBasePublic:!1}],Ds=[{svg:'<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>',description:"A simple square, representing a generic or foundational container."},{svg:'<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>',description:"A shield, representing security, protection, and defense."},{svg:'<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20V10"></path><path d="M18 20V4"></path><path d="M6 20V16"></path></svg>',description:"A bar chart, representing sales, data, analytics, and growth."},{svg:'<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>',description:"An information symbol, for help, support, or general knowledge."},{svg:'<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>',description:"A star, for special projects, favorites, or high-priority items."},{svg:'<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>',description:"A package or box, representing products, inventory, or launches."}],oo=[{url:"https://images.unsplash.com/photo-1550751827-4138d04d405b?q=80&w=1280&auto=format&fit=crop",description:"A server room with glowing blue lights, representing technology, data, and security."},{url:"https://images.unsplash.com/photo-1520607162513-77705c0f0d4a?q=80&w=1280&auto=format&fit=crop",description:"A modern office meeting with professionals discussing charts, representing business, sales, and collaboration."},{url:"https://images.unsplash.com/photo-1519389950473-47ba0277781c?q=80&w=1280&auto=format&fit=crop",description:"A team working together at a desk with laptops and documents, representing teamwork, projects, and development."},{url:"https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?q=80&w=1280&auto=format&fit=crop",description:"A close-up of a laptop showing financial charts and graphs, suitable for finance, analytics, or data-driven departments."},{url:"https://images.unsplash.com/photo-1552664730-d307ca884978?q=80&w=1280&auto=format&fit=crop",description:"A person presenting a strategy on a clear board, representing marketing, planning, and strategy."},{url:"https://images.unsplash.com/photo-1581092916374-03595232a51a?q=80&w=1280&auto=format&fit=crop",description:"A scientist in a lab coat working with test tubes, representing research, science, and development."}],uc=Ds.map(n=>n.svg),Oo=['<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>'];/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const C={containers:[],branding:{...Dt},availableModels:[...Je],draftBranding:null,draftAvailableModels:null,currentContainerId:null,currentSettingsContainerId:null,draftSettingsContainer:null,attachedFile:null,draftNewContainer:null,currentRunningFunction:null,containerChats:new Map,itemToDelete:null,currentUser:null,knowledgeBaseSourcePage:null};var Li={};async function hc(){return console.log("Simulating API call to load MSAL config..."),await new Promise(n=>setTimeout(n,100)),{clientId:Li.MSAL_CLIENT_ID||null,tenantId:Li.MSAL_TENANT_ID||null}}async function fc(){console.log("Simulating API call to load app state..."),await new Promise(t=>setTimeout(t,100));const n=localStorage.getItem("appState");if(n)try{const t=JSON.parse(n);if(t&&Array.isArray(t.containers)&&t.branding&&Array.isArray(t.availableModels))return t}catch(t){console.error("Failed to parse state from localStorage, initializing with defaults.",t),localStorage.removeItem("appState")}return console.log("No valid saved state found, creating initial state from constants."),{containers:dc.map((t,o)=>({...t,id:`cont-${Date.now()}-${o}`,chats:[],activeChatId:null})),branding:Dt,availableModels:Je}}async function gc(n){console.log("Simulating API call to save app state..."),await new Promise(e=>setTimeout(e,100));try{const e=JSON.stringify(n);localStorage.setItem("appState",e)}catch(e){console.error("Failed to save state to localStorage",e)}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const _n=n=>new Promise((e,t)=>{const o=new FileReader;o.readAsDataURL(n),o.onload=()=>e(o.result),o.onerror=i=>t(i)}),Us=n=>n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/^### (.*$)/gim,"<h3>$1</h3>").replace(/^## (.*$)/gim,"<h2>$1</h2>").replace(/^# (.*$)/gim,"<h1>$1</h1>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/^\s*[\*-] (.*$)/gim,"<li>$1</li>").replace(/(<\/li>\s*<li>)/g,"</li><li>").replace(/((<li>.*<\/li>)+)/gs,"<ul>$1</ul>").replace(/\n/g,"<br />").replace(/<br \/>\s*<h[1-3]>/g,"<h$1>").replace(/<\/h[1-3]>\s*<br \/>/g,"</h3>").replace(/<br \/>\s*<ul>/g,"<ul>").replace(/<\/ul>\s*<br \/>/g,"</ul>"),Os=(n,e=2)=>{if(n===0)return"0 Bytes";const t=1024,o=e<0?0:e,i=["Bytes","KB","MB","GB","TB"],a=Math.floor(Math.log(n)/Math.log(t));return parseFloat((n/Math.pow(t,a)).toFixed(o))+" "+i[a]},pc=n=>new Date(n).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),_e=async()=>{try{const n={containers:C.containers,branding:C.branding,availableModels:C.availableModels};await gc(n)}catch(n){console.error("Could not save state to backend:",n)}},mc=async()=>{try{const n=localStorage.getItem("appState")===null,e=await fc();C.containers=e.containers||[],C.branding={...Dt,...e.branding||{},integrations:{...Dt.integrations,...e.branding?.integrations||{}}},C.availableModels=e.availableModels||[...Je],n&&await _e()}catch(n){console.error("Could not load state from backend:",n),C.containers=[],C.branding={...Dt},C.availableModels=[...Je]}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Cc,yc;function Tc(){return{geminiUrl:Cc,vertexUrl:yc}}function vc(n,e,t,o){var i,a;if(!n?.baseUrl){const l=Tc();return e?(i=l.vertexUrl)!==null&&i!==void 0?i:t:(a=l.geminiUrl)!==null&&a!==void 0?a:o}return n.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nt{}function P(n,e){const t=/\{([^}]+)\}/g;return n.replace(t,(o,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){const a=e[i];return a!=null?String(a):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function s(n,e,t){for(let a=0;a<e.length-1;a++){const l=e[a];if(l.endsWith("[]")){const c=l.slice(0,-2);if(!(c in n))if(Array.isArray(t))n[c]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${l}`);if(Array.isArray(n[c])){const u=n[c];if(Array.isArray(t))for(let d=0;d<u.length;d++){const h=u[d];s(h,e.slice(a+1),t[d])}else for(const d of u)s(d,e.slice(a+1),t)}return}else if(l.endsWith("[0]")){const c=l.slice(0,-3);c in n||(n[c]=[{}]);const u=n[c];s(u[0],e.slice(a+1),t);return}(!n[l]||typeof n[l]!="object")&&(n[l]={}),n=n[l]}const o=e[e.length-1],i=n[o];if(i!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===i)return;if(typeof i=="object"&&typeof t=="object"&&i!==null&&t!==null)Object.assign(i,t);else throw new Error(`Cannot set value for an existing key. Key: ${o}`)}else n[o]=t}function r(n,e){try{if(e.length===1&&e[0]==="_self")return n;for(let t=0;t<e.length;t++){if(typeof n!="object"||n===null)return;const o=e[t];if(o.endsWith("[]")){const i=o.slice(0,-2);if(i in n){const a=n[i];return Array.isArray(a)?a.map(l=>r(l,e.slice(t+1))):void 0}else return}else n=n[o]}return n}catch(t){if(t instanceof TypeError)return;throw t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function io(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Di;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Di||(Di={}));var Ui;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(Ui||(Ui={}));var b;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL"})(b||(b={}));var Oi;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",n.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",n.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",n.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",n.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT"})(Oi||(Oi={}));var Hi;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(Hi||(Hi={}));var Bi;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(Bi||(Bi={}));var Fi;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(Fi||(Fi={}));var Gi;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(Gi||(Gi={}));var qi;(function(n){n.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",n.SIMPLE_SEARCH="SIMPLE_SEARCH",n.ELASTIC_SEARCH="ELASTIC_SEARCH"})(qi||(qi={}));var Vi;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",n.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",n.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(Vi||(Vi={}));var Ki;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY",n.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL"})(Ki||(Ki={}));var $i;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})($i||($i={}));var Ji;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Ji||(Ji={}));var zi;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.IMAGE_SAFETY="IMAGE_SAFETY"})(zi||(zi={}));var Yi;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Yi||(Yi={}));var un;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(un||(un={}));var Wi;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Wi||(Wi={}));var ro;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(ro||(ro={}));var Qi;(function(n){n.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",n.TUNING_MODE_FULL="TUNING_MODE_FULL",n.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Qi||(Qi={}));var Xi;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Xi||(Xi={}));var Zi;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(Zi||(Zi={}));var ji;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(ji||(ji={}));var er;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(er||(er={}));var tr;(function(n){n.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",n.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(tr||(tr={}));var nr;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(nr||(nr={}));var or;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(or||(or={}));var ir;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(ir||(ir={}));var rr;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi",n.zh="zh",n.pt="pt",n.es="es"})(rr||(rr={}));var sr;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(sr||(sr={}));var ar;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(ar||(ar={}));var lr;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(lr||(lr={}));var cr;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(cr||(cr={}));var dr;(function(n){n.OPTIMIZED="OPTIMIZED",n.LOSSLESS="LOSSLESS"})(dr||(dr={}));var ur;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(ur||(ur={}));var hr;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(hr||(hr={}));var fr;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(fr||(fr={}));var gr;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(gr||(gr={}));var pr;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(pr||(pr={}));var mr;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(mr||(mr={}));var Cr;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Cr||(Cr={}));var yr;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(yr||(yr={}));var Tr;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Tr||(Tr={}));var vr;(function(n){n.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",n.QUALITY="QUALITY",n.DIVERSITY="DIVERSITY",n.VOCALIZATION="VOCALIZATION"})(vr||(vr={}));var ut;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(ut||(ut={}));class so{constructor(e){const t={};for(const o of e.headers.entries())t[o[0]]=o[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class Nt{get text(){var e,t,o,i,a,l,c,u;if(((i=(o=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||o===void 0?void 0:o.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",h=!1;const f=[];for(const p of(u=(c=(l=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.content)===null||c===void 0?void 0:c.parts)!==null&&u!==void 0?u:[]){for(const[m,v]of Object.entries(p))m!=="text"&&m!=="thought"&&(v!==null||v!==void 0)&&f.push(m);if(typeof p.text=="string"){if(typeof p.thought=="boolean"&&p.thought)continue;h=!0,d+=p.text}}return f.length>0&&console.warn(`there are non-text parts ${f} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),h?d:void 0}get data(){var e,t,o,i,a,l,c,u;if(((i=(o=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||o===void 0?void 0:o.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="";const h=[];for(const f of(u=(c=(l=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.content)===null||c===void 0?void 0:c.parts)!==null&&u!==void 0?u:[]){for(const[p,m]of Object.entries(f))p!=="inlineData"&&(m!==null||m!==void 0)&&h.push(p);f.inlineData&&typeof f.inlineData.data=="string"&&(d+=atob(f.inlineData.data))}return h.length>0&&console.warn(`there are non-data parts ${h} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var e,t,o,i,a,l,c,u;if(((i=(o=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||o===void 0?void 0:o.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(u=(c=(l=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.content)===null||c===void 0?void 0:c.parts)===null||u===void 0?void 0:u.filter(h=>h.functionCall).map(h=>h.functionCall).filter(h=>h!==void 0);if(d?.length!==0)return d}get executableCode(){var e,t,o,i,a,l,c,u,d;if(((i=(o=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||o===void 0?void 0:o.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const h=(u=(c=(l=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.content)===null||c===void 0?void 0:c.parts)===null||u===void 0?void 0:u.filter(f=>f.executableCode).map(f=>f.executableCode).filter(f=>f!==void 0);if(h?.length!==0)return(d=h?.[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var e,t,o,i,a,l,c,u,d;if(((i=(o=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||o===void 0?void 0:o.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const h=(u=(c=(l=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.content)===null||c===void 0?void 0:c.parts)===null||u===void 0?void 0:u.filter(f=>f.codeExecutionResult).map(f=>f.codeExecutionResult).filter(f=>f!==void 0);if(h?.length!==0)return(d=h?.[0])===null||d===void 0?void 0:d.output}}class Ir{}class Er{}class Ic{}class Ec{}class Sc{}class Sr{}class Ar{}class wr{}class Ac{}class _r{}class Rr{}class kr{}class Mr{}class wc{}class _c{}class Rc{}class Pr{}class kc{get text(){var e,t,o;let i="",a=!1;const l=[];for(const c of(o=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&o!==void 0?o:[]){for(const[u,d]of Object.entries(c))u!=="text"&&u!=="thought"&&d!==null&&l.push(u);if(typeof c.text=="string"){if(typeof c.thought=="boolean"&&c.thought)continue;a=!0,i+=c.text}}return l.length>0&&console.warn(`there are non-text parts ${l} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),a?i:void 0}get data(){var e,t,o;let i="";const a=[];for(const l of(o=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&o!==void 0?o:[]){for(const[c,u]of Object.entries(l))c!=="inlineData"&&u!==null&&a.push(c);l.inlineData&&typeof l.inlineData.data=="string"&&(i+=atob(l.inlineData.data))}return a.length>0&&console.warn(`there are non-data parts ${a} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class hn{_fromAPIResponse({apiResponse:e,isVertexAI:t}){const o=new hn;if(o.name=e.name,o.metadata=e.metadata,o.done=e.done,o.error=e.error,t){const i=e.response;if(i){const a=new _r,l=i.videos;a.generatedVideos=l?.map(c=>({video:{uri:c.gcsUri,videoBytes:c.bytesBase64Encoded?io(c.bytesBase64Encoded):void 0,mimeType:c.mimeType}})),a.raiMediaFilteredCount=i.raiMediaFilteredCount,a.raiMediaFilteredReasons=i.raiMediaFilteredReasons,o.response=a}}else{const i=e.response;if(i){const a=new _r,l=i.generateVideoResponse,c=l?.generatedSamples;a.generatedVideos=c?.map(u=>{const d=u.video;return{video:{uri:d?.uri,videoBytes:d?.encodedVideo?io(d?.encodedVideo):void 0,mimeType:u.encoding}}}),a.raiMediaFilteredCount=l?.raiMediaFilteredCount,a.raiMediaFilteredReasons=l?.raiMediaFilteredReasons,o.response=a}}return o}}class Mc{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function V(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function Hs(n,e){const t=V(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function Bs(n){return Array.isArray(n)?n.map(e=>fn(e)):[fn(n)]}function fn(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function Fs(n){const e=fn(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Gs(n){const e=fn(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function br(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function qs(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>br(e)):[br(n)]}function ao(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function Nr(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function xr(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function de(n){if(n==null)throw new Error("ContentUnion is required");return ao(n)?n:{role:"user",parts:qs(n)}}function Vs(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const o=de(t);return o.parts&&o.parts.length>0&&o.parts[0].text!==void 0?[o.parts[0].text]:[]});if(n.isVertexAI()){const t=de(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>de(t)):[de(e)]}function Se(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(Nr(n)||xr(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[de(n)]}const e=[],t=[],o=ao(n[0]);for(const i of n){const a=ao(i);if(a!=o)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(a)e.push(i);else{if(Nr(i)||xr(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(i)}}return o||e.push({role:"user",parts:qs(t)}),e}function Pc(n,e){n.includes("null")&&(e.nullable=!0);const t=n.filter(o=>o!=="null");if(t.length===1)e.type=Object.values(b).includes(t[0].toUpperCase())?t[0].toUpperCase():b.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const o of t)e.anyOf.push({type:Object.values(b).includes(o.toUpperCase())?o.toUpperCase():b.TYPE_UNSPECIFIED})}}function pt(n){const e={},t=["items"],o=["anyOf"],i=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");const a=n.anyOf;a!=null&&a.length==2&&(a[0].type==="null"?(e.nullable=!0,n=a[1]):a[1].type==="null"&&(e.nullable=!0,n=a[0])),n.type instanceof Array&&Pc(n.type,e);for(const[l,c]of Object.entries(n))if(c!=null)if(l=="type"){if(c==="null")throw new Error("type: null can not be the only possible type for the field.");if(c instanceof Array)continue;e.type=Object.values(b).includes(c.toUpperCase())?c.toUpperCase():b.TYPE_UNSPECIFIED}else if(t.includes(l))e[l]=pt(c);else if(o.includes(l)){const u=[];for(const d of c){if(d.type=="null"){e.nullable=!0;continue}u.push(pt(d))}e[l]=u}else if(i.includes(l)){const u={};for(const[d,h]of Object.entries(c))u[d]=pt(h);e[l]=u}else{if(l==="additionalProperties")continue;e[l]=c}return e}function Ho(n){return pt(n)}function Bo(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function Fo(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function wt(n){if(n.functionDeclarations)for(const e of n.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=pt(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=pt(e.response));return n}function _t(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");const e=[];for(const t of n)e.push(t);return e}function bc(n,e,t,o=1){const i=!e.startsWith(`${t}/`)&&e.split("/").length===o;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:i?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:i?`${t}/${e}`:e}function Ve(n,e){if(typeof e!="string")throw new Error("name must be a string");return bc(n,e,"cachedContents")}function Ks(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function ot(n){return io(n)}function Nc(n){return n!=null&&typeof n=="object"&&"name"in n}function xc(n){return n!=null&&typeof n=="object"&&"video"in n}function Lc(n){return n!=null&&typeof n=="object"&&"uri"in n}function $s(n){var e;let t;if(Nc(n)&&(t=n.name),!(Lc(n)&&(t=n.uri,t===void 0))&&!(xc(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){const i=t.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${t}`);t=i[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function Js(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function zs(n){for(const e of["models","tunedModels","publisherModels"])if(Dc(n,e))return n[e];return[]}function Dc(n,e){return n!==null&&typeof n=="object"&&e in n}function Uc(n,e={}){const t=n,o={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return e.behavior&&(o.behavior=e.behavior),{functionDeclarations:[o]}}function Oc(n,e={}){const t=[],o=new Set;for(const i of n){const a=i.name;if(o.has(a))throw new Error(`Duplicate function name ${a} found in MCP tools. Please ensure function names are unique.`);o.add(a);const l=Uc(i,e);l.functionDeclarations&&t.push(...l.functionDeclarations)}return{functionDeclarations:t}}function Ys(n,e){if(typeof e!="string"&&!Array.isArray(e)){if(n&&n.isVertexAI()){if(e.gcsUri&&e.bigqueryUri)throw new Error("Only one of `gcsUri` or `bigqueryUri` can be set.");if(!e.gcsUri&&!e.bigqueryUri)throw new Error("One of `gcsUri` or `bigqueryUri` must be set.")}else{if(e.inlinedRequests&&e.fileName)throw new Error("Only one of `inlinedRequests` or `fileName` can be set.");if(!e.inlinedRequests&&!e.fileName)throw new Error("One of `inlinedRequests` or `fileName` must be set.")}return e}else{if(Array.isArray(e))return{inlinedRequests:e};if(typeof e=="string"){if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:[e]};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};if(e.startsWith("files/"))return{fileName:e}}}throw new Error(`Unsupported source: ${e}`)}function Hc(n){if(typeof n!="string")return n;const e=n;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function Rt(n,e){const t=e;if(!n.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function Ws(n){const e=n;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Bc(n){const e={},t=r(n,["fps"]);t!=null&&s(e,["fps"],t);const o=r(n,["endOffset"]);o!=null&&s(e,["endOffset"],o);const i=r(n,["startOffset"]);return i!=null&&s(e,["startOffset"],i),e}function Fc(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["data"]);t!=null&&s(e,["data"],t);const o=r(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function Gc(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["fileUri"]);t!=null&&s(e,["fileUri"],t);const o=r(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function qc(n){const e={},t=r(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],Bc(t));const o=r(n,["thought"]);o!=null&&s(e,["thought"],o);const i=r(n,["inlineData"]);i!=null&&s(e,["inlineData"],Fc(i));const a=r(n,["fileData"]);a!=null&&s(e,["fileData"],Gc(a));const l=r(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const c=r(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const u=r(n,["executableCode"]);u!=null&&s(e,["executableCode"],u);const d=r(n,["functionCall"]);d!=null&&s(e,["functionCall"],d);const h=r(n,["functionResponse"]);h!=null&&s(e,["functionResponse"],h);const f=r(n,["text"]);return f!=null&&s(e,["text"],f),e}function Qs(n){const e={},t=r(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>qc(a))),s(e,["parts"],i)}const o=r(n,["role"]);return o!=null&&s(e,["role"],o),e}function Vc(n){const e={},t=r(n,["anyOf"]);t!=null&&s(e,["anyOf"],t);const o=r(n,["default"]);o!=null&&s(e,["default"],o);const i=r(n,["description"]);i!=null&&s(e,["description"],i);const a=r(n,["enum"]);a!=null&&s(e,["enum"],a);const l=r(n,["example"]);l!=null&&s(e,["example"],l);const c=r(n,["format"]);c!=null&&s(e,["format"],c);const u=r(n,["items"]);u!=null&&s(e,["items"],u);const d=r(n,["maxItems"]);d!=null&&s(e,["maxItems"],d);const h=r(n,["maxLength"]);h!=null&&s(e,["maxLength"],h);const f=r(n,["maxProperties"]);f!=null&&s(e,["maxProperties"],f);const p=r(n,["maximum"]);p!=null&&s(e,["maximum"],p);const m=r(n,["minItems"]);m!=null&&s(e,["minItems"],m);const v=r(n,["minLength"]);v!=null&&s(e,["minLength"],v);const y=r(n,["minProperties"]);y!=null&&s(e,["minProperties"],y);const E=r(n,["minimum"]);E!=null&&s(e,["minimum"],E);const A=r(n,["nullable"]);A!=null&&s(e,["nullable"],A);const R=r(n,["pattern"]);R!=null&&s(e,["pattern"],R);const M=r(n,["properties"]);M!=null&&s(e,["properties"],M);const L=r(n,["propertyOrdering"]);L!=null&&s(e,["propertyOrdering"],L);const _=r(n,["required"]);_!=null&&s(e,["required"],_);const H=r(n,["title"]);H!=null&&s(e,["title"],H);const D=r(n,["type"]);return D!=null&&s(e,["type"],D),e}function Kc(n){const e={};if(r(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const t=r(n,["category"]);t!=null&&s(e,["category"],t);const o=r(n,["threshold"]);return o!=null&&s(e,["threshold"],o),e}function $c(n){const e={},t=r(n,["behavior"]);t!=null&&s(e,["behavior"],t);const o=r(n,["description"]);o!=null&&s(e,["description"],o);const i=r(n,["name"]);i!=null&&s(e,["name"],i);const a=r(n,["parameters"]);a!=null&&s(e,["parameters"],a);const l=r(n,["parametersJsonSchema"]);l!=null&&s(e,["parametersJsonSchema"],l);const c=r(n,["response"]);c!=null&&s(e,["response"],c);const u=r(n,["responseJsonSchema"]);return u!=null&&s(e,["responseJsonSchema"],u),e}function Jc(n){const e={},t=r(n,["startTime"]);t!=null&&s(e,["startTime"],t);const o=r(n,["endTime"]);return o!=null&&s(e,["endTime"],o),e}function zc(n){const e={},t=r(n,["timeRangeFilter"]);if(t!=null&&s(e,["timeRangeFilter"],Jc(t)),r(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function Yc(n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const o=r(n,["dynamicThreshold"]);return o!=null&&s(e,["dynamicThreshold"],o),e}function Wc(n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],Yc(t)),e}function Qc(){return{}}function Xc(n){const e={},t=r(n,["environment"]);return t!=null&&s(e,["environment"],t),e}function Zc(n){const e={},t=r(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(d=>$c(d))),s(e,["functionDeclarations"],u)}if(r(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const o=r(n,["googleSearch"]);o!=null&&s(e,["googleSearch"],zc(o));const i=r(n,["googleSearchRetrieval"]);if(i!=null&&s(e,["googleSearchRetrieval"],Wc(i)),r(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");r(n,["urlContext"])!=null&&s(e,["urlContext"],Qc());const l=r(n,["computerUse"]);l!=null&&s(e,["computerUse"],Xc(l));const c=r(n,["codeExecution"]);return c!=null&&s(e,["codeExecution"],c),e}function jc(n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const o=r(n,["allowedFunctionNames"]);return o!=null&&s(e,["allowedFunctionNames"],o),e}function ed(n){const e={},t=r(n,["latitude"]);t!=null&&s(e,["latitude"],t);const o=r(n,["longitude"]);return o!=null&&s(e,["longitude"],o),e}function td(n){const e={},t=r(n,["latLng"]);t!=null&&s(e,["latLng"],ed(t));const o=r(n,["languageCode"]);return o!=null&&s(e,["languageCode"],o),e}function nd(n){const e={},t=r(n,["functionCallingConfig"]);t!=null&&s(e,["functionCallingConfig"],jc(t));const o=r(n,["retrievalConfig"]);return o!=null&&s(e,["retrievalConfig"],td(o)),e}function od(n){const e={},t=r(n,["voiceName"]);return t!=null&&s(e,["voiceName"],t),e}function Xs(n){const e={},t=r(n,["prebuiltVoiceConfig"]);return t!=null&&s(e,["prebuiltVoiceConfig"],od(t)),e}function id(n){const e={},t=r(n,["speaker"]);t!=null&&s(e,["speaker"],t);const o=r(n,["voiceConfig"]);return o!=null&&s(e,["voiceConfig"],Xs(o)),e}function rd(n){const e={},t=r(n,["speakerVoiceConfigs"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(i=>id(i))),s(e,["speakerVoiceConfigs"],o)}return e}function sd(n){const e={},t=r(n,["voiceConfig"]);t!=null&&s(e,["voiceConfig"],Xs(t));const o=r(n,["multiSpeakerVoiceConfig"]);o!=null&&s(e,["multiSpeakerVoiceConfig"],rd(o));const i=r(n,["languageCode"]);return i!=null&&s(e,["languageCode"],i),e}function ad(n){const e={},t=r(n,["includeThoughts"]);t!=null&&s(e,["includeThoughts"],t);const o=r(n,["thinkingBudget"]);return o!=null&&s(e,["thinkingBudget"],o),e}function ld(n,e,t){const o={},i=r(e,["systemInstruction"]);t!==void 0&&i!=null&&s(t,["systemInstruction"],Qs(de(i)));const a=r(e,["temperature"]);a!=null&&s(o,["temperature"],a);const l=r(e,["topP"]);l!=null&&s(o,["topP"],l);const c=r(e,["topK"]);c!=null&&s(o,["topK"],c);const u=r(e,["candidateCount"]);u!=null&&s(o,["candidateCount"],u);const d=r(e,["maxOutputTokens"]);d!=null&&s(o,["maxOutputTokens"],d);const h=r(e,["stopSequences"]);h!=null&&s(o,["stopSequences"],h);const f=r(e,["responseLogprobs"]);f!=null&&s(o,["responseLogprobs"],f);const p=r(e,["logprobs"]);p!=null&&s(o,["logprobs"],p);const m=r(e,["presencePenalty"]);m!=null&&s(o,["presencePenalty"],m);const v=r(e,["frequencyPenalty"]);v!=null&&s(o,["frequencyPenalty"],v);const y=r(e,["seed"]);y!=null&&s(o,["seed"],y);const E=r(e,["responseMimeType"]);E!=null&&s(o,["responseMimeType"],E);const A=r(e,["responseSchema"]);A!=null&&s(o,["responseSchema"],Vc(Ho(A)));const R=r(e,["responseJsonSchema"]);if(R!=null&&s(o,["responseJsonSchema"],R),r(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(r(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const M=r(e,["safetySettings"]);if(t!==void 0&&M!=null){let q=M;Array.isArray(q)&&(q=q.map(he=>Kc(he))),s(t,["safetySettings"],q)}const L=r(e,["tools"]);if(t!==void 0&&L!=null){let q=_t(L);Array.isArray(q)&&(q=q.map(he=>Zc(wt(he)))),s(t,["tools"],q)}const _=r(e,["toolConfig"]);if(t!==void 0&&_!=null&&s(t,["toolConfig"],nd(_)),r(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const H=r(e,["cachedContent"]);t!==void 0&&H!=null&&s(t,["cachedContent"],Ve(n,H));const D=r(e,["responseModalities"]);D!=null&&s(o,["responseModalities"],D);const F=r(e,["mediaResolution"]);F!=null&&s(o,["mediaResolution"],F);const x=r(e,["speechConfig"]);if(x!=null&&s(o,["speechConfig"],sd(Bo(x))),r(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const $=r(e,["thinkingConfig"]);return $!=null&&s(o,["thinkingConfig"],ad($)),o}function cd(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["request","model"],V(n,o));const i=r(e,["contents"]);if(i!=null){let l=Se(i);Array.isArray(l)&&(l=l.map(c=>Qs(c))),s(t,["request","contents"],l)}const a=r(e,["config"]);return a!=null&&s(t,["request","generationConfig"],ld(n,a,t)),t}function dd(n,e){const t={};if(r(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(r(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(r(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const o=r(e,["fileName"]);o!=null&&s(t,["fileName"],o);const i=r(e,["inlinedRequests"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(l=>cd(n,l))),s(t,["requests","requests"],a)}return t}function ud(n,e){const t={},o=r(n,["displayName"]);if(e!==void 0&&o!=null&&s(e,["batch","displayName"],o),r(n,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function hd(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","model"],V(n,o));const i=r(e,["src"]);i!=null&&s(t,["batch","inputConfig"],dd(n,Ys(n,i)));const a=r(e,["config"]);return a!=null&&s(t,["config"],ud(a,t)),t}function fd(n,e){const t={},o=r(e,["name"]);o!=null&&s(t,["_url","name"],Rt(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],i),t}function gd(n,e){const t={},o=r(e,["name"]);o!=null&&s(t,["_url","name"],Rt(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],i),t}function pd(n,e){const t={},o=r(n,["pageSize"]);e!==void 0&&o!=null&&s(e,["_query","pageSize"],o);const i=r(n,["pageToken"]);if(e!==void 0&&i!=null&&s(e,["_query","pageToken"],i),r(n,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function md(n){const e={},t=r(n,["config"]);return t!=null&&s(e,["config"],pd(t,e)),e}function Cd(n,e){const t={},o=r(e,["name"]);o!=null&&s(t,["_url","name"],Rt(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],i),t}function yd(n){const e={},t=r(n,["format"]);t!=null&&s(e,["instancesFormat"],t);const o=r(n,["gcsUri"]);o!=null&&s(e,["gcsSource","uris"],o);const i=r(n,["bigqueryUri"]);if(i!=null&&s(e,["bigquerySource","inputUri"],i),r(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(r(n,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function Td(n){const e={},t=r(n,["format"]);t!=null&&s(e,["predictionsFormat"],t);const o=r(n,["gcsUri"]);o!=null&&s(e,["gcsDestination","outputUriPrefix"],o);const i=r(n,["bigqueryUri"]);if(i!=null&&s(e,["bigqueryDestination","outputUri"],i),r(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(r(n,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");return e}function vd(n,e){const t={},o=r(n,["displayName"]);e!==void 0&&o!=null&&s(e,["displayName"],o);const i=r(n,["dest"]);return e!==void 0&&i!=null&&s(e,["outputConfig"],Td(Hc(i))),t}function Id(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["model"],V(n,o));const i=r(e,["src"]);i!=null&&s(t,["inputConfig"],yd(Ys(n,i)));const a=r(e,["config"]);return a!=null&&s(t,["config"],vd(a,t)),t}function Ed(n,e){const t={},o=r(e,["name"]);o!=null&&s(t,["_url","name"],Rt(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],i),t}function Sd(n,e){const t={},o=r(e,["name"]);o!=null&&s(t,["_url","name"],Rt(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],i),t}function Ad(n,e){const t={},o=r(n,["pageSize"]);e!==void 0&&o!=null&&s(e,["_query","pageSize"],o);const i=r(n,["pageToken"]);e!==void 0&&i!=null&&s(e,["_query","pageToken"],i);const a=r(n,["filter"]);return e!==void 0&&a!=null&&s(e,["_query","filter"],a),t}function wd(n){const e={},t=r(n,["config"]);return t!=null&&s(e,["config"],Ad(t,e)),e}function _d(n,e){const t={},o=r(e,["name"]);o!=null&&s(t,["_url","name"],Rt(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],i),t}function Rd(n){const e={},t=r(n,["fps"]);t!=null&&s(e,["fps"],t);const o=r(n,["endOffset"]);o!=null&&s(e,["endOffset"],o);const i=r(n,["startOffset"]);return i!=null&&s(e,["startOffset"],i),e}function kd(n){const e={},t=r(n,["data"]);t!=null&&s(e,["data"],t);const o=r(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function Md(n){const e={},t=r(n,["fileUri"]);t!=null&&s(e,["fileUri"],t);const o=r(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function Pd(n){const e={},t=r(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],Rd(t));const o=r(n,["thought"]);o!=null&&s(e,["thought"],o);const i=r(n,["inlineData"]);i!=null&&s(e,["inlineData"],kd(i));const a=r(n,["fileData"]);a!=null&&s(e,["fileData"],Md(a));const l=r(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const c=r(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const u=r(n,["executableCode"]);u!=null&&s(e,["executableCode"],u);const d=r(n,["functionCall"]);d!=null&&s(e,["functionCall"],d);const h=r(n,["functionResponse"]);h!=null&&s(e,["functionResponse"],h);const f=r(n,["text"]);return f!=null&&s(e,["text"],f),e}function bd(n){const e={},t=r(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Pd(a))),s(e,["parts"],i)}const o=r(n,["role"]);return o!=null&&s(e,["role"],o),e}function Nd(n){const e={},t=r(n,["citationSources"]);return t!=null&&s(e,["citations"],t),e}function xd(n){const e={},t=r(n,["retrievedUrl"]);t!=null&&s(e,["retrievedUrl"],t);const o=r(n,["urlRetrievalStatus"]);return o!=null&&s(e,["urlRetrievalStatus"],o),e}function Ld(n){const e={},t=r(n,["urlMetadata"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(i=>xd(i))),s(e,["urlMetadata"],o)}return e}function Dd(n){const e={},t=r(n,["content"]);t!=null&&s(e,["content"],bd(t));const o=r(n,["citationMetadata"]);o!=null&&s(e,["citationMetadata"],Nd(o));const i=r(n,["tokenCount"]);i!=null&&s(e,["tokenCount"],i);const a=r(n,["finishReason"]);a!=null&&s(e,["finishReason"],a);const l=r(n,["urlContextMetadata"]);l!=null&&s(e,["urlContextMetadata"],Ld(l));const c=r(n,["avgLogprobs"]);c!=null&&s(e,["avgLogprobs"],c);const u=r(n,["groundingMetadata"]);u!=null&&s(e,["groundingMetadata"],u);const d=r(n,["index"]);d!=null&&s(e,["index"],d);const h=r(n,["logprobsResult"]);h!=null&&s(e,["logprobsResult"],h);const f=r(n,["safetyRatings"]);return f!=null&&s(e,["safetyRatings"],f),e}function Ud(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["candidates"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(d=>Dd(d))),s(e,["candidates"],u)}const i=r(n,["modelVersion"]);i!=null&&s(e,["modelVersion"],i);const a=r(n,["promptFeedback"]);a!=null&&s(e,["promptFeedback"],a);const l=r(n,["responseId"]);l!=null&&s(e,["responseId"],l);const c=r(n,["usageMetadata"]);return c!=null&&s(e,["usageMetadata"],c),e}function Zs(n){const e={},t=r(n,["details"]);t!=null&&s(e,["details"],t);const o=r(n,["code"]);o!=null&&s(e,["code"],o);const i=r(n,["message"]);return i!=null&&s(e,["message"],i),e}function Od(n){const e={},t=r(n,["response"]);t!=null&&s(e,["response"],Ud(t));const o=r(n,["error"]);return o!=null&&s(e,["error"],Zs(o)),e}function Hd(n){const e={},t=r(n,["responsesFile"]);t!=null&&s(e,["fileName"],t);const o=r(n,["inlinedResponses","inlinedResponses"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(a=>Od(a))),s(e,["inlinedResponses"],i)}return e}function lo(n){const e={},t=r(n,["name"]);t!=null&&s(e,["name"],t);const o=r(n,["metadata","displayName"]);o!=null&&s(e,["displayName"],o);const i=r(n,["metadata","state"]);i!=null&&s(e,["state"],Ws(i));const a=r(n,["metadata","createTime"]);a!=null&&s(e,["createTime"],a);const l=r(n,["metadata","endTime"]);l!=null&&s(e,["endTime"],l);const c=r(n,["metadata","updateTime"]);c!=null&&s(e,["updateTime"],c);const u=r(n,["metadata","model"]);u!=null&&s(e,["model"],u);const d=r(n,["metadata","output"]);return d!=null&&s(e,["dest"],Hd(d)),e}function Bd(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["nextPageToken"]);o!=null&&s(e,["nextPageToken"],o);const i=r(n,["operations"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(l=>lo(l))),s(e,["batchJobs"],a)}return e}function Fd(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["name"]);o!=null&&s(e,["name"],o);const i=r(n,["done"]);i!=null&&s(e,["done"],i);const a=r(n,["error"]);return a!=null&&s(e,["error"],Zs(a)),e}function js(n){const e={},t=r(n,["details"]);t!=null&&s(e,["details"],t);const o=r(n,["code"]);o!=null&&s(e,["code"],o);const i=r(n,["message"]);return i!=null&&s(e,["message"],i),e}function Gd(n){const e={},t=r(n,["instancesFormat"]);t!=null&&s(e,["format"],t);const o=r(n,["gcsSource","uris"]);o!=null&&s(e,["gcsUri"],o);const i=r(n,["bigquerySource","inputUri"]);return i!=null&&s(e,["bigqueryUri"],i),e}function qd(n){const e={},t=r(n,["predictionsFormat"]);t!=null&&s(e,["format"],t);const o=r(n,["gcsDestination","outputUriPrefix"]);o!=null&&s(e,["gcsUri"],o);const i=r(n,["bigqueryDestination","outputUri"]);return i!=null&&s(e,["bigqueryUri"],i),e}function co(n){const e={},t=r(n,["name"]);t!=null&&s(e,["name"],t);const o=r(n,["displayName"]);o!=null&&s(e,["displayName"],o);const i=r(n,["state"]);i!=null&&s(e,["state"],Ws(i));const a=r(n,["error"]);a!=null&&s(e,["error"],js(a));const l=r(n,["createTime"]);l!=null&&s(e,["createTime"],l);const c=r(n,["startTime"]);c!=null&&s(e,["startTime"],c);const u=r(n,["endTime"]);u!=null&&s(e,["endTime"],u);const d=r(n,["updateTime"]);d!=null&&s(e,["updateTime"],d);const h=r(n,["model"]);h!=null&&s(e,["model"],h);const f=r(n,["inputConfig"]);f!=null&&s(e,["src"],Gd(f));const p=r(n,["outputConfig"]);return p!=null&&s(e,["dest"],qd(p)),e}function Vd(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["nextPageToken"]);o!=null&&s(e,["nextPageToken"],o);const i=r(n,["batchPredictionJobs"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(l=>co(l))),s(e,["batchJobs"],a)}return e}function Kd(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["name"]);o!=null&&s(e,["name"],o);const i=r(n,["done"]);i!=null&&s(e,["done"],i);const a=r(n,["error"]);return a!=null&&s(e,["error"],js(a)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Xe;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(Xe||(Xe={}));class Kt{constructor(e,t,o,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,o,i)}init(e,t,o){var i,a;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t?.sdkHttpResponse,this.idxInternal=0;let l={config:{}};!o||Object.keys(o).length===0?l={config:{}}:typeof o=="object"?l=Object.assign({},o):l=o,l.config&&(l.config.pageToken=t.nextPageToken),this.paramsInternal=l,this.pageInternalSize=(a=(i=l.config)===null||i===void 0?void 0:i.pageSize)!==null&&a!==void 0?a:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class $d extends nt{constructor(e){super(),this.apiClient=e,this.create=async t=>{if(this.apiClient.isVertexAI()){const i=Date.now().toString();if(Array.isArray(t.src))throw new Error("InlinedRequest[] is not supported in Vertex AI. Please use Google Cloud Storage URI or BigQuery URI instead.");if(t.config=t.config||{},t.config.displayName===void 0&&(t.config.displayName="genaiBatchJob_${timestampStr}"),t.config.dest===void 0&&typeof t.src=="string")if(t.src.startsWith("gs://")&&t.src.endsWith(".jsonl"))t.config.dest=`${t.src.slice(0,-6)}/dest`;else if(t.src.startsWith("bq://"))t.config.dest=`${t.src}_dest_${i}`;else throw new Error("Unsupported source:"+t.src)}return await this.createInternal(t)},this.list=async(t={})=>new Kt(Xe.PAGED_ITEM_BATCH_JOBS,o=>this.listInternal(o),await this.listInternal(t),t)}async createInternal(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=Id(this.apiClient,e);return c=P("batchPredictionJobs",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l.then(h=>co(h))}else{const d=hd(this.apiClient,e);return c=P("{model}:batchGenerateContent",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),l.then(h=>lo(h))}}async get(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=Ed(this.apiClient,e);return c=P("batchPredictionJobs/{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l.then(h=>co(h))}else{const d=fd(this.apiClient,e);return c=P("batches/{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),l.then(h=>lo(h))}}async cancel(e){var t,o,i,a;let l="",c={};if(this.apiClient.isVertexAI()){const u=Sd(this.apiClient,e);l=P("batchPredictionJobs/{name}:cancel",u._url),c=u._query,delete u.config,delete u._url,delete u._query,await this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}else{const u=gd(this.apiClient,e);l=P("batches/{name}:cancel",u._url),c=u._query,delete u.config,delete u._url,delete u._query,await this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal})}}async listInternal(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=wd(e);return c=P("batchPredictionJobs",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>{const f=Vd(h),p=new Pr;return Object.assign(p,f),p})}else{const d=md(e);return c=P("batches",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>{const f=Bd(h),p=new Pr;return Object.assign(p,f),p})}}async delete(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=_d(this.apiClient,e);return c=P("batchPredictionJobs/{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>Kd(h))}else{const d=Cd(this.apiClient,e);return c=P("batches/{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>Fd(h))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Jd(n){const e={},t=r(n,["fps"]);t!=null&&s(e,["fps"],t);const o=r(n,["endOffset"]);o!=null&&s(e,["endOffset"],o);const i=r(n,["startOffset"]);return i!=null&&s(e,["startOffset"],i),e}function zd(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["data"]);t!=null&&s(e,["data"],t);const o=r(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function Yd(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["fileUri"]);t!=null&&s(e,["fileUri"],t);const o=r(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function Wd(n){const e={},t=r(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],Jd(t));const o=r(n,["thought"]);o!=null&&s(e,["thought"],o);const i=r(n,["inlineData"]);i!=null&&s(e,["inlineData"],zd(i));const a=r(n,["fileData"]);a!=null&&s(e,["fileData"],Yd(a));const l=r(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const c=r(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const u=r(n,["executableCode"]);u!=null&&s(e,["executableCode"],u);const d=r(n,["functionCall"]);d!=null&&s(e,["functionCall"],d);const h=r(n,["functionResponse"]);h!=null&&s(e,["functionResponse"],h);const f=r(n,["text"]);return f!=null&&s(e,["text"],f),e}function Lr(n){const e={},t=r(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Wd(a))),s(e,["parts"],i)}const o=r(n,["role"]);return o!=null&&s(e,["role"],o),e}function Qd(n){const e={},t=r(n,["behavior"]);t!=null&&s(e,["behavior"],t);const o=r(n,["description"]);o!=null&&s(e,["description"],o);const i=r(n,["name"]);i!=null&&s(e,["name"],i);const a=r(n,["parameters"]);a!=null&&s(e,["parameters"],a);const l=r(n,["parametersJsonSchema"]);l!=null&&s(e,["parametersJsonSchema"],l);const c=r(n,["response"]);c!=null&&s(e,["response"],c);const u=r(n,["responseJsonSchema"]);return u!=null&&s(e,["responseJsonSchema"],u),e}function Xd(n){const e={},t=r(n,["startTime"]);t!=null&&s(e,["startTime"],t);const o=r(n,["endTime"]);return o!=null&&s(e,["endTime"],o),e}function Zd(n){const e={},t=r(n,["timeRangeFilter"]);if(t!=null&&s(e,["timeRangeFilter"],Xd(t)),r(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function jd(n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const o=r(n,["dynamicThreshold"]);return o!=null&&s(e,["dynamicThreshold"],o),e}function eu(n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],jd(t)),e}function tu(){return{}}function nu(n){const e={},t=r(n,["environment"]);return t!=null&&s(e,["environment"],t),e}function ou(n){const e={},t=r(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(d=>Qd(d))),s(e,["functionDeclarations"],u)}if(r(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const o=r(n,["googleSearch"]);o!=null&&s(e,["googleSearch"],Zd(o));const i=r(n,["googleSearchRetrieval"]);if(i!=null&&s(e,["googleSearchRetrieval"],eu(i)),r(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");r(n,["urlContext"])!=null&&s(e,["urlContext"],tu());const l=r(n,["computerUse"]);l!=null&&s(e,["computerUse"],nu(l));const c=r(n,["codeExecution"]);return c!=null&&s(e,["codeExecution"],c),e}function iu(n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const o=r(n,["allowedFunctionNames"]);return o!=null&&s(e,["allowedFunctionNames"],o),e}function ru(n){const e={},t=r(n,["latitude"]);t!=null&&s(e,["latitude"],t);const o=r(n,["longitude"]);return o!=null&&s(e,["longitude"],o),e}function su(n){const e={},t=r(n,["latLng"]);t!=null&&s(e,["latLng"],ru(t));const o=r(n,["languageCode"]);return o!=null&&s(e,["languageCode"],o),e}function au(n){const e={},t=r(n,["functionCallingConfig"]);t!=null&&s(e,["functionCallingConfig"],iu(t));const o=r(n,["retrievalConfig"]);return o!=null&&s(e,["retrievalConfig"],su(o)),e}function lu(n,e){const t={},o=r(n,["ttl"]);e!==void 0&&o!=null&&s(e,["ttl"],o);const i=r(n,["expireTime"]);e!==void 0&&i!=null&&s(e,["expireTime"],i);const a=r(n,["displayName"]);e!==void 0&&a!=null&&s(e,["displayName"],a);const l=r(n,["contents"]);if(e!==void 0&&l!=null){let h=Se(l);Array.isArray(h)&&(h=h.map(f=>Lr(f))),s(e,["contents"],h)}const c=r(n,["systemInstruction"]);e!==void 0&&c!=null&&s(e,["systemInstruction"],Lr(de(c)));const u=r(n,["tools"]);if(e!==void 0&&u!=null){let h=u;Array.isArray(h)&&(h=h.map(f=>ou(f))),s(e,["tools"],h)}const d=r(n,["toolConfig"]);if(e!==void 0&&d!=null&&s(e,["toolConfig"],au(d)),r(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function cu(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["model"],Hs(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],lu(i,t)),t}function du(n,e){const t={},o=r(e,["name"]);o!=null&&s(t,["_url","name"],Ve(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],i),t}function uu(n,e){const t={},o=r(e,["name"]);o!=null&&s(t,["_url","name"],Ve(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],i),t}function hu(n,e){const t={},o=r(n,["ttl"]);e!==void 0&&o!=null&&s(e,["ttl"],o);const i=r(n,["expireTime"]);return e!==void 0&&i!=null&&s(e,["expireTime"],i),t}function fu(n,e){const t={},o=r(e,["name"]);o!=null&&s(t,["_url","name"],Ve(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],hu(i,t)),t}function gu(n,e){const t={},o=r(n,["pageSize"]);e!==void 0&&o!=null&&s(e,["_query","pageSize"],o);const i=r(n,["pageToken"]);return e!==void 0&&i!=null&&s(e,["_query","pageToken"],i),t}function pu(n){const e={},t=r(n,["config"]);return t!=null&&s(e,["config"],gu(t,e)),e}function mu(n){const e={},t=r(n,["fps"]);t!=null&&s(e,["fps"],t);const o=r(n,["endOffset"]);o!=null&&s(e,["endOffset"],o);const i=r(n,["startOffset"]);return i!=null&&s(e,["startOffset"],i),e}function Cu(n){const e={},t=r(n,["displayName"]);t!=null&&s(e,["displayName"],t);const o=r(n,["data"]);o!=null&&s(e,["data"],o);const i=r(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function yu(n){const e={},t=r(n,["displayName"]);t!=null&&s(e,["displayName"],t);const o=r(n,["fileUri"]);o!=null&&s(e,["fileUri"],o);const i=r(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Tu(n){const e={},t=r(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],mu(t));const o=r(n,["thought"]);o!=null&&s(e,["thought"],o);const i=r(n,["inlineData"]);i!=null&&s(e,["inlineData"],Cu(i));const a=r(n,["fileData"]);a!=null&&s(e,["fileData"],yu(a));const l=r(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const c=r(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const u=r(n,["executableCode"]);u!=null&&s(e,["executableCode"],u);const d=r(n,["functionCall"]);d!=null&&s(e,["functionCall"],d);const h=r(n,["functionResponse"]);h!=null&&s(e,["functionResponse"],h);const f=r(n,["text"]);return f!=null&&s(e,["text"],f),e}function Dr(n){const e={},t=r(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Tu(a))),s(e,["parts"],i)}const o=r(n,["role"]);return o!=null&&s(e,["role"],o),e}function vu(n){const e={};if(r(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=r(n,["description"]);t!=null&&s(e,["description"],t);const o=r(n,["name"]);o!=null&&s(e,["name"],o);const i=r(n,["parameters"]);i!=null&&s(e,["parameters"],i);const a=r(n,["parametersJsonSchema"]);a!=null&&s(e,["parametersJsonSchema"],a);const l=r(n,["response"]);l!=null&&s(e,["response"],l);const c=r(n,["responseJsonSchema"]);return c!=null&&s(e,["responseJsonSchema"],c),e}function Iu(n){const e={},t=r(n,["startTime"]);t!=null&&s(e,["startTime"],t);const o=r(n,["endTime"]);return o!=null&&s(e,["endTime"],o),e}function Eu(n){const e={},t=r(n,["timeRangeFilter"]);t!=null&&s(e,["timeRangeFilter"],Iu(t));const o=r(n,["excludeDomains"]);return o!=null&&s(e,["excludeDomains"],o),e}function Su(n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const o=r(n,["dynamicThreshold"]);return o!=null&&s(e,["dynamicThreshold"],o),e}function Au(n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],Su(t)),e}function wu(n){const e={},t=r(n,["excludeDomains"]);return t!=null&&s(e,["excludeDomains"],t),e}function _u(n){const e={},t=r(n,["apiKeyString"]);return t!=null&&s(e,["apiKeyString"],t),e}function Ru(n){const e={},t=r(n,["apiKeyConfig"]);t!=null&&s(e,["apiKeyConfig"],_u(t));const o=r(n,["authType"]);o!=null&&s(e,["authType"],o);const i=r(n,["googleServiceAccountConfig"]);i!=null&&s(e,["googleServiceAccountConfig"],i);const a=r(n,["httpBasicAuthConfig"]);a!=null&&s(e,["httpBasicAuthConfig"],a);const l=r(n,["oauthConfig"]);l!=null&&s(e,["oauthConfig"],l);const c=r(n,["oidcConfig"]);return c!=null&&s(e,["oidcConfig"],c),e}function ku(n){const e={},t=r(n,["authConfig"]);return t!=null&&s(e,["authConfig"],Ru(t)),e}function Mu(){return{}}function Pu(n){const e={},t=r(n,["environment"]);return t!=null&&s(e,["environment"],t),e}function bu(n){const e={},t=r(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>vu(p))),s(e,["functionDeclarations"],f)}const o=r(n,["retrieval"]);o!=null&&s(e,["retrieval"],o);const i=r(n,["googleSearch"]);i!=null&&s(e,["googleSearch"],Eu(i));const a=r(n,["googleSearchRetrieval"]);a!=null&&s(e,["googleSearchRetrieval"],Au(a));const l=r(n,["enterpriseWebSearch"]);l!=null&&s(e,["enterpriseWebSearch"],wu(l));const c=r(n,["googleMaps"]);c!=null&&s(e,["googleMaps"],ku(c)),r(n,["urlContext"])!=null&&s(e,["urlContext"],Mu());const d=r(n,["computerUse"]);d!=null&&s(e,["computerUse"],Pu(d));const h=r(n,["codeExecution"]);return h!=null&&s(e,["codeExecution"],h),e}function Nu(n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const o=r(n,["allowedFunctionNames"]);return o!=null&&s(e,["allowedFunctionNames"],o),e}function xu(n){const e={},t=r(n,["latitude"]);t!=null&&s(e,["latitude"],t);const o=r(n,["longitude"]);return o!=null&&s(e,["longitude"],o),e}function Lu(n){const e={},t=r(n,["latLng"]);t!=null&&s(e,["latLng"],xu(t));const o=r(n,["languageCode"]);return o!=null&&s(e,["languageCode"],o),e}function Du(n){const e={},t=r(n,["functionCallingConfig"]);t!=null&&s(e,["functionCallingConfig"],Nu(t));const o=r(n,["retrievalConfig"]);return o!=null&&s(e,["retrievalConfig"],Lu(o)),e}function Uu(n,e){const t={},o=r(n,["ttl"]);e!==void 0&&o!=null&&s(e,["ttl"],o);const i=r(n,["expireTime"]);e!==void 0&&i!=null&&s(e,["expireTime"],i);const a=r(n,["displayName"]);e!==void 0&&a!=null&&s(e,["displayName"],a);const l=r(n,["contents"]);if(e!==void 0&&l!=null){let f=Se(l);Array.isArray(f)&&(f=f.map(p=>Dr(p))),s(e,["contents"],f)}const c=r(n,["systemInstruction"]);e!==void 0&&c!=null&&s(e,["systemInstruction"],Dr(de(c)));const u=r(n,["tools"]);if(e!==void 0&&u!=null){let f=u;Array.isArray(f)&&(f=f.map(p=>bu(p))),s(e,["tools"],f)}const d=r(n,["toolConfig"]);e!==void 0&&d!=null&&s(e,["toolConfig"],Du(d));const h=r(n,["kmsKeyName"]);return e!==void 0&&h!=null&&s(e,["encryption_spec","kmsKeyName"],h),t}function Ou(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["model"],Hs(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],Uu(i,t)),t}function Hu(n,e){const t={},o=r(e,["name"]);o!=null&&s(t,["_url","name"],Ve(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],i),t}function Bu(n,e){const t={},o=r(e,["name"]);o!=null&&s(t,["_url","name"],Ve(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],i),t}function Fu(n,e){const t={},o=r(n,["ttl"]);e!==void 0&&o!=null&&s(e,["ttl"],o);const i=r(n,["expireTime"]);return e!==void 0&&i!=null&&s(e,["expireTime"],i),t}function Gu(n,e){const t={},o=r(e,["name"]);o!=null&&s(t,["_url","name"],Ve(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],Fu(i,t)),t}function qu(n,e){const t={},o=r(n,["pageSize"]);e!==void 0&&o!=null&&s(e,["_query","pageSize"],o);const i=r(n,["pageToken"]);return e!==void 0&&i!=null&&s(e,["_query","pageToken"],i),t}function Vu(n){const e={},t=r(n,["config"]);return t!=null&&s(e,["config"],qu(t,e)),e}function cn(n){const e={},t=r(n,["name"]);t!=null&&s(e,["name"],t);const o=r(n,["displayName"]);o!=null&&s(e,["displayName"],o);const i=r(n,["model"]);i!=null&&s(e,["model"],i);const a=r(n,["createTime"]);a!=null&&s(e,["createTime"],a);const l=r(n,["updateTime"]);l!=null&&s(e,["updateTime"],l);const c=r(n,["expireTime"]);c!=null&&s(e,["expireTime"],c);const u=r(n,["usageMetadata"]);return u!=null&&s(e,["usageMetadata"],u),e}function Ku(){return{}}function $u(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["nextPageToken"]);o!=null&&s(e,["nextPageToken"],o);const i=r(n,["cachedContents"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(l=>cn(l))),s(e,["cachedContents"],a)}return e}function dn(n){const e={},t=r(n,["name"]);t!=null&&s(e,["name"],t);const o=r(n,["displayName"]);o!=null&&s(e,["displayName"],o);const i=r(n,["model"]);i!=null&&s(e,["model"],i);const a=r(n,["createTime"]);a!=null&&s(e,["createTime"],a);const l=r(n,["updateTime"]);l!=null&&s(e,["updateTime"],l);const c=r(n,["expireTime"]);c!=null&&s(e,["expireTime"],c);const u=r(n,["usageMetadata"]);return u!=null&&s(e,["usageMetadata"],u),e}function Ju(){return{}}function zu(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["nextPageToken"]);o!=null&&s(e,["nextPageToken"],o);const i=r(n,["cachedContents"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(l=>dn(l))),s(e,["cachedContents"],a)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Yu extends nt{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Kt(Xe.PAGED_ITEM_CACHED_CONTENTS,o=>this.listInternal(o),await this.listInternal(t),t)}async create(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=Ou(this.apiClient,e);return c=P("cachedContents",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l.then(h=>dn(h))}else{const d=cu(this.apiClient,e);return c=P("cachedContents",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),l.then(h=>cn(h))}}async get(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=Hu(this.apiClient,e);return c=P("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l.then(h=>dn(h))}else{const d=du(this.apiClient,e);return c=P("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),l.then(h=>cn(h))}}async delete(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=Bu(this.apiClient,e);return c=P("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l.then(()=>{const h=Ju(),f=new kr;return Object.assign(f,h),f})}else{const d=uu(this.apiClient,e);return c=P("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),l.then(()=>{const h=Ku(),f=new kr;return Object.assign(f,h),f})}}async update(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=Gu(this.apiClient,e);return c=P("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l.then(h=>dn(h))}else{const d=fu(this.apiClient,e);return c=P("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),l.then(h=>cn(h))}}async listInternal(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=Vu(e);return c=P("cachedContents",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>{const f=zu(h),p=new Mr;return Object.assign(p,f),p})}else{const d=pu(e);return c=P("cachedContents",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>{const f=$u(h),p=new Mr;return Object.assign(p,f),p})}}}function Ur(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],o=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&o>=n.length&&(n=void 0),{value:n&&n[o++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function W(n){return this instanceof W?(this.v=n,this):new W(n)}function mt(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=t.apply(n,e||[]),i,a=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",l),i[Symbol.asyncIterator]=function(){return this},i;function l(m){return function(v){return Promise.resolve(v).then(m,f)}}function c(m,v){o[m]&&(i[m]=function(y){return new Promise(function(E,A){a.push([m,y,E,A])>1||u(m,y)})},v&&(i[m]=v(i[m])))}function u(m,v){try{d(o[m](v))}catch(y){p(a[0][3],y)}}function d(m){m.value instanceof W?Promise.resolve(m.value.v).then(h,f):p(a[0][2],m)}function h(m){u("next",m)}function f(m){u("throw",m)}function p(m,v){m(v),a.shift(),a.length&&u(a[0][0],a[0][1])}}function Ut(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Ur=="function"?Ur(n):n[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(a){t[a]=n[a]&&function(l){return new Promise(function(c,u){l=n[a](l),i(c,u,l.done,l.value)})}}function i(a,l,c,u){Promise.resolve(u).then(function(d){a({value:d,done:c})},l)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Wu(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:ea(t)}function ea(n){if(n.parts===void 0||n.parts.length===0)return!1;for(const e of n.parts)if(e===void 0||Object.keys(e).length===0||!e.thought&&e.text!==void 0&&e.text==="")return!1;return!0}function Qu(n){if(n.length!==0){for(const e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Or(n){if(n===void 0||n.length===0)return[];const e=[],t=n.length;let o=0;for(;o<t;)if(n[o].role==="user")e.push(n[o]),o++;else{const i=[];let a=!0;for(;o<t&&n[o].role==="model";)i.push(n[o]),a&&!ea(n[o])&&(a=!1),o++;a?e.push(...i):e.pop()}return e}class Xu{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new Zu(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class Zu{constructor(e,t,o,i={},a=[]){this.apiClient=e,this.modelsModule=t,this.model=o,this.config=i,this.history=a,this.sendPromise=Promise.resolve(),Qu(a)}async sendMessage(e){var t;await this.sendPromise;const o=de(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(o),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var a,l,c;const u=await i,d=(l=(a=u.candidates)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.content,h=u.automaticFunctionCallingHistory,f=this.getHistory(!0).length;let p=[];h!=null&&(p=(c=h.slice(f))!==null&&c!==void 0?c:[]);const m=d?[d]:[];this.recordHistory(o,m,p)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var t;await this.sendPromise;const o=de(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(o),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const a=await i;return this.processStreamResponse(a,o)}getHistory(e=!1){const t=e?Or(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){var o,i;return mt(this,arguments,function*(){var l,c,u,d;const h=[];try{for(var f=!0,p=Ut(e),m;m=yield W(p.next()),l=m.done,!l;f=!0){d=m.value,f=!1;const v=d;if(Wu(v)){const y=(i=(o=v.candidates)===null||o===void 0?void 0:o[0])===null||i===void 0?void 0:i.content;y!==void 0&&h.push(y)}yield yield W(v)}}catch(v){c={error:v}}finally{try{!f&&!l&&(u=p.return)&&(yield W(u.call(p)))}finally{if(c)throw c.error}}this.recordHistory(t,h)})}recordHistory(e,t,o){let i=[];t.length>0&&t.every(a=>a.role!==void 0)?i=t:i.push({role:"model",parts:[]}),o&&o.length>0?this.history.push(...Or(o)):this.history.push(e),this.history.push(...i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Rn extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Rn.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ju(n,e){const t={},o=r(n,["pageSize"]);e!==void 0&&o!=null&&s(e,["_query","pageSize"],o);const i=r(n,["pageToken"]);return e!==void 0&&i!=null&&s(e,["_query","pageToken"],i),t}function eh(n){const e={},t=r(n,["config"]);return t!=null&&s(e,["config"],ju(t,e)),e}function th(n){const e={},t=r(n,["details"]);t!=null&&s(e,["details"],t);const o=r(n,["message"]);o!=null&&s(e,["message"],o);const i=r(n,["code"]);return i!=null&&s(e,["code"],i),e}function nh(n){const e={},t=r(n,["name"]);t!=null&&s(e,["name"],t);const o=r(n,["displayName"]);o!=null&&s(e,["displayName"],o);const i=r(n,["mimeType"]);i!=null&&s(e,["mimeType"],i);const a=r(n,["sizeBytes"]);a!=null&&s(e,["sizeBytes"],a);const l=r(n,["createTime"]);l!=null&&s(e,["createTime"],l);const c=r(n,["expirationTime"]);c!=null&&s(e,["expirationTime"],c);const u=r(n,["updateTime"]);u!=null&&s(e,["updateTime"],u);const d=r(n,["sha256Hash"]);d!=null&&s(e,["sha256Hash"],d);const h=r(n,["uri"]);h!=null&&s(e,["uri"],h);const f=r(n,["downloadUri"]);f!=null&&s(e,["downloadUri"],f);const p=r(n,["state"]);p!=null&&s(e,["state"],p);const m=r(n,["source"]);m!=null&&s(e,["source"],m);const v=r(n,["videoMetadata"]);v!=null&&s(e,["videoMetadata"],v);const y=r(n,["error"]);return y!=null&&s(e,["error"],th(y)),e}function oh(n){const e={},t=r(n,["file"]);t!=null&&s(e,["file"],nh(t));const o=r(n,["config"]);return o!=null&&s(e,["config"],o),e}function ih(n){const e={},t=r(n,["name"]);t!=null&&s(e,["_url","file"],$s(t));const o=r(n,["config"]);return o!=null&&s(e,["config"],o),e}function rh(n){const e={},t=r(n,["name"]);t!=null&&s(e,["_url","file"],$s(t));const o=r(n,["config"]);return o!=null&&s(e,["config"],o),e}function sh(n){const e={},t=r(n,["details"]);t!=null&&s(e,["details"],t);const o=r(n,["message"]);o!=null&&s(e,["message"],o);const i=r(n,["code"]);return i!=null&&s(e,["code"],i),e}function uo(n){const e={},t=r(n,["name"]);t!=null&&s(e,["name"],t);const o=r(n,["displayName"]);o!=null&&s(e,["displayName"],o);const i=r(n,["mimeType"]);i!=null&&s(e,["mimeType"],i);const a=r(n,["sizeBytes"]);a!=null&&s(e,["sizeBytes"],a);const l=r(n,["createTime"]);l!=null&&s(e,["createTime"],l);const c=r(n,["expirationTime"]);c!=null&&s(e,["expirationTime"],c);const u=r(n,["updateTime"]);u!=null&&s(e,["updateTime"],u);const d=r(n,["sha256Hash"]);d!=null&&s(e,["sha256Hash"],d);const h=r(n,["uri"]);h!=null&&s(e,["uri"],h);const f=r(n,["downloadUri"]);f!=null&&s(e,["downloadUri"],f);const p=r(n,["state"]);p!=null&&s(e,["state"],p);const m=r(n,["source"]);m!=null&&s(e,["source"],m);const v=r(n,["videoMetadata"]);v!=null&&s(e,["videoMetadata"],v);const y=r(n,["error"]);return y!=null&&s(e,["error"],sh(y)),e}function ah(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["nextPageToken"]);o!=null&&s(e,["nextPageToken"],o);const i=r(n,["files"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(l=>uo(l))),s(e,["files"],a)}return e}function lh(n){const e={},t=r(n,["sdkHttpResponse"]);return t!=null&&s(e,["sdkHttpResponse"],t),e}function ch(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class dh extends nt{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Kt(Xe.PAGED_ITEM_FILES,o=>this.listInternal(o),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>uo(t))}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,o;let i,a="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=eh(e);return a=P("files",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:u.headers},h})),i.then(u=>{const d=ah(u),h=new wc;return Object.assign(h,d),h})}}async createInternal(e){var t,o;let i,a="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=oh(e);return a=P("upload/v1beta/files",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json()),i.then(u=>{const d=lh(u),h=new _c;return Object.assign(h,d),h})}}async get(e){var t,o;let i,a="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=ih(e);return a=P("files/{file}",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json()),i.then(u=>uo(u))}}async delete(e){var t,o;let i,a="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=rh(e);return a=P("files/{file}",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json()),i.then(()=>{const u=ch(),d=new Rc;return Object.assign(d,u),d})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function uh(n){const e={},t=r(n,["voiceName"]);return t!=null&&s(e,["voiceName"],t),e}function ta(n){const e={},t=r(n,["prebuiltVoiceConfig"]);return t!=null&&s(e,["prebuiltVoiceConfig"],uh(t)),e}function hh(n){const e={},t=r(n,["speaker"]);t!=null&&s(e,["speaker"],t);const o=r(n,["voiceConfig"]);return o!=null&&s(e,["voiceConfig"],ta(o)),e}function fh(n){const e={},t=r(n,["speakerVoiceConfigs"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(i=>hh(i))),s(e,["speakerVoiceConfigs"],o)}return e}function gh(n){const e={},t=r(n,["voiceConfig"]);t!=null&&s(e,["voiceConfig"],ta(t));const o=r(n,["multiSpeakerVoiceConfig"]);o!=null&&s(e,["multiSpeakerVoiceConfig"],fh(o));const i=r(n,["languageCode"]);return i!=null&&s(e,["languageCode"],i),e}function ph(n){const e={},t=r(n,["fps"]);t!=null&&s(e,["fps"],t);const o=r(n,["endOffset"]);o!=null&&s(e,["endOffset"],o);const i=r(n,["startOffset"]);return i!=null&&s(e,["startOffset"],i),e}function mh(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["data"]);t!=null&&s(e,["data"],t);const o=r(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function Ch(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["fileUri"]);t!=null&&s(e,["fileUri"],t);const o=r(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function yh(n){const e={},t=r(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],ph(t));const o=r(n,["thought"]);o!=null&&s(e,["thought"],o);const i=r(n,["inlineData"]);i!=null&&s(e,["inlineData"],mh(i));const a=r(n,["fileData"]);a!=null&&s(e,["fileData"],Ch(a));const l=r(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const c=r(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const u=r(n,["executableCode"]);u!=null&&s(e,["executableCode"],u);const d=r(n,["functionCall"]);d!=null&&s(e,["functionCall"],d);const h=r(n,["functionResponse"]);h!=null&&s(e,["functionResponse"],h);const f=r(n,["text"]);return f!=null&&s(e,["text"],f),e}function Th(n){const e={},t=r(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>yh(a))),s(e,["parts"],i)}const o=r(n,["role"]);return o!=null&&s(e,["role"],o),e}function vh(n){const e={},t=r(n,["behavior"]);t!=null&&s(e,["behavior"],t);const o=r(n,["description"]);o!=null&&s(e,["description"],o);const i=r(n,["name"]);i!=null&&s(e,["name"],i);const a=r(n,["parameters"]);a!=null&&s(e,["parameters"],a);const l=r(n,["parametersJsonSchema"]);l!=null&&s(e,["parametersJsonSchema"],l);const c=r(n,["response"]);c!=null&&s(e,["response"],c);const u=r(n,["responseJsonSchema"]);return u!=null&&s(e,["responseJsonSchema"],u),e}function Ih(n){const e={},t=r(n,["startTime"]);t!=null&&s(e,["startTime"],t);const o=r(n,["endTime"]);return o!=null&&s(e,["endTime"],o),e}function Eh(n){const e={},t=r(n,["timeRangeFilter"]);if(t!=null&&s(e,["timeRangeFilter"],Ih(t)),r(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function Sh(n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const o=r(n,["dynamicThreshold"]);return o!=null&&s(e,["dynamicThreshold"],o),e}function Ah(n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],Sh(t)),e}function wh(){return{}}function _h(n){const e={},t=r(n,["environment"]);return t!=null&&s(e,["environment"],t),e}function Rh(n){const e={},t=r(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(d=>vh(d))),s(e,["functionDeclarations"],u)}if(r(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const o=r(n,["googleSearch"]);o!=null&&s(e,["googleSearch"],Eh(o));const i=r(n,["googleSearchRetrieval"]);if(i!=null&&s(e,["googleSearchRetrieval"],Ah(i)),r(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");r(n,["urlContext"])!=null&&s(e,["urlContext"],wh());const l=r(n,["computerUse"]);l!=null&&s(e,["computerUse"],_h(l));const c=r(n,["codeExecution"]);return c!=null&&s(e,["codeExecution"],c),e}function kh(n){const e={},t=r(n,["handle"]);if(t!=null&&s(e,["handle"],t),r(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Hr(){return{}}function Mh(n){const e={},t=r(n,["disabled"]);t!=null&&s(e,["disabled"],t);const o=r(n,["startOfSpeechSensitivity"]);o!=null&&s(e,["startOfSpeechSensitivity"],o);const i=r(n,["endOfSpeechSensitivity"]);i!=null&&s(e,["endOfSpeechSensitivity"],i);const a=r(n,["prefixPaddingMs"]);a!=null&&s(e,["prefixPaddingMs"],a);const l=r(n,["silenceDurationMs"]);return l!=null&&s(e,["silenceDurationMs"],l),e}function Ph(n){const e={},t=r(n,["automaticActivityDetection"]);t!=null&&s(e,["automaticActivityDetection"],Mh(t));const o=r(n,["activityHandling"]);o!=null&&s(e,["activityHandling"],o);const i=r(n,["turnCoverage"]);return i!=null&&s(e,["turnCoverage"],i),e}function bh(n){const e={},t=r(n,["targetTokens"]);return t!=null&&s(e,["targetTokens"],t),e}function Nh(n){const e={},t=r(n,["triggerTokens"]);t!=null&&s(e,["triggerTokens"],t);const o=r(n,["slidingWindow"]);return o!=null&&s(e,["slidingWindow"],bh(o)),e}function xh(n){const e={},t=r(n,["proactiveAudio"]);return t!=null&&s(e,["proactiveAudio"],t),e}function Lh(n,e){const t={},o=r(n,["generationConfig"]);e!==void 0&&o!=null&&s(e,["setup","generationConfig"],o);const i=r(n,["responseModalities"]);e!==void 0&&i!=null&&s(e,["setup","generationConfig","responseModalities"],i);const a=r(n,["temperature"]);e!==void 0&&a!=null&&s(e,["setup","generationConfig","temperature"],a);const l=r(n,["topP"]);e!==void 0&&l!=null&&s(e,["setup","generationConfig","topP"],l);const c=r(n,["topK"]);e!==void 0&&c!=null&&s(e,["setup","generationConfig","topK"],c);const u=r(n,["maxOutputTokens"]);e!==void 0&&u!=null&&s(e,["setup","generationConfig","maxOutputTokens"],u);const d=r(n,["mediaResolution"]);e!==void 0&&d!=null&&s(e,["setup","generationConfig","mediaResolution"],d);const h=r(n,["seed"]);e!==void 0&&h!=null&&s(e,["setup","generationConfig","seed"],h);const f=r(n,["speechConfig"]);e!==void 0&&f!=null&&s(e,["setup","generationConfig","speechConfig"],gh(Fo(f)));const p=r(n,["enableAffectiveDialog"]);e!==void 0&&p!=null&&s(e,["setup","generationConfig","enableAffectiveDialog"],p);const m=r(n,["systemInstruction"]);e!==void 0&&m!=null&&s(e,["setup","systemInstruction"],Th(de(m)));const v=r(n,["tools"]);if(e!==void 0&&v!=null){let _=_t(v);Array.isArray(_)&&(_=_.map(H=>Rh(wt(H)))),s(e,["setup","tools"],_)}const y=r(n,["sessionResumption"]);e!==void 0&&y!=null&&s(e,["setup","sessionResumption"],kh(y));const E=r(n,["inputAudioTranscription"]);e!==void 0&&E!=null&&s(e,["setup","inputAudioTranscription"],Hr());const A=r(n,["outputAudioTranscription"]);e!==void 0&&A!=null&&s(e,["setup","outputAudioTranscription"],Hr());const R=r(n,["realtimeInputConfig"]);e!==void 0&&R!=null&&s(e,["setup","realtimeInputConfig"],Ph(R));const M=r(n,["contextWindowCompression"]);e!==void 0&&M!=null&&s(e,["setup","contextWindowCompression"],Nh(M));const L=r(n,["proactivity"]);return e!==void 0&&L!=null&&s(e,["setup","proactivity"],xh(L)),t}function Dh(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["setup","model"],V(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],Lh(i,t)),t}function Uh(){return{}}function Oh(){return{}}function Hh(n){const e={},t=r(n,["media"]);t!=null&&s(e,["mediaChunks"],Bs(t));const o=r(n,["audio"]);o!=null&&s(e,["audio"],Gs(o));const i=r(n,["audioStreamEnd"]);i!=null&&s(e,["audioStreamEnd"],i);const a=r(n,["video"]);a!=null&&s(e,["video"],Fs(a));const l=r(n,["text"]);return l!=null&&s(e,["text"],l),r(n,["activityStart"])!=null&&s(e,["activityStart"],Uh()),r(n,["activityEnd"])!=null&&s(e,["activityEnd"],Oh()),e}function na(n){const e={},t=r(n,["text"]);t!=null&&s(e,["text"],t);const o=r(n,["weight"]);return o!=null&&s(e,["weight"],o),e}function Bh(n){const e={},t=r(n,["weightedPrompts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(i=>na(i))),s(e,["weightedPrompts"],o)}return e}function oa(n){const e={},t=r(n,["temperature"]);t!=null&&s(e,["temperature"],t);const o=r(n,["topK"]);o!=null&&s(e,["topK"],o);const i=r(n,["seed"]);i!=null&&s(e,["seed"],i);const a=r(n,["guidance"]);a!=null&&s(e,["guidance"],a);const l=r(n,["bpm"]);l!=null&&s(e,["bpm"],l);const c=r(n,["density"]);c!=null&&s(e,["density"],c);const u=r(n,["brightness"]);u!=null&&s(e,["brightness"],u);const d=r(n,["scale"]);d!=null&&s(e,["scale"],d);const h=r(n,["muteBass"]);h!=null&&s(e,["muteBass"],h);const f=r(n,["muteDrums"]);f!=null&&s(e,["muteDrums"],f);const p=r(n,["onlyBassAndDrums"]);p!=null&&s(e,["onlyBassAndDrums"],p);const m=r(n,["musicGenerationMode"]);return m!=null&&s(e,["musicGenerationMode"],m),e}function Fh(n){const e={},t=r(n,["musicGenerationConfig"]);return t!=null&&s(e,["musicGenerationConfig"],oa(t)),e}function ia(n){const e={},t=r(n,["model"]);return t!=null&&s(e,["model"],t),e}function ra(n){const e={},t=r(n,["weightedPrompts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(i=>na(i))),s(e,["weightedPrompts"],o)}return e}function ho(n){const e={},t=r(n,["setup"]);t!=null&&s(e,["setup"],ia(t));const o=r(n,["clientContent"]);o!=null&&s(e,["clientContent"],ra(o));const i=r(n,["musicGenerationConfig"]);i!=null&&s(e,["musicGenerationConfig"],oa(i));const a=r(n,["playbackControl"]);return a!=null&&s(e,["playbackControl"],a),e}function Gh(n){const e={},t=r(n,["voiceName"]);return t!=null&&s(e,["voiceName"],t),e}function qh(n){const e={},t=r(n,["prebuiltVoiceConfig"]);return t!=null&&s(e,["prebuiltVoiceConfig"],Gh(t)),e}function Vh(n){const e={},t=r(n,["voiceConfig"]);if(t!=null&&s(e,["voiceConfig"],qh(t)),r(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const o=r(n,["languageCode"]);return o!=null&&s(e,["languageCode"],o),e}function Kh(n){const e={},t=r(n,["fps"]);t!=null&&s(e,["fps"],t);const o=r(n,["endOffset"]);o!=null&&s(e,["endOffset"],o);const i=r(n,["startOffset"]);return i!=null&&s(e,["startOffset"],i),e}function $h(n){const e={},t=r(n,["displayName"]);t!=null&&s(e,["displayName"],t);const o=r(n,["data"]);o!=null&&s(e,["data"],o);const i=r(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Jh(n){const e={},t=r(n,["displayName"]);t!=null&&s(e,["displayName"],t);const o=r(n,["fileUri"]);o!=null&&s(e,["fileUri"],o);const i=r(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function zh(n){const e={},t=r(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],Kh(t));const o=r(n,["thought"]);o!=null&&s(e,["thought"],o);const i=r(n,["inlineData"]);i!=null&&s(e,["inlineData"],$h(i));const a=r(n,["fileData"]);a!=null&&s(e,["fileData"],Jh(a));const l=r(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const c=r(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const u=r(n,["executableCode"]);u!=null&&s(e,["executableCode"],u);const d=r(n,["functionCall"]);d!=null&&s(e,["functionCall"],d);const h=r(n,["functionResponse"]);h!=null&&s(e,["functionResponse"],h);const f=r(n,["text"]);return f!=null&&s(e,["text"],f),e}function Yh(n){const e={},t=r(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>zh(a))),s(e,["parts"],i)}const o=r(n,["role"]);return o!=null&&s(e,["role"],o),e}function Wh(n){const e={};if(r(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=r(n,["description"]);t!=null&&s(e,["description"],t);const o=r(n,["name"]);o!=null&&s(e,["name"],o);const i=r(n,["parameters"]);i!=null&&s(e,["parameters"],i);const a=r(n,["parametersJsonSchema"]);a!=null&&s(e,["parametersJsonSchema"],a);const l=r(n,["response"]);l!=null&&s(e,["response"],l);const c=r(n,["responseJsonSchema"]);return c!=null&&s(e,["responseJsonSchema"],c),e}function Qh(n){const e={},t=r(n,["startTime"]);t!=null&&s(e,["startTime"],t);const o=r(n,["endTime"]);return o!=null&&s(e,["endTime"],o),e}function Xh(n){const e={},t=r(n,["timeRangeFilter"]);t!=null&&s(e,["timeRangeFilter"],Qh(t));const o=r(n,["excludeDomains"]);return o!=null&&s(e,["excludeDomains"],o),e}function Zh(n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const o=r(n,["dynamicThreshold"]);return o!=null&&s(e,["dynamicThreshold"],o),e}function jh(n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],Zh(t)),e}function ef(n){const e={},t=r(n,["excludeDomains"]);return t!=null&&s(e,["excludeDomains"],t),e}function tf(n){const e={},t=r(n,["apiKeyString"]);return t!=null&&s(e,["apiKeyString"],t),e}function nf(n){const e={},t=r(n,["apiKeyConfig"]);t!=null&&s(e,["apiKeyConfig"],tf(t));const o=r(n,["authType"]);o!=null&&s(e,["authType"],o);const i=r(n,["googleServiceAccountConfig"]);i!=null&&s(e,["googleServiceAccountConfig"],i);const a=r(n,["httpBasicAuthConfig"]);a!=null&&s(e,["httpBasicAuthConfig"],a);const l=r(n,["oauthConfig"]);l!=null&&s(e,["oauthConfig"],l);const c=r(n,["oidcConfig"]);return c!=null&&s(e,["oidcConfig"],c),e}function of(n){const e={},t=r(n,["authConfig"]);return t!=null&&s(e,["authConfig"],nf(t)),e}function rf(){return{}}function sf(n){const e={},t=r(n,["environment"]);return t!=null&&s(e,["environment"],t),e}function af(n){const e={},t=r(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>Wh(p))),s(e,["functionDeclarations"],f)}const o=r(n,["retrieval"]);o!=null&&s(e,["retrieval"],o);const i=r(n,["googleSearch"]);i!=null&&s(e,["googleSearch"],Xh(i));const a=r(n,["googleSearchRetrieval"]);a!=null&&s(e,["googleSearchRetrieval"],jh(a));const l=r(n,["enterpriseWebSearch"]);l!=null&&s(e,["enterpriseWebSearch"],ef(l));const c=r(n,["googleMaps"]);c!=null&&s(e,["googleMaps"],of(c)),r(n,["urlContext"])!=null&&s(e,["urlContext"],rf());const d=r(n,["computerUse"]);d!=null&&s(e,["computerUse"],sf(d));const h=r(n,["codeExecution"]);return h!=null&&s(e,["codeExecution"],h),e}function lf(n){const e={},t=r(n,["handle"]);t!=null&&s(e,["handle"],t);const o=r(n,["transparent"]);return o!=null&&s(e,["transparent"],o),e}function Br(){return{}}function cf(n){const e={},t=r(n,["disabled"]);t!=null&&s(e,["disabled"],t);const o=r(n,["startOfSpeechSensitivity"]);o!=null&&s(e,["startOfSpeechSensitivity"],o);const i=r(n,["endOfSpeechSensitivity"]);i!=null&&s(e,["endOfSpeechSensitivity"],i);const a=r(n,["prefixPaddingMs"]);a!=null&&s(e,["prefixPaddingMs"],a);const l=r(n,["silenceDurationMs"]);return l!=null&&s(e,["silenceDurationMs"],l),e}function df(n){const e={},t=r(n,["automaticActivityDetection"]);t!=null&&s(e,["automaticActivityDetection"],cf(t));const o=r(n,["activityHandling"]);o!=null&&s(e,["activityHandling"],o);const i=r(n,["turnCoverage"]);return i!=null&&s(e,["turnCoverage"],i),e}function uf(n){const e={},t=r(n,["targetTokens"]);return t!=null&&s(e,["targetTokens"],t),e}function hf(n){const e={},t=r(n,["triggerTokens"]);t!=null&&s(e,["triggerTokens"],t);const o=r(n,["slidingWindow"]);return o!=null&&s(e,["slidingWindow"],uf(o)),e}function ff(n){const e={},t=r(n,["proactiveAudio"]);return t!=null&&s(e,["proactiveAudio"],t),e}function gf(n,e){const t={},o=r(n,["generationConfig"]);e!==void 0&&o!=null&&s(e,["setup","generationConfig"],o);const i=r(n,["responseModalities"]);e!==void 0&&i!=null&&s(e,["setup","generationConfig","responseModalities"],i);const a=r(n,["temperature"]);e!==void 0&&a!=null&&s(e,["setup","generationConfig","temperature"],a);const l=r(n,["topP"]);e!==void 0&&l!=null&&s(e,["setup","generationConfig","topP"],l);const c=r(n,["topK"]);e!==void 0&&c!=null&&s(e,["setup","generationConfig","topK"],c);const u=r(n,["maxOutputTokens"]);e!==void 0&&u!=null&&s(e,["setup","generationConfig","maxOutputTokens"],u);const d=r(n,["mediaResolution"]);e!==void 0&&d!=null&&s(e,["setup","generationConfig","mediaResolution"],d);const h=r(n,["seed"]);e!==void 0&&h!=null&&s(e,["setup","generationConfig","seed"],h);const f=r(n,["speechConfig"]);e!==void 0&&f!=null&&s(e,["setup","generationConfig","speechConfig"],Vh(Fo(f)));const p=r(n,["enableAffectiveDialog"]);e!==void 0&&p!=null&&s(e,["setup","generationConfig","enableAffectiveDialog"],p);const m=r(n,["systemInstruction"]);e!==void 0&&m!=null&&s(e,["setup","systemInstruction"],Yh(de(m)));const v=r(n,["tools"]);if(e!==void 0&&v!=null){let _=_t(v);Array.isArray(_)&&(_=_.map(H=>af(wt(H)))),s(e,["setup","tools"],_)}const y=r(n,["sessionResumption"]);e!==void 0&&y!=null&&s(e,["setup","sessionResumption"],lf(y));const E=r(n,["inputAudioTranscription"]);e!==void 0&&E!=null&&s(e,["setup","inputAudioTranscription"],Br());const A=r(n,["outputAudioTranscription"]);e!==void 0&&A!=null&&s(e,["setup","outputAudioTranscription"],Br());const R=r(n,["realtimeInputConfig"]);e!==void 0&&R!=null&&s(e,["setup","realtimeInputConfig"],df(R));const M=r(n,["contextWindowCompression"]);e!==void 0&&M!=null&&s(e,["setup","contextWindowCompression"],hf(M));const L=r(n,["proactivity"]);return e!==void 0&&L!=null&&s(e,["setup","proactivity"],ff(L)),t}function pf(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["setup","model"],V(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],gf(i,t)),t}function mf(){return{}}function Cf(){return{}}function yf(n){const e={},t=r(n,["media"]);t!=null&&s(e,["mediaChunks"],Bs(t));const o=r(n,["audio"]);o!=null&&s(e,["audio"],Gs(o));const i=r(n,["audioStreamEnd"]);i!=null&&s(e,["audioStreamEnd"],i);const a=r(n,["video"]);a!=null&&s(e,["video"],Fs(a));const l=r(n,["text"]);return l!=null&&s(e,["text"],l),r(n,["activityStart"])!=null&&s(e,["activityStart"],mf()),r(n,["activityEnd"])!=null&&s(e,["activityEnd"],Cf()),e}function Tf(){return{}}function vf(n){const e={},t=r(n,["fps"]);t!=null&&s(e,["fps"],t);const o=r(n,["endOffset"]);o!=null&&s(e,["endOffset"],o);const i=r(n,["startOffset"]);return i!=null&&s(e,["startOffset"],i),e}function If(n){const e={},t=r(n,["data"]);t!=null&&s(e,["data"],t);const o=r(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function Ef(n){const e={},t=r(n,["fileUri"]);t!=null&&s(e,["fileUri"],t);const o=r(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function Sf(n){const e={},t=r(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],vf(t));const o=r(n,["thought"]);o!=null&&s(e,["thought"],o);const i=r(n,["inlineData"]);i!=null&&s(e,["inlineData"],If(i));const a=r(n,["fileData"]);a!=null&&s(e,["fileData"],Ef(a));const l=r(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const c=r(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const u=r(n,["executableCode"]);u!=null&&s(e,["executableCode"],u);const d=r(n,["functionCall"]);d!=null&&s(e,["functionCall"],d);const h=r(n,["functionResponse"]);h!=null&&s(e,["functionResponse"],h);const f=r(n,["text"]);return f!=null&&s(e,["text"],f),e}function Af(n){const e={},t=r(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Sf(a))),s(e,["parts"],i)}const o=r(n,["role"]);return o!=null&&s(e,["role"],o),e}function Fr(n){const e={},t=r(n,["text"]);t!=null&&s(e,["text"],t);const o=r(n,["finished"]);return o!=null&&s(e,["finished"],o),e}function wf(n){const e={},t=r(n,["retrievedUrl"]);t!=null&&s(e,["retrievedUrl"],t);const o=r(n,["urlRetrievalStatus"]);return o!=null&&s(e,["urlRetrievalStatus"],o),e}function _f(n){const e={},t=r(n,["urlMetadata"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(i=>wf(i))),s(e,["urlMetadata"],o)}return e}function Rf(n){const e={},t=r(n,["modelTurn"]);t!=null&&s(e,["modelTurn"],Af(t));const o=r(n,["turnComplete"]);o!=null&&s(e,["turnComplete"],o);const i=r(n,["interrupted"]);i!=null&&s(e,["interrupted"],i);const a=r(n,["groundingMetadata"]);a!=null&&s(e,["groundingMetadata"],a);const l=r(n,["generationComplete"]);l!=null&&s(e,["generationComplete"],l);const c=r(n,["inputTranscription"]);c!=null&&s(e,["inputTranscription"],Fr(c));const u=r(n,["outputTranscription"]);u!=null&&s(e,["outputTranscription"],Fr(u));const d=r(n,["urlContextMetadata"]);return d!=null&&s(e,["urlContextMetadata"],_f(d)),e}function kf(n){const e={},t=r(n,["id"]);t!=null&&s(e,["id"],t);const o=r(n,["args"]);o!=null&&s(e,["args"],o);const i=r(n,["name"]);return i!=null&&s(e,["name"],i),e}function Mf(n){const e={},t=r(n,["functionCalls"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(i=>kf(i))),s(e,["functionCalls"],o)}return e}function Pf(n){const e={},t=r(n,["ids"]);return t!=null&&s(e,["ids"],t),e}function Qt(n){const e={},t=r(n,["modality"]);t!=null&&s(e,["modality"],t);const o=r(n,["tokenCount"]);return o!=null&&s(e,["tokenCount"],o),e}function bf(n){const e={},t=r(n,["promptTokenCount"]);t!=null&&s(e,["promptTokenCount"],t);const o=r(n,["cachedContentTokenCount"]);o!=null&&s(e,["cachedContentTokenCount"],o);const i=r(n,["responseTokenCount"]);i!=null&&s(e,["responseTokenCount"],i);const a=r(n,["toolUsePromptTokenCount"]);a!=null&&s(e,["toolUsePromptTokenCount"],a);const l=r(n,["thoughtsTokenCount"]);l!=null&&s(e,["thoughtsTokenCount"],l);const c=r(n,["totalTokenCount"]);c!=null&&s(e,["totalTokenCount"],c);const u=r(n,["promptTokensDetails"]);if(u!=null){let p=u;Array.isArray(p)&&(p=p.map(m=>Qt(m))),s(e,["promptTokensDetails"],p)}const d=r(n,["cacheTokensDetails"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(m=>Qt(m))),s(e,["cacheTokensDetails"],p)}const h=r(n,["responseTokensDetails"]);if(h!=null){let p=h;Array.isArray(p)&&(p=p.map(m=>Qt(m))),s(e,["responseTokensDetails"],p)}const f=r(n,["toolUsePromptTokensDetails"]);if(f!=null){let p=f;Array.isArray(p)&&(p=p.map(m=>Qt(m))),s(e,["toolUsePromptTokensDetails"],p)}return e}function Nf(n){const e={},t=r(n,["timeLeft"]);return t!=null&&s(e,["timeLeft"],t),e}function xf(n){const e={},t=r(n,["newHandle"]);t!=null&&s(e,["newHandle"],t);const o=r(n,["resumable"]);o!=null&&s(e,["resumable"],o);const i=r(n,["lastConsumedClientMessageIndex"]);return i!=null&&s(e,["lastConsumedClientMessageIndex"],i),e}function Lf(n){const e={};r(n,["setupComplete"])!=null&&s(e,["setupComplete"],Tf());const o=r(n,["serverContent"]);o!=null&&s(e,["serverContent"],Rf(o));const i=r(n,["toolCall"]);i!=null&&s(e,["toolCall"],Mf(i));const a=r(n,["toolCallCancellation"]);a!=null&&s(e,["toolCallCancellation"],Pf(a));const l=r(n,["usageMetadata"]);l!=null&&s(e,["usageMetadata"],bf(l));const c=r(n,["goAway"]);c!=null&&s(e,["goAway"],Nf(c));const u=r(n,["sessionResumptionUpdate"]);return u!=null&&s(e,["sessionResumptionUpdate"],xf(u)),e}function Df(){return{}}function Uf(n){const e={},t=r(n,["text"]);t!=null&&s(e,["text"],t);const o=r(n,["weight"]);return o!=null&&s(e,["weight"],o),e}function Of(n){const e={},t=r(n,["weightedPrompts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(i=>Uf(i))),s(e,["weightedPrompts"],o)}return e}function Hf(n){const e={},t=r(n,["temperature"]);t!=null&&s(e,["temperature"],t);const o=r(n,["topK"]);o!=null&&s(e,["topK"],o);const i=r(n,["seed"]);i!=null&&s(e,["seed"],i);const a=r(n,["guidance"]);a!=null&&s(e,["guidance"],a);const l=r(n,["bpm"]);l!=null&&s(e,["bpm"],l);const c=r(n,["density"]);c!=null&&s(e,["density"],c);const u=r(n,["brightness"]);u!=null&&s(e,["brightness"],u);const d=r(n,["scale"]);d!=null&&s(e,["scale"],d);const h=r(n,["muteBass"]);h!=null&&s(e,["muteBass"],h);const f=r(n,["muteDrums"]);f!=null&&s(e,["muteDrums"],f);const p=r(n,["onlyBassAndDrums"]);p!=null&&s(e,["onlyBassAndDrums"],p);const m=r(n,["musicGenerationMode"]);return m!=null&&s(e,["musicGenerationMode"],m),e}function Bf(n){const e={},t=r(n,["clientContent"]);t!=null&&s(e,["clientContent"],Of(t));const o=r(n,["musicGenerationConfig"]);return o!=null&&s(e,["musicGenerationConfig"],Hf(o)),e}function Ff(n){const e={},t=r(n,["data"]);t!=null&&s(e,["data"],t);const o=r(n,["mimeType"]);o!=null&&s(e,["mimeType"],o);const i=r(n,["sourceMetadata"]);return i!=null&&s(e,["sourceMetadata"],Bf(i)),e}function Gf(n){const e={},t=r(n,["audioChunks"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(i=>Ff(i))),s(e,["audioChunks"],o)}return e}function qf(n){const e={},t=r(n,["text"]);t!=null&&s(e,["text"],t);const o=r(n,["filteredReason"]);return o!=null&&s(e,["filteredReason"],o),e}function Vf(n){const e={};r(n,["setupComplete"])!=null&&s(e,["setupComplete"],Df());const o=r(n,["serverContent"]);o!=null&&s(e,["serverContent"],Gf(o));const i=r(n,["filteredPrompt"]);return i!=null&&s(e,["filteredPrompt"],qf(i)),e}function Kf(n){const e={},t=r(n,["sessionId"]);return t!=null&&s(e,["sessionId"],t),e}function $f(n){const e={},t=r(n,["fps"]);t!=null&&s(e,["fps"],t);const o=r(n,["endOffset"]);o!=null&&s(e,["endOffset"],o);const i=r(n,["startOffset"]);return i!=null&&s(e,["startOffset"],i),e}function Jf(n){const e={},t=r(n,["displayName"]);t!=null&&s(e,["displayName"],t);const o=r(n,["data"]);o!=null&&s(e,["data"],o);const i=r(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function zf(n){const e={},t=r(n,["displayName"]);t!=null&&s(e,["displayName"],t);const o=r(n,["fileUri"]);o!=null&&s(e,["fileUri"],o);const i=r(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Yf(n){const e={},t=r(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],$f(t));const o=r(n,["thought"]);o!=null&&s(e,["thought"],o);const i=r(n,["inlineData"]);i!=null&&s(e,["inlineData"],Jf(i));const a=r(n,["fileData"]);a!=null&&s(e,["fileData"],zf(a));const l=r(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const c=r(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const u=r(n,["executableCode"]);u!=null&&s(e,["executableCode"],u);const d=r(n,["functionCall"]);d!=null&&s(e,["functionCall"],d);const h=r(n,["functionResponse"]);h!=null&&s(e,["functionResponse"],h);const f=r(n,["text"]);return f!=null&&s(e,["text"],f),e}function Wf(n){const e={},t=r(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Yf(a))),s(e,["parts"],i)}const o=r(n,["role"]);return o!=null&&s(e,["role"],o),e}function Gr(n){const e={},t=r(n,["text"]);t!=null&&s(e,["text"],t);const o=r(n,["finished"]);return o!=null&&s(e,["finished"],o),e}function Qf(n){const e={},t=r(n,["modelTurn"]);t!=null&&s(e,["modelTurn"],Wf(t));const o=r(n,["turnComplete"]);o!=null&&s(e,["turnComplete"],o);const i=r(n,["interrupted"]);i!=null&&s(e,["interrupted"],i);const a=r(n,["groundingMetadata"]);a!=null&&s(e,["groundingMetadata"],a);const l=r(n,["generationComplete"]);l!=null&&s(e,["generationComplete"],l);const c=r(n,["inputTranscription"]);c!=null&&s(e,["inputTranscription"],Gr(c));const u=r(n,["outputTranscription"]);return u!=null&&s(e,["outputTranscription"],Gr(u)),e}function Xf(n){const e={},t=r(n,["args"]);t!=null&&s(e,["args"],t);const o=r(n,["name"]);return o!=null&&s(e,["name"],o),e}function Zf(n){const e={},t=r(n,["functionCalls"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(i=>Xf(i))),s(e,["functionCalls"],o)}return e}function jf(n){const e={},t=r(n,["ids"]);return t!=null&&s(e,["ids"],t),e}function Xt(n){const e={},t=r(n,["modality"]);t!=null&&s(e,["modality"],t);const o=r(n,["tokenCount"]);return o!=null&&s(e,["tokenCount"],o),e}function eg(n){const e={},t=r(n,["promptTokenCount"]);t!=null&&s(e,["promptTokenCount"],t);const o=r(n,["cachedContentTokenCount"]);o!=null&&s(e,["cachedContentTokenCount"],o);const i=r(n,["candidatesTokenCount"]);i!=null&&s(e,["responseTokenCount"],i);const a=r(n,["toolUsePromptTokenCount"]);a!=null&&s(e,["toolUsePromptTokenCount"],a);const l=r(n,["thoughtsTokenCount"]);l!=null&&s(e,["thoughtsTokenCount"],l);const c=r(n,["totalTokenCount"]);c!=null&&s(e,["totalTokenCount"],c);const u=r(n,["promptTokensDetails"]);if(u!=null){let m=u;Array.isArray(m)&&(m=m.map(v=>Xt(v))),s(e,["promptTokensDetails"],m)}const d=r(n,["cacheTokensDetails"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(v=>Xt(v))),s(e,["cacheTokensDetails"],m)}const h=r(n,["candidatesTokensDetails"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(v=>Xt(v))),s(e,["responseTokensDetails"],m)}const f=r(n,["toolUsePromptTokensDetails"]);if(f!=null){let m=f;Array.isArray(m)&&(m=m.map(v=>Xt(v))),s(e,["toolUsePromptTokensDetails"],m)}const p=r(n,["trafficType"]);return p!=null&&s(e,["trafficType"],p),e}function tg(n){const e={},t=r(n,["timeLeft"]);return t!=null&&s(e,["timeLeft"],t),e}function ng(n){const e={},t=r(n,["newHandle"]);t!=null&&s(e,["newHandle"],t);const o=r(n,["resumable"]);o!=null&&s(e,["resumable"],o);const i=r(n,["lastConsumedClientMessageIndex"]);return i!=null&&s(e,["lastConsumedClientMessageIndex"],i),e}function og(n){const e={},t=r(n,["setupComplete"]);t!=null&&s(e,["setupComplete"],Kf(t));const o=r(n,["serverContent"]);o!=null&&s(e,["serverContent"],Qf(o));const i=r(n,["toolCall"]);i!=null&&s(e,["toolCall"],Zf(i));const a=r(n,["toolCallCancellation"]);a!=null&&s(e,["toolCallCancellation"],jf(a));const l=r(n,["usageMetadata"]);l!=null&&s(e,["usageMetadata"],eg(l));const c=r(n,["goAway"]);c!=null&&s(e,["goAway"],tg(c));const u=r(n,["sessionResumptionUpdate"]);return u!=null&&s(e,["sessionResumptionUpdate"],ng(u)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ig(n){const e={},t=r(n,["fps"]);t!=null&&s(e,["fps"],t);const o=r(n,["endOffset"]);o!=null&&s(e,["endOffset"],o);const i=r(n,["startOffset"]);return i!=null&&s(e,["startOffset"],i),e}function rg(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["data"]);t!=null&&s(e,["data"],t);const o=r(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function sg(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["fileUri"]);t!=null&&s(e,["fileUri"],t);const o=r(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function ag(n){const e={},t=r(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],ig(t));const o=r(n,["thought"]);o!=null&&s(e,["thought"],o);const i=r(n,["inlineData"]);i!=null&&s(e,["inlineData"],rg(i));const a=r(n,["fileData"]);a!=null&&s(e,["fileData"],sg(a));const l=r(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const c=r(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const u=r(n,["executableCode"]);u!=null&&s(e,["executableCode"],u);const d=r(n,["functionCall"]);d!=null&&s(e,["functionCall"],d);const h=r(n,["functionResponse"]);h!=null&&s(e,["functionResponse"],h);const f=r(n,["text"]);return f!=null&&s(e,["text"],f),e}function kn(n){const e={},t=r(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>ag(a))),s(e,["parts"],i)}const o=r(n,["role"]);return o!=null&&s(e,["role"],o),e}function lg(n){const e={},t=r(n,["anyOf"]);t!=null&&s(e,["anyOf"],t);const o=r(n,["default"]);o!=null&&s(e,["default"],o);const i=r(n,["description"]);i!=null&&s(e,["description"],i);const a=r(n,["enum"]);a!=null&&s(e,["enum"],a);const l=r(n,["example"]);l!=null&&s(e,["example"],l);const c=r(n,["format"]);c!=null&&s(e,["format"],c);const u=r(n,["items"]);u!=null&&s(e,["items"],u);const d=r(n,["maxItems"]);d!=null&&s(e,["maxItems"],d);const h=r(n,["maxLength"]);h!=null&&s(e,["maxLength"],h);const f=r(n,["maxProperties"]);f!=null&&s(e,["maxProperties"],f);const p=r(n,["maximum"]);p!=null&&s(e,["maximum"],p);const m=r(n,["minItems"]);m!=null&&s(e,["minItems"],m);const v=r(n,["minLength"]);v!=null&&s(e,["minLength"],v);const y=r(n,["minProperties"]);y!=null&&s(e,["minProperties"],y);const E=r(n,["minimum"]);E!=null&&s(e,["minimum"],E);const A=r(n,["nullable"]);A!=null&&s(e,["nullable"],A);const R=r(n,["pattern"]);R!=null&&s(e,["pattern"],R);const M=r(n,["properties"]);M!=null&&s(e,["properties"],M);const L=r(n,["propertyOrdering"]);L!=null&&s(e,["propertyOrdering"],L);const _=r(n,["required"]);_!=null&&s(e,["required"],_);const H=r(n,["title"]);H!=null&&s(e,["title"],H);const D=r(n,["type"]);return D!=null&&s(e,["type"],D),e}function cg(n){const e={};if(r(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const t=r(n,["category"]);t!=null&&s(e,["category"],t);const o=r(n,["threshold"]);return o!=null&&s(e,["threshold"],o),e}function dg(n){const e={},t=r(n,["behavior"]);t!=null&&s(e,["behavior"],t);const o=r(n,["description"]);o!=null&&s(e,["description"],o);const i=r(n,["name"]);i!=null&&s(e,["name"],i);const a=r(n,["parameters"]);a!=null&&s(e,["parameters"],a);const l=r(n,["parametersJsonSchema"]);l!=null&&s(e,["parametersJsonSchema"],l);const c=r(n,["response"]);c!=null&&s(e,["response"],c);const u=r(n,["responseJsonSchema"]);return u!=null&&s(e,["responseJsonSchema"],u),e}function ug(n){const e={},t=r(n,["startTime"]);t!=null&&s(e,["startTime"],t);const o=r(n,["endTime"]);return o!=null&&s(e,["endTime"],o),e}function hg(n){const e={},t=r(n,["timeRangeFilter"]);if(t!=null&&s(e,["timeRangeFilter"],ug(t)),r(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function fg(n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const o=r(n,["dynamicThreshold"]);return o!=null&&s(e,["dynamicThreshold"],o),e}function gg(n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],fg(t)),e}function pg(){return{}}function mg(n){const e={},t=r(n,["environment"]);return t!=null&&s(e,["environment"],t),e}function Cg(n){const e={},t=r(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(d=>dg(d))),s(e,["functionDeclarations"],u)}if(r(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const o=r(n,["googleSearch"]);o!=null&&s(e,["googleSearch"],hg(o));const i=r(n,["googleSearchRetrieval"]);if(i!=null&&s(e,["googleSearchRetrieval"],gg(i)),r(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");r(n,["urlContext"])!=null&&s(e,["urlContext"],pg());const l=r(n,["computerUse"]);l!=null&&s(e,["computerUse"],mg(l));const c=r(n,["codeExecution"]);return c!=null&&s(e,["codeExecution"],c),e}function yg(n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const o=r(n,["allowedFunctionNames"]);return o!=null&&s(e,["allowedFunctionNames"],o),e}function Tg(n){const e={},t=r(n,["latitude"]);t!=null&&s(e,["latitude"],t);const o=r(n,["longitude"]);return o!=null&&s(e,["longitude"],o),e}function vg(n){const e={},t=r(n,["latLng"]);t!=null&&s(e,["latLng"],Tg(t));const o=r(n,["languageCode"]);return o!=null&&s(e,["languageCode"],o),e}function Ig(n){const e={},t=r(n,["functionCallingConfig"]);t!=null&&s(e,["functionCallingConfig"],yg(t));const o=r(n,["retrievalConfig"]);return o!=null&&s(e,["retrievalConfig"],vg(o)),e}function Eg(n){const e={},t=r(n,["voiceName"]);return t!=null&&s(e,["voiceName"],t),e}function sa(n){const e={},t=r(n,["prebuiltVoiceConfig"]);return t!=null&&s(e,["prebuiltVoiceConfig"],Eg(t)),e}function Sg(n){const e={},t=r(n,["speaker"]);t!=null&&s(e,["speaker"],t);const o=r(n,["voiceConfig"]);return o!=null&&s(e,["voiceConfig"],sa(o)),e}function Ag(n){const e={},t=r(n,["speakerVoiceConfigs"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(i=>Sg(i))),s(e,["speakerVoiceConfigs"],o)}return e}function wg(n){const e={},t=r(n,["voiceConfig"]);t!=null&&s(e,["voiceConfig"],sa(t));const o=r(n,["multiSpeakerVoiceConfig"]);o!=null&&s(e,["multiSpeakerVoiceConfig"],Ag(o));const i=r(n,["languageCode"]);return i!=null&&s(e,["languageCode"],i),e}function _g(n){const e={},t=r(n,["includeThoughts"]);t!=null&&s(e,["includeThoughts"],t);const o=r(n,["thinkingBudget"]);return o!=null&&s(e,["thinkingBudget"],o),e}function Rg(n,e,t){const o={},i=r(e,["systemInstruction"]);t!==void 0&&i!=null&&s(t,["systemInstruction"],kn(de(i)));const a=r(e,["temperature"]);a!=null&&s(o,["temperature"],a);const l=r(e,["topP"]);l!=null&&s(o,["topP"],l);const c=r(e,["topK"]);c!=null&&s(o,["topK"],c);const u=r(e,["candidateCount"]);u!=null&&s(o,["candidateCount"],u);const d=r(e,["maxOutputTokens"]);d!=null&&s(o,["maxOutputTokens"],d);const h=r(e,["stopSequences"]);h!=null&&s(o,["stopSequences"],h);const f=r(e,["responseLogprobs"]);f!=null&&s(o,["responseLogprobs"],f);const p=r(e,["logprobs"]);p!=null&&s(o,["logprobs"],p);const m=r(e,["presencePenalty"]);m!=null&&s(o,["presencePenalty"],m);const v=r(e,["frequencyPenalty"]);v!=null&&s(o,["frequencyPenalty"],v);const y=r(e,["seed"]);y!=null&&s(o,["seed"],y);const E=r(e,["responseMimeType"]);E!=null&&s(o,["responseMimeType"],E);const A=r(e,["responseSchema"]);A!=null&&s(o,["responseSchema"],lg(Ho(A)));const R=r(e,["responseJsonSchema"]);if(R!=null&&s(o,["responseJsonSchema"],R),r(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(r(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const M=r(e,["safetySettings"]);if(t!==void 0&&M!=null){let q=M;Array.isArray(q)&&(q=q.map(he=>cg(he))),s(t,["safetySettings"],q)}const L=r(e,["tools"]);if(t!==void 0&&L!=null){let q=_t(L);Array.isArray(q)&&(q=q.map(he=>Cg(wt(he)))),s(t,["tools"],q)}const _=r(e,["toolConfig"]);if(t!==void 0&&_!=null&&s(t,["toolConfig"],Ig(_)),r(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const H=r(e,["cachedContent"]);t!==void 0&&H!=null&&s(t,["cachedContent"],Ve(n,H));const D=r(e,["responseModalities"]);D!=null&&s(o,["responseModalities"],D);const F=r(e,["mediaResolution"]);F!=null&&s(o,["mediaResolution"],F);const x=r(e,["speechConfig"]);if(x!=null&&s(o,["speechConfig"],wg(Bo(x))),r(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const $=r(e,["thinkingConfig"]);return $!=null&&s(o,["thinkingConfig"],_g($)),o}function qr(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","model"],V(n,o));const i=r(e,["contents"]);if(i!=null){let l=Se(i);Array.isArray(l)&&(l=l.map(c=>kn(c))),s(t,["contents"],l)}const a=r(e,["config"]);return a!=null&&s(t,["generationConfig"],Rg(n,a,t)),t}function kg(n,e){const t={},o=r(n,["taskType"]);e!==void 0&&o!=null&&s(e,["requests[]","taskType"],o);const i=r(n,["title"]);e!==void 0&&i!=null&&s(e,["requests[]","title"],i);const a=r(n,["outputDimensionality"]);if(e!==void 0&&a!=null&&s(e,["requests[]","outputDimensionality"],a),r(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(r(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function Mg(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","model"],V(n,o));const i=r(e,["contents"]);i!=null&&s(t,["requests[]","content"],Vs(n,i));const a=r(e,["config"]);a!=null&&s(t,["config"],kg(a,t));const l=r(e,["model"]);return l!==void 0&&s(t,["requests[]","model"],V(n,l)),t}function Pg(n,e){const t={};if(r(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(r(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const o=r(n,["numberOfImages"]);e!==void 0&&o!=null&&s(e,["parameters","sampleCount"],o);const i=r(n,["aspectRatio"]);e!==void 0&&i!=null&&s(e,["parameters","aspectRatio"],i);const a=r(n,["guidanceScale"]);if(e!==void 0&&a!=null&&s(e,["parameters","guidanceScale"],a),r(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=r(n,["safetyFilterLevel"]);e!==void 0&&l!=null&&s(e,["parameters","safetySetting"],l);const c=r(n,["personGeneration"]);e!==void 0&&c!=null&&s(e,["parameters","personGeneration"],c);const u=r(n,["includeSafetyAttributes"]);e!==void 0&&u!=null&&s(e,["parameters","includeSafetyAttributes"],u);const d=r(n,["includeRaiReason"]);e!==void 0&&d!=null&&s(e,["parameters","includeRaiReason"],d);const h=r(n,["language"]);e!==void 0&&h!=null&&s(e,["parameters","language"],h);const f=r(n,["outputMimeType"]);e!==void 0&&f!=null&&s(e,["parameters","outputOptions","mimeType"],f);const p=r(n,["outputCompressionQuality"]);if(e!==void 0&&p!=null&&s(e,["parameters","outputOptions","compressionQuality"],p),r(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");const m=r(n,["imageSize"]);if(e!==void 0&&m!=null&&s(e,["parameters","sampleImageSize"],m),r(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function bg(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","model"],V(n,o));const i=r(e,["prompt"]);i!=null&&s(t,["instances[0]","prompt"],i);const a=r(e,["config"]);return a!=null&&s(t,["config"],Pg(a,t)),t}function Ng(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","name"],V(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],i),t}function xg(n,e,t){const o={},i=r(e,["pageSize"]);t!==void 0&&i!=null&&s(t,["_query","pageSize"],i);const a=r(e,["pageToken"]);t!==void 0&&a!=null&&s(t,["_query","pageToken"],a);const l=r(e,["filter"]);t!==void 0&&l!=null&&s(t,["_query","filter"],l);const c=r(e,["queryBase"]);return t!==void 0&&c!=null&&s(t,["_url","models_url"],Js(n,c)),o}function Lg(n,e){const t={},o=r(e,["config"]);return o!=null&&s(t,["config"],xg(n,o,t)),t}function Dg(n,e){const t={},o=r(n,["displayName"]);e!==void 0&&o!=null&&s(e,["displayName"],o);const i=r(n,["description"]);e!==void 0&&i!=null&&s(e,["description"],i);const a=r(n,["defaultCheckpointId"]);return e!==void 0&&a!=null&&s(e,["defaultCheckpointId"],a),t}function Ug(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","name"],V(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],Dg(i,t)),t}function Og(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","name"],V(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],i),t}function Hg(n){const e={};if(r(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(r(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(r(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function Bg(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","model"],V(n,o));const i=r(e,["contents"]);if(i!=null){let l=Se(i);Array.isArray(l)&&(l=l.map(c=>kn(c))),s(t,["contents"],l)}const a=r(e,["config"]);return a!=null&&s(t,["config"],Hg(a)),t}function Fg(n){const e={};if(r(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=r(n,["imageBytes"]);t!=null&&s(e,["bytesBase64Encoded"],ot(t));const o=r(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function Gg(n,e){const t={},o=r(n,["numberOfVideos"]);if(e!==void 0&&o!=null&&s(e,["parameters","sampleCount"],o),r(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(r(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const i=r(n,["durationSeconds"]);if(e!==void 0&&i!=null&&s(e,["parameters","durationSeconds"],i),r(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const a=r(n,["aspectRatio"]);if(e!==void 0&&a!=null&&s(e,["parameters","aspectRatio"],a),r(n,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const l=r(n,["personGeneration"]);if(e!==void 0&&l!=null&&s(e,["parameters","personGeneration"],l),r(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const c=r(n,["negativePrompt"]);e!==void 0&&c!=null&&s(e,["parameters","negativePrompt"],c);const u=r(n,["enhancePrompt"]);if(e!==void 0&&u!=null&&s(e,["parameters","enhancePrompt"],u),r(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");if(r(n,["lastFrame"])!==void 0)throw new Error("lastFrame parameter is not supported in Gemini API.");if(r(n,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function qg(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","model"],V(n,o));const i=r(e,["prompt"]);i!=null&&s(t,["instances[0]","prompt"],i);const a=r(e,["image"]);if(a!=null&&s(t,["instances[0]","image"],Fg(a)),r(e,["video"])!==void 0)throw new Error("video parameter is not supported in Gemini API.");const l=r(e,["config"]);return l!=null&&s(t,["config"],Gg(l,t)),t}function Vg(n){const e={},t=r(n,["fps"]);t!=null&&s(e,["fps"],t);const o=r(n,["endOffset"]);o!=null&&s(e,["endOffset"],o);const i=r(n,["startOffset"]);return i!=null&&s(e,["startOffset"],i),e}function Kg(n){const e={},t=r(n,["displayName"]);t!=null&&s(e,["displayName"],t);const o=r(n,["data"]);o!=null&&s(e,["data"],o);const i=r(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function $g(n){const e={},t=r(n,["displayName"]);t!=null&&s(e,["displayName"],t);const o=r(n,["fileUri"]);o!=null&&s(e,["fileUri"],o);const i=r(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Jg(n){const e={},t=r(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],Vg(t));const o=r(n,["thought"]);o!=null&&s(e,["thought"],o);const i=r(n,["inlineData"]);i!=null&&s(e,["inlineData"],Kg(i));const a=r(n,["fileData"]);a!=null&&s(e,["fileData"],$g(a));const l=r(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const c=r(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const u=r(n,["executableCode"]);u!=null&&s(e,["executableCode"],u);const d=r(n,["functionCall"]);d!=null&&s(e,["functionCall"],d);const h=r(n,["functionResponse"]);h!=null&&s(e,["functionResponse"],h);const f=r(n,["text"]);return f!=null&&s(e,["text"],f),e}function kt(n){const e={},t=r(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Jg(a))),s(e,["parts"],i)}const o=r(n,["role"]);return o!=null&&s(e,["role"],o),e}function zg(n){const e={},t=r(n,["anyOf"]);t!=null&&s(e,["anyOf"],t);const o=r(n,["default"]);o!=null&&s(e,["default"],o);const i=r(n,["description"]);i!=null&&s(e,["description"],i);const a=r(n,["enum"]);a!=null&&s(e,["enum"],a);const l=r(n,["example"]);l!=null&&s(e,["example"],l);const c=r(n,["format"]);c!=null&&s(e,["format"],c);const u=r(n,["items"]);u!=null&&s(e,["items"],u);const d=r(n,["maxItems"]);d!=null&&s(e,["maxItems"],d);const h=r(n,["maxLength"]);h!=null&&s(e,["maxLength"],h);const f=r(n,["maxProperties"]);f!=null&&s(e,["maxProperties"],f);const p=r(n,["maximum"]);p!=null&&s(e,["maximum"],p);const m=r(n,["minItems"]);m!=null&&s(e,["minItems"],m);const v=r(n,["minLength"]);v!=null&&s(e,["minLength"],v);const y=r(n,["minProperties"]);y!=null&&s(e,["minProperties"],y);const E=r(n,["minimum"]);E!=null&&s(e,["minimum"],E);const A=r(n,["nullable"]);A!=null&&s(e,["nullable"],A);const R=r(n,["pattern"]);R!=null&&s(e,["pattern"],R);const M=r(n,["properties"]);M!=null&&s(e,["properties"],M);const L=r(n,["propertyOrdering"]);L!=null&&s(e,["propertyOrdering"],L);const _=r(n,["required"]);_!=null&&s(e,["required"],_);const H=r(n,["title"]);H!=null&&s(e,["title"],H);const D=r(n,["type"]);return D!=null&&s(e,["type"],D),e}function Yg(n){const e={},t=r(n,["featureSelectionPreference"]);return t!=null&&s(e,["featureSelectionPreference"],t),e}function Wg(n){const e={},t=r(n,["method"]);t!=null&&s(e,["method"],t);const o=r(n,["category"]);o!=null&&s(e,["category"],o);const i=r(n,["threshold"]);return i!=null&&s(e,["threshold"],i),e}function Qg(n){const e={};if(r(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=r(n,["description"]);t!=null&&s(e,["description"],t);const o=r(n,["name"]);o!=null&&s(e,["name"],o);const i=r(n,["parameters"]);i!=null&&s(e,["parameters"],i);const a=r(n,["parametersJsonSchema"]);a!=null&&s(e,["parametersJsonSchema"],a);const l=r(n,["response"]);l!=null&&s(e,["response"],l);const c=r(n,["responseJsonSchema"]);return c!=null&&s(e,["responseJsonSchema"],c),e}function Xg(n){const e={},t=r(n,["startTime"]);t!=null&&s(e,["startTime"],t);const o=r(n,["endTime"]);return o!=null&&s(e,["endTime"],o),e}function Zg(n){const e={},t=r(n,["timeRangeFilter"]);t!=null&&s(e,["timeRangeFilter"],Xg(t));const o=r(n,["excludeDomains"]);return o!=null&&s(e,["excludeDomains"],o),e}function jg(n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const o=r(n,["dynamicThreshold"]);return o!=null&&s(e,["dynamicThreshold"],o),e}function ep(n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],jg(t)),e}function tp(n){const e={},t=r(n,["excludeDomains"]);return t!=null&&s(e,["excludeDomains"],t),e}function np(n){const e={},t=r(n,["apiKeyString"]);return t!=null&&s(e,["apiKeyString"],t),e}function op(n){const e={},t=r(n,["apiKeyConfig"]);t!=null&&s(e,["apiKeyConfig"],np(t));const o=r(n,["authType"]);o!=null&&s(e,["authType"],o);const i=r(n,["googleServiceAccountConfig"]);i!=null&&s(e,["googleServiceAccountConfig"],i);const a=r(n,["httpBasicAuthConfig"]);a!=null&&s(e,["httpBasicAuthConfig"],a);const l=r(n,["oauthConfig"]);l!=null&&s(e,["oauthConfig"],l);const c=r(n,["oidcConfig"]);return c!=null&&s(e,["oidcConfig"],c),e}function ip(n){const e={},t=r(n,["authConfig"]);return t!=null&&s(e,["authConfig"],op(t)),e}function rp(){return{}}function sp(n){const e={},t=r(n,["environment"]);return t!=null&&s(e,["environment"],t),e}function aa(n){const e={},t=r(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>Qg(p))),s(e,["functionDeclarations"],f)}const o=r(n,["retrieval"]);o!=null&&s(e,["retrieval"],o);const i=r(n,["googleSearch"]);i!=null&&s(e,["googleSearch"],Zg(i));const a=r(n,["googleSearchRetrieval"]);a!=null&&s(e,["googleSearchRetrieval"],ep(a));const l=r(n,["enterpriseWebSearch"]);l!=null&&s(e,["enterpriseWebSearch"],tp(l));const c=r(n,["googleMaps"]);c!=null&&s(e,["googleMaps"],ip(c)),r(n,["urlContext"])!=null&&s(e,["urlContext"],rp());const d=r(n,["computerUse"]);d!=null&&s(e,["computerUse"],sp(d));const h=r(n,["codeExecution"]);return h!=null&&s(e,["codeExecution"],h),e}function ap(n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const o=r(n,["allowedFunctionNames"]);return o!=null&&s(e,["allowedFunctionNames"],o),e}function lp(n){const e={},t=r(n,["latitude"]);t!=null&&s(e,["latitude"],t);const o=r(n,["longitude"]);return o!=null&&s(e,["longitude"],o),e}function cp(n){const e={},t=r(n,["latLng"]);t!=null&&s(e,["latLng"],lp(t));const o=r(n,["languageCode"]);return o!=null&&s(e,["languageCode"],o),e}function dp(n){const e={},t=r(n,["functionCallingConfig"]);t!=null&&s(e,["functionCallingConfig"],ap(t));const o=r(n,["retrievalConfig"]);return o!=null&&s(e,["retrievalConfig"],cp(o)),e}function up(n){const e={},t=r(n,["voiceName"]);return t!=null&&s(e,["voiceName"],t),e}function hp(n){const e={},t=r(n,["prebuiltVoiceConfig"]);return t!=null&&s(e,["prebuiltVoiceConfig"],up(t)),e}function fp(n){const e={},t=r(n,["voiceConfig"]);if(t!=null&&s(e,["voiceConfig"],hp(t)),r(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const o=r(n,["languageCode"]);return o!=null&&s(e,["languageCode"],o),e}function gp(n){const e={},t=r(n,["includeThoughts"]);t!=null&&s(e,["includeThoughts"],t);const o=r(n,["thinkingBudget"]);return o!=null&&s(e,["thinkingBudget"],o),e}function pp(n,e,t){const o={},i=r(e,["systemInstruction"]);t!==void 0&&i!=null&&s(t,["systemInstruction"],kt(de(i)));const a=r(e,["temperature"]);a!=null&&s(o,["temperature"],a);const l=r(e,["topP"]);l!=null&&s(o,["topP"],l);const c=r(e,["topK"]);c!=null&&s(o,["topK"],c);const u=r(e,["candidateCount"]);u!=null&&s(o,["candidateCount"],u);const d=r(e,["maxOutputTokens"]);d!=null&&s(o,["maxOutputTokens"],d);const h=r(e,["stopSequences"]);h!=null&&s(o,["stopSequences"],h);const f=r(e,["responseLogprobs"]);f!=null&&s(o,["responseLogprobs"],f);const p=r(e,["logprobs"]);p!=null&&s(o,["logprobs"],p);const m=r(e,["presencePenalty"]);m!=null&&s(o,["presencePenalty"],m);const v=r(e,["frequencyPenalty"]);v!=null&&s(o,["frequencyPenalty"],v);const y=r(e,["seed"]);y!=null&&s(o,["seed"],y);const E=r(e,["responseMimeType"]);E!=null&&s(o,["responseMimeType"],E);const A=r(e,["responseSchema"]);A!=null&&s(o,["responseSchema"],zg(Ho(A)));const R=r(e,["responseJsonSchema"]);R!=null&&s(o,["responseJsonSchema"],R);const M=r(e,["routingConfig"]);M!=null&&s(o,["routingConfig"],M);const L=r(e,["modelSelectionConfig"]);L!=null&&s(o,["modelConfig"],Yg(L));const _=r(e,["safetySettings"]);if(t!==void 0&&_!=null){let Ce=_;Array.isArray(Ce)&&(Ce=Ce.map(ne=>Wg(ne))),s(t,["safetySettings"],Ce)}const H=r(e,["tools"]);if(t!==void 0&&H!=null){let Ce=_t(H);Array.isArray(Ce)&&(Ce=Ce.map(ne=>aa(wt(ne)))),s(t,["tools"],Ce)}const D=r(e,["toolConfig"]);t!==void 0&&D!=null&&s(t,["toolConfig"],dp(D));const F=r(e,["labels"]);t!==void 0&&F!=null&&s(t,["labels"],F);const x=r(e,["cachedContent"]);t!==void 0&&x!=null&&s(t,["cachedContent"],Ve(n,x));const $=r(e,["responseModalities"]);$!=null&&s(o,["responseModalities"],$);const q=r(e,["mediaResolution"]);q!=null&&s(o,["mediaResolution"],q);const he=r(e,["speechConfig"]);he!=null&&s(o,["speechConfig"],fp(Bo(he)));const st=r(e,["audioTimestamp"]);st!=null&&s(o,["audioTimestamp"],st);const Me=r(e,["thinkingConfig"]);return Me!=null&&s(o,["thinkingConfig"],gp(Me)),o}function Vr(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","model"],V(n,o));const i=r(e,["contents"]);if(i!=null){let l=Se(i);Array.isArray(l)&&(l=l.map(c=>kt(c))),s(t,["contents"],l)}const a=r(e,["config"]);return a!=null&&s(t,["generationConfig"],pp(n,a,t)),t}function mp(n,e){const t={},o=r(n,["taskType"]);e!==void 0&&o!=null&&s(e,["instances[]","task_type"],o);const i=r(n,["title"]);e!==void 0&&i!=null&&s(e,["instances[]","title"],i);const a=r(n,["outputDimensionality"]);e!==void 0&&a!=null&&s(e,["parameters","outputDimensionality"],a);const l=r(n,["mimeType"]);e!==void 0&&l!=null&&s(e,["instances[]","mimeType"],l);const c=r(n,["autoTruncate"]);return e!==void 0&&c!=null&&s(e,["parameters","autoTruncate"],c),t}function Cp(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","model"],V(n,o));const i=r(e,["contents"]);i!=null&&s(t,["instances[]","content"],Vs(n,i));const a=r(e,["config"]);return a!=null&&s(t,["config"],mp(a,t)),t}function yp(n,e){const t={},o=r(n,["outputGcsUri"]);e!==void 0&&o!=null&&s(e,["parameters","storageUri"],o);const i=r(n,["negativePrompt"]);e!==void 0&&i!=null&&s(e,["parameters","negativePrompt"],i);const a=r(n,["numberOfImages"]);e!==void 0&&a!=null&&s(e,["parameters","sampleCount"],a);const l=r(n,["aspectRatio"]);e!==void 0&&l!=null&&s(e,["parameters","aspectRatio"],l);const c=r(n,["guidanceScale"]);e!==void 0&&c!=null&&s(e,["parameters","guidanceScale"],c);const u=r(n,["seed"]);e!==void 0&&u!=null&&s(e,["parameters","seed"],u);const d=r(n,["safetyFilterLevel"]);e!==void 0&&d!=null&&s(e,["parameters","safetySetting"],d);const h=r(n,["personGeneration"]);e!==void 0&&h!=null&&s(e,["parameters","personGeneration"],h);const f=r(n,["includeSafetyAttributes"]);e!==void 0&&f!=null&&s(e,["parameters","includeSafetyAttributes"],f);const p=r(n,["includeRaiReason"]);e!==void 0&&p!=null&&s(e,["parameters","includeRaiReason"],p);const m=r(n,["language"]);e!==void 0&&m!=null&&s(e,["parameters","language"],m);const v=r(n,["outputMimeType"]);e!==void 0&&v!=null&&s(e,["parameters","outputOptions","mimeType"],v);const y=r(n,["outputCompressionQuality"]);e!==void 0&&y!=null&&s(e,["parameters","outputOptions","compressionQuality"],y);const E=r(n,["addWatermark"]);e!==void 0&&E!=null&&s(e,["parameters","addWatermark"],E);const A=r(n,["imageSize"]);e!==void 0&&A!=null&&s(e,["parameters","sampleImageSize"],A);const R=r(n,["enhancePrompt"]);return e!==void 0&&R!=null&&s(e,["parameters","enhancePrompt"],R),t}function Tp(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","model"],V(n,o));const i=r(e,["prompt"]);i!=null&&s(t,["instances[0]","prompt"],i);const a=r(e,["config"]);return a!=null&&s(t,["config"],yp(a,t)),t}function Mt(n){const e={},t=r(n,["gcsUri"]);t!=null&&s(e,["gcsUri"],t);const o=r(n,["imageBytes"]);o!=null&&s(e,["bytesBase64Encoded"],ot(o));const i=r(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function vp(n){const e={},t=r(n,["maskMode"]);t!=null&&s(e,["maskMode"],t);const o=r(n,["segmentationClasses"]);o!=null&&s(e,["maskClasses"],o);const i=r(n,["maskDilation"]);return i!=null&&s(e,["dilation"],i),e}function Ip(n){const e={},t=r(n,["controlType"]);t!=null&&s(e,["controlType"],t);const o=r(n,["enableControlImageComputation"]);return o!=null&&s(e,["computeControl"],o),e}function Ep(n){const e={},t=r(n,["styleDescription"]);return t!=null&&s(e,["styleDescription"],t),e}function Sp(n){const e={},t=r(n,["subjectType"]);t!=null&&s(e,["subjectType"],t);const o=r(n,["subjectDescription"]);return o!=null&&s(e,["subjectDescription"],o),e}function Ap(n){const e={},t=r(n,["referenceImage"]);t!=null&&s(e,["referenceImage"],Mt(t));const o=r(n,["referenceId"]);o!=null&&s(e,["referenceId"],o);const i=r(n,["referenceType"]);i!=null&&s(e,["referenceType"],i);const a=r(n,["maskImageConfig"]);a!=null&&s(e,["maskImageConfig"],vp(a));const l=r(n,["controlImageConfig"]);l!=null&&s(e,["controlImageConfig"],Ip(l));const c=r(n,["styleImageConfig"]);c!=null&&s(e,["styleImageConfig"],Ep(c));const u=r(n,["subjectImageConfig"]);return u!=null&&s(e,["subjectImageConfig"],Sp(u)),e}function wp(n,e){const t={},o=r(n,["outputGcsUri"]);e!==void 0&&o!=null&&s(e,["parameters","storageUri"],o);const i=r(n,["negativePrompt"]);e!==void 0&&i!=null&&s(e,["parameters","negativePrompt"],i);const a=r(n,["numberOfImages"]);e!==void 0&&a!=null&&s(e,["parameters","sampleCount"],a);const l=r(n,["aspectRatio"]);e!==void 0&&l!=null&&s(e,["parameters","aspectRatio"],l);const c=r(n,["guidanceScale"]);e!==void 0&&c!=null&&s(e,["parameters","guidanceScale"],c);const u=r(n,["seed"]);e!==void 0&&u!=null&&s(e,["parameters","seed"],u);const d=r(n,["safetyFilterLevel"]);e!==void 0&&d!=null&&s(e,["parameters","safetySetting"],d);const h=r(n,["personGeneration"]);e!==void 0&&h!=null&&s(e,["parameters","personGeneration"],h);const f=r(n,["includeSafetyAttributes"]);e!==void 0&&f!=null&&s(e,["parameters","includeSafetyAttributes"],f);const p=r(n,["includeRaiReason"]);e!==void 0&&p!=null&&s(e,["parameters","includeRaiReason"],p);const m=r(n,["language"]);e!==void 0&&m!=null&&s(e,["parameters","language"],m);const v=r(n,["outputMimeType"]);e!==void 0&&v!=null&&s(e,["parameters","outputOptions","mimeType"],v);const y=r(n,["outputCompressionQuality"]);e!==void 0&&y!=null&&s(e,["parameters","outputOptions","compressionQuality"],y);const E=r(n,["addWatermark"]);e!==void 0&&E!=null&&s(e,["parameters","addWatermark"],E);const A=r(n,["editMode"]);e!==void 0&&A!=null&&s(e,["parameters","editMode"],A);const R=r(n,["baseSteps"]);return e!==void 0&&R!=null&&s(e,["parameters","editConfig","baseSteps"],R),t}function _p(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","model"],V(n,o));const i=r(e,["prompt"]);i!=null&&s(t,["instances[0]","prompt"],i);const a=r(e,["referenceImages"]);if(a!=null){let c=a;Array.isArray(c)&&(c=c.map(u=>Ap(u))),s(t,["instances[0]","referenceImages"],c)}const l=r(e,["config"]);return l!=null&&s(t,["config"],wp(l,t)),t}function Rp(n,e){const t={},o=r(n,["includeRaiReason"]);e!==void 0&&o!=null&&s(e,["parameters","includeRaiReason"],o);const i=r(n,["outputMimeType"]);e!==void 0&&i!=null&&s(e,["parameters","outputOptions","mimeType"],i);const a=r(n,["outputCompressionQuality"]);e!==void 0&&a!=null&&s(e,["parameters","outputOptions","compressionQuality"],a);const l=r(n,["enhanceInputImage"]);e!==void 0&&l!=null&&s(e,["parameters","upscaleConfig","enhanceInputImage"],l);const c=r(n,["imagePreservationFactor"]);e!==void 0&&c!=null&&s(e,["parameters","upscaleConfig","imagePreservationFactor"],c);const u=r(n,["numberOfImages"]);e!==void 0&&u!=null&&s(e,["parameters","sampleCount"],u);const d=r(n,["mode"]);return e!==void 0&&d!=null&&s(e,["parameters","mode"],d),t}function kp(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","model"],V(n,o));const i=r(e,["image"]);i!=null&&s(t,["instances[0]","image"],Mt(i));const a=r(e,["upscaleFactor"]);a!=null&&s(t,["parameters","upscaleConfig","upscaleFactor"],a);const l=r(e,["config"]);return l!=null&&s(t,["config"],Rp(l,t)),t}function Mp(n){const e={},t=r(n,["productImage"]);return t!=null&&s(e,["image"],Mt(t)),e}function Pp(n,e){const t={},o=r(n,["prompt"]);e!==void 0&&o!=null&&s(e,["instances[0]","prompt"],o);const i=r(n,["personImage"]);e!==void 0&&i!=null&&s(e,["instances[0]","personImage","image"],Mt(i));const a=r(n,["productImages"]);if(e!==void 0&&a!=null){let l=a;Array.isArray(l)&&(l=l.map(c=>Mp(c))),s(e,["instances[0]","productImages"],l)}return t}function bp(n,e){const t={},o=r(n,["numberOfImages"]);e!==void 0&&o!=null&&s(e,["parameters","sampleCount"],o);const i=r(n,["baseSteps"]);e!==void 0&&i!=null&&s(e,["parameters","editConfig","baseSteps"],i);const a=r(n,["outputGcsUri"]);e!==void 0&&a!=null&&s(e,["parameters","storageUri"],a);const l=r(n,["seed"]);e!==void 0&&l!=null&&s(e,["parameters","seed"],l);const c=r(n,["safetyFilterLevel"]);e!==void 0&&c!=null&&s(e,["parameters","safetySetting"],c);const u=r(n,["personGeneration"]);e!==void 0&&u!=null&&s(e,["parameters","personGeneration"],u);const d=r(n,["outputMimeType"]);e!==void 0&&d!=null&&s(e,["parameters","outputOptions","mimeType"],d);const h=r(n,["outputCompressionQuality"]);e!==void 0&&h!=null&&s(e,["parameters","outputOptions","compressionQuality"],h);const f=r(n,["enhancePrompt"]);return e!==void 0&&f!=null&&s(e,["parameters","enhancePrompt"],f),t}function Np(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","model"],V(n,o));const i=r(e,["source"]);i!=null&&s(t,["config"],Pp(i,t));const a=r(e,["config"]);return a!=null&&s(t,["config"],bp(a,t)),t}function xp(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","name"],V(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],i),t}function Lp(n,e,t){const o={},i=r(e,["pageSize"]);t!==void 0&&i!=null&&s(t,["_query","pageSize"],i);const a=r(e,["pageToken"]);t!==void 0&&a!=null&&s(t,["_query","pageToken"],a);const l=r(e,["filter"]);t!==void 0&&l!=null&&s(t,["_query","filter"],l);const c=r(e,["queryBase"]);return t!==void 0&&c!=null&&s(t,["_url","models_url"],Js(n,c)),o}function Dp(n,e){const t={},o=r(e,["config"]);return o!=null&&s(t,["config"],Lp(n,o,t)),t}function Up(n,e){const t={},o=r(n,["displayName"]);e!==void 0&&o!=null&&s(e,["displayName"],o);const i=r(n,["description"]);e!==void 0&&i!=null&&s(e,["description"],i);const a=r(n,["defaultCheckpointId"]);return e!==void 0&&a!=null&&s(e,["defaultCheckpointId"],a),t}function Op(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","model"],V(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],Up(i,t)),t}function Hp(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","name"],V(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],i),t}function Bp(n,e){const t={},o=r(n,["systemInstruction"]);e!==void 0&&o!=null&&s(e,["systemInstruction"],kt(de(o)));const i=r(n,["tools"]);if(e!==void 0&&i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>aa(c))),s(e,["tools"],l)}const a=r(n,["generationConfig"]);return e!==void 0&&a!=null&&s(e,["generationConfig"],a),t}function Fp(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","model"],V(n,o));const i=r(e,["contents"]);if(i!=null){let l=Se(i);Array.isArray(l)&&(l=l.map(c=>kt(c))),s(t,["contents"],l)}const a=r(e,["config"]);return a!=null&&s(t,["config"],Bp(a,t)),t}function Gp(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","model"],V(n,o));const i=r(e,["contents"]);if(i!=null){let l=Se(i);Array.isArray(l)&&(l=l.map(c=>kt(c))),s(t,["contents"],l)}const a=r(e,["config"]);return a!=null&&s(t,["config"],a),t}function qp(n){const e={},t=r(n,["uri"]);t!=null&&s(e,["gcsUri"],t);const o=r(n,["videoBytes"]);o!=null&&s(e,["bytesBase64Encoded"],ot(o));const i=r(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Vp(n,e){const t={},o=r(n,["numberOfVideos"]);e!==void 0&&o!=null&&s(e,["parameters","sampleCount"],o);const i=r(n,["outputGcsUri"]);e!==void 0&&i!=null&&s(e,["parameters","storageUri"],i);const a=r(n,["fps"]);e!==void 0&&a!=null&&s(e,["parameters","fps"],a);const l=r(n,["durationSeconds"]);e!==void 0&&l!=null&&s(e,["parameters","durationSeconds"],l);const c=r(n,["seed"]);e!==void 0&&c!=null&&s(e,["parameters","seed"],c);const u=r(n,["aspectRatio"]);e!==void 0&&u!=null&&s(e,["parameters","aspectRatio"],u);const d=r(n,["resolution"]);e!==void 0&&d!=null&&s(e,["parameters","resolution"],d);const h=r(n,["personGeneration"]);e!==void 0&&h!=null&&s(e,["parameters","personGeneration"],h);const f=r(n,["pubsubTopic"]);e!==void 0&&f!=null&&s(e,["parameters","pubsubTopic"],f);const p=r(n,["negativePrompt"]);e!==void 0&&p!=null&&s(e,["parameters","negativePrompt"],p);const m=r(n,["enhancePrompt"]);e!==void 0&&m!=null&&s(e,["parameters","enhancePrompt"],m);const v=r(n,["generateAudio"]);e!==void 0&&v!=null&&s(e,["parameters","generateAudio"],v);const y=r(n,["lastFrame"]);e!==void 0&&y!=null&&s(e,["instances[0]","lastFrame"],Mt(y));const E=r(n,["compressionQuality"]);return e!==void 0&&E!=null&&s(e,["parameters","compressionQuality"],E),t}function Kp(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["_url","model"],V(n,o));const i=r(e,["prompt"]);i!=null&&s(t,["instances[0]","prompt"],i);const a=r(e,["image"]);a!=null&&s(t,["instances[0]","image"],Mt(a));const l=r(e,["video"]);l!=null&&s(t,["instances[0]","video"],qp(l));const c=r(e,["config"]);return c!=null&&s(t,["config"],Vp(c,t)),t}function $p(n){const e={},t=r(n,["fps"]);t!=null&&s(e,["fps"],t);const o=r(n,["endOffset"]);o!=null&&s(e,["endOffset"],o);const i=r(n,["startOffset"]);return i!=null&&s(e,["startOffset"],i),e}function Jp(n){const e={},t=r(n,["data"]);t!=null&&s(e,["data"],t);const o=r(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function zp(n){const e={},t=r(n,["fileUri"]);t!=null&&s(e,["fileUri"],t);const o=r(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function Yp(n){const e={},t=r(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],$p(t));const o=r(n,["thought"]);o!=null&&s(e,["thought"],o);const i=r(n,["inlineData"]);i!=null&&s(e,["inlineData"],Jp(i));const a=r(n,["fileData"]);a!=null&&s(e,["fileData"],zp(a));const l=r(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const c=r(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const u=r(n,["executableCode"]);u!=null&&s(e,["executableCode"],u);const d=r(n,["functionCall"]);d!=null&&s(e,["functionCall"],d);const h=r(n,["functionResponse"]);h!=null&&s(e,["functionResponse"],h);const f=r(n,["text"]);return f!=null&&s(e,["text"],f),e}function Wp(n){const e={},t=r(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Yp(a))),s(e,["parts"],i)}const o=r(n,["role"]);return o!=null&&s(e,["role"],o),e}function Qp(n){const e={},t=r(n,["citationSources"]);return t!=null&&s(e,["citations"],t),e}function Xp(n){const e={},t=r(n,["retrievedUrl"]);t!=null&&s(e,["retrievedUrl"],t);const o=r(n,["urlRetrievalStatus"]);return o!=null&&s(e,["urlRetrievalStatus"],o),e}function Zp(n){const e={},t=r(n,["urlMetadata"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(i=>Xp(i))),s(e,["urlMetadata"],o)}return e}function jp(n){const e={},t=r(n,["content"]);t!=null&&s(e,["content"],Wp(t));const o=r(n,["citationMetadata"]);o!=null&&s(e,["citationMetadata"],Qp(o));const i=r(n,["tokenCount"]);i!=null&&s(e,["tokenCount"],i);const a=r(n,["finishReason"]);a!=null&&s(e,["finishReason"],a);const l=r(n,["urlContextMetadata"]);l!=null&&s(e,["urlContextMetadata"],Zp(l));const c=r(n,["avgLogprobs"]);c!=null&&s(e,["avgLogprobs"],c);const u=r(n,["groundingMetadata"]);u!=null&&s(e,["groundingMetadata"],u);const d=r(n,["index"]);d!=null&&s(e,["index"],d);const h=r(n,["logprobsResult"]);h!=null&&s(e,["logprobsResult"],h);const f=r(n,["safetyRatings"]);return f!=null&&s(e,["safetyRatings"],f),e}function Kr(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["candidates"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(d=>jp(d))),s(e,["candidates"],u)}const i=r(n,["modelVersion"]);i!=null&&s(e,["modelVersion"],i);const a=r(n,["promptFeedback"]);a!=null&&s(e,["promptFeedback"],a);const l=r(n,["responseId"]);l!=null&&s(e,["responseId"],l);const c=r(n,["usageMetadata"]);return c!=null&&s(e,["usageMetadata"],c),e}function em(n){const e={},t=r(n,["values"]);return t!=null&&s(e,["values"],t),e}function tm(){return{}}function nm(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["embeddings"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>em(l))),s(e,["embeddings"],a)}return r(n,["metadata"])!=null&&s(e,["metadata"],tm()),e}function om(n){const e={},t=r(n,["bytesBase64Encoded"]);t!=null&&s(e,["imageBytes"],ot(t));const o=r(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function la(n){const e={},t=r(n,["safetyAttributes","categories"]);t!=null&&s(e,["categories"],t);const o=r(n,["safetyAttributes","scores"]);o!=null&&s(e,["scores"],o);const i=r(n,["contentType"]);return i!=null&&s(e,["contentType"],i),e}function im(n){const e={},t=r(n,["_self"]);t!=null&&s(e,["image"],om(t));const o=r(n,["raiFilteredReason"]);o!=null&&s(e,["raiFilteredReason"],o);const i=r(n,["_self"]);return i!=null&&s(e,["safetyAttributes"],la(i)),e}function rm(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["predictions"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>im(l))),s(e,["generatedImages"],a)}const i=r(n,["positivePromptSafetyAttributes"]);return i!=null&&s(e,["positivePromptSafetyAttributes"],la(i)),e}function sm(n){const e={},t=r(n,["baseModel"]);t!=null&&s(e,["baseModel"],t);const o=r(n,["createTime"]);o!=null&&s(e,["createTime"],o);const i=r(n,["updateTime"]);return i!=null&&s(e,["updateTime"],i),e}function fo(n){const e={},t=r(n,["name"]);t!=null&&s(e,["name"],t);const o=r(n,["displayName"]);o!=null&&s(e,["displayName"],o);const i=r(n,["description"]);i!=null&&s(e,["description"],i);const a=r(n,["version"]);a!=null&&s(e,["version"],a);const l=r(n,["_self"]);l!=null&&s(e,["tunedModelInfo"],sm(l));const c=r(n,["inputTokenLimit"]);c!=null&&s(e,["inputTokenLimit"],c);const u=r(n,["outputTokenLimit"]);u!=null&&s(e,["outputTokenLimit"],u);const d=r(n,["supportedGenerationMethods"]);return d!=null&&s(e,["supportedActions"],d),e}function am(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["nextPageToken"]);o!=null&&s(e,["nextPageToken"],o);const i=r(n,["_self"]);if(i!=null){let a=zs(i);Array.isArray(a)&&(a=a.map(l=>fo(l))),s(e,["models"],a)}return e}function lm(){return{}}function cm(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["totalTokens"]);o!=null&&s(e,["totalTokens"],o);const i=r(n,["cachedContentTokenCount"]);return i!=null&&s(e,["cachedContentTokenCount"],i),e}function dm(n){const e={},t=r(n,["video","uri"]);t!=null&&s(e,["uri"],t);const o=r(n,["video","encodedVideo"]);o!=null&&s(e,["videoBytes"],ot(o));const i=r(n,["encoding"]);return i!=null&&s(e,["mimeType"],i),e}function um(n){const e={},t=r(n,["_self"]);return t!=null&&s(e,["video"],dm(t)),e}function hm(n){const e={},t=r(n,["generatedSamples"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(l=>um(l))),s(e,["generatedVideos"],a)}const o=r(n,["raiMediaFilteredCount"]);o!=null&&s(e,["raiMediaFilteredCount"],o);const i=r(n,["raiMediaFilteredReasons"]);return i!=null&&s(e,["raiMediaFilteredReasons"],i),e}function fm(n){const e={},t=r(n,["name"]);t!=null&&s(e,["name"],t);const o=r(n,["metadata"]);o!=null&&s(e,["metadata"],o);const i=r(n,["done"]);i!=null&&s(e,["done"],i);const a=r(n,["error"]);a!=null&&s(e,["error"],a);const l=r(n,["response","generateVideoResponse"]);return l!=null&&s(e,["response"],hm(l)),e}function gm(n){const e={},t=r(n,["fps"]);t!=null&&s(e,["fps"],t);const o=r(n,["endOffset"]);o!=null&&s(e,["endOffset"],o);const i=r(n,["startOffset"]);return i!=null&&s(e,["startOffset"],i),e}function pm(n){const e={},t=r(n,["displayName"]);t!=null&&s(e,["displayName"],t);const o=r(n,["data"]);o!=null&&s(e,["data"],o);const i=r(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function mm(n){const e={},t=r(n,["displayName"]);t!=null&&s(e,["displayName"],t);const o=r(n,["fileUri"]);o!=null&&s(e,["fileUri"],o);const i=r(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Cm(n){const e={},t=r(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],gm(t));const o=r(n,["thought"]);o!=null&&s(e,["thought"],o);const i=r(n,["inlineData"]);i!=null&&s(e,["inlineData"],pm(i));const a=r(n,["fileData"]);a!=null&&s(e,["fileData"],mm(a));const l=r(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const c=r(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const u=r(n,["executableCode"]);u!=null&&s(e,["executableCode"],u);const d=r(n,["functionCall"]);d!=null&&s(e,["functionCall"],d);const h=r(n,["functionResponse"]);h!=null&&s(e,["functionResponse"],h);const f=r(n,["text"]);return f!=null&&s(e,["text"],f),e}function ym(n){const e={},t=r(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Cm(a))),s(e,["parts"],i)}const o=r(n,["role"]);return o!=null&&s(e,["role"],o),e}function Tm(n){const e={},t=r(n,["citations"]);return t!=null&&s(e,["citations"],t),e}function vm(n){const e={},t=r(n,["retrievedUrl"]);t!=null&&s(e,["retrievedUrl"],t);const o=r(n,["urlRetrievalStatus"]);return o!=null&&s(e,["urlRetrievalStatus"],o),e}function Im(n){const e={},t=r(n,["urlMetadata"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(i=>vm(i))),s(e,["urlMetadata"],o)}return e}function Em(n){const e={},t=r(n,["content"]);t!=null&&s(e,["content"],ym(t));const o=r(n,["citationMetadata"]);o!=null&&s(e,["citationMetadata"],Tm(o));const i=r(n,["finishMessage"]);i!=null&&s(e,["finishMessage"],i);const a=r(n,["finishReason"]);a!=null&&s(e,["finishReason"],a);const l=r(n,["urlContextMetadata"]);l!=null&&s(e,["urlContextMetadata"],Im(l));const c=r(n,["avgLogprobs"]);c!=null&&s(e,["avgLogprobs"],c);const u=r(n,["groundingMetadata"]);u!=null&&s(e,["groundingMetadata"],u);const d=r(n,["index"]);d!=null&&s(e,["index"],d);const h=r(n,["logprobsResult"]);h!=null&&s(e,["logprobsResult"],h);const f=r(n,["safetyRatings"]);return f!=null&&s(e,["safetyRatings"],f),e}function $r(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["candidates"]);if(o!=null){let d=o;Array.isArray(d)&&(d=d.map(h=>Em(h))),s(e,["candidates"],d)}const i=r(n,["createTime"]);i!=null&&s(e,["createTime"],i);const a=r(n,["modelVersion"]);a!=null&&s(e,["modelVersion"],a);const l=r(n,["promptFeedback"]);l!=null&&s(e,["promptFeedback"],l);const c=r(n,["responseId"]);c!=null&&s(e,["responseId"],c);const u=r(n,["usageMetadata"]);return u!=null&&s(e,["usageMetadata"],u),e}function Sm(n){const e={},t=r(n,["truncated"]);t!=null&&s(e,["truncated"],t);const o=r(n,["token_count"]);return o!=null&&s(e,["tokenCount"],o),e}function Am(n){const e={},t=r(n,["values"]);t!=null&&s(e,["values"],t);const o=r(n,["statistics"]);return o!=null&&s(e,["statistics"],Sm(o)),e}function wm(n){const e={},t=r(n,["billableCharacterCount"]);return t!=null&&s(e,["billableCharacterCount"],t),e}function _m(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["predictions[]","embeddings"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>Am(l))),s(e,["embeddings"],a)}const i=r(n,["metadata"]);return i!=null&&s(e,["metadata"],wm(i)),e}function Rm(n){const e={},t=r(n,["gcsUri"]);t!=null&&s(e,["gcsUri"],t);const o=r(n,["bytesBase64Encoded"]);o!=null&&s(e,["imageBytes"],ot(o));const i=r(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function ca(n){const e={},t=r(n,["safetyAttributes","categories"]);t!=null&&s(e,["categories"],t);const o=r(n,["safetyAttributes","scores"]);o!=null&&s(e,["scores"],o);const i=r(n,["contentType"]);return i!=null&&s(e,["contentType"],i),e}function Mn(n){const e={},t=r(n,["_self"]);t!=null&&s(e,["image"],Rm(t));const o=r(n,["raiFilteredReason"]);o!=null&&s(e,["raiFilteredReason"],o);const i=r(n,["_self"]);i!=null&&s(e,["safetyAttributes"],ca(i));const a=r(n,["prompt"]);return a!=null&&s(e,["enhancedPrompt"],a),e}function km(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["predictions"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>Mn(l))),s(e,["generatedImages"],a)}const i=r(n,["positivePromptSafetyAttributes"]);return i!=null&&s(e,["positivePromptSafetyAttributes"],ca(i)),e}function Mm(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["predictions"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(a=>Mn(a))),s(e,["generatedImages"],i)}return e}function Pm(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["predictions"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(a=>Mn(a))),s(e,["generatedImages"],i)}return e}function bm(n){const e={},t=r(n,["predictions"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(i=>Mn(i))),s(e,["generatedImages"],o)}return e}function Nm(n){const e={},t=r(n,["endpoint"]);t!=null&&s(e,["name"],t);const o=r(n,["deployedModelId"]);return o!=null&&s(e,["deployedModelId"],o),e}function xm(n){const e={},t=r(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&s(e,["baseModel"],t);const o=r(n,["createTime"]);o!=null&&s(e,["createTime"],o);const i=r(n,["updateTime"]);return i!=null&&s(e,["updateTime"],i),e}function Lm(n){const e={},t=r(n,["checkpointId"]);t!=null&&s(e,["checkpointId"],t);const o=r(n,["epoch"]);o!=null&&s(e,["epoch"],o);const i=r(n,["step"]);return i!=null&&s(e,["step"],i),e}function go(n){const e={},t=r(n,["name"]);t!=null&&s(e,["name"],t);const o=r(n,["displayName"]);o!=null&&s(e,["displayName"],o);const i=r(n,["description"]);i!=null&&s(e,["description"],i);const a=r(n,["versionId"]);a!=null&&s(e,["version"],a);const l=r(n,["deployedModels"]);if(l!=null){let f=l;Array.isArray(f)&&(f=f.map(p=>Nm(p))),s(e,["endpoints"],f)}const c=r(n,["labels"]);c!=null&&s(e,["labels"],c);const u=r(n,["_self"]);u!=null&&s(e,["tunedModelInfo"],xm(u));const d=r(n,["defaultCheckpointId"]);d!=null&&s(e,["defaultCheckpointId"],d);const h=r(n,["checkpoints"]);if(h!=null){let f=h;Array.isArray(f)&&(f=f.map(p=>Lm(p))),s(e,["checkpoints"],f)}return e}function Dm(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["nextPageToken"]);o!=null&&s(e,["nextPageToken"],o);const i=r(n,["_self"]);if(i!=null){let a=zs(i);Array.isArray(a)&&(a=a.map(l=>go(l))),s(e,["models"],a)}return e}function Um(){return{}}function Om(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["totalTokens"]);return o!=null&&s(e,["totalTokens"],o),e}function Hm(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["tokensInfo"]);return o!=null&&s(e,["tokensInfo"],o),e}function Bm(n){const e={},t=r(n,["gcsUri"]);t!=null&&s(e,["uri"],t);const o=r(n,["bytesBase64Encoded"]);o!=null&&s(e,["videoBytes"],ot(o));const i=r(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Fm(n){const e={},t=r(n,["_self"]);return t!=null&&s(e,["video"],Bm(t)),e}function Gm(n){const e={},t=r(n,["videos"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(l=>Fm(l))),s(e,["generatedVideos"],a)}const o=r(n,["raiMediaFilteredCount"]);o!=null&&s(e,["raiMediaFilteredCount"],o);const i=r(n,["raiMediaFilteredReasons"]);return i!=null&&s(e,["raiMediaFilteredReasons"],i),e}function qm(n){const e={},t=r(n,["name"]);t!=null&&s(e,["name"],t);const o=r(n,["metadata"]);o!=null&&s(e,["metadata"],o);const i=r(n,["done"]);i!=null&&s(e,["done"],i);const a=r(n,["error"]);a!=null&&s(e,["error"],a);const l=r(n,["response"]);return l!=null&&s(e,["response"],Gm(l)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Vm="Content-Type",Km="X-Server-Timeout",$m="User-Agent",po="x-goog-api-client",Jm="1.14.0",zm=`google-genai-sdk/${Jm}`,Ym="v1beta1",Wm="v1beta",Jr=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class Qm{constructor(e){var t,o;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:Ym,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(o=this.clientOptions.apiVersion)!==null&&o!==void 0?o:Wm,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const o=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&o.push(e.apiVersion),o.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,o){const i=[this.getRequestUrlInternal(t)];return o&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const o=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,o);if(e.queryParams)for(const[l,c]of Object.entries(e.queryParams))i.searchParams.append(l,String(c));let a={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else a.body=e.body;return a=await this.includeExtraHttpOptionsToRequestInit(a,t,e.abortSignal),this.unaryApiCall(i,a,e.httpMethod)}patchHttpOptions(e,t){const o=JSON.parse(JSON.stringify(e));for(const[i,a]of Object.entries(t))typeof a=="object"?o[i]=Object.assign(Object.assign({},o[i]),a):a!==void 0&&(o[i]=a);return o}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const o=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,o);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let a={};return a.body=e.body,a=await this.includeExtraHttpOptionsToRequestInit(a,t,e.abortSignal),this.streamApiCall(i,a,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,o){if(t&&t.timeout||o){const i=new AbortController,a=i.signal;if(t.timeout&&t?.timeout>0){const l=setTimeout(()=>i.abort(),t.timeout);l&&typeof l.unref=="function"&&l.unref()}o&&o.addEventListener("abort",()=>{i.abort()}),e.signal=a}return t&&t.extraBody!==null&&Xm(e,t.extraBody),e.headers=await this.getHeadersInternal(t),e}async unaryApiCall(e,t,o){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:o})).then(async i=>(await zr(i),new so(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,t,o){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:o})).then(async i=>(await zr(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){var t;return mt(this,arguments,function*(){const i=(t=e?.body)===null||t===void 0?void 0:t.getReader(),a=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let l="";for(;;){const{done:c,value:u}=yield W(i.read());if(c){if(l.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const d=a.decode(u,{stream:!0});try{const f=JSON.parse(d);if("error"in f){const p=JSON.parse(JSON.stringify(f.error)),m=p.status,v=p.code,y=`got status: ${m}. ${JSON.stringify(f)}`;if(v>=400&&v<600)throw new Rn({message:y,status:v})}}catch(f){if(f.name==="ApiError")throw f}l+=d;let h=l.match(Jr);for(;h;){const f=h[1];try{const p=new Response(f,{headers:e?.headers,status:e?.status,statusText:e?.statusText});yield yield W(new so(p)),l=l.slice(h[0].length),h=l.match(Jr)}catch(p){throw new Error(`exception parsing stream chunk ${f}. ${p}`)}}}}finally{i.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(o=>{throw new Error(`exception ${o} sending request`)})}getDefaultHeaders(){const e={},t=zm+" "+this.clientOptions.userAgentExtra;return e[$m]=t,e[po]=t,e[Vm]="application/json",e}async getHeadersInternal(e){const t=new Headers;if(e&&e.headers){for(const[o,i]of Object.entries(e.headers))t.append(o,i);e.timeout&&e.timeout>0&&t.append(Km,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(t),t}async uploadFile(e,t){var o;const i={};t!=null&&(i.mimeType=t.mimeType,i.name=t.name,i.displayName=t.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const a=this.clientOptions.uploader,l=await a.stat(e);i.sizeBytes=String(l.size);const c=(o=t?.mimeType)!==null&&o!==void 0?o:l.type;if(c===void 0||c==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=c;const u=await this.fetchUploadUrl(i,t);return a.upload(e,u,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t){var o;let i={};t?.httpOptions?i=t.httpOptions:i={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};const a={file:e},l=await this.request({path:P("upload/v1beta/files",a._url),body:JSON.stringify(a),httpMethod:"POST",httpOptions:i});if(!l||!l?.headers)throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const c=(o=l?.headers)===null||o===void 0?void 0:o["x-goog-upload-url"];if(c===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return c}}async function zr(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){const t=n.status;let o;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?o=await n.json():o={error:{message:await n.text(),code:n.status,status:n.statusText}};const i=JSON.stringify(o);throw t>=400&&t<600?new Rn({message:i,status:t}):new Error(i)}}function Xm(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{const a=JSON.parse(n.body);if(typeof a=="object"&&a!==null&&!Array.isArray(a))t=a;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function o(a,l){const c=Object.assign({},a);for(const u in l)if(Object.prototype.hasOwnProperty.call(l,u)){const d=l[u],h=c[u];d&&typeof d=="object"&&!Array.isArray(d)&&h&&typeof h=="object"&&!Array.isArray(h)?c[u]=o(h,d):(h&&d&&typeof h!=typeof d&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${u}". Original type: ${typeof h}, New type: ${typeof d}. Overwriting.`),c[u]=d)}return c}const i=o(t,e);n.body=JSON.stringify(i)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Zm="mcp_used/unknown";let jm=!1;function da(n){for(const e of n)if(eC(e)||typeof e=="object"&&"inputSchema"in e)return!0;return jm}function ua(n){var e;const t=(e=n[po])!==null&&e!==void 0?e:"";n[po]=(t+` ${Zm}`).trimStart()}function eC(n){return n!==null&&typeof n=="object"&&n instanceof Go}function tC(n,e=100){return mt(this,arguments,function*(){let o,i=0;for(;i<e;){const a=yield W(n.listTools({cursor:o}));for(const l of a.tools)yield yield W(l),i++;if(!a.nextCursor)break;o=a.nextCursor}})}class Go{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new Go(e,t)}async initialize(){var e,t,o,i;if(this.mcpTools.length>0)return;const a={},l=[];for(const h of this.mcpClients)try{for(var c=!0,u=(t=void 0,Ut(tC(h))),d;d=await u.next(),e=d.done,!e;c=!0){i=d.value,c=!1;const f=i;l.push(f);const p=f.name;if(a[p])throw new Error(`Duplicate function name ${p} found in MCP tools. Please ensure function names are unique.`);a[p]=h}}catch(f){t={error:f}}finally{try{!c&&!e&&(o=u.return)&&await o.call(u)}finally{if(t)throw t.error}}this.mcpTools=l,this.functionNameToMcpClient=a}async tool(){return await this.initialize(),Oc(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const o of e)if(o.name in this.functionNameToMcpClient){const i=this.functionNameToMcpClient[o.name];let a;this.config.timeout&&(a={timeout:this.config.timeout});const l=await i.callTool({name:o.name,arguments:o.args},void 0,a);t.push({functionResponse:{name:o.name,response:l.isError?{error:l}:l}})}return t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function nC(n,e,t){const o=new Mc;let i;t.data instanceof Blob?i=JSON.parse(await t.data.text()):i=JSON.parse(t.data);const a=Vf(i);Object.assign(o,a),e(o)}class oC{constructor(e,t,o){this.apiClient=e,this.auth=t,this.webSocketFactory=o}async connect(e){var t,o;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),a=this.apiClient.getApiVersion(),l=sC(this.apiClient.getDefaultHeaders()),c=this.apiClient.getApiKey(),u=`${i}/ws/google.ai.generativelanguage.${a}.GenerativeService.BidiGenerateMusic?key=${c}`;let d=()=>{};const h=new Promise(M=>{d=M}),f=e.callbacks,p=function(){d({})},m=this.apiClient,v={onopen:p,onmessage:M=>{nC(m,f.onmessage,M)},onerror:(t=f?.onerror)!==null&&t!==void 0?t:function(M){},onclose:(o=f?.onclose)!==null&&o!==void 0?o:function(M){}},y=this.webSocketFactory.create(u,rC(l),v);y.connect(),await h;const E=V(this.apiClient,e.model),A=ia({model:E}),R=ho({setup:A});return y.send(JSON.stringify(R)),new iC(y,this.apiClient)}}class iC{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=Bh(e),o=ra(t);this.conn.send(JSON.stringify({clientContent:o}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=Fh(e),o=ho(t);this.conn.send(JSON.stringify(o))}sendPlaybackControl(e){const t=ho({playbackControl:e});this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(ut.PLAY)}pause(){this.sendPlaybackControl(ut.PAUSE)}stop(){this.sendPlaybackControl(ut.STOP)}resetContext(){this.sendPlaybackControl(ut.RESET_CONTEXT)}close(){this.conn.close()}}function rC(n){const e={};return n.forEach((t,o)=>{e[o]=t}),e}function sC(n){const e=new Headers;for(const[t,o]of Object.entries(n))e.append(t,o);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const aC="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function lC(n,e,t){const o=new kc;let i;t.data instanceof Blob?i=await t.data.text():t.data instanceof ArrayBuffer?i=new TextDecoder().decode(t.data):i=t.data;const a=JSON.parse(i);if(n.isVertexAI()){const l=og(a);Object.assign(o,l)}else{const l=Lf(a);Object.assign(o,l)}e(o)}class cC{constructor(e,t,o){this.apiClient=e,this.auth=t,this.webSocketFactory=o,this.music=new oC(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,o,i,a,l,c;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const u=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let h;const f=this.apiClient.getHeaders();e.config&&e.config.tools&&da(e.config.tools)&&ua(f);const p=fC(f);if(this.apiClient.isVertexAI())h=`${u}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(p);else{const x=this.apiClient.getApiKey();let $="BidiGenerateContent",q="key";x?.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),d!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),$="BidiGenerateContentConstrained",q="access_token"),h=`${u}/ws/google.ai.generativelanguage.${d}.GenerativeService.${$}?${q}=${x}`}let m=()=>{};const v=new Promise(x=>{m=x}),y=e.callbacks,E=function(){var x;(x=y?.onopen)===null||x===void 0||x.call(y),m({})},A=this.apiClient,R={onopen:E,onmessage:x=>{lC(A,y.onmessage,x)},onerror:(t=y?.onerror)!==null&&t!==void 0?t:function(x){},onclose:(o=y?.onclose)!==null&&o!==void 0?o:function(x){}},M=this.webSocketFactory.create(h,hC(p),R);M.connect(),await v;let L=V(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&L.startsWith("publishers/")){const x=this.apiClient.getProject(),$=this.apiClient.getLocation();L=`projects/${x}/locations/${$}/`+L}let _={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[un.AUDIO]}:e.config.responseModalities=[un.AUDIO]),!((a=e.config)===null||a===void 0)&&a.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const H=(c=(l=e.config)===null||l===void 0?void 0:l.tools)!==null&&c!==void 0?c:[],D=[];for(const x of H)if(this.isCallableTool(x)){const $=x;D.push(await $.tool())}else D.push(x);D.length>0&&(e.config.tools=D);const F={model:L,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?_=pf(this.apiClient,F):_=Dh(this.apiClient,F),delete _.config,M.send(JSON.stringify(_)),new uC(M,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const dC={turnComplete:!0};class uC{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let o=[];try{o=Se(t.turns),e.isVertexAI()?o=o.map(i=>kt(i)):o=o.map(i=>kn(i))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:o,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let o=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?o=t.functionResponses:o=[t.functionResponses],o.length===0)throw new Error("functionResponses is required.");for(const a of o){if(typeof a!="object"||a===null||!("name"in a)||!("response"in a))throw new Error(`Could not parse function response, type '${typeof a}'.`);if(!e.isVertexAI()&&!("id"in a))throw new Error(aC)}return{toolResponse:{functionResponses:o}}}sendClientContent(e){e=Object.assign(Object.assign({},dC),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:yf(e)}:t={realtimeInput:Hh(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function hC(n){const e={};return n.forEach((t,o)=>{e[o]=t}),e}function fC(n){const e=new Headers;for(const[t,o]of Object.entries(n))e.append(t,o);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Yr=10;function Wr(n){var e,t,o;if(!((e=n?.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(const l of(t=n?.tools)!==null&&t!==void 0?t:[])if(Ct(l)){i=!0;break}if(!i)return!0;const a=(o=n?.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls;return a&&(a<0||!Number.isInteger(a))||a==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",a),!0):!1}function Ct(n){return"callTool"in n&&typeof n.callTool=="function"}function gC(n){var e,t,o;return(o=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(i=>Ct(i)))!==null&&o!==void 0?o:!1}function pC(n){var e,t,o;return(o=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(i=>!Ct(i)))!==null&&o!==void 0?o:!1}function Qr(n){var e;return!(!((e=n?.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class mC extends nt{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var o,i,a,l,c;const u=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!gC(t)||Wr(t.config))return await this.generateContentInternal(u);if(pC(t))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");let d,h;const f=Se(u.contents),p=(a=(i=(o=u.config)===null||o===void 0?void 0:o.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&a!==void 0?a:Yr;let m=0;for(;m<p&&(d=await this.generateContentInternal(u),!(!d.functionCalls||d.functionCalls.length===0));){const v=d.candidates[0].content,y=[];for(const E of(c=(l=t.config)===null||l===void 0?void 0:l.tools)!==null&&c!==void 0?c:[])if(Ct(E)){const R=await E.callTool(d.functionCalls);y.push(...R)}m++,h={role:"user",parts:y},u.contents=Se(u.contents),u.contents.push(v),u.contents.push(h),Qr(u.config)&&(f.push(v),f.push(h))}return Qr(u.config)&&(d.automaticFunctionCallingHistory=f),d},this.generateContentStream=async t=>{if(this.maybeMoveToResponseJsonSchem(t),Wr(t.config)){const o=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(o)}else return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(o=>{var i;let a;const l=[];if(o?.generatedImages)for(const u of o.generatedImages)u&&u?.safetyAttributes&&((i=u?.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?a=u?.safetyAttributes:l.push(u);let c;return a?c={generatedImages:l,positivePromptSafetyAttributes:a,sdkHttpResponse:o.sdkHttpResponse}:c={generatedImages:l,sdkHttpResponse:o.sdkHttpResponse},c}),this.list=async t=>{var o;const l={config:Object.assign(Object.assign({},{queryBase:!0}),t?.config)};if(this.apiClient.isVertexAI()&&!l.config.queryBase){if(!((o=l.config)===null||o===void 0)&&o.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");l.config.filter="labels.tune-type:*"}return new Kt(Xe.PAGED_ITEM_MODELS,c=>this.listInternal(c),await this.listInternal(l),l)},this.editImage=async t=>{const o={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(o.referenceImages=t.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(o)},this.upscaleImage=async t=>{let o={numberOfImages:1,mode:"upscale"};t.config&&(o=Object.assign(Object.assign({},o),t.config));const i={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:o};return await this.upscaleImageInternal(i)},this.generateVideos=async t=>await this.generateVideosInternal(t)}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,o,i;const a=(t=e.config)===null||t===void 0?void 0:t.tools;if(!a)return e;const l=await Promise.all(a.map(async u=>Ct(u)?await u.tool():u)),c={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:l})};if(c.config.tools=l,e.config&&e.config.tools&&da(e.config.tools)){const u=(i=(o=e.config.httpOptions)===null||o===void 0?void 0:o.headers)!==null&&i!==void 0?i:{};let d=Object.assign({},u);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),ua(d),c.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:d})}return c}async initAfcToolsMap(e){var t,o,i;const a=new Map;for(const l of(o=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&o!==void 0?o:[])if(Ct(l)){const c=l,u=await c.tool();for(const d of(i=u.functionDeclarations)!==null&&i!==void 0?i:[]){if(!d.name)throw new Error("Function declaration name is required.");if(a.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);a.set(d.name,c)}}return a}async processAfcStream(e){var t,o,i;const a=(i=(o=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls)!==null&&i!==void 0?i:Yr;let l=!1,c=0;const u=await this.initAfcToolsMap(e);return(function(d,h,f){var p,m;return mt(this,arguments,function*(){for(var v,y,E,A;c<a;){l&&(c++,l=!1);const _=yield W(d.processParamsMaybeAddMcpUsage(f)),H=yield W(d.generateContentStreamInternal(_)),D=[],F=[];try{for(var R=!0,M=(y=void 0,Ut(H)),L;L=yield W(M.next()),v=L.done,!v;R=!0){A=L.value,R=!1;const x=A;if(yield yield W(x),x.candidates&&(!((p=x.candidates[0])===null||p===void 0)&&p.content)){F.push(x.candidates[0].content);for(const $ of(m=x.candidates[0].content.parts)!==null&&m!==void 0?m:[])if(c<a&&$.functionCall){if(!$.functionCall.name)throw new Error("Function call name was not returned by the model.");if(h.has($.functionCall.name)){const q=yield W(h.get($.functionCall.name).callTool([$.functionCall]));D.push(...q)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${h.keys()}, mising tool: ${$.functionCall.name}`)}}}}catch(x){y={error:x}}finally{try{!R&&!v&&(E=M.return)&&(yield W(E.call(M)))}finally{if(y)throw y.error}}if(D.length>0){l=!0;const x=new Nt;x.candidates=[{content:{role:"user",parts:D}}],yield yield W(x);const $=[];$.push(...F),$.push({role:"user",parts:D});const q=Se(f.contents).concat($);f.contents=q}else break}})})(this,u,e)}async generateContentInternal(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=Vr(this.apiClient,e);return c=P("{model}:generateContent",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>{const f=$r(h),p=new Nt;return Object.assign(p,f),p})}else{const d=qr(this.apiClient,e);return c=P("{model}:generateContent",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>{const f=Kr(h),p=new Nt;return Object.assign(p,f),p})}}async generateContentStreamInternal(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=Vr(this.apiClient,e);return c=P("{model}:streamGenerateContent?alt=sse",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.requestStream({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),l.then(function(f){return mt(this,arguments,function*(){var p,m,v,y;try{for(var E=!0,A=Ut(f),R;R=yield W(A.next()),p=R.done,!p;E=!0){y=R.value,E=!1;const M=y,L=$r(yield W(M.json()));L.sdkHttpResponse={headers:M.headers};const _=new Nt;Object.assign(_,L),yield yield W(_)}}catch(M){m={error:M}}finally{try{!E&&!p&&(v=A.return)&&(yield W(v.call(A)))}finally{if(m)throw m.error}}})})}else{const d=qr(this.apiClient,e);return c=P("{model}:streamGenerateContent?alt=sse",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.requestStream({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}),l.then(function(f){return mt(this,arguments,function*(){var p,m,v,y;try{for(var E=!0,A=Ut(f),R;R=yield W(A.next()),p=R.done,!p;E=!0){y=R.value,E=!1;const M=y,L=Kr(yield W(M.json()));L.sdkHttpResponse={headers:M.headers};const _=new Nt;Object.assign(_,L),yield yield W(_)}}catch(M){m={error:M}}finally{try{!E&&!p&&(v=A.return)&&(yield W(v.call(A)))}finally{if(m)throw m.error}}})})}}async embedContent(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=Cp(this.apiClient,e);return c=P("{model}:predict",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>{const f=_m(h),p=new Ir;return Object.assign(p,f),p})}else{const d=Mg(this.apiClient,e);return c=P("{model}:batchEmbedContents",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>{const f=nm(h),p=new Ir;return Object.assign(p,f),p})}}async generateImagesInternal(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=Tp(this.apiClient,e);return c=P("{model}:predict",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>{const f=km(h),p=new Er;return Object.assign(p,f),p})}else{const d=bg(this.apiClient,e);return c=P("{model}:predict",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>{const f=rm(h),p=new Er;return Object.assign(p,f),p})}}async editImageInternal(e){var t,o;let i,a="",l={};if(this.apiClient.isVertexAI()){const c=_p(this.apiClient,e);return a=P("{model}:predict",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:u.headers},h})),i.then(u=>{const d=Mm(u),h=new Ic;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,o;let i,a="",l={};if(this.apiClient.isVertexAI()){const c=kp(this.apiClient,e);return a=P("{model}:predict",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:u.headers},h})),i.then(u=>{const d=Pm(u),h=new Ec;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,o;let i,a="",l={};if(this.apiClient.isVertexAI()){const c=Np(this.apiClient,e);return a=P("{model}:predict",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json()),i.then(u=>{const d=bm(u),h=new Sc;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=xp(this.apiClient,e);return c=P("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l.then(h=>go(h))}else{const d=Ng(this.apiClient,e);return c=P("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),l.then(h=>fo(h))}}async listInternal(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=Dp(this.apiClient,e);return c=P("{models_url}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>{const f=Dm(h),p=new Sr;return Object.assign(p,f),p})}else{const d=Lg(this.apiClient,e);return c=P("{models_url}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>{const f=am(h),p=new Sr;return Object.assign(p,f),p})}}async update(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=Op(this.apiClient,e);return c=P("{model}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l.then(h=>go(h))}else{const d=Ug(this.apiClient,e);return c=P("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),l.then(h=>fo(h))}}async delete(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=Hp(this.apiClient,e);return c=P("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l.then(()=>{const h=Um(),f=new Ar;return Object.assign(f,h),f})}else{const d=Og(this.apiClient,e);return c=P("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),l.then(()=>{const h=lm(),f=new Ar;return Object.assign(f,h),f})}}async countTokens(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=Fp(this.apiClient,e);return c=P("{model}:countTokens",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>{const f=Om(h),p=new wr;return Object.assign(p,f),p})}else{const d=Bg(this.apiClient,e);return c=P("{model}:countTokens",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>{const f=cm(h),p=new wr;return Object.assign(p,f),p})}}async computeTokens(e){var t,o;let i,a="",l={};if(this.apiClient.isVertexAI()){const c=Gp(this.apiClient,e);return a=P("{model}:computeTokens",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:u.headers},h})),i.then(u=>{const d=Hm(u),h=new Ac;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=Kp(this.apiClient,e);return c=P("{model}:predictLongRunning",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l.then(h=>{const f=qm(h),p=new hn;return Object.assign(p,f),p})}else{const d=qg(this.apiClient,e);return c=P("{model}:predictLongRunning",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),l.then(h=>{const f=fm(h),p=new hn;return Object.assign(p,f),p})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function CC(n){const e={},t=r(n,["operationName"]);t!=null&&s(e,["_url","operationName"],t);const o=r(n,["config"]);return o!=null&&s(e,["config"],o),e}function yC(n){const e={},t=r(n,["operationName"]);t!=null&&s(e,["_url","operationName"],t);const o=r(n,["config"]);return o!=null&&s(e,["config"],o),e}function TC(n){const e={},t=r(n,["operationName"]);t!=null&&s(e,["operationName"],t);const o=r(n,["resourceName"]);o!=null&&s(e,["_url","resourceName"],o);const i=r(n,["config"]);return i!=null&&s(e,["config"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class vC extends nt{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,o=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=t.name.split("/operations/")[0];let a;o&&"httpOptions"in o&&(a=o.httpOptions);const l=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:a}});return t._fromAPIResponse({apiResponse:l,isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:t.name,config:o});return t._fromAPIResponse({apiResponse:i,isVertexAI:!1})}}async get(e){const t=e.operation,o=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=t.name.split("/operations/")[0];let a;o&&"httpOptions"in o&&(a=o.httpOptions);const l=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:a}});return t._fromAPIResponse({apiResponse:l,isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:t.name,config:o});return t._fromAPIResponse({apiResponse:i,isVertexAI:!1})}}async getVideosOperationInternal(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=yC(e);return c=P("{operationName}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l}else{const d=CC(e);return c=P("{operationName}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),l}}async fetchPredictVideosOperationInternal(e){var t,o;let i,a="",l={};if(this.apiClient.isVertexAI()){const c=TC(e);return a=P("{resourceName}:fetchPredictOperation",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function IC(n){const e={},t=r(n,["voiceName"]);return t!=null&&s(e,["voiceName"],t),e}function ha(n){const e={},t=r(n,["prebuiltVoiceConfig"]);return t!=null&&s(e,["prebuiltVoiceConfig"],IC(t)),e}function EC(n){const e={},t=r(n,["speaker"]);t!=null&&s(e,["speaker"],t);const o=r(n,["voiceConfig"]);return o!=null&&s(e,["voiceConfig"],ha(o)),e}function SC(n){const e={},t=r(n,["speakerVoiceConfigs"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(i=>EC(i))),s(e,["speakerVoiceConfigs"],o)}return e}function AC(n){const e={},t=r(n,["voiceConfig"]);t!=null&&s(e,["voiceConfig"],ha(t));const o=r(n,["multiSpeakerVoiceConfig"]);o!=null&&s(e,["multiSpeakerVoiceConfig"],SC(o));const i=r(n,["languageCode"]);return i!=null&&s(e,["languageCode"],i),e}function wC(n){const e={},t=r(n,["fps"]);t!=null&&s(e,["fps"],t);const o=r(n,["endOffset"]);o!=null&&s(e,["endOffset"],o);const i=r(n,["startOffset"]);return i!=null&&s(e,["startOffset"],i),e}function _C(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["data"]);t!=null&&s(e,["data"],t);const o=r(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function RC(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["fileUri"]);t!=null&&s(e,["fileUri"],t);const o=r(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function kC(n){const e={},t=r(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],wC(t));const o=r(n,["thought"]);o!=null&&s(e,["thought"],o);const i=r(n,["inlineData"]);i!=null&&s(e,["inlineData"],_C(i));const a=r(n,["fileData"]);a!=null&&s(e,["fileData"],RC(a));const l=r(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const c=r(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const u=r(n,["executableCode"]);u!=null&&s(e,["executableCode"],u);const d=r(n,["functionCall"]);d!=null&&s(e,["functionCall"],d);const h=r(n,["functionResponse"]);h!=null&&s(e,["functionResponse"],h);const f=r(n,["text"]);return f!=null&&s(e,["text"],f),e}function MC(n){const e={},t=r(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>kC(a))),s(e,["parts"],i)}const o=r(n,["role"]);return o!=null&&s(e,["role"],o),e}function PC(n){const e={},t=r(n,["behavior"]);t!=null&&s(e,["behavior"],t);const o=r(n,["description"]);o!=null&&s(e,["description"],o);const i=r(n,["name"]);i!=null&&s(e,["name"],i);const a=r(n,["parameters"]);a!=null&&s(e,["parameters"],a);const l=r(n,["parametersJsonSchema"]);l!=null&&s(e,["parametersJsonSchema"],l);const c=r(n,["response"]);c!=null&&s(e,["response"],c);const u=r(n,["responseJsonSchema"]);return u!=null&&s(e,["responseJsonSchema"],u),e}function bC(n){const e={},t=r(n,["startTime"]);t!=null&&s(e,["startTime"],t);const o=r(n,["endTime"]);return o!=null&&s(e,["endTime"],o),e}function NC(n){const e={},t=r(n,["timeRangeFilter"]);if(t!=null&&s(e,["timeRangeFilter"],bC(t)),r(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function xC(n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const o=r(n,["dynamicThreshold"]);return o!=null&&s(e,["dynamicThreshold"],o),e}function LC(n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],xC(t)),e}function DC(){return{}}function UC(n){const e={},t=r(n,["environment"]);return t!=null&&s(e,["environment"],t),e}function OC(n){const e={},t=r(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(d=>PC(d))),s(e,["functionDeclarations"],u)}if(r(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const o=r(n,["googleSearch"]);o!=null&&s(e,["googleSearch"],NC(o));const i=r(n,["googleSearchRetrieval"]);if(i!=null&&s(e,["googleSearchRetrieval"],LC(i)),r(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");r(n,["urlContext"])!=null&&s(e,["urlContext"],DC());const l=r(n,["computerUse"]);l!=null&&s(e,["computerUse"],UC(l));const c=r(n,["codeExecution"]);return c!=null&&s(e,["codeExecution"],c),e}function HC(n){const e={},t=r(n,["handle"]);if(t!=null&&s(e,["handle"],t),r(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Xr(){return{}}function BC(n){const e={},t=r(n,["disabled"]);t!=null&&s(e,["disabled"],t);const o=r(n,["startOfSpeechSensitivity"]);o!=null&&s(e,["startOfSpeechSensitivity"],o);const i=r(n,["endOfSpeechSensitivity"]);i!=null&&s(e,["endOfSpeechSensitivity"],i);const a=r(n,["prefixPaddingMs"]);a!=null&&s(e,["prefixPaddingMs"],a);const l=r(n,["silenceDurationMs"]);return l!=null&&s(e,["silenceDurationMs"],l),e}function FC(n){const e={},t=r(n,["automaticActivityDetection"]);t!=null&&s(e,["automaticActivityDetection"],BC(t));const o=r(n,["activityHandling"]);o!=null&&s(e,["activityHandling"],o);const i=r(n,["turnCoverage"]);return i!=null&&s(e,["turnCoverage"],i),e}function GC(n){const e={},t=r(n,["targetTokens"]);return t!=null&&s(e,["targetTokens"],t),e}function qC(n){const e={},t=r(n,["triggerTokens"]);t!=null&&s(e,["triggerTokens"],t);const o=r(n,["slidingWindow"]);return o!=null&&s(e,["slidingWindow"],GC(o)),e}function VC(n){const e={},t=r(n,["proactiveAudio"]);return t!=null&&s(e,["proactiveAudio"],t),e}function KC(n,e){const t={},o=r(n,["generationConfig"]);e!==void 0&&o!=null&&s(e,["setup","generationConfig"],o);const i=r(n,["responseModalities"]);e!==void 0&&i!=null&&s(e,["setup","generationConfig","responseModalities"],i);const a=r(n,["temperature"]);e!==void 0&&a!=null&&s(e,["setup","generationConfig","temperature"],a);const l=r(n,["topP"]);e!==void 0&&l!=null&&s(e,["setup","generationConfig","topP"],l);const c=r(n,["topK"]);e!==void 0&&c!=null&&s(e,["setup","generationConfig","topK"],c);const u=r(n,["maxOutputTokens"]);e!==void 0&&u!=null&&s(e,["setup","generationConfig","maxOutputTokens"],u);const d=r(n,["mediaResolution"]);e!==void 0&&d!=null&&s(e,["setup","generationConfig","mediaResolution"],d);const h=r(n,["seed"]);e!==void 0&&h!=null&&s(e,["setup","generationConfig","seed"],h);const f=r(n,["speechConfig"]);e!==void 0&&f!=null&&s(e,["setup","generationConfig","speechConfig"],AC(Fo(f)));const p=r(n,["enableAffectiveDialog"]);e!==void 0&&p!=null&&s(e,["setup","generationConfig","enableAffectiveDialog"],p);const m=r(n,["systemInstruction"]);e!==void 0&&m!=null&&s(e,["setup","systemInstruction"],MC(de(m)));const v=r(n,["tools"]);if(e!==void 0&&v!=null){let _=_t(v);Array.isArray(_)&&(_=_.map(H=>OC(wt(H)))),s(e,["setup","tools"],_)}const y=r(n,["sessionResumption"]);e!==void 0&&y!=null&&s(e,["setup","sessionResumption"],HC(y));const E=r(n,["inputAudioTranscription"]);e!==void 0&&E!=null&&s(e,["setup","inputAudioTranscription"],Xr());const A=r(n,["outputAudioTranscription"]);e!==void 0&&A!=null&&s(e,["setup","outputAudioTranscription"],Xr());const R=r(n,["realtimeInputConfig"]);e!==void 0&&R!=null&&s(e,["setup","realtimeInputConfig"],FC(R));const M=r(n,["contextWindowCompression"]);e!==void 0&&M!=null&&s(e,["setup","contextWindowCompression"],qC(M));const L=r(n,["proactivity"]);return e!==void 0&&L!=null&&s(e,["setup","proactivity"],VC(L)),t}function $C(n,e){const t={},o=r(e,["model"]);o!=null&&s(t,["setup","model"],V(n,o));const i=r(e,["config"]);return i!=null&&s(t,["config"],KC(i,t)),t}function JC(n,e,t){const o={},i=r(e,["expireTime"]);t!==void 0&&i!=null&&s(t,["expireTime"],i);const a=r(e,["newSessionExpireTime"]);t!==void 0&&a!=null&&s(t,["newSessionExpireTime"],a);const l=r(e,["uses"]);t!==void 0&&l!=null&&s(t,["uses"],l);const c=r(e,["liveConnectConstraints"]);t!==void 0&&c!=null&&s(t,["bidiGenerateContentSetup"],$C(n,c));const u=r(e,["lockAdditionalFields"]);return t!==void 0&&u!=null&&s(t,["fieldMask"],u),o}function zC(n,e){const t={},o=r(e,["config"]);return o!=null&&s(t,["config"],JC(n,o,t)),t}function YC(n){const e={},t=r(n,["name"]);return t!=null&&s(e,["name"],t),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function WC(n){const e=[];for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const o=n[t];if(typeof o=="object"&&o!=null&&Object.keys(o).length>0){const i=Object.keys(o).map(a=>`${t}.${a}`);e.push(...i)}else e.push(t)}return e.join(",")}function QC(n,e){let t=null;const o=n.bidiGenerateContentSetup;if(typeof o=="object"&&o!==null&&"setup"in o){const a=o.setup;typeof a=="object"&&a!==null?(n.bidiGenerateContentSetup=a,t=a):delete n.bidiGenerateContentSetup}else o!==void 0&&delete n.bidiGenerateContentSetup;const i=n.fieldMask;if(t){const a=WC(t);if(Array.isArray(e?.lockAdditionalFields)&&e?.lockAdditionalFields.length===0)a?n.fieldMask=a:delete n.fieldMask;else if(e?.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){const l=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let c=[];i.length>0&&(c=i.map(d=>l.includes(d)?`generationConfig.${d}`:d));const u=[];a&&u.push(a),c.length>0&&u.push(...c),u.length>0?n.fieldMask=u.join(","):delete n.fieldMask}else delete n.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?n.fieldMask=i.join(","):delete n.fieldMask;return n}class XC extends nt{constructor(e){super(),this.apiClient=e}async create(e){var t,o;let i,a="",l={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const c=zC(this.apiClient,e);a=P("auth_tokens",c._url),l=c._query,delete c.config,delete c._url,delete c._query;const u=QC(c,e.config);return i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>YC(d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ZC(n){const e={},t=r(n,["name"]);t!=null&&s(e,["_url","name"],t);const o=r(n,["config"]);return o!=null&&s(e,["config"],o),e}function jC(n,e){const t={},o=r(n,["pageSize"]);e!==void 0&&o!=null&&s(e,["_query","pageSize"],o);const i=r(n,["pageToken"]);e!==void 0&&i!=null&&s(e,["_query","pageToken"],i);const a=r(n,["filter"]);return e!==void 0&&a!=null&&s(e,["_query","filter"],a),t}function ey(n){const e={},t=r(n,["config"]);return t!=null&&s(e,["config"],jC(t,e)),e}function ty(n){const e={},t=r(n,["textInput"]);t!=null&&s(e,["textInput"],t);const o=r(n,["output"]);return o!=null&&s(e,["output"],o),e}function ny(n){const e={};if(r(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(r(n,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const t=r(n,["examples"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(i=>ty(i))),s(e,["examples","examples"],o)}return e}function oy(n,e){const t={};if(r(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const o=r(n,["tunedModelDisplayName"]);if(e!==void 0&&o!=null&&s(e,["displayName"],o),r(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const i=r(n,["epochCount"]);e!==void 0&&i!=null&&s(e,["tuningTask","hyperparameters","epochCount"],i);const a=r(n,["learningRateMultiplier"]);if(a!=null&&s(t,["tuningTask","hyperparameters","learningRateMultiplier"],a),r(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(r(n,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(r(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const l=r(n,["batchSize"]);e!==void 0&&l!=null&&s(e,["tuningTask","hyperparameters","batchSize"],l);const c=r(n,["learningRate"]);return e!==void 0&&c!=null&&s(e,["tuningTask","hyperparameters","learningRate"],c),t}function iy(n){const e={},t=r(n,["baseModel"]);t!=null&&s(e,["baseModel"],t);const o=r(n,["preTunedModel"]);o!=null&&s(e,["preTunedModel"],o);const i=r(n,["trainingDataset"]);i!=null&&s(e,["tuningTask","trainingData"],ny(i));const a=r(n,["config"]);return a!=null&&s(e,["config"],oy(a,e)),e}function ry(n){const e={},t=r(n,["name"]);t!=null&&s(e,["_url","name"],t);const o=r(n,["config"]);return o!=null&&s(e,["config"],o),e}function sy(n,e){const t={},o=r(n,["pageSize"]);e!==void 0&&o!=null&&s(e,["_query","pageSize"],o);const i=r(n,["pageToken"]);e!==void 0&&i!=null&&s(e,["_query","pageToken"],i);const a=r(n,["filter"]);return e!==void 0&&a!=null&&s(e,["_query","filter"],a),t}function ay(n){const e={},t=r(n,["config"]);return t!=null&&s(e,["config"],sy(t,e)),e}function ly(n,e){const t={},o=r(n,["gcsUri"]);e!==void 0&&o!=null&&s(e,["supervisedTuningSpec","trainingDatasetUri"],o);const i=r(n,["vertexDatasetResource"]);if(e!==void 0&&i!=null&&s(e,["supervisedTuningSpec","trainingDatasetUri"],i),r(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return t}function cy(n,e){const t={},o=r(n,["gcsUri"]);o!=null&&s(t,["validationDatasetUri"],o);const i=r(n,["vertexDatasetResource"]);return e!==void 0&&i!=null&&s(e,["supervisedTuningSpec","trainingDatasetUri"],i),t}function dy(n,e){const t={},o=r(n,["validationDataset"]);e!==void 0&&o!=null&&s(e,["supervisedTuningSpec"],cy(o,t));const i=r(n,["tunedModelDisplayName"]);e!==void 0&&i!=null&&s(e,["tunedModelDisplayName"],i);const a=r(n,["description"]);e!==void 0&&a!=null&&s(e,["description"],a);const l=r(n,["epochCount"]);e!==void 0&&l!=null&&s(e,["supervisedTuningSpec","hyperParameters","epochCount"],l);const c=r(n,["learningRateMultiplier"]);e!==void 0&&c!=null&&s(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],c);const u=r(n,["exportLastCheckpointOnly"]);e!==void 0&&u!=null&&s(e,["supervisedTuningSpec","exportLastCheckpointOnly"],u);const d=r(n,["preTunedModelCheckpointId"]);d!=null&&s(t,["preTunedModel","checkpointId"],d);const h=r(n,["adapterSize"]);if(e!==void 0&&h!=null&&s(e,["supervisedTuningSpec","hyperParameters","adapterSize"],h),r(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(r(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return t}function uy(n){const e={},t=r(n,["baseModel"]);t!=null&&s(e,["baseModel"],t);const o=r(n,["preTunedModel"]);o!=null&&s(e,["preTunedModel"],o);const i=r(n,["trainingDataset"]);i!=null&&s(e,["supervisedTuningSpec","trainingDatasetUri"],ly(i,e));const a=r(n,["config"]);return a!=null&&s(e,["config"],dy(a,e)),e}function hy(n){const e={},t=r(n,["name"]);t!=null&&s(e,["model"],t);const o=r(n,["name"]);return o!=null&&s(e,["endpoint"],o),e}function fa(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["name"]);o!=null&&s(e,["name"],o);const i=r(n,["state"]);i!=null&&s(e,["state"],Ks(i));const a=r(n,["createTime"]);a!=null&&s(e,["createTime"],a);const l=r(n,["tuningTask","startTime"]);l!=null&&s(e,["startTime"],l);const c=r(n,["tuningTask","completeTime"]);c!=null&&s(e,["endTime"],c);const u=r(n,["updateTime"]);u!=null&&s(e,["updateTime"],u);const d=r(n,["description"]);d!=null&&s(e,["description"],d);const h=r(n,["baseModel"]);h!=null&&s(e,["baseModel"],h);const f=r(n,["_self"]);f!=null&&s(e,["tunedModel"],hy(f));const p=r(n,["customBaseModel"]);p!=null&&s(e,["customBaseModel"],p);const m=r(n,["experiment"]);m!=null&&s(e,["experiment"],m);const v=r(n,["labels"]);v!=null&&s(e,["labels"],v);const y=r(n,["outputUri"]);y!=null&&s(e,["outputUri"],y);const E=r(n,["pipelineJob"]);E!=null&&s(e,["pipelineJob"],E);const A=r(n,["serviceAccount"]);A!=null&&s(e,["serviceAccount"],A);const R=r(n,["tunedModelDisplayName"]);return R!=null&&s(e,["tunedModelDisplayName"],R),e}function fy(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["nextPageToken"]);o!=null&&s(e,["nextPageToken"],o);const i=r(n,["tunedModels"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(l=>fa(l))),s(e,["tuningJobs"],a)}return e}function gy(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["name"]);o!=null&&s(e,["name"],o);const i=r(n,["metadata"]);i!=null&&s(e,["metadata"],i);const a=r(n,["done"]);a!=null&&s(e,["done"],a);const l=r(n,["error"]);return l!=null&&s(e,["error"],l),e}function py(n){const e={},t=r(n,["checkpointId"]);t!=null&&s(e,["checkpointId"],t);const o=r(n,["epoch"]);o!=null&&s(e,["epoch"],o);const i=r(n,["step"]);i!=null&&s(e,["step"],i);const a=r(n,["endpoint"]);return a!=null&&s(e,["endpoint"],a),e}function my(n){const e={},t=r(n,["model"]);t!=null&&s(e,["model"],t);const o=r(n,["endpoint"]);o!=null&&s(e,["endpoint"],o);const i=r(n,["checkpoints"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(l=>py(l))),s(e,["checkpoints"],a)}return e}function mo(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["name"]);o!=null&&s(e,["name"],o);const i=r(n,["state"]);i!=null&&s(e,["state"],Ks(i));const a=r(n,["createTime"]);a!=null&&s(e,["createTime"],a);const l=r(n,["startTime"]);l!=null&&s(e,["startTime"],l);const c=r(n,["endTime"]);c!=null&&s(e,["endTime"],c);const u=r(n,["updateTime"]);u!=null&&s(e,["updateTime"],u);const d=r(n,["error"]);d!=null&&s(e,["error"],d);const h=r(n,["description"]);h!=null&&s(e,["description"],h);const f=r(n,["baseModel"]);f!=null&&s(e,["baseModel"],f);const p=r(n,["tunedModel"]);p!=null&&s(e,["tunedModel"],my(p));const m=r(n,["preTunedModel"]);m!=null&&s(e,["preTunedModel"],m);const v=r(n,["supervisedTuningSpec"]);v!=null&&s(e,["supervisedTuningSpec"],v);const y=r(n,["tuningDataStats"]);y!=null&&s(e,["tuningDataStats"],y);const E=r(n,["encryptionSpec"]);E!=null&&s(e,["encryptionSpec"],E);const A=r(n,["partnerModelTuningSpec"]);A!=null&&s(e,["partnerModelTuningSpec"],A);const R=r(n,["customBaseModel"]);R!=null&&s(e,["customBaseModel"],R);const M=r(n,["experiment"]);M!=null&&s(e,["experiment"],M);const L=r(n,["labels"]);L!=null&&s(e,["labels"],L);const _=r(n,["outputUri"]);_!=null&&s(e,["outputUri"],_);const H=r(n,["pipelineJob"]);H!=null&&s(e,["pipelineJob"],H);const D=r(n,["serviceAccount"]);D!=null&&s(e,["serviceAccount"],D);const F=r(n,["tunedModelDisplayName"]);return F!=null&&s(e,["tunedModelDisplayName"],F),e}function Cy(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const o=r(n,["nextPageToken"]);o!=null&&s(e,["nextPageToken"],o);const i=r(n,["tuningJobs"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(l=>mo(l))),s(e,["tuningJobs"],a)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class yy extends nt{constructor(e){super(),this.apiClient=e,this.get=async t=>await this.getInternal(t),this.list=async(t={})=>new Kt(Xe.PAGED_ITEM_TUNING_JOBS,o=>this.listInternal(o),await this.listInternal(t),t),this.tune=async t=>{if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){const o={tunedModelName:t.baseModel},i=Object.assign(Object.assign({},t),{preTunedModel:o});return i.baseModel=void 0,await this.tuneInternal(i)}else{const o=Object.assign({},t);return await this.tuneInternal(o)}else{const o=Object.assign({},t),i=await this.tuneMldevInternal(o);let a="";return i.metadata!==void 0&&i.metadata.tunedModel!==void 0?a=i.metadata.tunedModel:i.name!==void 0&&i.name.includes("/operations/")&&(a=i.name.split("/operations/")[0]),{name:a,state:ro.JOB_STATE_QUEUED}}}}async getInternal(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=ry(e);return c=P("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>mo(h))}else{const d=ZC(e);return c=P("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>fa(h))}}async listInternal(e){var t,o,i,a;let l,c="",u={};if(this.apiClient.isVertexAI()){const d=ay(e);return c=P("tuningJobs",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>{const f=Cy(h),p=new Rr;return Object.assign(p,f),p})}else{const d=ey(e);return c=P("tunedModels",d._url),u=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),l.then(h=>{const f=fy(h),p=new Rr;return Object.assign(p,f),p})}}async tuneInternal(e){var t,o;let i,a="",l={};if(this.apiClient.isVertexAI()){const c=uy(e);return a=P("tuningJobs",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:u.headers},h})),i.then(u=>mo(u))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,o;let i,a="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=iy(e);return a=P("tunedModels",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:u.headers},h})),i.then(u=>gy(u))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ty{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const vy=1024*1024*8,Iy=3,Ey=1e3,Sy=2,Jn="x-goog-upload-status";async function Ay(n,e,t){var o,i,a;let l=0,c=0,u=new so(new Response),d="upload";for(l=n.size;c<l;){const f=Math.min(vy,l-c),p=n.slice(c,c+f);c+f>=l&&(d+=", finalize");let m=0,v=Ey;for(;m<Iy&&(u=await t.request({path:"",body:p,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(c),"Content-Length":String(f)}}}),!(!((o=u?.headers)===null||o===void 0)&&o[Jn]));)m++,await _y(v),v=v*Sy;if(c+=f,((i=u?.headers)===null||i===void 0?void 0:i[Jn])!=="active")break;if(l<=c)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const h=await u?.json();if(((a=u?.headers)===null||a===void 0?void 0:a[Jn])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return h.file}async function wy(n){return{size:n.size,type:n.type}}function _y(n){return new Promise(e=>setTimeout(e,n))}class Ry{async upload(e,t,o){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Ay(e,t,o)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await wy(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ky{create(e,t,o){return new My(e,t,o)}}class My{constructor(e,t,o){this.url=e,this.headers=t,this.callbacks=o}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Zr="x-goog-api-key";class Py{constructor(e){this.apiKey=e}async addAuthHeaders(e){if(e.get(Zr)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(Zr,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const by="gl-node/";class Ny{constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const o=vc(e.httpOptions,e.vertexai,void 0,void 0);o&&(e.httpOptions?e.httpOptions.baseUrl=o:e.httpOptions={baseUrl:o}),this.apiVersion=e.apiVersion;const i=new Py(this.apiKey);this.apiClient=new Qm({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:by+"web",uploader:new Ry,downloader:new Ty}),this.models=new mC(this.apiClient),this.live=new cC(this.apiClient,i,new ky),this.batches=new $d(this.apiClient),this.chats=new Xu(this.models,this.apiClient),this.caches=new Yu(this.apiClient),this.files=new dh(this.apiClient),this.operations=new vC(this.apiClient),this.authTokens=new XC(this.apiClient),this.tunings=new yy(this.apiClient)}}var jr={};let ze;jr.API_KEY?ze=new Ny({apiKey:jr.API_KEY}):(console.error("API_KEY environment variable not set. AI features will be disabled."),ze=new Proxy({},{get(n,e,t){return e==="models"||e==="operations"||e==="chats"?new Proxy({},{get(){return()=>{throw new Error("AI Service is not configured. Please ensure the API_KEY is set in the environment settings.")}}}):Reflect.get(n,e,t)}}));async function ga(n,e){const t=e==="questions"?`Based on a container named '${n}', generate 4 diverse and insightful 'quick questions' a user might ask an AI assistant in this context. Focus on actionable and common queries.`:`Based on a container named '${n}', generate 4 creative and distinct 'personas' for an AI assistant. Examples: 'Concise Expert', 'Friendly Guide', 'Data-driven Analyst', 'Creative Brainstormer'.`;try{const o=await ze.models.generateContent({model:"gemini-2.5-flash",contents:t,config:{responseMimeType:"application/json",responseSchema:{type:b.OBJECT,properties:{suggestions:{type:b.ARRAY,items:{type:b.STRING}}}}}});return JSON.parse(o.text).suggestions||[]}catch(o){throw console.error(`Error generating ${e}:`,o),new Error("Sorry, I couldn't generate suggestions. Please try again.")}}async function xy(n){const e=`Based on the user request for a function: "${n}", generate a configuration for it. The function should run inside a chat application. 
     - Define a short, clear 'name'.
     - Write a concise one-sentence 'description'.
     - Select a suitable SVG 'icon' from the provided list.
     - Define 1 to 3 input 'parameters' the user needs to provide (name, type, description). Parameter 'type' must be one of: 'string', 'number', 'textarea'.
     - Create a detailed 'promptTemplate' to be sent to another AI model. The prompt template must use placeholders like {parameterName} for each parameter defined.
    Available icons:
${Oo.join(`
`)}`;try{const t=await ze.models.generateContent({model:"gemini-2.5-flash",contents:e,config:{responseMimeType:"application/json",responseSchema:{type:b.OBJECT,properties:{name:{type:b.STRING},description:{type:b.STRING},icon:{type:b.STRING},parameters:{type:b.ARRAY,items:{type:b.OBJECT,properties:{name:{type:b.STRING},type:{type:b.STRING,enum:["string","number","textarea"]},description:{type:b.STRING}},required:["name","type","description"]}},promptTemplate:{type:b.STRING}},required:["name","description","icon","parameters","promptTemplate"]}}});return JSON.parse(t.text)}catch(t){throw console.error("Error generating function:",t),new Error("Sorry, I couldn't generate the function. The model might have returned an invalid structure. Please try again with a different request.")}}async function Ly(n,e,t){const o=JSON.stringify(Ds),i=JSON.stringify(oo);let a=`A user wants to create a new container in an application. The container is named "${n}" and is of the type "${e}".`;e==="product"&&t?a+=` The product's website is ${t}. Please analyze the website content to inform your suggestions, especially for the description, quick questions, and functions, making them highly relevant to the product. For example, a support bot for a software product might need functions to check system status or explain features.`:e==="department"&&(a+=" The container is for a corporate department. Tailor suggestions to a professional, internal-use context. For example, an HR container might need functions for leave policies or benefits lookup.");const l=`${a}
Based on this context, generate a complete configuration:
- **description**: A concise, one-sentence summary of the container's purpose.
- **icon**: Choose the most appropriate SVG icon from the provided list by returning its exact SVG string.
- **cardImageUrl**: Choose the most thematically appropriate image URL from the provided list for a background card, paying close attention to the container's name ('${n}') and its purpose.
- **theme**: Suggest a complete color theme with nine hex color codes: userBg, userText, botBg, botText, bgGradientStart, bgGradientEnd, sidebarBg, sidebarText, and sidebarHighlightBg. Choose colors that are aesthetically pleasing, accessible (good contrast), and reflect the container's purpose (e.g., professional tones for 'Finance', creative colors for 'Design').
- **quickQuestions**: Generate an array of 4 diverse and insightful string 'quick questions' a user might ask.
- **availablePersonas**: Generate an array of 4 creative and distinct string 'personas' for the AI assistant.
- **functions**: Generate an array of 2-3 relevant 'functions' a user might need. For each function, provide: name, description, an icon from the function icon list, 1-2 parameters (name, type, description), and a detailed promptTemplate using placeholders like {parameterName}.
- **initialKnowledgeFile**: If a website URL was provided, generate a text file summarizing the key information from the site. This object must have a 'name' (e.g., "Website_Summary.txt") and 'content' (a plain-text summary). If no URL, return null for this field.

Available container icons: ${o}
Available card images: ${i}
Available function icons: ${Oo.join(`
`)}`;try{const c=await ze.models.generateContent({model:"gemini-2.5-flash",contents:l,config:{responseMimeType:"application/json",responseSchema:{type:b.OBJECT,properties:{description:{type:b.STRING},icon:{type:b.STRING},cardImageUrl:{type:b.STRING},theme:{type:b.OBJECT,properties:{userBg:{type:b.STRING},userText:{type:b.STRING},botBg:{type:b.STRING},botText:{type:b.STRING},bgGradientStart:{type:b.STRING},bgGradientEnd:{type:b.STRING},sidebarBg:{type:b.STRING},sidebarText:{type:b.STRING},sidebarHighlightBg:{type:b.STRING}},required:["userBg","userText","botBg","botText","bgGradientStart","bgGradientEnd","sidebarBg","sidebarText","sidebarHighlightBg"]},quickQuestions:{type:b.ARRAY,items:{type:b.STRING}},availablePersonas:{type:b.ARRAY,items:{type:b.STRING}},functions:{type:b.ARRAY,items:{type:b.OBJECT,properties:{name:{type:b.STRING},description:{type:b.STRING},icon:{type:b.STRING},parameters:{type:b.ARRAY,items:{type:b.OBJECT,properties:{name:{type:b.STRING},type:{type:b.STRING,enum:["string","number","textarea"]},description:{type:b.STRING}},required:["name","type","description"]}},promptTemplate:{type:b.STRING}},required:["name","description","icon","parameters","promptTemplate"]}},initialKnowledgeFile:{type:b.OBJECT,nullable:!0,properties:{name:{type:b.STRING},content:{type:b.STRING}}}},required:["description","icon","cardImageUrl","theme","quickQuestions","availablePersonas","functions"]}}});return JSON.parse(c.text)}catch(c){throw console.error("Error generating container details:",c),new Error("Could not generate suggestions. Please fill in manually.")}}async function Dy(n){if(n.length<2)return"New Conversation";const e=n[0].parts.find(i=>"text"in i),t=n[1].parts.find(i=>"text"in i);if(!e||!("text"in e)||!t||!("text"in t))return"New Conversation";const o=`Based on the following conversation, create a very short, concise title (max 5 words, and no quotes).

Conversation:
User: "${e.text}"
Model: "${t.text}"`;try{return(await ze.models.generateContent({model:"gemini-2.5-flash",contents:o})).text.trim().replace(/["']/g,"")}catch(i){return console.error("Error generating chat name:",i),"New Conversation"}}async function Uy(n,e,t,o){return ze.models.generateContentStream({model:n,contents:{parts:[...t.map(i=>({inlineData:{mimeType:i.type,data:i.base64Content.split(",")[1]}})),...o]},config:{systemInstruction:`You are an AI assistant. Your current persona is: ${e}.`}})}async function Oy(n){if(n.length===0)return[];const e=n.map(o=>{try{if(!o.type.startsWith("text/")&&o.type!=="application/pdf")return"";const i=o.base64Content.split(",")[1];return i?atob(i):""}catch(i){return console.error(`Could not decode base64 for file ${o.name}`,i),""}}).join(`

`).substring(0,1e4);if(e.trim().length===0)return[];const t=`Based on the following information from a knowledge base, generate 4 insightful and relevant "quick questions" a user might ask an AI assistant. The questions should be diverse and cover key topics present in the text.

<knowledge_base_content>
${e}
</knowledge_base_content>

Generate only the questions.`;try{const o=await ze.models.generateContent({model:"gemini-2.5-flash",contents:t,config:{responseMimeType:"application/json",responseSchema:{type:b.OBJECT,properties:{questions:{type:b.ARRAY,items:{type:b.STRING},description:"An array of 4 generated questions."}},required:["questions"]}}});return JSON.parse(o.text).questions||[]}catch(o){return console.error("Error generating questions from knowledge:",o),[]}}/*! @azure/msal-common v14.16.1 2025-08-05 */const I={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},Zt={CLIENT_ERROR_RANGE_START:400,CLIENT_ERROR_RANGE_END:499,SERVER_ERROR_RANGE_START:500,SERVER_ERROR_RANGE_END:599},Pt=[I.OPENID_SCOPE,I.PROFILE_SCOPE,I.OFFLINE_ACCESS_SCOPE],es=[...Pt,I.EMAIL_SCOPE],fe={CONTENT_TYPE:"Content-Type",CONTENT_LENGTH:"Content-Length",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},oe={ID_TOKEN:"idtoken",CLIENT_INFO:"client.info",ADAL_ID_TOKEN:"adal.idtoken",ERROR:"error",ERROR_DESC:"error.description",ACTIVE_ACCOUNT:"active-account",ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},$e={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},jt={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},ie={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},ts={PLAIN:"plain",S256:"S256"},$t={QUERY:"query",FRAGMENT:"fragment"},Hy={...$t},pa={AUTHORIZATION_CODE_GRANT:"authorization_code",REFRESH_TOKEN_GRANT:"refresh_token"},en={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",GENERIC_ACCOUNT_TYPE:"Generic"},ce={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},O={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},qo="appmetadata",By="client_info",Ot="1",gn={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:3600*24},ye={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},se={SCHEMA_VERSION:5,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},J={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},Ht={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},ns={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},os={username:"username",password:"password"},tn={httpSuccess:200,httpBadRequest:400},at={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},zn={CONFIGURED_NO_AUTO_DETECTION:"2",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},Ke={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},Fy={Pop:"pop"},Gy=300;/*! @azure/msal-common v14.16.1 2025-08-05 */const Vo="unexpected_error",qy="post_request_failed";/*! @azure/msal-common v14.16.1 2025-08-05 */const is={[Vo]:"Unexpected error in authentication.",[qy]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};class X extends Error{constructor(e,t,o){const i=t?`${e}: ${t}`:e;super(i),Object.setPrototypeOf(this,X.prototype),this.errorCode=e||I.EMPTY_STRING,this.errorMessage=t||I.EMPTY_STRING,this.subError=o||I.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function ma(n,e){return new X(n,e?`${is[n]} ${e}`:is[n])}/*! @azure/msal-common v14.16.1 2025-08-05 */const Ko="client_info_decoding_error",Ca="client_info_empty_error",$o="token_parsing_error",ya="null_or_empty_token",Be="endpoints_resolution_error",Ta="network_error",va="openid_config_error",Ia="hash_not_deserialized",vt="invalid_state",Ea="state_mismatch",pn="state_not_found",Sa="nonce_mismatch",Jo="auth_time_not_found",Aa="max_age_transpired",Vy="multiple_matching_tokens",Ky="multiple_matching_accounts",wa="multiple_matching_appMetadata",_a="request_cannot_be_made",Ra="cannot_remove_empty_scope",ka="cannot_append_scopeset",Co="empty_input_scopeset",$y="device_code_polling_cancelled",Jy="device_code_expired",zy="device_code_unknown_error",zo="no_account_in_silent_request",Ma="invalid_cache_record",Yo="invalid_cache_environment",yo="no_account_found",To="no_crypto_object",vo="unexpected_credential_type",Yy="invalid_assertion",Wy="invalid_client_credential",Fe="token_refresh_required",Qy="user_timeout_reached",Pa="token_claims_cnf_required_for_signedjwt",ba="authorization_code_missing_from_server_response",Xy="binding_key_not_removed",Na="end_session_endpoint_not_supported",Wo="key_id_missing",Zy="no_network_connectivity",jy="user_canceled",eT="missing_tenant_id_error",B="method_not_implemented",tT="nested_app_auth_bridge_disabled";/*! @azure/msal-common v14.16.1 2025-08-05 */const rs={[Ko]:"The client info could not be parsed/decoded correctly",[Ca]:"The client info was empty",[$o]:"Token cannot be parsed",[ya]:"The token is null or empty",[Be]:"Endpoints cannot be resolved",[Ta]:"Network request failed",[va]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[Ia]:"The hash parameters could not be deserialized",[vt]:"State was not the expected format",[Ea]:"State mismatch error",[pn]:"State not found",[Sa]:"Nonce mismatch error",[Jo]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[Aa]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[Vy]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[Ky]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[wa]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[_a]:"Token request cannot be made without authorization code or refresh token.",[Ra]:"Cannot remove null or empty scope from ScopeSet",[ka]:"Cannot append ScopeSet",[Co]:"Empty input ScopeSet cannot be processed",[$y]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[Jy]:"Device code is expired.",[zy]:"Device code stopped polling for unknown reasons.",[zo]:"Please pass an account object, silent flow is not supported without account information",[Ma]:"Cache record object was null or undefined.",[Yo]:"Invalid environment when attempting to create cache entry",[yo]:"No account found in cache for given key.",[To]:"No crypto object detected.",[vo]:"Unexpected credential type.",[Yy]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[Wy]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[Fe]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[Qy]:"User defined timeout for device code polling reached",[Pa]:"Cannot generate a POP jwt if the token_claims are not populated",[ba]:"Server response does not contain an authorization code to proceed",[Xy]:"Could not remove the credential's binding key from storage.",[Na]:"The provided authority does not support logout",[Wo]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[Zy]:"No network connectivity. Check your internet connection.",[jy]:"User cancelled the flow.",[eT]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[B]:"This method has not been implemented",[tT]:"The nested app auth bridge is disabled"};class Pn extends X{constructor(e,t){super(e,t?`${rs[e]}: ${t}`:rs[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,Pn.prototype)}}function S(n,e){return new Pn(n,e)}/*! @azure/msal-common v14.16.1 2025-08-05 */const mn={createNewGuid:()=>{throw S(B)},base64Decode:()=>{throw S(B)},base64Encode:()=>{throw S(B)},base64UrlEncode:()=>{throw S(B)},encodeKid:()=>{throw S(B)},async getPublicKeyThumbprint(){throw S(B)},async removeTokenBindingKey(){throw S(B)},async clearKeystore(){throw S(B)},async signJwt(){throw S(B)},async hashString(){throw S(B)}};/*! @azure/msal-common v14.16.1 2025-08-05 */var Z;(function(n){n[n.Error=0]="Error",n[n.Warning=1]="Warning",n[n.Info=2]="Info",n[n.Verbose=3]="Verbose",n[n.Trace=4]="Trace"})(Z||(Z={}));let Jt=class Io{constructor(e,t,o){this.level=Z.Info;const i=()=>{},a=e||Io.createDefaultLoggerOptions();this.localCallback=a.loggerCallback||i,this.piiLoggingEnabled=a.piiLoggingEnabled||!1,this.level=typeof a.logLevel=="number"?a.logLevel:Z.Info,this.correlationId=a.correlationId||I.EMPTY_STRING,this.packageName=t||I.EMPTY_STRING,this.packageVersion=o||I.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:Z.Info}}clone(e,t,o){return new Io({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:o||this.correlationId},e,t)}logMessage(e,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const a=`${`[${new Date().toUTCString()}] : [${t.correlationId||this.correlationId||""}]`} : ${this.packageName}@${this.packageVersion} : ${Z[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,a,t.containsPii||!1)}executeCallback(e,t,o){this.localCallback&&this.localCallback(e,t,o)}error(e,t){this.logMessage(e,{logLevel:Z.Error,containsPii:!1,correlationId:t||I.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:Z.Error,containsPii:!0,correlationId:t||I.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:Z.Warning,containsPii:!1,correlationId:t||I.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:Z.Warning,containsPii:!0,correlationId:t||I.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:Z.Info,containsPii:!1,correlationId:t||I.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:Z.Info,containsPii:!0,correlationId:t||I.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:Z.Verbose,containsPii:!1,correlationId:t||I.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:Z.Verbose,containsPii:!0,correlationId:t||I.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:Z.Trace,containsPii:!1,correlationId:t||I.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:Z.Trace,containsPii:!0,correlationId:t||I.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}};/*! @azure/msal-common v14.16.1 2025-08-05 */const xa="@azure/msal-common",Qo="14.16.1";/*! @azure/msal-common v14.16.1 2025-08-05 */const Xo={None:"none"};/*! @azure/msal-common v14.16.1 2025-08-05 */function it(n,e){const t=nT(n);try{const o=e(t);return JSON.parse(o)}catch{throw S($o)}}function nT(n){if(!n)throw S(ya);const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(n);if(!t||t.length<4)throw S($o);return t[2]}function La(n,e){if(e===0||Date.now()-3e5>n+e)throw S(Aa)}/*! @azure/msal-common v14.16.1 2025-08-05 */function De(){return Math.round(new Date().getTime()/1e3)}function Eo(n,e){const t=Number(n)||0;return De()+e>t}function oT(n){return Number(n)>De()}/*! @azure/msal-common v14.16.1 2025-08-05 */function ht(n){return[iT(n),rT(n),sT(n),aT(n),lT(n)].join(ce.CACHE_KEY_SEPARATOR).toLowerCase()}function bn(n,e,t,o,i){return{credentialType:O.ID_TOKEN,homeAccountId:n,environment:e,clientId:o,secret:t,realm:i}}function Nn(n,e,t,o,i,a,l,c,u,d,h,f,p,m,v){const y={homeAccountId:n,credentialType:O.ACCESS_TOKEN,secret:t,cachedAt:De().toString(),expiresOn:l.toString(),extendedExpiresOn:c.toString(),environment:e,clientId:o,realm:i,target:a,tokenType:h||J.BEARER};if(f&&(y.userAssertionHash=f),d&&(y.refreshOn=d.toString()),m&&(y.requestedClaims=m,y.requestedClaimsHash=v),y.tokenType?.toLowerCase()!==J.BEARER.toLowerCase())switch(y.credentialType=O.ACCESS_TOKEN_WITH_AUTH_SCHEME,y.tokenType){case J.POP:const E=it(t,u);if(!E?.cnf?.kid)throw S(Pa);y.keyId=E.cnf.kid;break;case J.SSH:y.keyId=p}return y}function Da(n,e,t,o,i,a,l){const c={credentialType:O.REFRESH_TOKEN,homeAccountId:n,environment:e,clientId:o,secret:t};return a&&(c.userAssertionHash=a),i&&(c.familyId=i),l&&(c.expiresOn=l.toString()),c}function Zo(n){return n.hasOwnProperty("homeAccountId")&&n.hasOwnProperty("environment")&&n.hasOwnProperty("credentialType")&&n.hasOwnProperty("clientId")&&n.hasOwnProperty("secret")}function ss(n){return n?Zo(n)&&n.hasOwnProperty("realm")&&n.hasOwnProperty("target")&&(n.credentialType===O.ACCESS_TOKEN||n.credentialType===O.ACCESS_TOKEN_WITH_AUTH_SCHEME):!1}function as(n){return n?Zo(n)&&n.hasOwnProperty("realm")&&n.credentialType===O.ID_TOKEN:!1}function ls(n){return n?Zo(n)&&n.credentialType===O.REFRESH_TOKEN:!1}function iT(n){return[n.homeAccountId,n.environment].join(ce.CACHE_KEY_SEPARATOR).toLowerCase()}function rT(n){const e=n.credentialType===O.REFRESH_TOKEN&&n.familyId||n.clientId;return[n.credentialType,e,n.realm||""].join(ce.CACHE_KEY_SEPARATOR).toLowerCase()}function sT(n){return(n.target||"").toLowerCase()}function aT(n){return(n.requestedClaimsHash||"").toLowerCase()}function lT(n){return n.tokenType&&n.tokenType.toLowerCase()!==J.BEARER.toLowerCase()?n.tokenType.toLowerCase():""}function cT(n,e){const t=n.indexOf(se.CACHE_KEY)===0;let o=!0;return e&&(o=e.hasOwnProperty("failedRequests")&&e.hasOwnProperty("errors")&&e.hasOwnProperty("cacheHits")),t&&o}function dT(n,e){let t=!1;n&&(t=n.indexOf(Ht.THROTTLING_PREFIX)===0);let o=!0;return e&&(o=e.hasOwnProperty("throttleTime")),t&&o}function uT({environment:n,clientId:e}){return[qo,n,e].join(ce.CACHE_KEY_SEPARATOR).toLowerCase()}function hT(n,e){return e?n.indexOf(qo)===0&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("environment"):!1}function fT(n,e){return e?n.indexOf(gn.CACHE_KEY)===0&&e.hasOwnProperty("aliases")&&e.hasOwnProperty("preferred_cache")&&e.hasOwnProperty("preferred_network")&&e.hasOwnProperty("canonical_authority")&&e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("aliasesFromNetwork")&&e.hasOwnProperty("endpointsFromNetwork")&&e.hasOwnProperty("expiresAt")&&e.hasOwnProperty("jwks_uri"):!1}function cs(){return De()+gn.REFRESH_TIME_SECONDS}function nn(n,e,t){n.authorization_endpoint=e.authorization_endpoint,n.token_endpoint=e.token_endpoint,n.end_session_endpoint=e.end_session_endpoint,n.issuer=e.issuer,n.endpointsFromNetwork=t,n.jwks_uri=e.jwks_uri}function Yn(n,e,t){n.aliases=e.aliases,n.preferred_cache=e.preferred_cache,n.preferred_network=e.preferred_network,n.aliasesFromNetwork=t}function ds(n){return n.expiresAt<=De()}/*! @azure/msal-common v14.16.1 2025-08-05 */const Ua="redirect_uri_empty",gT="claims_request_parsing_error",Oa="authority_uri_insecure",xt="url_parse_error",Ha="empty_url_error",Ba="empty_input_scopes_error",Fa="invalid_prompt_value",jo="invalid_claims",Ga="token_request_empty",qa="logout_request_empty",Va="invalid_code_challenge_method",ei="pkce_params_missing",ti="invalid_cloud_discovery_metadata",Ka="invalid_authority_metadata",$a="untrusted_authority",xn="missing_ssh_jwk",Ja="missing_ssh_kid",pT="missing_nonce_authentication_header",mT="invalid_authentication_header",za="cannot_set_OIDCOptions",Ya="cannot_allow_native_broker",Wa="authority_mismatch";/*! @azure/msal-common v14.16.1 2025-08-05 */const CT={[Ua]:"A redirect URI is required for all calls, and none has been set.",[gT]:"Could not parse the given claims request object.",[Oa]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[xt]:"URL could not be parsed into appropriate segments.",[Ha]:"URL was empty or null.",[Ba]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[Fa]:"Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest",[jo]:"Given claims parameter must be a stringified JSON object.",[Ga]:"Token request was empty and not found in cache.",[qa]:"The logout request was null or undefined.",[Va]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[ei]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[ti]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[Ka]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[$a]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[xn]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[Ja]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[pT]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[mT]:"Invalid authentication header provided",[za]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[Ya]:"Cannot set allowNativeBroker parameter to true when not in AAD protocol mode.",[Wa]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."};class ni extends X{constructor(e){super(e,CT[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,ni.prototype)}}function z(n){return new ni(n)}/*! @azure/msal-common v14.16.1 2025-08-05 */class Re{static isEmptyObj(e){if(e)try{const t=JSON.parse(e);return Object.keys(t).length===0}catch{}return!0}static startsWith(e,t){return e.indexOf(t)===0}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){const t={},o=e.split("&"),i=a=>decodeURIComponent(a.replace(/\+/g," "));return o.forEach(a=>{if(a.trim()){const[l,c]=a.split(/=(.+)/g,2);l&&c&&(t[i(l)]=i(c))}}),t}static trimArrayEntries(e){return e.map(t=>t.trim())}static removeEmptyStringsFromArray(e){return e.filter(t=>!!t)}static jsonParseHelper(e){try{return JSON.parse(e)}catch{return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}/*! @azure/msal-common v14.16.1 2025-08-05 */class ee{constructor(e){const t=e?Re.trimArrayEntries([...e]):[],o=t?Re.removeEmptyStringsFromArray(t):[];this.validateInputScopes(o),this.scopes=new Set,o.forEach(i=>this.scopes.add(i))}static fromString(e){const o=(e||I.EMPTY_STRING).split(" ");return new ee(o)}static createSearchScopes(e){const t=new ee(e);return t.containsOnlyOIDCScopes()?t.removeScope(I.OFFLINE_ACCESS_SCOPE):t.removeOIDCScopes(),t}validateInputScopes(e){if(!e||e.length<1)throw z(Ba)}containsScope(e){const t=this.printScopesLowerCase().split(" "),o=new ee(t);return e?o.scopes.has(e.toLowerCase()):!1}containsScopeSet(e){return!e||e.scopes.size<=0?!1:this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){let e=0;return es.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch{throw S(ka)}}removeScope(e){if(!e)throw S(Ra);this.scopes.delete(e.trim())}removeOIDCScopes(){es.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw S(Co);const t=new Set;return e.scopes.forEach(o=>t.add(o.toLowerCase())),this.scopes.forEach(o=>t.add(o.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw S(Co);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),o=e.getScopeCount(),i=this.getScopeCount();return t.size<i+o}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):I.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}/*! @azure/msal-common v14.16.1 2025-08-05 */function Cn(n,e){if(!n)throw S(Ca);try{const t=e(n);return JSON.parse(t)}catch{throw S(Ko)}}function ft(n){if(!n)throw S(Ko);const e=n.split(ce.CLIENT_INFO_SEPARATOR,2);return{uid:e[0],utid:e.length<2?I.EMPTY_STRING:e[1]}}/*! @azure/msal-common v14.16.1 2025-08-05 */function yn(n,e){return!!n&&!!e&&n===e.split(".")[1]}function oi(n,e,t,o){if(o){const{oid:i,sub:a,tid:l,name:c,tfp:u,acr:d}=o,h=l||u||d||"";return{tenantId:h,localAccountId:i||a||"",name:c,isHomeTenant:yn(h,n)}}else return{tenantId:t,localAccountId:e,isHomeTenant:yn(t,n)}}function ii(n,e,t,o){let i=n;if(e){const{isHomeTenant:a,...l}=e;i={...n,...l}}if(t){const{isHomeTenant:a,...l}=oi(n.homeAccountId,n.localAccountId,n.tenantId,t);return i={...i,...l,idTokenClaims:t,idToken:o},i}return i}/*! @azure/msal-common v14.16.1 2025-08-05 */const we={Default:0,Adfs:1,Dsts:2,Ciam:3};/*! @azure/msal-common v14.16.1 2025-08-05 */function Qa(n){return n&&(n.tid||n.tfp||n.acr)||null}/*! @azure/msal-common v14.16.1 2025-08-05 */const qe={AAD:"AAD",OIDC:"OIDC"};/*! @azure/msal-common v14.16.1 2025-08-05 */class te{generateAccountId(){return[this.homeAccountId,this.environment].join(ce.CACHE_KEY_SEPARATOR).toLowerCase()}generateAccountKey(){return te.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})}getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e]))}}isSingleTenant(){return!this.tenantProfiles}static generateAccountCacheKey(e){const t=e.homeAccountId.split(".")[1];return[e.homeAccountId,e.environment||"",t||e.tenantId||""].join(ce.CACHE_KEY_SEPARATOR).toLowerCase()}static createAccount(e,t,o){const i=new te;t.authorityType===we.Adfs?i.authorityType=en.ADFS_ACCOUNT_TYPE:t.protocolMode===qe.AAD?i.authorityType=en.MSSTS_ACCOUNT_TYPE:i.authorityType=en.GENERIC_ACCOUNT_TYPE;let a;e.clientInfo&&o&&(a=Cn(e.clientInfo,o)),i.clientInfo=e.clientInfo,i.homeAccountId=e.homeAccountId,i.nativeAccountId=e.nativeAccountId;const l=e.environment||t&&t.getPreferredCache();if(!l)throw S(Yo);i.environment=l,i.realm=a?.utid||Qa(e.idTokenClaims)||"",i.localAccountId=a?.uid||e.idTokenClaims?.oid||e.idTokenClaims?.sub||"";const c=e.idTokenClaims?.preferred_username||e.idTokenClaims?.upn,u=e.idTokenClaims?.emails?e.idTokenClaims.emails[0]:null;if(i.username=c||u||"",i.name=e.idTokenClaims?.name||"",i.cloudGraphHostName=e.cloudGraphHostName,i.msGraphHost=e.msGraphHost,e.tenantProfiles)i.tenantProfiles=e.tenantProfiles;else{const d=oi(e.homeAccountId,i.localAccountId,i.realm,e.idTokenClaims);i.tenantProfiles=[d]}return i}static createFromAccountInfo(e,t,o){const i=new te;return i.authorityType=e.authorityType||en.GENERIC_ACCOUNT_TYPE,i.homeAccountId=e.homeAccountId,i.localAccountId=e.localAccountId,i.nativeAccountId=e.nativeAccountId,i.realm=e.tenantId,i.environment=e.environment,i.username=e.username,i.name=e.name,i.cloudGraphHostName=t,i.msGraphHost=o,i.tenantProfiles=Array.from(e.tenantProfiles?.values()||[]),i}static generateHomeAccountId(e,t,o,i,a){if(!(t===we.Adfs||t===we.Dsts)){if(e)try{const l=Cn(e,i.base64Decode);if(l.uid&&l.utid)return`${l.uid}.${l.utid}`}catch{}o.warning("No client info in response")}return a?.sub||""}static isAccountEntity(e){return e?e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType"):!1}static accountInfoIsEqual(e,t,o){if(!e||!t)return!1;let i=!0;if(o){const a=e.idTokenClaims||{},l=t.idTokenClaims||{};i=a.iat===l.iat&&a.nonce===l.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&i}}/*! @azure/msal-common v14.16.1 2025-08-05 */function Xa(n){return n.startsWith("#/")?n.substring(2):n.startsWith("#")||n.startsWith("?")?n.substring(1):n}function Tn(n){if(!n||n.indexOf("=")<0)return null;try{const e=Xa(n),t=Object.fromEntries(new URLSearchParams(e));if(t.code||t.error||t.error_description||t.state)return t}catch{throw S(Ia)}return null}/*! @azure/msal-common v14.16.1 2025-08-05 */class G{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw z(Ha);e.includes("#")||(this._urlString=G.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return Re.endsWith(t,"?")?t=t.slice(0,-1):Re.endsWith(t,"?/")&&(t=t.slice(0,-2)),Re.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch{throw z(xt)}if(!e.HostNameAndPort||!e.PathSegments)throw z(xt);if(!e.Protocol||e.Protocol.toLowerCase()!=="https:")throw z(Oa)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return G.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){const t=this.getUrlComponents(),o=t.PathSegments;return e&&o.length!==0&&(o[0]===$e.COMMON||o[0]===$e.ORGANIZATIONS)&&(o[0]=e),G.constructAuthorityUriFromObject(t)}getUrlComponents(){const e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw z(xt);const o={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]};let i=o.AbsolutePath.split("/");return i=i.filter(a=>a&&a.length>0),o.PathSegments=i,o.QueryString&&o.QueryString.endsWith("/")&&(o.QueryString=o.QueryString.substring(0,o.QueryString.length-1)),o}static getDomainFromUrl(e){const t=RegExp("^([^:/?#]+://)?([^/?#]*)"),o=e.match(t);if(!o)throw z(xt);return o[2]}static getAbsoluteUrl(e,t){if(e[0]===I.FORWARD_SLASH){const i=new G(t).getUrlComponents();return i.Protocol+"//"+i.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new G(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!Tn(e)}}/*! @azure/msal-common v14.16.1 2025-08-05 */const Za={endpointMetadata:{"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},instanceDiscoveryMetadata:{metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}},us=Za.endpointMetadata,ri=Za.instanceDiscoveryMetadata,ja=new Set;ri.metadata.forEach(n=>{n.aliases.forEach(e=>{ja.add(e)})});function yT(n,e){let t;const o=n.canonicalAuthority;if(o){const i=new G(o).getUrlComponents().HostNameAndPort;t=hs(i,n.cloudDiscoveryMetadata?.metadata,ye.CONFIG,e)||hs(i,ri.metadata,ye.HARDCODED_VALUES,e)||n.knownAuthorities}return t||[]}function hs(n,e,t,o){if(o?.trace(`getAliasesFromMetadata called with source: ${t}`),n&&e){const i=vn(e,n);if(i)return o?.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${t}, returning aliases`),i.aliases;o?.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${t}`)}return null}function TT(n){return vn(ri.metadata,n)}function vn(n,e){for(let t=0;t<n.length;t++){const o=n[t];if(o.aliases.includes(e))return o}return null}/*! @azure/msal-common v14.16.1 2025-08-05 */const si="cache_quota_exceeded",ai="cache_error_unknown";/*! @azure/msal-common v14.16.1 2025-08-05 */const Wn={[si]:"Exceeded cache storage capacity.",[ai]:"Unexpected error occurred when using cache storage."};class yt extends Error{constructor(e,t){const o=t||(Wn[e]?Wn[e]:Wn[ai]);super(`${e}: ${o}`),Object.setPrototypeOf(this,yt.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=o}}function el(n){return n instanceof Error?n.name==="QuotaExceededError"||n.name==="NS_ERROR_DOM_QUOTA_REACHED"||n.message.includes("exceeded the quota")?new yt(si):new yt(n.name,n.message):new yt(ai)}/*! @azure/msal-common v14.16.1 2025-08-05 */class It{constructor(e,t,o,i){this.clientId=e,this.cryptoImpl=t,this.commonLogger=o.clone(xa,Qo),this.staticAuthorityOptions=i}getAllAccounts(e,t){return this.buildTenantProfiles(this.getAccountsFilteredBy(t||{},e),e,t)}getAccountInfoFilteredBy(e,t){const o=this.getAllAccounts(t,e);return o.length>1?o.sort(a=>a.idTokenClaims?-1:1)[0]:o.length===1?o[0]:null}getBaseAccountInfo(e,t){const o=this.getAccountsFilteredBy(e,t);return o.length>0?o[0].getAccountInfo():null}buildTenantProfiles(e,t,o){return e.flatMap(i=>this.getTenantProfilesFromAccountEntity(i,t,o?.tenantId,o))}getTenantedAccountInfoByFilter(e,t,o,i,a){let l=null,c;if(a&&!this.tenantProfileMatchesFilter(o,a))return null;const u=this.getIdToken(e,i,t,o.tenantId);return u&&(c=it(u.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(c,a))?null:(l=ii(e,o,c,u?.secret),l)}getTenantProfilesFromAccountEntity(e,t,o,i){const a=e.getAccountInfo();let l=a.tenantProfiles||new Map;const c=this.getTokenKeys();if(o){const d=l.get(o);if(d)l=new Map([[o,d]]);else return[]}const u=[];return l.forEach(d=>{const h=this.getTenantedAccountInfoByFilter(a,c,d,t,i);h&&u.push(h)}),u}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||t.isHomeTenant!==void 0&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!(t&&(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId)||t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint)||t.username&&!this.matchUsername(e.preferred_username,t.username)||t.name&&!this.matchName(e,t.name)||t.sid&&!this.matchSid(e,t.sid)))}async saveCacheRecord(e,t,o){if(!e)throw S(Ma);try{e.account&&this.setAccount(e.account,t),e.idToken&&o?.idToken!==!1&&this.setIdTokenCredential(e.idToken,t),e.accessToken&&o?.accessToken!==!1&&await this.saveAccessToken(e.accessToken,t),e.refreshToken&&o?.refreshToken!==!1&&this.setRefreshTokenCredential(e.refreshToken,t),e.appMetadata&&this.setAppMetadata(e.appMetadata,t)}catch(i){throw this.commonLogger?.error("CacheManager.saveCacheRecord: failed"),i instanceof X?i:el(i)}}async saveAccessToken(e,t){const o={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},i=this.getTokenKeys(),a=ee.fromString(e.target);i.accessToken.forEach(l=>{if(!this.accessTokenKeyMatchesFilter(l,o,!1))return;const c=this.getAccessTokenCredential(l,t);c&&this.credentialMatchesFilter(c,o)&&ee.fromString(c.target).intersectingScopeSets(a)&&this.removeAccessToken(l,t)}),this.setAccessTokenCredential(e,t)}getAccountsFilteredBy(e,t){const o=this.getAccountKeys(),i=[];return o.forEach(a=>{if(!this.isAccountKey(a,e.homeAccountId))return;const l=this.getAccount(a,t,this.commonLogger);if(!l||e.homeAccountId&&!this.matchHomeAccountId(l,e.homeAccountId)||e.username&&!this.matchUsername(l.username,e.username)||e.environment&&!this.matchEnvironment(l,e.environment)||e.realm&&!this.matchRealm(l,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(l,e.nativeAccountId)||e.authorityType&&!this.matchAuthorityType(l,e.authorityType))return;const c={localAccountId:e?.localAccountId,name:e?.name},u=l.tenantProfiles?.filter(d=>this.tenantProfileMatchesFilter(d,c));u&&u.length===0||i.push(l)}),i}isAccountKey(e,t,o){return!(e.split(ce.CACHE_KEY_SEPARATOR).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||o&&!e.toLowerCase().includes(o.toLowerCase()))}isCredentialKey(e){if(e.split(ce.CACHE_KEY_SEPARATOR).length<6)return!1;const t=e.toLowerCase();if(t.indexOf(O.ID_TOKEN.toLowerCase())===-1&&t.indexOf(O.ACCESS_TOKEN.toLowerCase())===-1&&t.indexOf(O.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())===-1&&t.indexOf(O.REFRESH_TOKEN.toLowerCase())===-1)return!1;if(t.indexOf(O.REFRESH_TOKEN.toLowerCase())>-1){const o=`${O.REFRESH_TOKEN}${ce.CACHE_KEY_SEPARATOR}${this.clientId}${ce.CACHE_KEY_SEPARATOR}`,i=`${O.REFRESH_TOKEN}${ce.CACHE_KEY_SEPARATOR}${Ot}${ce.CACHE_KEY_SEPARATOR}`;if(t.indexOf(o.toLowerCase())===-1&&t.indexOf(i.toLowerCase())===-1)return!1}else if(t.indexOf(this.clientId.toLowerCase())===-1)return!1;return!0}credentialMatchesFilter(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||typeof t.homeAccountId=="string"&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===O.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===J.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e){const t=this.getKeys(),o={};return t.forEach(i=>{if(!this.isAppMetadata(i))return;const a=this.getAppMetadata(i);a&&(e.environment&&!this.matchEnvironment(a,e.environment)||e.clientId&&!this.matchClientId(a,e.clientId)||(o[i]=a))}),o}getAuthorityMetadataByAlias(e){const t=this.getAuthorityMetadataKeys();let o=null;return t.forEach(i=>{if(!this.isAuthorityMetadata(i)||i.indexOf(this.clientId)===-1)return;const a=this.getAuthorityMetadata(i);a&&a.aliases.indexOf(e)!==-1&&(o=a)}),o}async removeAllAccounts(e){const t=this.getAccountKeys(),o=[];t.forEach(i=>{o.push(this.removeAccount(i,e))}),await Promise.all(o)}async removeAccount(e,t){const o=this.getAccount(e,t,this.commonLogger);o&&(await this.removeAccountContext(o,t),this.removeItem(e,t))}async removeAccountContext(e,t){const o=this.getTokenKeys(),i=e.generateAccountId();o.idToken.forEach(a=>{a.indexOf(i)===0&&this.removeIdToken(a,t)}),o.accessToken.forEach(a=>{a.indexOf(i)===0&&this.removeAccessToken(a,t)}),o.refreshToken.forEach(a=>{a.indexOf(i)===0&&this.removeRefreshToken(a,t)}),this.getKeys().forEach(a=>{a.includes(i)&&this.removeItem(a,t)})}updateOutdatedCachedAccount(e,t,o,i){if(t&&t.isSingleTenant()){this.commonLogger?.verbose("updateOutdatedCachedAccount: Found a single-tenant (outdated) account entity in the cache, migrating to multi-tenant account entity");const a=this.getAccountKeys().filter(h=>h.startsWith(t.homeAccountId)),l=[];a.forEach(h=>{const f=this.getCachedAccountEntity(h,o);f&&l.push(f)});const c=l.find(h=>yn(h.realm,h.homeAccountId))||l[0];c.tenantProfiles=l.map(h=>({tenantId:h.realm,localAccountId:h.localAccountId,name:h.name,isHomeTenant:yn(h.realm,h.homeAccountId)}));const u=It.toObject(new te,{...c}),d=u.generateAccountKey();return a.forEach(h=>{h!==d&&this.removeOutdatedAccount(e,o)}),this.setAccount(u,o),i?.verbose("Updated an outdated account entity in the cache"),u}return t}removeAccessToken(e,t){const o=this.getAccessTokenCredential(e,t);if(this.removeItem(e,t),!o||o.credentialType.toLowerCase()!==O.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()||o.tokenType!==J.POP)return;const i=o.keyId;i&&this.cryptoImpl.removeTokenBindingKey(i).catch(()=>{this.commonLogger.error("Binding key could not be removed")})}removeAppMetadata(e){return this.getKeys().forEach(o=>{this.isAppMetadata(o)&&this.removeItem(o,e)}),!0}readAccountFromCache(e,t){const o=te.generateAccountCacheKey(e);return this.getAccount(o,t,this.commonLogger)}getIdToken(e,t,o,i,a){this.commonLogger.trace("CacheManager - getIdToken called");const l={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:O.ID_TOKEN,clientId:this.clientId,realm:i},c=this.getIdTokensByFilter(l,t,o),u=c.size;if(u<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(u>1){let d=c;if(!i){const h=new Map;c.forEach((p,m)=>{p.realm===e.tenantId&&h.set(m,p)});const f=h.size;if(f<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),c.values().next().value;if(f===1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),h.values().next().value;d=h}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),d.forEach((h,f)=>{this.removeIdToken(f,t)}),a&&t&&a.addFields({multiMatchedID:c.size},t),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),c.values().next().value}getIdTokensByFilter(e,t,o){const i=o&&o.idToken||this.getTokenKeys().idToken,a=new Map;return i.forEach(l=>{if(!this.idTokenKeyMatchesFilter(l,{clientId:this.clientId,...e}))return;const c=this.getIdTokenCredential(l,t);c&&this.credentialMatchesFilter(c,e)&&a.set(l,c)}),a}idTokenKeyMatchesFilter(e,t){const o=e.toLowerCase();return!(t.clientId&&o.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&o.indexOf(t.homeAccountId.toLowerCase())===-1)}removeIdToken(e,t){this.removeItem(e,t)}removeRefreshToken(e,t){this.removeItem(e,t)}getAccessToken(e,t,o,i,a){this.commonLogger.trace("CacheManager - getAccessToken called");const l=ee.createSearchScopes(t.scopes),c=t.authenticationScheme||J.BEARER,u=c.toLowerCase()!==J.BEARER.toLowerCase()?O.ACCESS_TOKEN_WITH_AUTH_SCHEME:O.ACCESS_TOKEN,d={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:u,clientId:this.clientId,realm:i||e.tenantId,target:l,tokenType:c,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},h=o&&o.accessToken||this.getTokenKeys().accessToken,f=[];h.forEach(m=>{if(this.accessTokenKeyMatchesFilter(m,d,!0)){const v=this.getAccessTokenCredential(m,t.correlationId);v&&this.credentialMatchesFilter(v,d)&&f.push(v)}});const p=f.length;return p<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found"),null):p>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them"),f.forEach(m=>{this.removeAccessToken(ht(m),t.correlationId)}),a&&t.correlationId&&a.addFields({multiMatchedAT:f.length},t.correlationId),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),f[0])}accessTokenKeyMatchesFilter(e,t,o){const i=e.toLowerCase();if(t.clientId&&i.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&i.indexOf(t.homeAccountId.toLowerCase())===-1||t.realm&&i.indexOf(t.realm.toLowerCase())===-1||t.requestedClaimsHash&&i.indexOf(t.requestedClaimsHash.toLowerCase())===-1)return!1;if(t.target){const a=t.target.asArray();for(let l=0;l<a.length;l++){if(o&&!i.includes(a[l].toLowerCase()))return!1;if(!o&&i.includes(a[l].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e,t){const o=this.getTokenKeys(),i=[];return o.accessToken.forEach(a=>{if(!this.accessTokenKeyMatchesFilter(a,e,!0))return;const l=this.getAccessTokenCredential(a,t);l&&this.credentialMatchesFilter(l,e)&&i.push(l)}),i}getRefreshToken(e,t,o,i,a){this.commonLogger.trace("CacheManager - getRefreshToken called");const l=t?Ot:void 0,c={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:O.REFRESH_TOKEN,clientId:this.clientId,familyId:l},u=i&&i.refreshToken||this.getTokenKeys().refreshToken,d=[];u.forEach(f=>{if(this.refreshTokenKeyMatchesFilter(f,c)){const p=this.getRefreshTokenCredential(f,o);p&&this.credentialMatchesFilter(p,c)&&d.push(p)}});const h=d.length;return h<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(h>1&&a&&o&&a.addFields({multiMatchedRT:h},o),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),d[0])}refreshTokenKeyMatchesFilter(e,t){const o=e.toLowerCase();return!(t.familyId&&o.indexOf(t.familyId.toLowerCase())===-1||!t.familyId&&t.clientId&&o.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&o.indexOf(t.homeAccountId.toLowerCase())===-1)}readAppMetadataFromCache(e){const t={environment:e,clientId:this.clientId},o=this.getAppMetadataFilteredBy(t),i=Object.keys(o).map(l=>o[l]),a=i.length;if(a<1)return null;if(a>1)throw S(wa);return i[0]}isAppMetadataFOCI(e){const t=this.readAppMetadataFromCache(e);return!!(t&&t.familyId===Ot)}matchHomeAccountId(e,t){return typeof e.homeAccountId=="string"&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){const o=e.oid||e.sub;return t===o}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){return t.toLowerCase()===e.name?.toLowerCase()}matchUsername(e,t){return!!(e&&typeof e=="string"&&t?.toLowerCase()===e.toLowerCase())}matchUserAssertionHash(e,t){return!!(e.userAssertionHash&&t===e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){const i=yT(this.staticAuthorityOptions,this.commonLogger);if(i.includes(t)&&i.includes(e.environment))return!0}const o=this.getAuthorityMetadataByAlias(t);return!!(o&&o.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!!(e.clientId&&t===e.clientId)}matchFamilyId(e,t){return!!(e.familyId&&t===e.familyId)}matchRealm(e,t){return e.realm?.toLowerCase()===t.toLowerCase()}matchNativeAccountId(e,t){return!!(e.nativeAccountId&&t===e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!!(e.authorityType&&t.toLowerCase()===e.authorityType.toLowerCase())}matchTarget(e,t){return e.credentialType!==O.ACCESS_TOKEN&&e.credentialType!==O.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target?!1:ee.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!!(e.tokenType&&e.tokenType===t)}matchKeyId(e,t){return!!(e.keyId&&e.keyId===t)}isAppMetadata(e){return e.indexOf(qo)!==-1}isAuthorityMetadata(e){return e.indexOf(gn.CACHE_KEY)!==-1}generateAuthorityMetadataCacheKey(e){return`${gn.CACHE_KEY}-${this.clientId}-${e}`}static toObject(e,t){for(const o in t)e[o]=t[o];return e}}class vT extends It{setAccount(){throw S(B)}getAccount(){throw S(B)}getCachedAccountEntity(){throw S(B)}setIdTokenCredential(){throw S(B)}getIdTokenCredential(){throw S(B)}setAccessTokenCredential(){throw S(B)}getAccessTokenCredential(){throw S(B)}setRefreshTokenCredential(){throw S(B)}getRefreshTokenCredential(){throw S(B)}setAppMetadata(){throw S(B)}getAppMetadata(){throw S(B)}setServerTelemetry(){throw S(B)}getServerTelemetry(){throw S(B)}setAuthorityMetadata(){throw S(B)}getAuthorityMetadata(){throw S(B)}getAuthorityMetadataKeys(){throw S(B)}setThrottlingCache(){throw S(B)}getThrottlingCache(){throw S(B)}removeItem(){throw S(B)}getKeys(){throw S(B)}getAccountKeys(){throw S(B)}getTokenKeys(){throw S(B)}updateCredentialCacheKey(){throw S(B)}removeOutdatedAccount(){throw S(B)}}/*! @azure/msal-common v14.16.1 2025-08-05 */const tl={tokenRenewalOffsetSeconds:Gy,preventCorsPreflight:!1},IT={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:Z.Info,correlationId:I.EMPTY_STRING},ET={claimsBasedCachingEnabled:!1},ST={async sendGetRequestAsync(){throw S(B)},async sendPostRequestAsync(){throw S(B)}},AT={sku:I.SKU,version:Qo,cpu:I.EMPTY_STRING,os:I.EMPTY_STRING},wT={clientSecret:I.EMPTY_STRING,clientAssertion:void 0},_T={azureCloudInstance:Xo.None,tenant:`${I.DEFAULT_COMMON_TENANT}`},RT={application:{appName:"",appVersion:""}};function kT({authOptions:n,systemOptions:e,loggerOptions:t,cacheOptions:o,storageInterface:i,networkInterface:a,cryptoInterface:l,clientCredentials:c,libraryInfo:u,telemetry:d,serverTelemetryManager:h,persistencePlugin:f,serializableCache:p}){const m={...IT,...t};return{authOptions:MT(n),systemOptions:{...tl,...e},loggerOptions:m,cacheOptions:{...ET,...o},storageInterface:i||new vT(n.clientId,mn,new Jt(m)),networkInterface:a||ST,cryptoInterface:l||mn,clientCredentials:c||wT,libraryInfo:{...AT,...u},telemetry:{...RT,...d},serverTelemetryManager:h||null,persistencePlugin:f||null,serializableCache:p||null}}function MT(n){return{clientCapabilities:[],azureCloudOptions:_T,skipAuthorityMetadataCache:!1,instanceAware:!1,...n}}function So(n){return n.authOptions.authority.options.protocolMode===qe.OIDC}/*! @azure/msal-common v14.16.1 2025-08-05 */const Ie={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"};/*! @azure/msal-common v14.16.1 2025-08-05 */const Ze="client_id",nl="redirect_uri",fs="response_type",PT="response_mode",bT="grant_type",NT="claims",xT="scope",LT="refresh_token",DT="state",UT="nonce",OT="prompt",HT="code",BT="code_challenge",FT="code_challenge_method",GT="code_verifier",qT="client-request-id",VT="x-client-SKU",KT="x-client-VER",$T="x-client-OS",JT="x-client-CPU",zT="x-client-current-telemetry",YT="x-client-last-telemetry",WT="x-ms-lib-capability",QT="x-app-name",XT="x-app-ver",ZT="post_logout_redirect_uri",jT="id_token_hint",ev="device_code",tv="client_secret",nv="client_assertion",ov="client_assertion_type",gs="token_type",ps="req_cnf",iv="assertion",rv="requested_token_use",ms="return_spa_code",sv="nativebroker",av="logout_hint",lv="sid",cv="login_hint",dv="domain_hint",uv="x-client-xtra-sku",li="brk_client_id",Ao="brk_redirect_uri";/*! @azure/msal-common v14.16.1 2025-08-05 */class lt{static validateRedirectUri(e){if(!e)throw z(Ua)}static validatePrompt(e){const t=[];for(const o in ie)t.push(ie[o]);if(t.indexOf(e)<0)throw z(Fa)}static validateClaims(e){try{JSON.parse(e)}catch{throw z(jo)}}static validateCodeChallengeParams(e,t){if(!e||!t)throw z(ei);this.validateCodeChallengeMethod(t)}static validateCodeChallengeMethod(e){if([ts.PLAIN,ts.S256].indexOf(e)<0)throw z(Va)}}/*! @azure/msal-common v14.16.1 2025-08-05 */function hv(n,e,t){if(!e)return;const o=n.get(Ze);o&&n.has(li)&&t?.addFields({embeddedClientId:o,embeddedRedirectUri:n.get(nl)},e)}class Bt{constructor(e,t){this.parameters=new Map,this.performanceClient=t,this.correlationId=e}addResponseTypeCode(){this.parameters.set(fs,encodeURIComponent(I.CODE_RESPONSE_TYPE))}addResponseTypeForTokenAndIdToken(){this.parameters.set(fs,encodeURIComponent(`${I.TOKEN_RESPONSE_TYPE} ${I.ID_TOKEN_RESPONSE_TYPE}`))}addResponseMode(e){this.parameters.set(PT,encodeURIComponent(e||Hy.QUERY))}addNativeBroker(){this.parameters.set(sv,encodeURIComponent("1"))}addScopes(e,t=!0,o=Pt){t&&!o.includes("openid")&&!e.includes("openid")&&o.push("openid");const i=t?[...e||[],...o]:e||[],a=new ee(i);this.parameters.set(xT,encodeURIComponent(a.printScopes()))}addClientId(e){this.parameters.set(Ze,encodeURIComponent(e))}addRedirectUri(e){lt.validateRedirectUri(e),this.parameters.set(nl,encodeURIComponent(e))}addPostLogoutRedirectUri(e){lt.validateRedirectUri(e),this.parameters.set(ZT,encodeURIComponent(e))}addIdTokenHint(e){this.parameters.set(jT,encodeURIComponent(e))}addDomainHint(e){this.parameters.set(dv,encodeURIComponent(e))}addLoginHint(e){this.parameters.set(cv,encodeURIComponent(e))}addCcsUpn(e){this.parameters.set(fe.CCS_HEADER,encodeURIComponent(`UPN:${e}`))}addCcsOid(e){this.parameters.set(fe.CCS_HEADER,encodeURIComponent(`Oid:${e.uid}@${e.utid}`))}addSid(e){this.parameters.set(lv,encodeURIComponent(e))}addClaims(e,t){const o=this.addClientCapabilitiesToClaims(e,t);lt.validateClaims(o),this.parameters.set(NT,encodeURIComponent(o))}addCorrelationId(e){this.parameters.set(qT,encodeURIComponent(e))}addLibraryInfo(e){this.parameters.set(VT,e.sku),this.parameters.set(KT,e.version),e.os&&this.parameters.set($T,e.os),e.cpu&&this.parameters.set(JT,e.cpu)}addApplicationTelemetry(e){e?.appName&&this.parameters.set(QT,e.appName),e?.appVersion&&this.parameters.set(XT,e.appVersion)}addPrompt(e){lt.validatePrompt(e),this.parameters.set(`${OT}`,encodeURIComponent(e))}addState(e){e&&this.parameters.set(DT,encodeURIComponent(e))}addNonce(e){this.parameters.set(UT,encodeURIComponent(e))}addCodeChallengeParams(e,t){if(lt.validateCodeChallengeParams(e,t),e&&t)this.parameters.set(BT,encodeURIComponent(e)),this.parameters.set(FT,encodeURIComponent(t));else throw z(ei)}addAuthorizationCode(e){this.parameters.set(HT,encodeURIComponent(e))}addDeviceCode(e){this.parameters.set(ev,encodeURIComponent(e))}addRefreshToken(e){this.parameters.set(LT,encodeURIComponent(e))}addCodeVerifier(e){this.parameters.set(GT,encodeURIComponent(e))}addClientSecret(e){this.parameters.set(tv,encodeURIComponent(e))}addClientAssertion(e){e&&this.parameters.set(nv,encodeURIComponent(e))}addClientAssertionType(e){e&&this.parameters.set(ov,encodeURIComponent(e))}addOboAssertion(e){this.parameters.set(iv,encodeURIComponent(e))}addRequestTokenUse(e){this.parameters.set(rv,encodeURIComponent(e))}addGrantType(e){this.parameters.set(bT,encodeURIComponent(e))}addClientInfo(){this.parameters.set(By,"1")}addExtraQueryParameters(e){Object.entries(e).forEach(([t,o])=>{!this.parameters.has(t)&&o&&this.parameters.set(t,o)})}addClientCapabilitiesToClaims(e,t){let o;if(!e)o={};else try{o=JSON.parse(e)}catch{throw z(jo)}return t&&t.length>0&&(o.hasOwnProperty(jt.ACCESS_TOKEN)||(o[jt.ACCESS_TOKEN]={}),o[jt.ACCESS_TOKEN][jt.XMS_CC]={values:t}),JSON.stringify(o)}addUsername(e){this.parameters.set(os.username,encodeURIComponent(e))}addPassword(e){this.parameters.set(os.password,encodeURIComponent(e))}addPopToken(e){e&&(this.parameters.set(gs,J.POP),this.parameters.set(ps,encodeURIComponent(e)))}addSshJwk(e){e&&(this.parameters.set(gs,J.SSH),this.parameters.set(ps,encodeURIComponent(e)))}addServerTelemetry(e){this.parameters.set(zT,e.generateCurrentRequestHeaderValue()),this.parameters.set(YT,e.generateLastRequestHeaderValue())}addThrottling(){this.parameters.set(WT,Ht.X_MS_LIB_CAPABILITY_VALUE)}addLogoutHint(e){this.parameters.set(av,encodeURIComponent(e))}addBrokerParameters(e){const t={};t[li]=e.brokerClientId,t[Ao]=e.brokerRedirectUri,this.addExtraQueryParameters(t)}createQueryString(){const e=new Array;return this.parameters.forEach((t,o)=>{e.push(`${o}=${t}`)}),hv(this.parameters,this.correlationId,this.performanceClient),e.join("&")}}/*! @azure/msal-common v14.16.1 2025-08-05 */function fv(n){return n.hasOwnProperty("authorization_endpoint")&&n.hasOwnProperty("token_endpoint")&&n.hasOwnProperty("issuer")&&n.hasOwnProperty("jwks_uri")}/*! @azure/msal-common v14.16.1 2025-08-05 */function gv(n){return n.hasOwnProperty("tenant_discovery_endpoint")&&n.hasOwnProperty("metadata")}/*! @azure/msal-common v14.16.1 2025-08-05 */function pv(n){return n.hasOwnProperty("error")&&n.hasOwnProperty("error_description")}/*! @azure/msal-common v14.16.1 2025-08-05 */const T={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenPreRedirect:"acquireTokenPreRedirect",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",AwaitConcurrentIframe:"awaitConcurrentIframe",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",NetworkClientSendPostRequestAsync:"networkClientSendPostRequestAsync",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",StandardInteractionClientInitializeAuthorizationCodeRequest:"standardInteractionClientInitializeAuthorizationCodeRequest",GetAuthCodeUrl:"getAuthCodeUrl",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",AuthClientCreateQueryString:"authClientCreateQueryString",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues"},mv={InProgress:1};/*! @azure/msal-common v14.16.1 2025-08-05 */const rt=(n,e,t,o,i)=>(...a)=>{t.trace(`Executing function ${e}`);const l=o?.startMeasurement(e,i);if(i){const c=e+"CallCount";o?.incrementFields({[c]:1},i)}try{const c=n(...a);return l?.end({success:!0}),t.trace(`Returning result from ${e}`),c}catch(c){t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(c))}catch{t.trace("Unable to print error message.")}throw l?.end({success:!1},c),c}},w=(n,e,t,o,i)=>(...a)=>{t.trace(`Executing function ${e}`);const l=o?.startMeasurement(e,i);if(i){const c=e+"CallCount";o?.incrementFields({[c]:1},i)}return o?.setPreQueueTime(e,i),n(...a).then(c=>(t.trace(`Returning result from ${e}`),l?.end({success:!0}),c)).catch(c=>{t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(c))}catch{t.trace("Unable to print error message.")}throw l?.end({success:!1},c),c})};/*! @azure/msal-common v14.16.1 2025-08-05 */class Ln{constructor(e,t,o,i){this.networkInterface=e,this.logger=t,this.performanceClient=o,this.correlationId=i}async detectRegion(e,t){this.performanceClient?.addQueueMeasurement(T.RegionDiscoveryDetectRegion,this.correlationId);let o=e;if(o)t.region_source=at.ENVIRONMENT_VARIABLE;else{const i=Ln.IMDS_OPTIONS;try{const a=await w(this.getRegionFromIMDS.bind(this),T.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(I.IMDS_VERSION,i);if(a.status===tn.httpSuccess&&(o=a.body,t.region_source=at.IMDS),a.status===tn.httpBadRequest){const l=await w(this.getCurrentVersion.bind(this),T.RegionDiscoveryGetCurrentVersion,this.logger,this.performanceClient,this.correlationId)(i);if(!l)return t.region_source=at.FAILED_AUTO_DETECTION,null;const c=await w(this.getRegionFromIMDS.bind(this),T.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(l,i);c.status===tn.httpSuccess&&(o=c.body,t.region_source=at.IMDS)}}catch{return t.region_source=at.FAILED_AUTO_DETECTION,null}}return o||(t.region_source=at.FAILED_AUTO_DETECTION),o||null}async getRegionFromIMDS(e,t){return this.performanceClient?.addQueueMeasurement(T.RegionDiscoveryGetRegionFromIMDS,this.correlationId),this.networkInterface.sendGetRequestAsync(`${I.IMDS_ENDPOINT}?api-version=${e}&format=text`,t,I.IMDS_TIMEOUT)}async getCurrentVersion(e){this.performanceClient?.addQueueMeasurement(T.RegionDiscoveryGetCurrentVersion,this.correlationId);try{const t=await this.networkInterface.sendGetRequestAsync(`${I.IMDS_ENDPOINT}?format=json`,e);return t.status===tn.httpBadRequest&&t.body&&t.body["newest-versions"]&&t.body["newest-versions"].length>0?t.body["newest-versions"][0]:null}catch{return null}}}Ln.IMDS_OPTIONS={headers:{Metadata:"true"}};/*! @azure/msal-common v14.16.1 2025-08-05 */class le{constructor(e,t,o,i,a,l,c,u){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=o,this.authorityOptions=i,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=a,this.performanceClient=c,this.correlationId=l,this.managedIdentity=u||!1,this.regionDiscovery=new Ln(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(I.CIAM_AUTH_URL))return we.Ciam;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case I.ADFS:return we.Adfs;case I.DSTS:return we.Dsts}return we.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new G(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw S(Be)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw S(Be)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw S(Be)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw S(Na);return this.replacePath(this.metadata.end_session_endpoint)}else throw S(Be)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw S(Be)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw S(Be)}canReplaceTenant(e){return e.PathSegments.length===1&&!le.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===we.Default&&this.protocolMode===qe.AAD}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const i=new G(this.metadata.canonical_authority).getUrlComponents(),a=i.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((c,u)=>{let d=a[u];if(u===0&&this.canReplaceTenant(i)){const h=new G(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];d!==h&&(this.logger.verbose(`Replacing tenant domain name ${d} with id ${h}`),d=h)}c!==d&&(t=t.replace(`/${d}/`,`/${c}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===we.Adfs||this.protocolMode!==qe.AAD&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){this.performanceClient?.addQueueMeasurement(T.AuthorityResolveEndpointsAsync,this.correlationId);const e=this.getCurrentMetadataEntity(),t=await w(this.updateCloudDiscoveryMetadata.bind(this),T.AuthorityUpdateCloudDiscoveryMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);const o=await w(this.updateEndpointMetadata.bind(this),T.AuthorityUpdateEndpointMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:o}),this.performanceClient?.addFields({cloudDiscoverySource:t,authorityEndpointSource:o},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:cs(),jwks_uri:""}),e}updateCachedMetadata(e,t,o){t!==ye.CACHE&&o?.source!==ye.CACHE&&(e.expiresAt=cs(),e.canonical_authority=this.canonicalAuthority);const i=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(i,e),this.metadata=e}async updateEndpointMetadata(e){this.performanceClient?.addQueueMeasurement(T.AuthorityUpdateEndpointMetadata,this.correlationId);const t=this.updateEndpointMetadataFromLocalSources(e);if(t){if(t.source===ye.HARDCODED_VALUES&&this.authorityOptions.azureRegionConfiguration?.azureRegion&&t.metadata){const i=await w(this.updateMetadataWithRegionalInformation.bind(this),T.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(t.metadata);nn(e,i,!1),e.canonical_authority=this.canonicalAuthority}return t.source}let o=await w(this.getEndpointMetadataFromNetwork.bind(this),T.AuthorityGetEndpointMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(o)return this.authorityOptions.azureRegionConfiguration?.azureRegion&&(o=await w(this.updateMetadataWithRegionalInformation.bind(this),T.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(o)),nn(e,o,!0),ye.NETWORK;throw S(va,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),nn(e,t,!1),{source:ye.CONFIG};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{const i=this.getEndpointMetadataFromHardcodedValues();if(i)return nn(e,i,!1),{source:ye.HARDCODED_VALUES,metadata:i};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}const o=ds(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!o?(this.logger.verbose("Found endpoint metadata in the cache."),{source:ye.CACHE}):(o&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new G(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw z(Ka)}return null}async getEndpointMetadataFromNetwork(){this.performanceClient?.addQueueMeasurement(T.AuthorityGetEndpointMetadataFromNetwork,this.correlationId);const e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${t}`);try{const o=await this.networkInterface.sendGetRequestAsync(t,e);return fv(o.body)?o.body:(this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(o){return this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${o}`),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in us?us[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){this.performanceClient?.addQueueMeasurement(T.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId);const t=this.authorityOptions.azureRegionConfiguration?.azureRegion;if(t){if(t!==I.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome=zn.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,le.replaceWithRegionalInformation(e,t);const o=await w(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),T.RegionDiscoveryDetectRegion,this.logger,this.performanceClient,this.correlationId)(this.authorityOptions.azureRegionConfiguration?.environmentRegion,this.regionDiscoveryMetadata);if(o)return this.regionDiscoveryMetadata.region_outcome=zn.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=o,le.replaceWithRegionalInformation(e,o);this.regionDiscoveryMetadata.region_outcome=zn.AUTO_DETECTION_REQUESTED_FAILED}return e}async updateCloudDiscoveryMetadata(e){this.performanceClient?.addQueueMeasurement(T.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId);const t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;const o=await w(this.getCloudDiscoveryMetadataFromNetwork.bind(this),T.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(o)return Yn(e,o,!0),ye.NETWORK;throw z($a)}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||I.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||I.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||I.NOT_APPLICABLE}`);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),Yn(e,t,!1),ye.CONFIG;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{const i=TT(this.hostnameAndPort);if(i)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),Yn(e,i,!1),ye.HARDCODED_VALUES;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}const o=ds(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!o?(this.logger.verbose("Found cloud discovery metadata in the cache."),ye.CACHE):(o&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===we.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),le.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");const e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=vn(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),z(ti)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),le.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){this.performanceClient?.addQueueMeasurement(T.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId);const e=`${I.AAD_INSTANCE_DISCOVERY_ENDPT}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={};let o=null;try{const i=await this.networkInterface.sendGetRequestAsync(e,t);let a,l;if(gv(i.body))a=i.body,l=a.metadata,this.logger.verbosePii(`tenant_discovery_endpoint is: ${a.tenant_discovery_endpoint}`);else if(pv(i.body)){if(this.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${i.status}`),a=i.body,a.error===I.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${a.error}`),this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${a.error_description}`),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),l=[]}else return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),o=vn(l,this.hostnameAndPort)}catch(i){if(i instanceof X)this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.
Error: ${i.errorCode}
Error Description: ${i.errorMessage}`);else{const a=i;this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.
Error: ${a.name}
Error Description: ${a.message}`)}return null}return o||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),o=le.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),o}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&G.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let o;if(t&&t.azureCloudInstance!==Xo.None){const i=t.tenant?t.tenant:I.DEFAULT_COMMON_TENANT;o=`${t.azureCloudInstance}/${i}/`}return o||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return I.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw S(Be)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return ja.has(e)}static isPublicCloudAuthority(e){return I.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,o){const i=new G(e);i.validateAsUri();const a=i.getUrlComponents();let l=`${t}.${a.HostNameAndPort}`;this.isPublicCloudAuthority(a.HostNameAndPort)&&(l=`${t}.${I.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);const c=G.constructAuthorityUriFromObject({...i.getUrlComponents(),HostNameAndPort:l}).urlString;return o?`${c}?${o}`:c}static replaceWithRegionalInformation(e,t){const o={...e};return o.authorization_endpoint=le.buildRegionalAuthorityString(o.authorization_endpoint,t),o.token_endpoint=le.buildRegionalAuthorityString(o.token_endpoint,t),o.end_session_endpoint&&(o.end_session_endpoint=le.buildRegionalAuthorityString(o.end_session_endpoint,t)),o}static transformCIAMAuthority(e){let t=e;const i=new G(e).getUrlComponents();if(i.PathSegments.length===0&&i.HostNameAndPort.endsWith(I.CIAM_AUTH_URL)){const a=i.HostNameAndPort.split(".")[0];t=`${t}${a}${I.AAD_TENANT_DOMAIN_SUFFIX}`}return t}}le.reservedTenantDomains=new Set(["{tenant}","{tenantid}",$e.COMMON,$e.CONSUMERS,$e.ORGANIZATIONS]);function Cv(n){const o=new G(n).getUrlComponents().PathSegments.slice(-1)[0]?.toLowerCase();switch(o){case $e.COMMON:case $e.ORGANIZATIONS:case $e.CONSUMERS:return;default:return o}}function ol(n){return n.endsWith(I.FORWARD_SLASH)?n:`${n}${I.FORWARD_SLASH}`}function yv(n){const e=n.cloudDiscoveryMetadata;let t;if(e)try{t=JSON.parse(e)}catch{throw z(ti)}return{canonicalAuthority:n.authority?ol(n.authority):void 0,knownAuthorities:n.knownAuthorities,cloudDiscoveryMetadata:t}}/*! @azure/msal-common v14.16.1 2025-08-05 */async function il(n,e,t,o,i,a,l){l?.addQueueMeasurement(T.AuthorityFactoryCreateDiscoveredInstance,a);const c=le.transformCIAMAuthority(ol(n)),u=new le(c,e,t,o,i,a,l);try{return await w(u.resolveEndpointsAsync.bind(u),T.AuthorityResolveEndpointsAsync,i,l,a)(),u}catch{throw S(Be)}}/*! @azure/msal-common v14.16.1 2025-08-05 */class Ye extends X{constructor(e,t,o,i,a){super(e,t,o),this.name="ServerError",this.errorNo=i,this.status=a,Object.setPrototypeOf(this,Ye.prototype)}}/*! @azure/msal-common v14.16.1 2025-08-05 */class be{static generateThrottlingStorageKey(e){return`${Ht.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t,o){const i=be.generateThrottlingStorageKey(t),a=e.getThrottlingCache(i);if(a){if(a.throttleTime<Date.now()){e.removeItem(i,o);return}throw new Ye(a.errorCodes?.join(" ")||I.EMPTY_STRING,a.errorMessage,a.subError)}}static postProcess(e,t,o,i){if(be.checkResponseStatus(o)||be.checkResponseForRetryAfter(o)){const a={throttleTime:be.calculateThrottleTime(parseInt(o.headers[fe.RETRY_AFTER])),error:o.body.error,errorCodes:o.body.error_codes,errorMessage:o.body.error_description,subError:o.body.suberror};e.setThrottlingCache(be.generateThrottlingStorageKey(t),a,i)}}static checkResponseStatus(e){return e.status===429||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return e.headers?e.headers.hasOwnProperty(fe.RETRY_AFTER)&&(e.status<200||e.status>=300):!1}static calculateThrottleTime(e){const t=e<=0?0:e,o=Date.now()/1e3;return Math.floor(Math.min(o+(t||Ht.DEFAULT_THROTTLE_TIME_SECONDS),o+Ht.DEFAULT_MAX_THROTTLE_TIME_SECONDS)*1e3)}static removeThrottle(e,t,o,i){const a={clientId:t,authority:o.authority,scopes:o.scopes,homeAccountIdentifier:i,claims:o.claims,authenticationScheme:o.authenticationScheme,resourceRequestMethod:o.resourceRequestMethod,resourceRequestUri:o.resourceRequestUri,shrClaims:o.shrClaims,sshKid:o.sshKid},l=this.generateThrottlingStorageKey(a);e.removeItem(l,o.correlationId)}}/*! @azure/msal-common v14.16.1 2025-08-05 */class Dn extends X{constructor(e,t,o){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,Dn.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=o}}function Cs(n,e,t){return new Dn(n,e,t)}/*! @azure/msal-common v14.16.1 2025-08-05 */class ci{constructor(e,t){this.config=kT(e),this.logger=new Jt(this.config.loggerOptions,xa,Qo),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){const t={};if(t[fe.CONTENT_TYPE]=I.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case Ie.HOME_ACCOUNT_ID:try{const o=ft(e.credential);t[fe.CCS_HEADER]=`Oid:${o.uid}@${o.utid}`}catch(o){this.logger.verbose("Could not parse home account ID for CCS Header: "+o)}break;case Ie.UPN:t[fe.CCS_HEADER]=`UPN: ${e.credential}`;break}return t}async executePostToTokenEndpoint(e,t,o,i,a,l){l&&this.performanceClient?.addQueueMeasurement(l,a);const c=await this.sendPostRequest(i,e,{body:t,headers:o},a);return this.config.serverTelemetryManager&&c.status<500&&c.status!==429&&this.config.serverTelemetryManager.clearTelemetryCache(),c}async sendPostRequest(e,t,o,i){be.preProcess(this.cacheManager,e,i);let a;try{a=await w(this.networkClient.sendPostRequestAsync.bind(this.networkClient),T.NetworkClientSendPostRequestAsync,this.logger,this.performanceClient,i)(t,o);const l=a.headers||{};this.performanceClient?.addFields({refreshTokenSize:a.body.refresh_token?.length||0,httpVerToken:l[fe.X_MS_HTTP_VERSION]||"",requestId:l[fe.X_MS_REQUEST_ID]||""},i)}catch(l){if(l instanceof Dn){const c=l.responseHeaders;throw c&&this.performanceClient?.addFields({httpVerToken:c[fe.X_MS_HTTP_VERSION]||"",requestId:c[fe.X_MS_REQUEST_ID]||"",contentTypeHeader:c[fe.CONTENT_TYPE]||void 0,contentLengthHeader:c[fe.CONTENT_LENGTH]||void 0,httpStatus:l.httpStatus},i),l.error}throw l instanceof X?l:S(Ta)}return be.postProcess(this.cacheManager,e,a,i),a}async updateAuthority(e,t){this.performanceClient?.addQueueMeasurement(T.UpdateTokenEndpointAuthority,t);const o=`https://${e}/${this.authority.tenant}/`,i=await il(o,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=i}createTokenQueryParameters(e){const t=new Bt(e.correlationId,this.performanceClient);return e.embeddedClientId&&t.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.addCorrelationId(e.correlationId),t.createQueryString()}}/*! @azure/msal-common v14.16.1 2025-08-05 */const In="no_tokens_found",rl="native_account_unavailable",di="refresh_token_expired",Tv="interaction_required",vv="consent_required",Iv="login_required",Un="bad_token";/*! @azure/msal-common v14.16.1 2025-08-05 */const ys=[Tv,vv,Iv,Un],Ev=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],Sv={[In]:"No refresh token found in the cache. Please sign-in.",[rl]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[di]:"Refresh token has expired.",[Un]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve."};class Ae extends X{constructor(e,t,o,i,a,l,c,u){super(e,t,o),Object.setPrototypeOf(this,Ae.prototype),this.timestamp=i||I.EMPTY_STRING,this.traceId=a||I.EMPTY_STRING,this.correlationId=l||I.EMPTY_STRING,this.claims=c||I.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=u}}function Ts(n,e,t){const o=!!n&&ys.indexOf(n)>-1,i=!!t&&Ev.indexOf(t)>-1,a=!!e&&ys.some(l=>e.indexOf(l)>-1);return o||a||i}function wo(n){return new Ae(n,Sv[n])}/*! @azure/msal-common v14.16.1 2025-08-05 */class ke{static setRequestState(e,t,o){const i=ke.generateLibraryState(e,o);return t?`${i}${I.RESOURCE_DELIM}${t}`:i}static generateLibraryState(e,t){if(!e)throw S(To);const o={id:e.createNewGuid()};t&&(o.meta=t);const i=JSON.stringify(o);return e.base64Encode(i)}static parseRequestState(e,t){if(!e)throw S(To);if(!t)throw S(vt);try{const o=t.split(I.RESOURCE_DELIM),i=o[0],a=o.length>1?o.slice(1).join(I.RESOURCE_DELIM):I.EMPTY_STRING,l=e.base64Decode(i),c=JSON.parse(l);return{userRequestState:a||I.EMPTY_STRING,libraryState:c}}catch{throw S(vt)}}}/*! @azure/msal-common v14.16.1 2025-08-05 */const Av={SW:"sw"};class Et{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){this.performanceClient?.addQueueMeasurement(T.PopTokenGenerateCnf,e.correlationId);const o=await w(this.generateKid.bind(this),T.PopTokenGenerateCnf,t,this.performanceClient,e.correlationId)(e),i=this.cryptoUtils.base64UrlEncode(JSON.stringify(o));return{kid:o.kid,reqCnfString:i}}async generateKid(e){return this.performanceClient?.addQueueMeasurement(T.PopTokenGenerateKid,e.correlationId),{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:Av.SW}}async signPopToken(e,t,o){return this.signPayload(e,t,o)}async signPayload(e,t,o,i){const{resourceRequestMethod:a,resourceRequestUri:l,shrClaims:c,shrNonce:u,shrOptions:d}=o,f=(l?new G(l):void 0)?.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:De(),m:a?.toUpperCase(),u:f?.HostNameAndPort,nonce:u||this.cryptoUtils.createNewGuid(),p:f?.AbsolutePath,q:f?.QueryString?[[],f.QueryString]:void 0,client_claims:c||void 0,...i},t,d,o.correlationId)}}/*! @azure/msal-common v14.16.1 2025-08-05 */class wv{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}/*! @azure/msal-common v14.16.1 2025-08-05 */function _v(n){const e="code=",t=n.error_uri?.lastIndexOf(e);return t&&t>=0?n.error_uri?.substring(t+e.length):void 0}class je{constructor(e,t,o,i,a,l,c){this.clientId=e,this.cacheStorage=t,this.cryptoObj=o,this.logger=i,this.serializableCache=a,this.persistencePlugin=l,this.performanceClient=c}validateServerAuthorizationCodeResponse(e,t){if(!e.state||!t)throw e.state?S(pn,"Cached State"):S(pn,"Server State");let o,i;try{o=decodeURIComponent(e.state)}catch{throw S(vt,e.state)}try{i=decodeURIComponent(t)}catch{throw S(vt,e.state)}if(o!==i)throw S(Ea);if(e.error||e.error_description||e.suberror){const a=_v(e);throw Ts(e.error,e.error_description,e.suberror)?new Ae(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",a):new Ye(e.error||"",e.error_description,e.suberror,a)}}validateTokenResponse(e,t){if(e.error||e.error_description||e.suberror){const o=`Error(s): ${e.error_codes||I.NOT_AVAILABLE} - Timestamp: ${e.timestamp||I.NOT_AVAILABLE} - Description: ${e.error_description||I.NOT_AVAILABLE} - Correlation ID: ${e.correlation_id||I.NOT_AVAILABLE} - Trace ID: ${e.trace_id||I.NOT_AVAILABLE}`,i=e.error_codes?.length?e.error_codes[0]:void 0,a=new Ye(e.error,o,e.suberror,i,e.status);if(t&&e.status&&e.status>=Zt.SERVER_ERROR_RANGE_START&&e.status<=Zt.SERVER_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.
${a}`);return}else if(t&&e.status&&e.status>=Zt.CLIENT_ERROR_RANGE_START&&e.status<=Zt.CLIENT_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.
${a}`);return}throw Ts(e.error,e.error_description,e.suberror)?new Ae(e.error,e.error_description,e.suberror,e.timestamp||I.EMPTY_STRING,e.trace_id||I.EMPTY_STRING,e.correlation_id||I.EMPTY_STRING,e.claims||I.EMPTY_STRING,i):a}}async handleServerTokenResponse(e,t,o,i,a,l,c,u,d){this.performanceClient?.addQueueMeasurement(T.HandleServerTokenResponse,e.correlation_id);let h;if(e.id_token){if(h=it(e.id_token||I.EMPTY_STRING,this.cryptoObj.base64Decode),a&&a.nonce&&h.nonce!==a.nonce)throw S(Sa);if(i.maxAge||i.maxAge===0){const v=h.auth_time;if(!v)throw S(Jo);La(v,i.maxAge)}}this.homeAccountIdentifier=te.generateHomeAccountId(e.client_info||I.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,h);let f;a&&a.state&&(f=ke.parseRequestState(this.cryptoObj,a.state)),e.key_id=e.key_id||i.sshKid||void 0;const p=this.generateCacheRecord(e,t,o,i,h,l,a);let m;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),m=new wv(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(m)),c&&!u&&p.account){const v=p.account.generateAccountKey();if(!this.cacheStorage.getAccount(v,i.correlationId,this.logger))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),await je.generateAuthenticationResult(this.cryptoObj,t,p,!1,i,h,f,void 0,d)}await this.cacheStorage.saveCacheRecord(p,i.correlationId,i.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&m&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),await this.persistencePlugin.afterCacheAccess(m))}return je.generateAuthenticationResult(this.cryptoObj,t,p,!1,i,h,f,e,d)}generateCacheRecord(e,t,o,i,a,l,c){const u=t.getPreferredCache();if(!u)throw S(Yo);const d=Qa(a);let h,f;e.id_token&&a&&(h=bn(this.homeAccountIdentifier,u,e.id_token,this.clientId,d||""),f=ui(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,i.correlationId,a,e.client_info,u,d,c,void 0,this.logger));let p=null;if(e.access_token){const y=e.scope?ee.fromString(e.scope):new ee(i.scopes||[]),E=(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,A=(typeof e.ext_expires_in=="string"?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,R=(typeof e.refresh_in=="string"?parseInt(e.refresh_in,10):e.refresh_in)||void 0,M=o+E,L=M+A,_=R&&R>0?o+R:void 0;p=Nn(this.homeAccountIdentifier,u,e.access_token,this.clientId,d||t.tenant||"",y.printScopes(),M,L,this.cryptoObj.base64Decode,_,e.token_type,l,e.key_id,i.claims,i.requestedClaimsHash)}let m=null;if(e.refresh_token){let y;if(e.refresh_token_expires_in){const E=typeof e.refresh_token_expires_in=="string"?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in;y=o+E}m=Da(this.homeAccountIdentifier,u,e.refresh_token,this.clientId,e.foci,l,y)}let v=null;return e.foci&&(v={clientId:this.clientId,environment:u,familyId:e.foci}),{account:f,idToken:h,accessToken:p,refreshToken:m,appMetadata:v}}static async generateAuthenticationResult(e,t,o,i,a,l,c,u,d){let h=I.EMPTY_STRING,f=[],p=null,m,v,y=I.EMPTY_STRING;if(o.accessToken){if(o.accessToken.tokenType===J.POP&&!a.popKid){const M=new Et(e),{secret:L,keyId:_}=o.accessToken;if(!_)throw S(Wo);h=await M.signPopToken(L,_,a)}else h=o.accessToken.secret;f=ee.fromString(o.accessToken.target).asArray(),p=new Date(Number(o.accessToken.expiresOn)*1e3),m=new Date(Number(o.accessToken.extendedExpiresOn)*1e3),o.accessToken.refreshOn&&(v=new Date(Number(o.accessToken.refreshOn)*1e3))}o.appMetadata&&(y=o.appMetadata.familyId===Ot?Ot:"");const E=l?.oid||l?.sub||"",A=l?.tid||"";u?.spa_accountid&&o.account&&(o.account.nativeAccountId=u?.spa_accountid);const R=o.account?ii(o.account.getAccountInfo(),void 0,l,o.idToken?.secret):null;return{authority:t.canonicalAuthority,uniqueId:E,tenantId:A,scopes:f,account:R,idToken:o?.idToken?.secret||"",idTokenClaims:l||{},accessToken:h,fromCache:i,expiresOn:p,extExpiresOn:m,refreshOn:v,correlationId:a.correlationId,requestId:d||I.EMPTY_STRING,familyId:y,tokenType:o.accessToken?.tokenType||I.EMPTY_STRING,state:c?c.userRequestState:I.EMPTY_STRING,cloudGraphHostName:o.account?.cloudGraphHostName||I.EMPTY_STRING,msGraphHost:o.account?.msGraphHost||I.EMPTY_STRING,code:u?.spa_code,fromNativeBroker:!1}}}function ui(n,e,t,o,i,a,l,c,u,d,h,f){f?.verbose("setCachedAccount called");const m=n.getAccountKeys().find(R=>R.startsWith(t));let v=null;m&&(v=n.getAccount(m,i,f));const y=v||te.createAccount({homeAccountId:t,idTokenClaims:a,clientInfo:l,environment:c,cloudGraphHostName:d?.cloud_graph_host_name,msGraphHost:d?.msgraph_host,nativeAccountId:h},e,o),E=y.tenantProfiles||[],A=u||y.realm;if(A&&!E.find(R=>R.tenantId===A)){const R=oi(t,y.localAccountId,A,a);E.push(R)}return y.tenantProfiles=E,y}/*! @azure/msal-common v14.16.1 2025-08-05 */async function sl(n,e,t){return typeof n=="string"?n:n({clientId:e,tokenEndpoint:t})}/*! @azure/msal-common v14.16.1 2025-08-05 */class al extends ci{constructor(e,t){super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=this.config.authOptions.authority.options.OIDCOptions?.defaultScopes}async getAuthCodeUrl(e){this.performanceClient?.addQueueMeasurement(T.GetAuthCodeUrl,e.correlationId);const t=await w(this.createAuthCodeUrlQueryString.bind(this),T.AuthClientCreateQueryString,this.logger,this.performanceClient,e.correlationId)(e);return G.appendQueryString(this.authority.authorizationEndpoint,t)}async acquireToken(e,t){if(this.performanceClient?.addQueueMeasurement(T.AuthClientAcquireToken,e.correlationId),!e.code)throw S(_a);const o=De(),i=await w(this.executeTokenRequest.bind(this),T.AuthClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(this.authority,e),a=i.headers?.[fe.X_MS_REQUEST_ID],l=new je(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return l.validateTokenResponse(i.body),w(l.handleServerTokenResponse.bind(l),T.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(i.body,this.authority,o,e,t,void 0,void 0,void 0,a)}handleFragmentResponse(e,t){if(new je(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null).validateServerAuthorizationCodeResponse(e,t),!e.code)throw S(ba);return e}getLogoutUri(e){if(!e)throw z(qa);const t=this.createLogoutUrlQueryString(e);return G.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t){this.performanceClient?.addQueueMeasurement(T.AuthClientExecuteTokenRequest,t.correlationId);const o=this.createTokenQueryParameters(t),i=G.appendQueryString(e.tokenEndpoint,o),a=await w(this.createTokenRequestBody.bind(this),T.AuthClientCreateTokenRequestBody,this.logger,this.performanceClient,t.correlationId)(t);let l;if(t.clientInfo)try{const d=Cn(t.clientInfo,this.cryptoUtils.base64Decode);l={credential:`${d.uid}${ce.CLIENT_INFO_SEPARATOR}${d.utid}`,type:Ie.HOME_ACCOUNT_ID}}catch(d){this.logger.verbose("Could not parse client info for CCS Header: "+d)}const c=this.createTokenRequestHeaders(l||t.ccsCredential),u={clientId:t.tokenBodyParameters?.clientId||this.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid};return w(this.executePostToTokenEndpoint.bind(this),T.AuthorizationCodeClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,t.correlationId)(i,a,c,u,t.correlationId,T.AuthorizationCodeClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){this.performanceClient?.addQueueMeasurement(T.AuthClientCreateTokenRequestBody,e.correlationId);const t=new Bt(e.correlationId,this.performanceClient);if(t.addClientId(e.embeddedClientId||e.tokenBodyParameters?.[Ze]||this.config.authOptions.clientId),this.includeRedirectUri?t.addRedirectUri(e.redirectUri):lt.validateRedirectUri(e.redirectUri),t.addScopes(e.scopes,!0,this.oidcDefaultScopes),t.addAuthorizationCode(e.code),t.addLibraryInfo(this.config.libraryInfo),t.addApplicationTelemetry(this.config.telemetry.application),t.addThrottling(),this.serverTelemetryManager&&!So(this.config)&&t.addServerTelemetry(this.serverTelemetryManager),e.codeVerifier&&t.addCodeVerifier(e.codeVerifier),this.config.clientCredentials.clientSecret&&t.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const i=this.config.clientCredentials.clientAssertion;t.addClientAssertion(await sl(i.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),t.addClientAssertionType(i.assertionType)}if(t.addGrantType(pa.AUTHORIZATION_CODE_GRANT),t.addClientInfo(),e.authenticationScheme===J.POP){const i=new Et(this.cryptoUtils,this.performanceClient);let a;e.popKid?a=this.cryptoUtils.encodeKid(e.popKid):a=(await w(i.generateCnf.bind(i),T.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,t.addPopToken(a)}else if(e.authenticationScheme===J.SSH)if(e.sshJwk)t.addSshJwk(e.sshJwk);else throw z(xn);(!Re.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities);let o;if(e.clientInfo)try{const i=Cn(e.clientInfo,this.cryptoUtils.base64Decode);o={credential:`${i.uid}${ce.CLIENT_INFO_SEPARATOR}${i.utid}`,type:Ie.HOME_ACCOUNT_ID}}catch(i){this.logger.verbose("Could not parse client info for CCS Header: "+i)}else o=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&o)switch(o.type){case Ie.HOME_ACCOUNT_ID:try{const i=ft(o.credential);t.addCcsOid(i)}catch(i){this.logger.verbose("Could not parse home account ID for CCS Header: "+i)}break;case Ie.UPN:t.addCcsUpn(o.credential);break}return e.embeddedClientId&&t.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),e.tokenBodyParameters&&t.addExtraQueryParameters(e.tokenBodyParameters),e.enableSpaAuthorizationCode&&(!e.tokenBodyParameters||!e.tokenBodyParameters[ms])&&t.addExtraQueryParameters({[ms]:"1"}),t.createQueryString()}async createAuthCodeUrlQueryString(e){const t=e.correlationId||this.config.cryptoInterface.createNewGuid();this.performanceClient?.addQueueMeasurement(T.AuthClientCreateQueryString,t);const o=new Bt(t,this.performanceClient);o.addClientId(e.embeddedClientId||e.extraQueryParameters?.[Ze]||this.config.authOptions.clientId);const i=[...e.scopes||[],...e.extraScopesToConsent||[]];if(o.addScopes(i,!0,this.oidcDefaultScopes),o.addRedirectUri(e.redirectUri),o.addCorrelationId(t),o.addResponseMode(e.responseMode),o.addResponseTypeCode(),o.addLibraryInfo(this.config.libraryInfo),So(this.config)||o.addApplicationTelemetry(this.config.telemetry.application),o.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&o.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&o.addPrompt(e.prompt),e.domainHint&&o.addDomainHint(e.domainHint),e.prompt!==ie.SELECT_ACCOUNT)if(e.sid&&e.prompt===ie.NONE)this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),o.addSid(e.sid);else if(e.account){const a=this.extractAccountSid(e.account);let l=this.extractLoginHint(e.account);if(l&&e.domainHint&&(this.logger.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),l=null),l){this.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),o.addLoginHint(l);try{const c=ft(e.account.homeAccountId);o.addCcsOid(c)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(a&&e.prompt===ie.NONE){this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),o.addSid(a);try{const c=ft(e.account.homeAccountId);o.addCcsOid(c)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),o.addLoginHint(e.loginHint),o.addCcsUpn(e.loginHint);else if(e.account.username){this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),o.addLoginHint(e.account.username);try{const c=ft(e.account.homeAccountId);o.addCcsOid(c)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(this.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),o.addLoginHint(e.loginHint),o.addCcsUpn(e.loginHint));else this.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");if(e.nonce&&o.addNonce(e.nonce),e.state&&o.addState(e.state),(e.claims||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&o.addClaims(e.claims,this.config.authOptions.clientCapabilities),e.embeddedClientId&&o.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),this.addExtraQueryParams(e,o),e.nativeBroker&&(o.addNativeBroker(),e.authenticationScheme===J.POP)){const a=new Et(this.cryptoUtils);let l;e.popKid?l=this.cryptoUtils.encodeKid(e.popKid):l=(await w(a.generateCnf.bind(a),T.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,o.addPopToken(l)}return o.createQueryString()}createLogoutUrlQueryString(e){const t=new Bt(e.correlationId,this.performanceClient);return e.postLogoutRedirectUri&&t.addPostLogoutRedirectUri(e.postLogoutRedirectUri),e.correlationId&&t.addCorrelationId(e.correlationId),e.idTokenHint&&t.addIdTokenHint(e.idTokenHint),e.state&&t.addState(e.state),e.logoutHint&&t.addLogoutHint(e.logoutHint),this.addExtraQueryParams(e,t),t.createQueryString()}addExtraQueryParams(e,t){!(e.extraQueryParameters&&e.extraQueryParameters.hasOwnProperty("instance_aware"))&&this.config.authOptions.instanceAware&&(e.extraQueryParameters=e.extraQueryParameters||{},e.extraQueryParameters.instance_aware="true"),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters)}extractAccountSid(e){return e.idTokenClaims?.sid||null}extractLoginHint(e){return e.idTokenClaims?.login_hint||null}}/*! @azure/msal-common v14.16.1 2025-08-05 */const Rv=300;class _o extends ci{constructor(e,t){super(e,t)}async acquireToken(e){this.performanceClient?.addQueueMeasurement(T.RefreshTokenClientAcquireToken,e.correlationId);const t=De(),o=await w(this.executeTokenRequest.bind(this),T.RefreshTokenClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(e,this.authority),i=o.headers?.[fe.X_MS_REQUEST_ID],a=new je(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return a.validateTokenResponse(o.body),w(a.handleServerTokenResponse.bind(a),T.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(o.body,this.authority,t,e,void 0,void 0,!0,e.forceCache,i)}async acquireTokenByRefreshToken(e){if(!e)throw z(Ga);if(this.performanceClient?.addQueueMeasurement(T.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw S(zo);if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return await w(this.acquireTokenWithCachedRefreshToken.bind(this),T.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!0)}catch(o){const i=o instanceof Ae&&o.errorCode===In,a=o instanceof Ye&&o.errorCode===ns.INVALID_GRANT_ERROR&&o.subError===ns.CLIENT_MISMATCH_ERROR;if(i||a)return w(this.acquireTokenWithCachedRefreshToken.bind(this),T.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1);throw o}return w(this.acquireTokenWithCachedRefreshToken.bind(this),T.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1)}async acquireTokenWithCachedRefreshToken(e,t){this.performanceClient?.addQueueMeasurement(T.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);const o=rt(this.cacheManager.getRefreshToken.bind(this.cacheManager),T.CacheManagerGetRefreshToken,this.logger,this.performanceClient,e.correlationId)(e.account,t,e.correlationId,void 0,this.performanceClient);if(!o)throw wo(In);if(o.expiresOn&&Eo(o.expiresOn,e.refreshTokenExpirationOffsetSeconds||Rv))throw wo(di);const i={...e,refreshToken:o.secret,authenticationScheme:e.authenticationScheme||J.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:Ie.HOME_ACCOUNT_ID}};try{return await w(this.acquireToken.bind(this),T.RefreshTokenClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(i)}catch(a){if(a instanceof Ae&&a.subError===Un){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");const l=ht(o);this.cacheManager.removeRefreshToken(l,e.correlationId)}throw a}}async executeTokenRequest(e,t){this.performanceClient?.addQueueMeasurement(T.RefreshTokenClientExecuteTokenRequest,e.correlationId);const o=this.createTokenQueryParameters(e),i=G.appendQueryString(t.tokenEndpoint,o),a=await w(this.createTokenRequestBody.bind(this),T.RefreshTokenClientCreateTokenRequestBody,this.logger,this.performanceClient,e.correlationId)(e),l=this.createTokenRequestHeaders(e.ccsCredential),c={clientId:e.tokenBodyParameters?.clientId||this.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};return w(this.executePostToTokenEndpoint.bind(this),T.RefreshTokenClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,e.correlationId)(i,a,l,c,e.correlationId,T.RefreshTokenClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){this.performanceClient?.addQueueMeasurement(T.RefreshTokenClientCreateTokenRequestBody,e.correlationId);const t=e.correlationId,o=new Bt(t,this.performanceClient);if(o.addClientId(e.embeddedClientId||e.tokenBodyParameters?.[Ze]||this.config.authOptions.clientId),e.redirectUri&&o.addRedirectUri(e.redirectUri),o.addScopes(e.scopes,!0,this.config.authOptions.authority.options.OIDCOptions?.defaultScopes),o.addGrantType(pa.REFRESH_TOKEN_GRANT),o.addClientInfo(),o.addLibraryInfo(this.config.libraryInfo),o.addApplicationTelemetry(this.config.telemetry.application),o.addThrottling(),this.serverTelemetryManager&&!So(this.config)&&o.addServerTelemetry(this.serverTelemetryManager),o.addRefreshToken(e.refreshToken),this.config.clientCredentials.clientSecret&&o.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const i=this.config.clientCredentials.clientAssertion;o.addClientAssertion(await sl(i.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),o.addClientAssertionType(i.assertionType)}if(e.authenticationScheme===J.POP){const i=new Et(this.cryptoUtils,this.performanceClient);let a;e.popKid?a=this.cryptoUtils.encodeKid(e.popKid):a=(await w(i.generateCnf.bind(i),T.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,o.addPopToken(a)}else if(e.authenticationScheme===J.SSH)if(e.sshJwk)o.addSshJwk(e.sshJwk);else throw z(xn);if((!Re.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&o.addClaims(e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case Ie.HOME_ACCOUNT_ID:try{const i=ft(e.ccsCredential.credential);o.addCcsOid(i)}catch(i){this.logger.verbose("Could not parse home account ID for CCS Header: "+i)}break;case Ie.UPN:o.addCcsUpn(e.ccsCredential.credential);break}return e.embeddedClientId&&o.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),e.tokenBodyParameters&&o.addExtraQueryParameters(e.tokenBodyParameters),o.createQueryString()}}/*! @azure/msal-common v14.16.1 2025-08-05 */class kv extends ci{constructor(e,t){super(e,t)}async acquireToken(e){try{const[t,o]=await this.acquireCachedToken({...e,scopes:e.scopes?.length?e.scopes:[...Pt]});return o===Ke.PROACTIVELY_REFRESHED&&(this.logger.info("SilentFlowClient:acquireCachedToken - Cached access token's refreshOn property has been exceeded'. It's not expired, but must be refreshed."),new _o(this.config,this.performanceClient).acquireTokenByRefreshToken(e).catch(()=>{})),t}catch(t){if(t instanceof Pn&&t.errorCode===Fe)return new _o(this.config,this.performanceClient).acquireTokenByRefreshToken(e);throw t}}async acquireCachedToken(e){this.performanceClient?.addQueueMeasurement(T.SilentFlowClientAcquireCachedToken,e.correlationId);let t=Ke.NOT_APPLICABLE;if(e.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!Re.isEmptyObj(e.claims))throw this.setCacheOutcome(Ke.FORCE_REFRESH_OR_CLAIMS,e.correlationId),S(Fe);if(!e.account)throw S(zo);const o=e.account.tenantId||Cv(e.authority),i=this.cacheManager.getTokenKeys(),a=this.cacheManager.getAccessToken(e.account,e,i,o,this.performanceClient);if(a){if(oT(a.cachedAt)||Eo(a.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(Ke.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),S(Fe);a.refreshOn&&Eo(a.refreshOn,0)&&(t=Ke.PROACTIVELY_REFRESHED)}else throw this.setCacheOutcome(Ke.NO_CACHED_ACCESS_TOKEN,e.correlationId),S(Fe);const l=e.authority||this.authority.getPreferredCache(),c={account:this.cacheManager.readAccountFromCache(e.account,e.correlationId),accessToken:a,idToken:this.cacheManager.getIdToken(e.account,e.correlationId,i,o,this.performanceClient),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(l)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await w(this.generateResultFromCacheRecord.bind(this),T.SilentFlowClientGenerateResultFromCacheRecord,this.logger,this.performanceClient,e.correlationId)(c,e),t]}setCacheOutcome(e,t){this.serverTelemetryManager?.setCacheOutcome(e),this.performanceClient?.addFields({cacheOutcome:e},t),e!==Ke.NOT_APPLICABLE&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}async generateResultFromCacheRecord(e,t){this.performanceClient?.addQueueMeasurement(T.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId);let o;if(e.idToken&&(o=it(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||t.maxAge===0){const i=o?.auth_time;if(!i)throw S(Jo);La(i,t.maxAge)}return je.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,o)}}/*! @azure/msal-common v14.16.1 2025-08-05 */const Mv={sendGetRequestAsync:()=>Promise.reject(S(B)),sendPostRequestAsync:()=>Promise.reject(S(B))};/*! @azure/msal-common v14.16.1 2025-08-05 */const vs=",",ll="|";function Pv(n){const{skus:e,libraryName:t,libraryVersion:o,extensionName:i,extensionVersion:a}=n,l=new Map([[0,[t,o]],[2,[i,a]]]);let c=[];if(e?.length){if(c=e.split(vs),c.length<4)return e}else c=Array.from({length:4},()=>ll);return l.forEach((u,d)=>{u.length===2&&u[0]?.length&&u[1]?.length&&bv({skuArr:c,index:d,skuName:u[0],skuVersion:u[1]})}),c.join(vs)}function bv(n){const{skuArr:e,index:t,skuName:o,skuVersion:i}=n;t>=e.length||(e[t]=[o,i].join(ll))}class Ft{constructor(e,t){this.cacheOutcome=Ke.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||I.EMPTY_STRING,this.wrapperVer=e.wrapperVer||I.EMPTY_STRING,this.telemetryCacheKey=se.CACHE_KEY+ce.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${se.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],o=this.getNativeBrokerErrorCode();o?.length&&t.push(`broker_error=${o}`);const i=t.join(se.VALUE_SEPARATOR),a=this.getRegionDiscoveryFields(),l=[e,a].join(se.VALUE_SEPARATOR);return[se.SCHEMA_VERSION,l,i].join(se.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=Ft.maxErrorsToSend(e),o=e.failedRequests.slice(0,2*t).join(se.VALUE_SEPARATOR),i=e.errors.slice(0,t).join(se.VALUE_SEPARATOR),a=e.errors.length,l=t<a?se.OVERFLOW_TRUE:se.OVERFLOW_FALSE,c=[a,l].join(se.VALUE_SEPARATOR);return[se.SCHEMA_VERSION,e.cacheHits,o,i,c].join(se.CATEGORY_SEPARATOR)}cacheFailedRequest(e){const t=this.getLastRequests();t.errors.length>=se.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof X?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(se.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId),e.cacheHits}getLastRequests(){const e={failedRequests:[],errors:[],cacheHits:0};return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||e}clearTelemetryCache(){const e=this.getLastRequests(),t=Ft.maxErrorsToSend(e),o=e.errors.length;if(t===o)this.cacheManager.removeItem(this.telemetryCacheKey,this.correlationId);else{const i={failedRequests:e.failedRequests.slice(t*2),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,i,this.correlationId)}}static maxErrorsToSend(e){let t,o=0,i=0;const a=e.errors.length;for(t=0;t<a;t++){const l=e.failedRequests[2*t]||I.EMPTY_STRING,c=e.failedRequests[2*t+1]||I.EMPTY_STRING,u=e.errors[t]||I.EMPTY_STRING;if(i+=l.toString().length+c.toString().length+u.length+3,i<se.MAX_LAST_HEADER_BYTES)o+=1;else break}return o}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||I.EMPTY_STRING),e.push(this.regionSource||I.EMPTY_STRING),e.push(this.regionOutcome||I.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){const t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){const e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId)}static makeExtraSkuString(e){return Pv(e)}}/*! @azure/msal-common v14.16.1 2025-08-05 */const cl="missing_kid_error",dl="missing_alg_error";/*! @azure/msal-common v14.16.1 2025-08-05 */const Nv={[cl]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[dl]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class hi extends X{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,hi.prototype)}}function Is(n){return new hi(n,Nv[n])}/*! @azure/msal-common v14.16.1 2025-08-05 */class fi{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw Is(cl);if(!e.alg)throw Is(dl);const t=new fi({typ:e.typ||Fy.Pop,kid:e.kid,alg:e.alg});return JSON.stringify(t)}}/*! @azure/msal-common v14.16.1 2025-08-05 */class Es{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class xv{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:mv.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new Es}}startPerformanceMeasurement(){return new Es}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}/*! @azure/msal-browser v3.30.0 2025-08-05 */const gi="pkce_not_created",Ro="crypto_nonexistent",On="empty_navigate_uri",ul="hash_empty_error",pi="no_state_in_hash",hl="hash_does_not_contain_known_properties",fl="unable_to_parse_state",gl="state_interaction_type_mismatch",pl="interaction_in_progress",ml="popup_window_error",Cl="empty_window_error",et="user_cancelled",Lv="monitor_popup_timeout",yl="monitor_window_timeout",Tl="redirect_in_iframe",vl="block_iframe_reload",Il="block_nested_popups",Dv="iframe_closed_prematurely",Hn="silent_logout_unsupported",El="no_account_error",Uv="silent_prompt_value_error",Sl="no_token_request_cache_error",Al="unable_to_parse_token_request_cache_error",mi="no_cached_authority_error",Ov="auth_request_not_set_error",Hv="invalid_cache_type",Bn="non_browser_environment",ct="database_not_open",En="no_network_connectivity",wl="post_request_failed",_l="get_request_failed",ko="failed_to_parse_response",Rl="unable_to_load_token",Ci="crypto_key_not_found",kl="auth_code_required",Ml="auth_code_or_nativeAccountId_required",Pl="spa_code_and_nativeAccountId_present",yi="database_unavailable",bl="unable_to_acquire_token_from_native_platform",Nl="native_handshake_timeout",xl="native_extension_not_installed",zt="native_connection_not_established",Ll="uninitialized_public_client_application",Dl="native_prompt_not_supported",Ul="invalid_base64_string",Ol="invalid_pop_token_request",Hl="failed_to_build_headers",Bl="failed_to_parse_headers";/*! @azure/msal-browser v3.30.0 2025-08-05 */const He="For more visit: aka.ms/msaljs/browser-errors",Bv={[gi]:"The PKCE code challenge and verifier could not be generated.",[Ro]:"The crypto object or function is not available.",[On]:"Navigation URI is empty. Please check stack trace for more info.",[ul]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${He}`,[pi]:"Hash does not contain state. Please verify that the request originated from msal.",[hl]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${He}`,[fl]:"Unable to parse state. Please verify that the request originated from msal.",[gl]:"Hash contains state but the interaction type does not match the caller.",[pl]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${He}`,[ml]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[Cl]:"window.open returned null or undefined window object.",[et]:"User cancelled the flow.",[Lv]:`Token acquisition in popup failed due to timeout.  ${He}`,[yl]:`Token acquisition in iframe failed due to timeout.  ${He}`,[Tl]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[vl]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${He}`,[Il]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[Dv]:"The iframe being monitored was closed prematurely.",[Hn]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[El]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[Uv]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[Sl]:"No token request found in cache.",[Al]:"The cached token request could not be parsed.",[mi]:"No cached authority found.",[Ov]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[Hv]:"Invalid cache type",[Bn]:"Login and token requests are not supported in non-browser environments.",[ct]:"Database is not open!",[En]:"No network connectivity. Check your internet connection.",[wl]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[_l]:"Network request failed. Please check the network trace to determine root cause.",[ko]:"Failed to parse network response. Check network trace.",[Rl]:"Error loading token to cache.",[Ci]:"Cryptographic Key or Keypair not found in browser storage.",[kl]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[Ml]:"An authorization code or nativeAccountId must be provided to this flow.",[Pl]:"Request cannot contain both spa code and native account id.",[yi]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[bl]:`Unable to acquire token from native platform.  ${He}`,[Nl]:"Timed out while attempting to establish connection to browser extension",[xl]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[zt]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${He}`,[Ll]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${He}`,[Dl]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[Ul]:"Invalid base64 encoded string.",[Ol]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true.",[Hl]:"Failed to build request headers object.",[Bl]:"Failed to parse response headers"};class Yt extends X{constructor(e,t){super(e,Bv[e],t),Object.setPrototypeOf(this,Yt.prototype),this.name="BrowserAuthError"}}function k(n,e){return new Yt(n,e)}/*! @azure/msal-browser v3.30.0 2025-08-05 */const ve={INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},gt={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS"},We={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},me={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},Ss={GET:"GET",POST:"POST"},K={AUTHORITY:"authority",ACQUIRE_TOKEN_ACCOUNT:"acquireToken.account",SESSION_STATE:"session.state",REQUEST_STATE:"request.state",NONCE_IDTOKEN:"nonce.id_token",ORIGIN_URI:"request.origin",RENEW_STATUS:"token.renew.status",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",SCOPES:"scopes",INTERACTION_STATUS_KEY:"interaction.status",CCS_CREDENTIAL:"ccs.credential",CORRELATION_ID:"request.correlationId",NATIVE_REQUEST:"request.native",REDIRECT_CONTEXT:"request.redirect.context"},Ee={ACCOUNT_KEYS:"msal.account.keys",TOKEN_KEYS:"msal.token.keys",VERSION:"msal.version"},on={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},Q={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};var N;(function(n){n.Redirect="redirect",n.Popup="popup",n.Silent="silent",n.None="none"})(N||(N={}));const As={scopes:Pt},Fl="jwk",Mo="msal.db",Fv=1,Gv=`${Mo}.keys`,Te={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},qv=[Te.Default,Te.Skip,Te.RefreshTokenAndNetwork],Vv="msal.browser.log.level",Kv="msal.browser.log.pii";/*! @azure/msal-browser v3.30.0 2025-08-05 */function rn(n){return encodeURIComponent(Ti(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function Fn(n){return Gl(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Ti(n){return Gl(new TextEncoder().encode(n))}function Gl(n){const e=Array.from(n,t=>String.fromCodePoint(t)).join("");return btoa(e)}/*! @azure/msal-browser v3.30.0 2025-08-05 */const $v="RSASSA-PKCS1-v1_5",ql="SHA-256",Jv=2048,zv=new Uint8Array([1,0,1]),ws="0123456789abcdef",_s=new Uint32Array(1),Yv="crypto_subtle_undefined",vi={name:$v,hash:ql,modulusLength:Jv,publicExponent:zv};function Wv(n){if(!window)throw k(Bn);if(!window.crypto)throw k(Ro);if(!n&&!window.crypto.subtle)throw k(Ro,Yv)}async function Vl(n,e,t){e?.addQueueMeasurement(T.Sha256Digest,t);const i=new TextEncoder().encode(n);return window.crypto.subtle.digest(ql,i)}function Qv(n){return window.crypto.getRandomValues(n)}function Qn(){return window.crypto.getRandomValues(_s),_s[0]}function Ue(){const n=Date.now(),e=Qn()*1024+(Qn()&1023),t=new Uint8Array(16),o=Math.trunc(e/2**30),i=e&2**30-1,a=Qn();t[0]=n/2**40,t[1]=n/2**32,t[2]=n/2**24,t[3]=n/2**16,t[4]=n/2**8,t[5]=n,t[6]=112|o>>>8,t[7]=o,t[8]=128|i>>>24,t[9]=i>>>16,t[10]=i>>>8,t[11]=i,t[12]=a>>>24,t[13]=a>>>16,t[14]=a>>>8,t[15]=a;let l="";for(let c=0;c<t.length;c++)l+=ws.charAt(t[c]>>>4),l+=ws.charAt(t[c]&15),(c===3||c===5||c===7||c===9)&&(l+="-");return l}async function Xv(n,e){return window.crypto.subtle.generateKey(vi,n,e)}async function Xn(n){return window.crypto.subtle.exportKey(Fl,n)}async function Zv(n,e,t){return window.crypto.subtle.importKey(Fl,n,vi,e,t)}async function jv(n,e){return window.crypto.subtle.sign(vi,n,e)}async function Kl(n){const e=await Vl(n),t=new Uint8Array(e);return Fn(t)}/*! @azure/msal-browser v3.30.0 2025-08-05 */const Ii="storage_not_supported",eI="stubbed_public_client_application_called",$l="in_mem_redirect_unavailable";/*! @azure/msal-browser v3.30.0 2025-08-05 */const tI={[Ii]:"Given storage configuration option was not supported.",[eI]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[$l]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};class Ei extends X{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,Ei.prototype)}}function Si(n){return new Ei(n,tI[n])}/*! @azure/msal-browser v3.30.0 2025-08-05 */function nI(n){n.location.hash="",typeof n.history.replaceState=="function"&&n.history.replaceState(null,"",`${n.location.origin}${n.location.pathname}${n.location.search}`)}function oI(n){const e=n.split("#");e.shift(),window.location.hash=e.length>0?e.join("#"):""}function Ai(){return window.parent!==window}function iI(){return typeof window<"u"&&!!window.opener&&window.opener!==window&&typeof window.name=="string"&&window.name.indexOf(`${ve.POPUP_NAME_PREFIX}.`)===0}function Ge(){return typeof window<"u"&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function rI(){const e=new G(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function sI(){if(G.hashContainsKnownProperties(window.location.hash)&&Ai())throw k(vl)}function aI(n){if(Ai()&&!n)throw k(Tl)}function lI(){if(iI())throw k(Il)}function Jl(){if(typeof window>"u")throw k(Bn)}function zl(n){if(!n)throw k(Ll)}function wi(n){Jl(),sI(),lI(),zl(n)}function Rs(n,e){if(wi(n),aI(e.system.allowRedirectInIframe),e.cache.cacheLocation===me.MemoryStorage&&!e.cache.storeAuthStateInCookie)throw Si($l)}function Yl(n){const e=document.createElement("link");e.rel="preconnect",e.href=new URL(n).origin,e.crossOrigin="anonymous",document.head.appendChild(e),window.setTimeout(()=>{try{document.head.removeChild(e)}catch{}},1e4)}function cI(){return Ue()}/*! @azure/msal-browser v3.30.0 2025-08-05 */class Sn{navigateInternal(e,t){return Sn.defaultNavigateWindow(e,t)}navigateExternal(e,t){return Sn.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(o=>{setTimeout(()=>{o(!0)},t.timeout)})}}/*! @azure/msal-browser v3.30.0 2025-08-05 */class dI{async sendGetRequestAsync(e,t){let o,i={},a=0;const l=ks(t);try{o=await fetch(e,{method:Ss.GET,headers:l})}catch{throw k(window.navigator.onLine?_l:En)}i=Ms(o.headers);try{return a=o.status,{headers:i,body:await o.json(),status:a}}catch{throw Cs(k(ko),a,i)}}async sendPostRequestAsync(e,t){const o=t&&t.body||"",i=ks(t);let a,l=0,c={};try{a=await fetch(e,{method:Ss.POST,headers:i,body:o})}catch{throw k(window.navigator.onLine?wl:En)}c=Ms(a.headers);try{return l=a.status,{headers:c,body:await a.json(),status:l}}catch{throw Cs(k(ko),l,c)}}}function ks(n){try{const e=new Headers;if(!(n&&n.headers))return e;const t=n.headers;return Object.entries(t).forEach(([o,i])=>{e.append(o,i)}),e}catch{throw k(Hl)}}function Ms(n){try{const e={};return n.forEach((t,o)=>{e[o]=t}),e}catch{throw k(Bl)}}/*! @azure/msal-browser v3.30.0 2025-08-05 */const uI=6e4,Po=1e4,hI=3e4,fI=2e3;function gI({auth:n,cache:e,system:t,telemetry:o},i){const a={clientId:I.EMPTY_STRING,authority:`${I.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:I.EMPTY_STRING,authorityMetadata:I.EMPTY_STRING,redirectUri:typeof window<"u"?Ge():"",postLogoutRedirectUri:I.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:qe.AAD,OIDCOptions:{serverResponseType:$t.FRAGMENT,defaultScopes:[I.OPENID_SCOPE,I.PROFILE_SCOPE,I.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:Xo.None,tenant:I.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1},l={cacheLocation:me.SessionStorage,temporaryCacheLocation:me.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!!(e&&e.cacheLocation===me.LocalStorage),claimsBasedCachingEnabled:!1},c={loggerCallback:()=>{},logLevel:Z.Info,piiLoggingEnabled:!1},d={...{...tl,loggerOptions:c,networkClient:i?new dI:Mv,navigationClient:new Sn,loadFrameTimeout:0,windowHashTimeout:t?.loadFrameTimeout||uI,iframeHashTimeout:t?.loadFrameTimeout||Po,navigateFrameWait:0,redirectNavigationTimeout:hI,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!1,nativeBrokerHandshakeTimeout:t?.nativeBrokerHandshakeTimeout||fI,pollIntervalMilliseconds:ve.DEFAULT_POLL_INTERVAL_MS},...t,loggerOptions:t?.loggerOptions||c},h={application:{appName:I.EMPTY_STRING,appVersion:I.EMPTY_STRING},client:new xv};if(n?.protocolMode!==qe.OIDC&&n?.OIDCOptions&&new Jt(d.loggerOptions).warning(JSON.stringify(z(za))),n?.protocolMode&&n.protocolMode!==qe.AAD&&d?.allowNativeBroker)throw z(Ya);return{auth:{...a,...n,OIDCOptions:{...a.OIDCOptions,...n?.OIDCOptions}},cache:{...l,...e},system:d,telemetry:{...h,...o}}}/*! @azure/msal-browser v3.30.0 2025-08-05 */const pI="@azure/msal-browser",St="3.30.0";/*! @azure/msal-browser v3.30.0 2025-08-05 */class _i{static loggerCallback(e,t){switch(e){case Z.Error:console.error(t);return;case Z.Info:console.info(t);return;case Z.Verbose:console.debug(t);return;case Z.Warning:console.warn(t);return;default:console.log(t);return}}constructor(e){this.browserEnvironment=typeof window<"u",this.config=gI(e,this.browserEnvironment);let t;try{t=window[me.SessionStorage]}catch{}const o=t?.getItem(Vv),i=t?.getItem(Kv)?.toLowerCase(),a=i==="true"?!0:i==="false"?!1:void 0,l={...this.config.system.loggerOptions},c=o&&Object.keys(Z).includes(o)?Z[o]:void 0;c&&(l.loggerCallback=_i.loggerCallback,l.logLevel=c),a!==void 0&&(l.piiLoggingEnabled=a),this.logger=new Jt(l,pI,St),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}/*! @azure/msal-browser v3.30.0 2025-08-05 */class tt extends _i{getModuleName(){return tt.MODULE_NAME}getId(){return tt.ID}async initialize(){return this.available=typeof window<"u",this.available}}tt.MODULE_NAME="";tt.ID="StandardOperatingContext";/*! @azure/msal-browser v3.30.0 2025-08-05 */function Le(n){return new TextDecoder().decode(mI(n))}function mI(n){let e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw k(Ul)}const t=atob(e);return Uint8Array.from(t,o=>o.codePointAt(0)||0)}/*! @azure/msal-browser v3.30.0 2025-08-05 */class CI{constructor(){this.dbName=Mo,this.version=Fv,this.tableName=Gv,this.dbOpen=!1}async open(){return new Promise((e,t)=>{const o=window.indexedDB.open(this.dbName,this.version);o.addEventListener("upgradeneeded",i=>{i.target.result.createObjectStore(this.tableName)}),o.addEventListener("success",i=>{const a=i;this.db=a.target.result,this.dbOpen=!0,e()}),o.addEventListener("error",()=>t(k(yi)))})}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise((t,o)=>{if(!this.db)return o(k(ct));const l=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);l.addEventListener("success",c=>{const u=c;this.closeConnection(),t(u.target.result)}),l.addEventListener("error",c=>{this.closeConnection(),o(c)})})}async setItem(e,t){return await this.validateDbIsOpen(),new Promise((o,i)=>{if(!this.db)return i(k(ct));const c=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);c.addEventListener("success",()=>{this.closeConnection(),o()}),c.addEventListener("error",u=>{this.closeConnection(),i(u)})})}async removeItem(e){return await this.validateDbIsOpen(),new Promise((t,o)=>{if(!this.db)return o(k(ct));const l=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);l.addEventListener("success",()=>{this.closeConnection(),t()}),l.addEventListener("error",c=>{this.closeConnection(),o(c)})})}async getKeys(){return await this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t(k(ct));const a=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();a.addEventListener("success",l=>{const c=l;this.closeConnection(),e(c.target.result)}),a.addEventListener("error",l=>{this.closeConnection(),t(l)})})}async containsKey(e){return await this.validateDbIsOpen(),new Promise((t,o)=>{if(!this.db)return o(k(ct));const l=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);l.addEventListener("success",c=>{const u=c;this.closeConnection(),t(u.target.result===1)}),l.addEventListener("error",c=>{this.closeConnection(),o(c)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{const o=window.indexedDB.deleteDatabase(Mo),i=setTimeout(()=>t(!1),200);o.addEventListener("success",()=>(clearTimeout(i),e(!0))),o.addEventListener("blocked",()=>(clearTimeout(i),e(!0))),o.addEventListener("error",()=>(clearTimeout(i),t(!1)))})}}/*! @azure/msal-browser v3.30.0 2025-08-05 */class bo{constructor(){this.cache=new Map}getItem(e){return this.cache.get(e)||null}setItem(e,t){this.cache.set(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach((t,o)=>{e.push(o)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}}/*! @azure/msal-browser v3.30.0 2025-08-05 */class yI{constructor(e){this.inMemoryCache=new bo,this.indexedDBCache=new CI,this.logger=e}handleDatabaseAccessError(e){if(e instanceof Yt&&e.errorCode===yi)this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.");else throw e}async getItem(e){const t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.getItem(e)}catch(o){this.handleDatabaseAccessError(o)}return t}async setItem(e,t){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(o){this.handleDatabaseAccessError(o)}}async removeItem(e){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(t){this.handleDatabaseAccessError(t)}}async getKeys(){const e=this.inMemoryCache.getKeys();if(e.length===0)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),await this.indexedDBCache.getKeys()}catch(t){this.handleDatabaseAccessError(t)}return e}async containsKey(e){const t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.containsKey(e)}catch(o){this.handleDatabaseAccessError(o)}return t}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}async clearPersistent(){try{this.logger.verbose("Deleting persistent keystore");const e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}}}/*! @azure/msal-browser v3.30.0 2025-08-05 */class At{constructor(e,t,o){this.logger=e,Wv(o??!1),this.cache=new yI(this.logger),this.performanceClient=t}createNewGuid(){return Ue()}base64Encode(e){return Ti(e)}base64Decode(e){return Le(e)}base64UrlEncode(e){return rn(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){const t=this.performanceClient?.startMeasurement(T.CryptoOptsGetPublicKeyThumbprint,e.correlationId),o=await Xv(At.EXTRACTABLE,At.POP_KEY_USAGES),i=await Xn(o.publicKey),a={e:i.e,kty:i.kty,n:i.n},l=Ps(a),c=await this.hashString(l),u=await Xn(o.privateKey),d=await Zv(u,!1,["sign"]);return await this.cache.setItem(c,{privateKey:d,publicKey:o.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),t&&t.end({success:!0}),c}async removeTokenBindingKey(e){return await this.cache.removeItem(e),!await this.cache.containsKey(e)}async clearKeystore(){this.cache.clearInMemory();try{return await this.cache.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error(`Clearing keystore failed with error: ${e.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}}async signJwt(e,t,o,i){const a=this.performanceClient?.startMeasurement(T.CryptoOptsSignJwt,i),l=await this.cache.getItem(t);if(!l)throw k(Ci);const c=await Xn(l.publicKey),u=Ps(c),d=rn(JSON.stringify({kid:t})),h=fi.getShrHeaderString({...o?.header,alg:c.alg,kid:d}),f=rn(h);e.cnf={jwk:JSON.parse(u)};const p=rn(JSON.stringify(e)),m=`${f}.${p}`,y=new TextEncoder().encode(m),E=await jv(l.privateKey,y),A=Fn(new Uint8Array(E)),R=`${m}.${A}`;return a&&a.end({success:!0}),R}async hashString(e){return Kl(e)}}At.POP_KEY_USAGES=["sign","verify"];At.EXTRACTABLE=!0;function Ps(n){return JSON.stringify(n,Object.keys(n).sort())}/*! @azure/msal-browser v3.30.0 2025-08-05 */class TI{constructor(){if(!window.localStorage)throw Si(Ii)}getItem(e){return window.localStorage.getItem(e)}setItem(e,t){window.localStorage.setItem(e,t)}removeItem(e){window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}}/*! @azure/msal-browser v3.30.0 2025-08-05 */class vI{constructor(){if(!window.sessionStorage)throw Si(Ii)}getItem(e){return window.sessionStorage.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}}/*! @azure/msal-browser v3.30.0 2025-08-05 */function Wl(n,e){if(!e)return null;try{return ke.parseRequestState(n,e).libraryState.meta}catch{throw S(vt)}}/*! @azure/msal-browser v3.30.0 2025-08-05 */const II=1440*60*1e3;class EI{getItem(e){const t=`${encodeURIComponent(e)}`,o=document.cookie.split(";");for(let i=0;i<o.length;i++){const a=o[i],[l,...c]=decodeURIComponent(a).trim().split("="),u=c.join("=");if(l===t)return u}return""}setItem(e,t,o,i=!0){let a=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=Lax;`;if(o){const l=SI(o);a+=`expires=${l};`}i&&(a+="Secure;"),document.cookie=a}removeItem(e){this.setItem(e,"",-1)}getKeys(){const e=document.cookie.split(";"),t=[];return e.forEach(o=>{const i=decodeURIComponent(o).trim().split("=");t.push(i[0])}),t}containsKey(e){return this.getKeys().includes(e)}}function SI(n){const e=new Date;return new Date(e.getTime()+n*II).toUTCString()}/*! @azure/msal-browser v3.30.0 2025-08-05 */class No extends It{constructor(e,t,o,i,a,l){super(e,o,i,a),this.cacheConfig=t,this.logger=i,this.internalStorage=new bo,this.browserStorage=this.setupBrowserStorage(this.cacheConfig.cacheLocation),this.temporaryCacheStorage=this.setupBrowserStorage(this.cacheConfig.temporaryCacheLocation),this.cookieStorage=new EI,t.cacheMigrationEnabled&&(this.migrateCacheEntries(),this.createKeyMaps()),this.performanceClient=l}setupBrowserStorage(e){try{switch(e){case me.LocalStorage:return new TI;case me.SessionStorage:return new vI;case me.MemoryStorage:default:break}}catch(t){this.logger.error(t)}return this.cacheConfig.cacheLocation=me.MemoryStorage,new bo}migrateCacheEntries(){const e=this.browserStorage.getItem(Ee.VERSION);e&&this.logger.info(`MSAL.js was last initialized with version ${e}`),e!==St&&this.browserStorage.setItem(Ee.VERSION,St);const t=`${I.CACHE_PREFIX}.${oe.ID_TOKEN}`,o=`${I.CACHE_PREFIX}.${oe.CLIENT_INFO}`,i=`${I.CACHE_PREFIX}.${oe.ERROR}`,a=`${I.CACHE_PREFIX}.${oe.ERROR_DESC}`,l=this.browserStorage.getItem(t),c=this.browserStorage.getItem(o),u=this.browserStorage.getItem(i),d=this.browserStorage.getItem(a),h=[l,c,u,d];[oe.ID_TOKEN,oe.CLIENT_INFO,oe.ERROR,oe.ERROR_DESC].forEach((p,m)=>{const v=h[m];v&&this.setTemporaryCache(p,v,!0)})}createKeyMaps(){this.logger.trace("BrowserCacheManager - createKeyMaps called.");const e=this.cryptoImpl.createNewGuid(),t=this.getItem(Ee.ACCOUNT_KEYS),o=this.getItem(`${Ee.TOKEN_KEYS}.${this.clientId}`);if(t&&o){this.logger.verbose("BrowserCacheManager:createKeyMaps - account and token key maps already exist, skipping migration.");return}this.browserStorage.getKeys().forEach(a=>{if(this.isCredentialKey(a)){const l=this.getItem(a);if(l){const c=this.validateAndParseJson(l);if(c&&c.hasOwnProperty("credentialType"))switch(c.credentialType){case O.ID_TOKEN:if(as(c)){this.logger.trace("BrowserCacheManager:createKeyMaps - idToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - idToken with key: ${a} found, saving key to token key map`);const u=c,d=this.updateCredentialCacheKey(a,u,e);this.addTokenKey(d,O.ID_TOKEN,e);return}else this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching idToken schema with value containing idToken credentialType field but value failed IdTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed idToken validation on key: ${a}`);break;case O.ACCESS_TOKEN:case O.ACCESS_TOKEN_WITH_AUTH_SCHEME:if(ss(c)){this.logger.trace("BrowserCacheManager:createKeyMaps - accessToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - accessToken with key: ${a} found, saving key to token key map`);const u=c,d=this.updateCredentialCacheKey(a,u,e);this.addTokenKey(d,O.ACCESS_TOKEN,e);return}else this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching accessToken schema with value containing accessToken credentialType field but value failed AccessTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed accessToken validation on key: ${a}`);break;case O.REFRESH_TOKEN:if(ls(c)){this.logger.trace("BrowserCacheManager:createKeyMaps - refreshToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - refreshToken with key: ${a} found, saving key to token key map`);const u=c,d=this.updateCredentialCacheKey(a,u,e);this.addTokenKey(d,O.REFRESH_TOKEN,e);return}else this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching refreshToken schema with value containing refreshToken credentialType field but value failed RefreshTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed refreshToken validation on key: ${a}`);break}}}if(this.isAccountKey(a)){const l=this.getItem(a);if(l){const c=this.validateAndParseJson(l);c&&te.isAccountEntity(c)&&(this.logger.trace("BrowserCacheManager:createKeyMaps - account found, saving key to account key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - account with key: ${a} found, saving key to account key map`),this.addAccountKeyToMap(a,e))}}})}validateAndParseJson(e){try{const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch{return null}}getItem(e){return this.browserStorage.getItem(e)}setItem(e,t,o){let i=[];for(let l=0;l<=20;l++)try{this.browserStorage.setItem(e,t),l>0&&this.removeAccessTokenKeys(i.slice(0,l),o);break}catch(c){const u=el(c);if(u.errorCode===si&&l<20){if(i.length||(e===`${Ee.TOKEN_KEYS}.${this.clientId}`?i=JSON.parse(t).accessToken:i=this.getTokenKeys().accessToken),i.length<=l)throw u;this.removeAccessToken(i[l],o,!1)}else throw u}}getAccount(e,t,o){this.logger.trace("BrowserCacheManager.getAccount called");const i=this.getCachedAccountEntity(e,t);return this.updateOutdatedCachedAccount(e,i,t,o)}getCachedAccountEntity(e,t){const o=this.getItem(e);if(!o)return this.removeAccountKeyFromMap(e,t),null;const i=this.validateAndParseJson(o);return!i||!te.isAccountEntity(i)?null:It.toObject(new te,i)}setAccount(e,t){this.logger.trace("BrowserCacheManager.setAccount called");const o=e.generateAccountKey();e.lastUpdatedAt=Date.now().toString(),this.setItem(o,JSON.stringify(e),t),this.addAccountKeyToMap(o,t)}getAccountKeys(){this.logger.trace("BrowserCacheManager.getAccountKeys called");const e=this.getItem(Ee.ACCOUNT_KEYS);return e?JSON.parse(e):(this.logger.verbose("BrowserCacheManager.getAccountKeys - No account keys found"),[])}addAccountKeyToMap(e,t){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);const o=this.getAccountKeys();o.indexOf(e)===-1?(o.push(e),this.setItem(Ee.ACCOUNT_KEYS,JSON.stringify(o),t),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added")):this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map")}removeAccountKeyFromMap(e,t){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);const o=this.getAccountKeys(),i=o.indexOf(e);if(i>-1){if(o.splice(i,1),o.length===0){this.removeItem(Ee.ACCOUNT_KEYS);return}else this.setItem(Ee.ACCOUNT_KEYS,JSON.stringify(o),t);this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")}else this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}async removeAccount(e,t){super.removeAccount(e,t),this.removeAccountKeyFromMap(e,t)}removeOutdatedAccount(e,t){this.removeItem(e),this.removeAccountKeyFromMap(e,t)}removeIdToken(e,t){super.removeIdToken(e,t),this.removeTokenKey(e,O.ID_TOKEN,t)}removeAccessToken(e,t,o=!0){super.removeAccessToken(e,t),this.performanceClient?.incrementFields({accessTokensRemoved:1},t),o&&this.removeTokenKey(e,O.ACCESS_TOKEN,t)}removeAccessTokenKeys(e,t){this.logger.trace("removeAccessTokenKey called");const o=this.getTokenKeys();let i=0;if(e.forEach(a=>{const l=o.accessToken.indexOf(a);l>-1&&(o.accessToken.splice(l,1),i++)}),i>0){this.logger.info(`removed ${i} accessToken keys from tokenKeys map`),this.setTokenKeys(o,t);return}}removeRefreshToken(e,t){super.removeRefreshToken(e,t),this.removeTokenKey(e,O.REFRESH_TOKEN,t)}getTokenKeys(){this.logger.trace("BrowserCacheManager.getTokenKeys called");const e=this.getItem(`${Ee.TOKEN_KEYS}.${this.clientId}`);if(e){const t=this.validateAndParseJson(e);if(t&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken"))return t;this.logger.error("BrowserCacheManager.getTokenKeys - Token keys found but in an unknown format. Returning empty key map.")}else this.logger.verbose("BrowserCacheManager.getTokenKeys - No token keys found");return{idToken:[],accessToken:[],refreshToken:[]}}setTokenKeys(e,t){if(e.idToken.length===0&&e.accessToken.length===0&&e.refreshToken.length===0){this.removeItem(`${Ee.TOKEN_KEYS}.${this.clientId}`);return}else this.setItem(`${Ee.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(e),t)}addTokenKey(e,t,o){this.logger.trace("BrowserCacheManager addTokenKey called");const i=this.getTokenKeys();switch(t){case O.ID_TOKEN:i.idToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),i.idToken.push(e));break;case O.ACCESS_TOKEN:const a=i.accessToken.indexOf(e);a!==-1&&i.accessToken.splice(a,1),this.logger.trace(`access token ${a===-1?"added to":"updated in"} map`),i.accessToken.push(e);break;case O.REFRESH_TOKEN:i.refreshToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),i.refreshToken.push(e));break;default:throw this.logger.error(`BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: ${t}`),S(vo)}this.setTokenKeys(i,o)}removeTokenKey(e,t,o,i=this.getTokenKeys()){switch(this.logger.trace("BrowserCacheManager removeTokenKey called"),t){case O.ID_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: ${e} from map`);const a=i.idToken.indexOf(e);a>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),i.idToken.splice(a,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case O.ACCESS_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: ${e} from map`);const l=i.accessToken.indexOf(e);l>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),i.accessToken.splice(l,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case O.REFRESH_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: ${e} from map`);const c=i.refreshToken.indexOf(e);c>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),i.refreshToken.splice(c,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:throw this.logger.error(`BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: ${t}`),S(vo)}this.setTokenKeys(i,o)}getIdTokenCredential(e,t){const o=this.getItem(e);if(!o)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeIdToken(e,t),null;const i=this.validateAndParseJson(o);return!i||!as(i)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),i)}setIdTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const o=ht(e);e.lastUpdatedAt=Date.now().toString(),this.setItem(o,JSON.stringify(e),t),this.addTokenKey(o,O.ID_TOKEN,t)}getAccessTokenCredential(e,t){const o=this.getItem(e);if(!o)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,O.ACCESS_TOKEN,t),null;const i=this.validateAndParseJson(o);return!i||!ss(i)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),i)}setAccessTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const o=ht(e);e.lastUpdatedAt=Date.now().toString(),this.setItem(o,JSON.stringify(e),t),this.addTokenKey(o,O.ACCESS_TOKEN,t)}getRefreshTokenCredential(e,t){const o=this.getItem(e);if(!o)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,O.REFRESH_TOKEN,t),null;const i=this.validateAndParseJson(o);return!i||!ls(i)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),i)}setRefreshTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const o=ht(e);e.lastUpdatedAt=Date.now().toString(),this.setItem(o,JSON.stringify(e),t),this.addTokenKey(o,O.REFRESH_TOKEN,t)}getAppMetadata(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const o=this.validateAndParseJson(t);return!o||!hT(e,o)?(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),o)}setAppMetadata(e,t){this.logger.trace("BrowserCacheManager.setAppMetadata called");const o=uT(e);this.setItem(o,JSON.stringify(e),t)}getServerTelemetry(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const o=this.validateAndParseJson(t);return!o||!cT(e,o)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),o)}setServerTelemetry(e,t,o){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t),o)}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const o=this.validateAndParseJson(t);return o&&fT(e,o)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),o):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem(on.WRAPPER_SKU,e),this.internalStorage.setItem(on.WRAPPER_VER,t)}getWrapperMetadata(){const e=this.internalStorage.getItem(on.WRAPPER_SKU)||I.EMPTY_STRING,t=this.internalStorage.getItem(on.WRAPPER_VER)||I.EMPTY_STRING;return[e,t]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(e){const t=this.generateCacheKey(oe.ACTIVE_ACCOUNT_FILTERS),o=this.getItem(t);if(!o){this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters cache schema found, looking for legacy schema");const a=this.generateCacheKey(oe.ACTIVE_ACCOUNT),l=this.getItem(a);if(!l)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null;const c=this.getAccountInfoFilteredBy({localAccountId:l},e);return c?(this.logger.trace("BrowserCacheManager.getActiveAccount: Legacy active account cache schema found"),this.logger.trace("BrowserCacheManager.getActiveAccount: Adding active account filters cache schema"),this.setActiveAccount(c,e),c):null}const i=this.validateAndParseJson(o);return i?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:i.homeAccountId,localAccountId:i.localAccountId,tenantId:i.tenantId},e)):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e,t){const o=this.generateCacheKey(oe.ACTIVE_ACCOUNT_FILTERS),i=this.generateCacheKey(oe.ACTIVE_ACCOUNT);if(e){this.logger.verbose("setActiveAccount: Active account set");const a={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId,lastUpdatedAt:Date.now().toString()};this.setItem(o,JSON.stringify(a),t),this.setItem(i,e.localAccountId,t)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(o),this.browserStorage.removeItem(i)}getThrottlingCache(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const o=this.validateAndParseJson(t);return!o||!dT(e,o)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),o)}setThrottlingCache(e,t,o){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t),o)}getTemporaryCache(e,t){const o=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const a=this.cookieStorage.getItem(o);if(a)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),a}const i=this.temporaryCacheStorage.getItem(o);if(!i){if(this.cacheConfig.cacheLocation===me.LocalStorage){const a=this.browserStorage.getItem(o);if(a)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),a}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),i}setTemporaryCache(e,t,o){const i=o?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(i,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.cookieStorage.setItem(i,t,void 0,this.cacheConfig.secureCookies))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.cookieStorage.removeItem(e))}getKeys(){return this.browserStorage.getKeys()}async clear(e){await this.removeAllAccounts(e),this.removeAppMetadata(e),this.temporaryCacheStorage.getKeys().forEach(t=>{(t.indexOf(I.CACHE_PREFIX)!==-1||t.indexOf(this.clientId)!==-1)&&this.removeTemporaryItem(t)}),this.browserStorage.getKeys().forEach(t=>{(t.indexOf(I.CACHE_PREFIX)!==-1||t.indexOf(this.clientId)!==-1)&&this.browserStorage.removeItem(t)}),this.internalStorage.clear()}async clearTokensAndKeysWithClaims(e,t){e.addQueueMeasurement(T.ClearTokensAndKeysWithClaims,t);const o=this.getTokenKeys();let i=0;o.accessToken.forEach(a=>{const l=this.getAccessTokenCredential(a,t);l?.requestedClaimsHash&&a.includes(l.requestedClaimsHash.toLowerCase())&&(this.removeAccessToken(a,t),i++)}),i>0&&this.logger.warning(`${i} access tokens with claims in the cache keys have been removed from the cache.`)}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):Re.startsWith(e,I.CACHE_PREFIX)||Re.startsWith(e,oe.ADAL_ID_TOKEN)?e:`${I.CACHE_PREFIX}.${this.clientId}.${e}`}generateAuthorityKey(e){const{libraryState:{id:t}}=ke.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${K.AUTHORITY}.${t}`)}generateNonceKey(e){const{libraryState:{id:t}}=ke.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${K.NONCE_IDTOKEN}.${t}`)}generateStateKey(e){const{libraryState:{id:t}}=ke.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${K.REQUEST_STATE}.${t}`)}getCachedAuthority(e){const t=this.generateStateKey(e),o=this.getTemporaryCache(t);if(!o)return null;const i=this.generateAuthorityKey(o);return this.getTemporaryCache(i)}updateCacheEntries(e,t,o,i,a){this.logger.trace("BrowserCacheManager.updateCacheEntries called");const l=this.generateStateKey(e);this.setTemporaryCache(l,e,!1);const c=this.generateNonceKey(e);this.setTemporaryCache(c,t,!1);const u=this.generateAuthorityKey(e);if(this.setTemporaryCache(u,o,!1),a){const d={credential:a.homeAccountId,type:Ie.HOME_ACCOUNT_ID};this.setTemporaryCache(K.CCS_CREDENTIAL,JSON.stringify(d),!0)}else if(i){const d={credential:i,type:Ie.UPN};this.setTemporaryCache(K.CCS_CREDENTIAL,JSON.stringify(d),!0)}}resetRequestCache(e){this.logger.trace("BrowserCacheManager.resetRequestCache called"),e&&(this.temporaryCacheStorage.getKeys().forEach(t=>{t.indexOf(e)!==-1&&this.removeTemporaryItem(t)}),this.removeTemporaryItem(this.generateStateKey(e)),this.removeTemporaryItem(this.generateNonceKey(e)),this.removeTemporaryItem(this.generateAuthorityKey(e))),this.removeTemporaryItem(this.generateCacheKey(K.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(K.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(K.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(K.CORRELATION_ID)),this.removeTemporaryItem(this.generateCacheKey(K.CCS_CREDENTIAL)),this.removeTemporaryItem(this.generateCacheKey(K.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cleanRequestByState(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){const t=this.generateStateKey(e),o=this.temporaryCacheStorage.getItem(t);this.logger.infoPii(`BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: ${o}`),this.resetRequestCache(o||I.EMPTY_STRING)}}cleanRequestByInteractionType(e){this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.temporaryCacheStorage.getKeys().forEach(t=>{if(t.indexOf(K.REQUEST_STATE)===-1)return;const o=this.temporaryCacheStorage.getItem(t);if(!o)return;const i=Wl(this.cryptoImpl,o);i&&i.interactionType===e&&(this.logger.infoPii(`BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: ${o}`),this.resetRequestCache(o))}),this.setInteractionInProgress(!1)}cacheCodeRequest(e){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");const t=Ti(JSON.stringify(e));this.setTemporaryCache(K.REQUEST_PARAMS,t,!0)}getCachedRequest(e){this.logger.trace("BrowserCacheManager.getCachedRequest called");const t=this.getTemporaryCache(K.REQUEST_PARAMS,!0);if(!t)throw k(Sl);let o;try{o=JSON.parse(Le(t))}catch(i){throw this.logger.errorPii(`Attempted to parse: ${t}`),this.logger.error(`Parsing cached token request threw with error: ${i}`),k(Al)}if(this.removeTemporaryItem(this.generateCacheKey(K.REQUEST_PARAMS)),!o.authority){const i=this.generateAuthorityKey(e),a=this.getTemporaryCache(i);if(!a)throw k(mi);o.authority=a}return o}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache(K.NATIVE_REQUEST,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;const t=this.validateAndParseJson(e);return t||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress();return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${I.CACHE_PREFIX}.${K.INTERACTION_STATUS_KEY}`;return this.getTemporaryCache(e,!1)}setInteractionInProgress(e){const t=`${I.CACHE_PREFIX}.${K.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())throw k(pl);this.setTemporaryCache(t,this.clientId,!1)}else!e&&this.getInteractionInProgress()===this.clientId&&this.removeTemporaryItem(t)}getLegacyLoginHint(){const e=this.getTemporaryCache(oe.ADAL_ID_TOKEN);e&&(this.browserStorage.removeItem(oe.ADAL_ID_TOKEN),this.logger.verbose("Cached ADAL id token retrieved."));const t=this.getTemporaryCache(oe.ID_TOKEN,!0);t&&(this.browserStorage.removeItem(this.generateCacheKey(oe.ID_TOKEN)),this.logger.verbose("Cached MSAL.js v1 id token retrieved"));const o=t||e;if(o){const i=it(o,Le);if(i.preferred_username)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 preferred_username as loginHint"),i.preferred_username;if(i.upn)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 upn as loginHint"),i.upn;this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, however, no account hint claim found. Enable preferred_username or upn id token claim to get SSO.")}return null}updateCredentialCacheKey(e,t,o){const i=ht(t);if(e!==i){const a=this.getItem(e);if(a)return this.browserStorage.removeItem(e),this.setItem(i,a,o),this.logger.verbose(`Updated an outdated ${t.credentialType} cache key`),i;this.logger.error(`Attempted to update an outdated ${t.credentialType} cache key but no item matching the outdated key was found in storage`)}return e}async hydrateCache(e,t){const o=bn(e.account?.homeAccountId,e.account?.environment,e.idToken,this.clientId,e.tenantId);let i;t.claims&&(i=await this.cryptoImpl.hashString(t.claims));const a=Nn(e.account?.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?e.expiresOn.getTime()/1e3:0,e.extExpiresOn?e.extExpiresOn.getTime()/1e3:0,Le,void 0,e.tokenType,void 0,t.sshKid,t.claims,i),l={idToken:o,accessToken:a};return this.saveCacheRecord(l,e.correlationId)}async saveCacheRecord(e,t,o){try{await super.saveCacheRecord(e,t,o)}catch(i){if(i instanceof yt&&this.performanceClient&&t)try{const a=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:a.refreshToken.length,cacheIdCount:a.idToken.length,cacheAtCount:a.accessToken.length},t)}catch{}throw i}}}const AI=(n,e)=>{const t={cacheLocation:me.MemoryStorage,temporaryCacheLocation:me.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};return new No(n,t,mn,e)};/*! @azure/msal-browser v3.30.0 2025-08-05 */function wI(n,e,t,o,i){return n.verbose("getAllAccounts called"),t?e.getAllAccounts(o,i):[]}function _I(n,e,t,o){if(e.trace("getAccount called"),Object.keys(n).length===0)return e.warning("getAccount: No accountFilter provided"),null;const i=t.getAccountInfoFilteredBy(n,o);return i?(e.verbose("getAccount: Account matching provided filter found, returning"),i):(e.verbose("getAccount: No matching account found, returning null"),null)}function RI(n,e,t,o){if(e.trace("getAccountByUsername called"),!n)return e.warning("getAccountByUsername: No username provided"),null;const i=t.getAccountInfoFilteredBy({username:n},o);return i?(e.verbose("getAccountByUsername: Account matching username found, returning"),e.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${n}`),i):(e.verbose("getAccountByUsername: No matching account found, returning null"),null)}function kI(n,e,t,o){if(e.trace("getAccountByHomeId called"),!n)return e.warning("getAccountByHomeId: No homeAccountId provided"),null;const i=t.getAccountInfoFilteredBy({homeAccountId:n},o);return i?(e.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),e.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${n}`),i):(e.verbose("getAccountByHomeId: No matching account found, returning null"),null)}function MI(n,e,t,o){if(e.trace("getAccountByLocalId called"),!n)return e.warning("getAccountByLocalId: No localAccountId provided"),null;const i=t.getAccountInfoFilteredBy({localAccountId:n},o);return i?(e.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),e.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${n}`),i):(e.verbose("getAccountByLocalId: No matching account found, returning null"),null)}function PI(n,e,t){e.setActiveAccount(n,t)}function bI(n,e){return n.getActiveAccount(e)}/*! @azure/msal-browser v3.30.0 2025-08-05 */const U={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache"};/*! @azure/msal-browser v3.30.0 2025-08-05 */class NI{constructor(e){this.eventCallbacks=new Map,this.logger=e||new Jt({})}addEventCallback(e,t,o){if(typeof window<"u"){const i=o||cI();return this.eventCallbacks.has(i)?(this.logger.error(`Event callback with id: ${i} is already registered. Please provide a unique id or remove the existing callback and try again.`),null):(this.eventCallbacks.set(i,[e,t||[]]),this.logger.verbose(`Event callback registered with id: ${i}`),i)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}emitEvent(e,t,o,i){if(typeof window<"u"){const a={eventType:e,interactionType:t||null,payload:o||null,error:i||null,timestamp:Date.now()};this.eventCallbacks.forEach(([l,c],u)=>{(c.length===0||c.includes(e))&&(this.logger.verbose(`Emitting event to callback ${u}: ${e}`),l.apply(null,[a]))})}}}/*! @azure/msal-browser v3.30.0 2025-08-05 */class Ql{constructor(e,t,o,i,a,l,c,u,d){this.config=e,this.browserStorage=t,this.browserCrypto=o,this.networkClient=this.config.system.networkClient,this.eventHandler=a,this.navigationClient=l,this.nativeMessageHandler=u,this.correlationId=d||Ue(),this.logger=i.clone(ve.MSAL_SKU,St,this.correlationId),this.performanceClient=c}async clearCacheOnLogout(e){if(e){te.accountInfoIsEqual(e,this.browserStorage.getActiveAccount(this.correlationId),!1)&&(this.logger.verbose("Setting active account to null"),this.browserStorage.setActiveAccount(null,this.correlationId));try{await this.browserStorage.removeAccount(te.generateAccountCacheKey(e),this.correlationId),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch{this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),await this.browserStorage.clear(this.correlationId),await this.browserCrypto.clearKeystore()}catch{this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}}getRedirectUri(e){this.logger.verbose("getRedirectUri called");const t=e||this.config.auth.redirectUri;return G.getAbsoluteUrl(t,Ge())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const o={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new Ft(o,this.browserStorage)}async getDiscoveredAuthority(e){const{account:t}=e,o=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;this.performanceClient.addQueueMeasurement(T.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);const i={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},a=e.requestAuthority||this.config.auth.authority,l=o?.length?o==="true":this.config.auth.instanceAware,c=t&&l?this.config.auth.authority.replace(G.getDomainFromUrl(a),t.environment):a,u=le.generateAuthority(c,e.requestAzureCloudOptions||this.config.auth.azureCloudOptions),d=await w(il,T.AuthorityFactoryCreateDiscoveredInstance,this.logger,this.performanceClient,this.correlationId)(u,this.config.system.networkClient,this.browserStorage,i,this.logger,this.correlationId,this.performanceClient);if(t&&!d.isAlias(t.environment))throw z(Wa);return d}}/*! @azure/msal-browser v3.30.0 2025-08-05 */const xI=32;async function LI(n,e,t){n.addQueueMeasurement(T.GeneratePkceCodes,t);const o=rt(DI,T.GenerateCodeVerifier,e,n,t)(n,e,t),i=await w(UI,T.GenerateCodeChallengeFromVerifier,e,n,t)(o,n,e,t);return{verifier:o,challenge:i}}function DI(n,e,t){try{const o=new Uint8Array(xI);return rt(Qv,T.GetRandomValues,e,n,t)(o),Fn(o)}catch{throw k(gi)}}async function UI(n,e,t,o){e.addQueueMeasurement(T.GenerateCodeChallengeFromVerifier,o);try{const i=await w(Vl,T.Sha256Digest,t,e,o)(n,e,o);return Fn(new Uint8Array(i))}catch{throw k(gi)}}/*! @azure/msal-browser v3.30.0 2025-08-05 */async function Ri(n,e,t,o){t.addQueueMeasurement(T.InitializeBaseRequest,n.correlationId);const i=n.authority||e.auth.authority,a=[...n&&n.scopes||[]],l={...n,correlationId:n.correlationId,authority:i,scopes:a};if(!l.authenticationScheme)l.authenticationScheme=J.BEARER,o.verbose(`Authentication Scheme wasn't explicitly set in request, defaulting to "Bearer" request`);else{if(l.authenticationScheme===J.SSH){if(!n.sshJwk)throw z(xn);if(!n.sshKid)throw z(Ja)}o.verbose(`Authentication Scheme set to "${l.authenticationScheme}" as configured in Auth request`)}return e.cache.claimsBasedCachingEnabled&&n.claims&&!Re.isEmptyObj(n.claims)&&(l.requestedClaimsHash=await Kl(n.claims)),l}async function OI(n,e,t,o,i){o.addQueueMeasurement(T.InitializeSilentRequest,n.correlationId);const a=await w(Ri,T.InitializeBaseRequest,i,o,n.correlationId)(n,t,o,i);return{...n,...a,account:e,forceRefresh:n.forceRefresh||!1}}/*! @azure/msal-browser v3.30.0 2025-08-05 */class bt extends Ql{async initializeAuthorizationCodeRequest(e){this.performanceClient.addQueueMeasurement(T.StandardInteractionClientInitializeAuthorizationCodeRequest,this.correlationId);const t=await w(LI,T.GeneratePkceCodes,this.logger,this.performanceClient,this.correlationId)(this.performanceClient,this.logger,this.correlationId),o={...e,redirectUri:e.redirectUri,code:I.EMPTY_STRING,codeVerifier:t.verifier};return e.codeChallenge=t.challenge,e.codeChallengeMethod=I.S256_CODE_CHALLENGE_METHOD,o}initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e?.correlationId);const t={correlationId:this.correlationId||Ue(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const o=this.getLogoutHintFromIdTokenClaims(e.account);o&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=o)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return!e||e.postLogoutRedirectUri!==null?e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=G.getAbsoluteUrl(e.postLogoutRedirectUri,Ge())):this.config.auth.postLogoutRedirectUri===null?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=G.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,Ge())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=G.getAbsoluteUrl(Ge(),Ge())):this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}async createAuthCodeClient(e){this.performanceClient.addQueueMeasurement(T.StandardInteractionClientCreateAuthCodeClient,this.correlationId);const t=await w(this.getClientConfiguration.bind(this),T.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e);return new al(t,this.performanceClient)}async getClientConfiguration(e){const{serverTelemetryManager:t,requestAuthority:o,requestAzureCloudOptions:i,requestExtraQueryParameters:a,account:l}=e;this.performanceClient.addQueueMeasurement(T.StandardInteractionClientGetClientConfiguration,this.correlationId);const c=await w(this.getDiscoveredAuthority.bind(this),T.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,this.correlationId)({requestAuthority:o,requestAzureCloudOptions:i,requestExtraQueryParameters:a,account:l}),u=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:c,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:u.loggerCallback,piiLoggingEnabled:u.piiLoggingEnabled,logLevel:u.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:ve.MSAL_SKU,version:St,cpu:I.EMPTY_STRING,os:I.EMPTY_STRING},telemetry:this.config.telemetry}}async initializeAuthorizationRequest(e,t){this.performanceClient.addQueueMeasurement(T.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId);const o=this.getRedirectUri(e.redirectUri),i={interactionType:t},a=ke.setRequestState(this.browserCrypto,e&&e.state||I.EMPTY_STRING,i),c={...await w(Ri,T.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)({...e,correlationId:this.correlationId},this.config,this.performanceClient,this.logger),redirectUri:o,state:a,nonce:e.nonce||Ue(),responseMode:this.config.auth.OIDCOptions.serverResponseType};if(e.loginHint||e.sid)return c;const u=e.account||this.browserStorage.getActiveAccount(this.correlationId);if(u&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${u.homeAccountId}`,this.correlationId),c.account=u),!c.loginHint&&!u){const d=this.browserStorage.getLegacyLoginHint();d&&(c.loginHint=d)}return c}}/*! @azure/msal-browser v3.30.0 2025-08-05 */const HI="ContentError",Xl="user_switch";/*! @azure/msal-browser v3.30.0 2025-08-05 */const BI="USER_INTERACTION_REQUIRED",FI="USER_CANCEL",GI="NO_NETWORK",qI="PERSISTENT_ERROR",VI="DISABLED",KI="ACCOUNT_UNAVAILABLE";/*! @azure/msal-browser v3.30.0 2025-08-05 */const $I=-2147186943,JI={[Xl]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class Ne extends X{constructor(e,t,o){super(e,t),Object.setPrototypeOf(this,Ne.prototype),this.name="NativeAuthError",this.ext=o}}function dt(n){if(n.ext&&n.ext.status&&(n.ext.status===qI||n.ext.status===VI)||n.ext&&n.ext.error&&n.ext.error===$I)return!0;switch(n.errorCode){case HI:return!0;default:return!1}}function xo(n,e,t){if(t&&t.status)switch(t.status){case KI:return wo(rl);case BI:return new Ae(n,e);case FI:return k(et);case GI:return k(En)}return new Ne(n,JI[n]||e,t)}/*! @azure/msal-browser v3.30.0 2025-08-05 */class Zl extends bt{async acquireToken(e){this.performanceClient.addQueueMeasurement(T.SilentCacheClientAcquireToken,e.correlationId);const t=this.initializeServerTelemetryManager(Q.acquireTokenSilent_silentFlow),o=await w(this.getClientConfiguration.bind(this),T.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),i=new kv(o,this.performanceClient);this.logger.verbose("Silent auth client created");try{const l=(await w(i.acquireCachedToken.bind(i),T.SilentFlowClientAcquireCachedToken,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),l}catch(a){throw a instanceof Yt&&a.errorCode===Ci&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),a}}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t?.account)}}/*! @azure/msal-browser v3.30.0 2025-08-05 */class Tt extends Ql{constructor(e,t,o,i,a,l,c,u,d,h,f,p){super(e,t,o,i,a,l,u,d,p),this.apiId=c,this.accountId=h,this.nativeMessageHandler=d,this.nativeStorageManager=f,this.silentCacheClient=new Zl(e,this.nativeStorageManager,o,i,a,l,u,d,p),this.serverTelemetryManager=this.initializeServerTelemetryManager(this.apiId);const m=this.nativeMessageHandler.getExtensionId()===gt.PREFERRED_EXTENSION_ID?"chrome":this.nativeMessageHandler.getExtensionId()?.length?"unknown":void 0;this.skus=Ft.makeExtraSkuString({libraryName:ve.MSAL_SKU,libraryVersion:St,extensionName:m,extensionVersion:this.nativeMessageHandler.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[uv]:this.skus}}async acquireToken(e){this.performanceClient.addQueueMeasurement(T.NativeInteractionClientAcquireToken,e.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");const t=this.performanceClient.startMeasurement(T.NativeInteractionClientAcquireToken,e.correlationId),o=De();try{const i=await this.initializeNativeRequest(e);try{const d=await this.acquireTokensFromCache(this.accountId,i);return t.end({success:!0,isNativeBroker:!1,fromCache:!0}),d}catch{this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const{...a}=i,l={method:We.GetToken,request:a},c=await this.nativeMessageHandler.sendMessage(l),u=this.validateNativeResponse(c);return await this.handleNativeResponse(u,i,o).then(d=>(t.end({success:!0,isNativeBroker:!0,requestId:d.requestId}),this.serverTelemetryManager.clearNativeBrokerErrorCode(),d)).catch(d=>{throw t.end({success:!1,errorCode:d.errorCode,subErrorCode:d.subError,isNativeBroker:!0}),d})}catch(i){throw i instanceof Ne&&this.serverTelemetryManager.setNativeBrokerErrorCode(i.errorCode),i}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:ee.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),S(yo);const o=this.browserStorage.getBaseAccountInfo({nativeAccountId:e},t.correlationId);if(!o)throw S(yo);try{const i=this.createSilentCacheRequest(t,o),a=await this.silentCacheClient.acquireToken(i),l={...o,idTokenClaims:a?.idTokenClaims,idToken:a?.idToken};return{...a,account:l}}catch(i){throw i}}async acquireTokenRedirect(e,t){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const{...o}=e;delete o.onRedirectNavigate;const i=await this.initializeNativeRequest(o),a={method:We.GetToken,request:i};try{const u=await this.nativeMessageHandler.sendMessage(a);this.validateNativeResponse(u)}catch(u){if(u instanceof Ne&&(this.serverTelemetryManager.setNativeBrokerErrorCode(u.errorCode),dt(u)))throw u}this.browserStorage.setTemporaryCache(K.NATIVE_REQUEST,JSON.stringify(i),!0);const l={apiId:Q.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},c=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);t.end({success:!0}),await this.navigationClient.navigateExternal(c,l)}async handleRedirectPromise(e,t){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const o=this.browserStorage.getCachedNativeRequest();if(!o)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&e?.addFields({errorCode:"no_cached_request"},t),null;const{prompt:i,...a}=o;i&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(K.NATIVE_REQUEST));const l={method:We.GetToken,request:a},c=De();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const u=await this.nativeMessageHandler.sendMessage(l);this.validateNativeResponse(u);const d=this.handleNativeResponse(u,a,c);this.browserStorage.setInteractionInProgress(!1);const h=await d;return this.serverTelemetryManager.clearNativeBrokerErrorCode(),h}catch(u){throw this.browserStorage.setInteractionInProgress(!1),u}}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,o){this.logger.trace("NativeInteractionClient - handleNativeResponse called.");const i=it(e.id_token,Le),a=this.createHomeAccountIdentifier(e,i),l=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId},this.correlationId)?.homeAccountId;if(a!==l&&e.account.id!==t.accountId)throw xo(Xl);const c=await this.getDiscoveredAuthority({requestAuthority:t.authority}),u=ui(this.browserStorage,c,a,Le,this.correlationId,i,e.client_info,void 0,i.tid,void 0,e.account.id,this.logger),d=await this.generateAuthenticationResult(e,t,i,u,c.canonicalAuthority,o);return this.cacheAccount(u),this.cacheNativeTokens(e,t,a,i,e.access_token,d.tenantId,o),d}createHomeAccountIdentifier(e,t){return te.generateHomeAccountId(e.client_info||I.EMPTY_STRING,we.Default,this.logger,this.browserCrypto,t)}generateScopes(e,t){return e.scope?ee.fromString(e.scope):ee.fromString(t.scope)}async generatePopAccessToken(e,t){if(t.tokenType===J.POP&&t.signPopToken){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const o=new Et(this.browserCrypto),i={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw S(Wo);return o.signPopToken(e.access_token,t.keyId,i)}else return e.access_token}async generateAuthenticationResult(e,t,o,i,a,l){const c=this.addTelemetryFromNativeResponse(e),u=e.scope?ee.fromString(e.scope):ee.fromString(t.scope),d=e.account.properties||{},h=d.UID||o.oid||o.sub||I.EMPTY_STRING,f=d.TenantId||o.tid||I.EMPTY_STRING,p=ii(i.getAccountInfo(),void 0,o,e.id_token);p.nativeAccountId!==e.account.id&&(p.nativeAccountId=e.account.id);const m=await this.generatePopAccessToken(e,t),v=t.tokenType===J.POP?J.POP:J.BEARER;return{authority:a,uniqueId:h,tenantId:f,scopes:u.asArray(),account:p,idToken:e.id_token,idTokenClaims:o,accessToken:m,fromCache:c?this.isResponseFromCache(c):!1,expiresOn:new Date(Number(l+e.expires_in)*1e3),tokenType:v,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}}cacheAccount(e){this.browserStorage.setAccount(e,this.correlationId),this.browserStorage.removeAccountContext(e,this.correlationId).catch(t=>{this.logger.error(`Error occurred while removing account context from browser storage. ${t}`)})}cacheNativeTokens(e,t,o,i,a,l,c){const u=bn(o,t.authority,e.id_token||"",t.clientId,i.tid||""),d=t.tokenType===J.POP?I.SHR_NONCE_VALIDITY:(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,h=c+d,f=this.generateScopes(e,t),p=Nn(o,t.authority,a,t.clientId,i.tid||l,f.printScopes(),h,0,Le,void 0,t.tokenType,void 0,t.keyId),m={idToken:u,accessToken:p};this.nativeStorageManager.saveCacheRecord(m,t.correlationId,t.storeInCache)}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}validateNativeResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw ma(Vo,"Response missing expected properties.")}getMATSFromResponse(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");const t=e.authority||this.config.auth.authority;e.account&&await this.getDiscoveredAuthority({requestAuthority:t,requestAzureCloudOptions:e.azureCloudOptions,account:e.account});const o=new G(t);o.validateAsUri();const{scopes:i,...a}=e,l=new ee(i||[]);l.appendScopes(Pt);const c=()=>{switch(this.apiId){case Q.ssoSilent:case Q.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),ie.NONE}if(!e.prompt){this.logger.trace("initializeNativeRequest: prompt was not provided");return}switch(e.prompt){case ie.NONE:case ie.CONSENT:case ie.LOGIN:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e.prompt} is not compatible with native flow`),k(Dl)}},u={...a,accountId:this.accountId,clientId:this.config.auth.clientId,authority:o.urlString,scope:l.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:c(),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1,keyId:e.popKid};if(u.signPopToken&&e.popKid)throw k(Ol);if(this.handleExtraBrokerParams(u),u.extraParameters=u.extraParameters||{},u.extraParameters.telemetry=gt.MATS_TELEMETRY,e.authenticationScheme===J.POP){const d={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},h=new Et(this.browserCrypto);let f;if(u.keyId)f=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:u.keyId})),u.signPopToken=!1;else{const p=await w(h.generateCnf.bind(h),T.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(d,this.logger);f=p.reqCnfString,u.keyId=p.kid,u.signPopToken=!0}u.reqCnf=f}return this.addRequestSKUs(u),u}handleExtraBrokerParams(e){const t=e.extraParameters&&e.extraParameters.hasOwnProperty(li)&&e.extraParameters.hasOwnProperty(Ao)&&e.extraParameters.hasOwnProperty(Ze);if(!e.embeddedClientId&&!t)return;let o="";const i=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,o=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[Ao],o=e.extraParameters[Ze]),e.extraParameters={child_client_id:o,child_redirect_uri:i},this.performanceClient?.addFields({embeddedClientId:o,embeddedRedirectUri:i},e.correlationId)}}/*! @azure/msal-browser v3.30.0 2025-08-05 */class xe{constructor(e,t,o,i){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=i,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=o,this.handshakeEvent=o.startMeasurement(T.NativeMessageHandlerHandshake)}async sendMessage(e){this.logger.trace("NativeMessageHandler - sendMessage called.");const t={channel:gt.CHANNEL_ID,extensionId:this.extensionId,responseId:Ue(),body:e};return this.logger.trace("NativeMessageHandler - Sending request to browser extension"),this.logger.tracePii(`NativeMessageHandler - Sending request to browser extension: ${JSON.stringify(t)}`),this.messageChannel.port1.postMessage(t),new Promise((o,i)=>{this.resolvers.set(t.responseId,{resolve:o,reject:i})})}static async createProvider(e,t,o){e.trace("NativeMessageHandler - createProvider called.");try{const i=new xe(e,t,o,gt.PREFERRED_EXTENSION_ID);return await i.sendHandshakeRequest(),i}catch{const a=new xe(e,t,o);return await a.sendHandshakeRequest(),a}}async sendHandshakeRequest(){this.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);const e={channel:gt.CHANNEL_ID,extensionId:this.extensionId,responseId:Ue(),body:{method:We.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=t=>{this.onChannelMessage(t)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise((t,o)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:o}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),o(k(Nl)),this.handshakeResolvers.delete(e.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source!==window)return;const t=e.data;if(!(!t.channel||t.channel!==gt.CHANNEL_ID)&&!(t.extensionId&&t.extensionId!==this.extensionId)&&t.body.method===We.HandshakeRequest){const o=this.handshakeResolvers.get(t.responseId);if(!o){this.logger.trace(`NativeMessageHandler.onWindowMessage - resolver can't be found for request ${t.responseId}`);return}this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),o.reject(k(xl))}}onChannelMessage(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");const t=e.data,o=this.resolvers.get(t.responseId),i=this.handshakeResolvers.get(t.responseId);try{const a=t.body.method;if(a===We.Response){if(!o)return;const l=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii(`NativeMessageHandler - Received response from browser extension: ${JSON.stringify(l)}`),l.status!=="Success")o.reject(xo(l.code,l.description,l.ext));else if(l.result)l.result.code&&l.result.description?o.reject(xo(l.result.code,l.result.description,l.result.ext)):o.resolve(l.result);else throw ma(Vo,"Event does not contain result.");this.resolvers.delete(t.responseId)}else if(a===We.HandshakeResponse){if(!i){this.logger.trace(`NativeMessageHandler.onChannelMessage - resolver can't be found for request ${t.responseId}`);return}clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(`NativeMessageHandler - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),i.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(a){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${a}`),this.logger.errorPii(`Unable to parse ${e}`),o?o.reject(a):i&&i.reject(a)}}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}static isNativeAvailable(e,t,o,i){if(t.trace("isNativeAvailable called"),!e.system.allowNativeBroker)return t.trace("isNativeAvailable: allowNativeBroker is not enabled, returning false"),!1;if(!o)return t.trace("isNativeAvailable: WAM extension provider is not initialized, returning false"),!1;if(i)switch(i){case J.BEARER:case J.POP:return t.trace("isNativeAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isNativeAvailable: authenticationScheme is not supported, returning false"),!1}return!0}}/*! @azure/msal-browser v3.30.0 2025-08-05 */class ki{constructor(e,t,o,i,a){this.authModule=e,this.browserStorage=t,this.authCodeRequest=o,this.logger=i,this.performanceClient=a}async handleCodeResponse(e,t){this.performanceClient.addQueueMeasurement(T.HandleCodeResponse,t.correlationId);let o;try{o=this.authModule.handleFragmentResponse(e,t.state)}catch(i){throw i instanceof Ye&&i.subError===et?k(et):i}return w(this.handleCodeResponseFromServer.bind(this),T.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(o,t)}async handleCodeResponseFromServer(e,t,o=!0){if(this.performanceClient.addQueueMeasurement(T.HandleCodeResponseFromServer,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&await w(this.authModule.updateAuthority.bind(this.authModule),T.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId),o&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const a=this.createCcsCredentials(t);a&&(this.authCodeRequest.ccsCredential=a)}return await w(this.authModule.acquireToken.bind(this.authModule),T.AuthClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:Ie.HOME_ACCOUNT_ID}:e.loginHint?{credential:e.loginHint,type:Ie.UPN}:null}}/*! @azure/msal-browser v3.30.0 2025-08-05 */function jl(n,e,t){const o=Tn(n);if(!o)throw Xa(n)?(t.error(`A ${e} is present in the iframe but it does not contain known properties. It's likely that the ${e} has been replaced by code running on the redirectUri page.`),t.errorPii(`The ${e} detected is: ${n}`),k(hl)):(t.error(`The request has returned to the redirectUri but a ${e} is not present. It's likely that the ${e} has been removed or the page has been redirected by code running on the redirectUri page.`),k(ul));return o}function zI(n,e,t){if(!n.state)throw k(pi);const o=Wl(e,n.state);if(!o)throw k(fl);if(o.interactionType!==t)throw k(gl)}/*! @azure/msal-browser v3.30.0 2025-08-05 */class YI extends bt{constructor(e,t,o,i,a,l,c,u,d,h){super(e,t,o,i,a,l,c,d,h),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=u}acquireToken(e){try{const o={popupName:this.generatePopupName(e.scopes||Pt,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window};return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,o)):(this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),o.popup=this.openSizedPopup("about:blank",o),this.acquireTokenPopupAsync(e,o))}catch(t){return Promise.reject(t)}}logout(e){try{this.logger.verbose("logoutPopup called");const t=this.initializeLogoutRequest(e),o={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:e?.popupWindowAttributes||{},popupWindowParent:e?.popupWindowParent??window},i=e&&e.authority,a=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,o,i,a)):(this.logger.verbose("asyncPopup set to false, opening popup"),o.popup=this.openSizedPopup("about:blank",o),this.logoutPopupAsync(t,o,i,a))}catch(t){return Promise.reject(t)}}async acquireTokenPopupAsync(e,t){this.logger.verbose("acquireTokenPopupAsync called");const o=this.initializeServerTelemetryManager(Q.acquireTokenPopup),i=await w(this.initializeAuthorizationRequest.bind(this),T.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,N.Popup);Yl(i.authority);try{const a=await w(this.initializeAuthorizationCodeRequest.bind(this),T.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(i),l=await w(this.createAuthCodeClient.bind(this),T.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:i.authority,requestAzureCloudOptions:i.azureCloudOptions,requestExtraQueryParameters:i.extraQueryParameters,account:i.account}),c=xe.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme);let u;c&&(u=this.performanceClient.startMeasurement(T.FetchAccountIdWithNativeBroker,e.correlationId));const d=await l.getAuthCodeUrl({...i,nativeBroker:c}),h=new ki(l,this.browserStorage,a,this.logger,this.performanceClient),f=this.initiateAuthRequest(d,t);this.eventHandler.emitEvent(U.POPUP_OPENED,N.Popup,{popupWindow:f},null);const p=await this.monitorPopupForHash(f,t.popupWindowParent),m=rt(jl,T.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(p,this.config.auth.OIDCOptions.serverResponseType,this.logger);if(be.removeThrottle(this.browserStorage,this.config.auth.clientId,a),m.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),u&&u.end({success:!0,isNativeBroker:!0}),!this.nativeMessageHandler)throw k(zt);const y=new Tt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Q.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,m.accountId,this.nativeStorage,i.correlationId),{userRequestState:E}=ke.parseRequestState(this.browserCrypto,i.state);return await y.acquireToken({...i,state:E,prompt:void 0})}return await h.handleCodeResponse(m,i)}catch(a){throw t.popup?.close(),a instanceof X&&(a.setCorrelationId(this.correlationId),o.cacheFailedRequest(a)),a}}async logoutPopupAsync(e,t,o,i){this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(U.LOGOUT_START,N.Popup,e);const a=this.initializeServerTelemetryManager(Q.logoutPopup);try{await this.clearCacheOnLogout(e.account);const l=await w(this.createAuthCodeClient.bind(this),T.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:a,requestAuthority:o,account:e.account||void 0});try{l.authority.endSessionEndpoint}catch{if(e.account?.homeAccountId&&e.postLogoutRedirectUri&&l.authority.protocolMode===qe.OIDC){if(this.browserStorage.removeAccount(e.account?.homeAccountId,this.correlationId),this.eventHandler.emitEvent(U.LOGOUT_SUCCESS,N.Popup,e),i){const d={apiId:Q.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},h=G.getAbsoluteUrl(i,Ge());await this.navigationClient.navigateInternal(h,d)}t.popup?.close();return}}const c=l.getLogoutUri(e);this.eventHandler.emitEvent(U.LOGOUT_SUCCESS,N.Popup,e);const u=this.openPopup(c,t);if(this.eventHandler.emitEvent(U.POPUP_OPENED,N.Popup,{popupWindow:u},null),await this.monitorPopupForHash(u,t.popupWindowParent).catch(()=>{}),i){const d={apiId:Q.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},h=G.getAbsoluteUrl(i,Ge());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${h}`),await this.navigationClient.navigateInternal(h,d)}else this.logger.verbose("No main window navigation requested")}catch(l){throw t.popup?.close(),l instanceof X&&(l.setCorrelationId(this.correlationId),a.cacheFailedRequest(l)),this.browserStorage.setInteractionInProgress(!1),this.eventHandler.emitEvent(U.LOGOUT_FAILURE,N.Popup,null,l),this.eventHandler.emitEvent(U.LOGOUT_END,N.Popup),l}this.eventHandler.emitEvent(U.LOGOUT_END,N.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),k(On)}monitorPopupForHash(e,t){return new Promise((o,i)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const a=setInterval(()=>{if(e.closed){this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(a),i(k(et));return}let l="";try{l=e.location.href}catch{}if(!l||l==="about:blank")return;clearInterval(a);let c="";const u=this.config.auth.OIDCOptions.serverResponseType;e&&(u===$t.QUERY?c=e.location.search:c=e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),o(c)},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e,t)})}openPopup(e,t){try{let o;if(t.popup?(o=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),o.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii(`Opening popup window to: ${e}`),o=this.openSizedPopup(e,t)),!o)throw k(Cl);return o.focus&&o.focus(),this.currentWindow=o,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),o}catch(o){throw this.logger.error("error opening popup "+o.message),this.browserStorage.setInteractionInProgress(!1),k(ml)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:o,popupWindowParent:i}){const a=i.screenLeft?i.screenLeft:i.screenX,l=i.screenTop?i.screenTop:i.screenY,c=i.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,u=i.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let d=o.popupSize?.width,h=o.popupSize?.height,f=o.popupPosition?.top,p=o.popupPosition?.left;return(!d||d<0||d>c)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),d=ve.POPUP_WIDTH),(!h||h<0||h>u)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),h=ve.POPUP_HEIGHT),(!f||f<0||f>u)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),f=Math.max(0,u/2-ve.POPUP_HEIGHT/2+l)),(!p||p<0||p>c)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),p=Math.max(0,c/2-ve.POPUP_WIDTH/2+a)),i.open(e,t,`width=${d}, height=${h}, top=${f}, left=${p}, scrollbars=yes`)}unloadWindow(e){this.browserStorage.cleanRequestByInteractionType(N.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)}generatePopupName(e,t){return`${ve.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${ve.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}/*! @azure/msal-browser v3.30.0 2025-08-05 */class bs{constructor(e,t,o,i,a){this.authModule=e,this.browserStorage=t,this.authCodeRequest=o,this.logger=i,this.performanceClient=a}async initiateAuthRequest(e,t){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){t.redirectStartPage&&(this.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),this.browserStorage.setTemporaryCache(K.ORIGIN_URI,t.redirectStartPage,!0)),this.browserStorage.setTemporaryCache(K.CORRELATION_ID,this.authCodeRequest.correlationId,!0),this.browserStorage.cacheCodeRequest(this.authCodeRequest),this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);const o={apiId:Q.acquireTokenRedirect,timeout:t.redirectTimeout,noHistory:!1};if(typeof t.onRedirectNavigate=="function")if(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),t.onRedirectNavigate(e)!==!1){this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),await t.navigationClient.navigateExternal(e,o);return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation");return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),await t.navigationClient.navigateExternal(e,o);return}}else throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),k(On)}async handleCodeResponse(e,t){this.logger.verbose("RedirectHandler.handleCodeResponse called"),this.browserStorage.setInteractionInProgress(!1);const o=this.browserStorage.generateStateKey(t),i=this.browserStorage.getTemporaryCache(o);if(!i)throw S(pn,"Cached State");let a;try{a=this.authModule.handleFragmentResponse(e,i)}catch(d){throw d instanceof Ye&&d.subError===et?k(et):d}const l=this.browserStorage.generateNonceKey(i),c=this.browserStorage.getTemporaryCache(l);if(this.authCodeRequest.code=a.code,a.cloud_instance_host_name&&await w(this.authModule.updateAuthority.bind(this.authModule),T.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,this.authCodeRequest.correlationId)(a.cloud_instance_host_name,this.authCodeRequest.correlationId),a.nonce=c||void 0,a.state=i,a.client_info)this.authCodeRequest.clientInfo=a.client_info;else{const d=this.checkCcsCredentials();d&&(this.authCodeRequest.ccsCredential=d)}const u=await this.authModule.acquireToken(this.authCodeRequest,a);return this.browserStorage.cleanRequestByState(t),u}checkCcsCredentials(){const e=this.browserStorage.getTemporaryCache(K.CCS_CREDENTIAL,!0);if(e)try{return JSON.parse(e)}catch{this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii(`Cache credential could not be parsed: ${e}`)}return null}}/*! @azure/msal-browser v3.30.0 2025-08-05 */function WI(){if(typeof window>"u"||typeof window.performance>"u"||typeof window.performance.getEntriesByType!="function")return;const n=window.performance.getEntriesByType("navigation");return(n.length?n[0]:void 0)?.type}class QI extends bt{constructor(e,t,o,i,a,l,c,u,d,h){super(e,t,o,i,a,l,c,d,h),this.nativeStorage=u}async acquireToken(e){const t=await w(this.initializeAuthorizationRequest.bind(this),T.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,N.Redirect);this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||"",t.account||null);const o=this.initializeServerTelemetryManager(Q.acquireTokenRedirect),i=a=>{a.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.cleanRequestByState(t.state),this.eventHandler.emitEvent(U.RESTORE_FROM_BFCACHE,N.Redirect))};try{const a=await w(this.initializeAuthorizationCodeRequest.bind(this),T.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(t),l=await w(this.createAuthCodeClient.bind(this),T.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),c=new bs(l,this.browserStorage,a,this.logger,this.performanceClient),u=await l.getAuthCodeUrl({...t,nativeBroker:xe.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme)}),d=this.getRedirectStartPage(e.redirectStartPage);return this.logger.verbosePii(`Redirect start page: ${d}`),window.addEventListener("pageshow",i),await c.initiateAuthRequest(u,{navigationClient:this.navigationClient,redirectTimeout:this.config.system.redirectNavigationTimeout,redirectStartPage:d,onRedirectNavigate:e.onRedirectNavigate||this.config.auth.onRedirectNavigate})}catch(a){throw a instanceof X&&(a.setCorrelationId(this.correlationId),o.cacheFailedRequest(a)),window.removeEventListener("pageshow",i),this.browserStorage.cleanRequestByState(t.state),a}}async handleRedirectPromise(e="",t){const o=this.initializeServerTelemetryManager(Q.handleRedirectPromise);try{if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const[i,a]=this.getRedirectResponse(e||"");if(!i)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.cleanRequestByInteractionType(N.Redirect),WI()!=="back_forward"?t.event.errorCode="no_server_response":this.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;const l=this.browserStorage.getTemporaryCache(K.ORIGIN_URI,!0)||I.EMPTY_STRING,c=G.removeHashFromUrl(l),u=G.removeHashFromUrl(window.location.href);if(c===u&&this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("Current page is loginRequestUrl, handling response"),l.indexOf("#")>-1&&oI(l),await this.handleResponse(i,o);if(this.config.auth.navigateToLoginRequestUrl){if(!Ai()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(K.URL_HASH,a,!0);const d={apiId:Q.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let h=!0;if(!l||l==="null"){const f=rI();this.browserStorage.setTemporaryCache(K.ORIGIN_URI,f,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),h=await this.navigationClient.navigateInternal(f,d)}else this.logger.verbose(`Navigating to loginRequestUrl: ${l}`),h=await this.navigationClient.navigateInternal(l,d);if(!h)return await this.handleResponse(i,o)}}else return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),await this.handleResponse(i,o);return null}catch(i){throw i instanceof X&&(i.setCorrelationId(this.correlationId),o.cacheFailedRequest(i)),this.browserStorage.cleanRequestByInteractionType(N.Redirect),i}}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(this.config.auth.OIDCOptions.serverResponseType===$t.QUERY?t=window.location.search:t=window.location.hash);let o=Tn(t);if(o){try{zI(o,this.browserCrypto,N.Redirect)}catch(a){return a instanceof X&&this.logger.error(`Interaction type validation failed due to ${a.errorCode}: ${a.errorMessage}`),[null,""]}return nI(window),this.logger.verbose("Hash contains known properties, returning response hash"),[o,t]}const i=this.browserStorage.getTemporaryCache(K.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(K.URL_HASH)),i&&(o=Tn(i),o)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[o,i]):[null,""]}async handleResponse(e,t){const o=e.state;if(!o)throw k(pi);const i=this.browserStorage.getCachedRequest(o);if(this.logger.verbose("handleResponse called, retrieved cached request"),e.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw k(zt);const u=new Tt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Q.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,e.accountId,this.nativeStorage,i.correlationId),{userRequestState:d}=ke.parseRequestState(this.browserCrypto,o);return u.acquireToken({...i,state:d,prompt:void 0}).finally(()=>{this.browserStorage.cleanRequestByState(o)})}const a=this.browserStorage.getCachedAuthority(o);if(!a)throw k(mi);const l=await w(this.createAuthCodeClient.bind(this),T.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:a});return be.removeThrottle(this.browserStorage,this.config.auth.clientId,i),new bs(l,this.browserStorage,i,this.logger,this.performanceClient).handleCodeResponse(e,o)}async logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e),o=this.initializeServerTelemetryManager(Q.logout);try{this.eventHandler.emitEvent(U.LOGOUT_START,N.Redirect,e),await this.clearCacheOnLogout(t.account);const i={apiId:Q.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=await w(this.createAuthCodeClient.bind(this),T.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:e&&e.authority,requestExtraQueryParameters:e?.extraQueryParameters,account:e&&e.account||void 0});if(a.authority.protocolMode===qe.OIDC)try{a.authority.endSessionEndpoint}catch{if(t.account?.homeAccountId){this.browserStorage.removeAccount(t.account?.homeAccountId,this.correlationId),this.eventHandler.emitEvent(U.LOGOUT_SUCCESS,N.Redirect,t);return}}const l=a.getLogoutUri(t);if(this.eventHandler.emitEvent(U.LOGOUT_SUCCESS,N.Redirect,t),e&&typeof e.onRedirectNavigate=="function")if(e.onRedirectNavigate(l)!==!1){this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),await this.navigationClient.navigateExternal(l,i);return}else this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation");else{this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),await this.navigationClient.navigateExternal(l,i);return}}catch(i){throw i instanceof X&&(i.setCorrelationId(this.correlationId),o.cacheFailedRequest(i)),this.eventHandler.emitEvent(U.LOGOUT_FAILURE,N.Redirect,null,i),this.eventHandler.emitEvent(U.LOGOUT_END,N.Redirect),i}this.eventHandler.emitEvent(U.LOGOUT_END,N.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return G.getAbsoluteUrl(t,Ge())}}/*! @azure/msal-browser v3.30.0 2025-08-05 */async function XI(n,e,t,o,i){if(e.addQueueMeasurement(T.SilentHandlerInitiateAuthRequest,o),!n)throw t.info("Navigate url is empty"),k(On);return i?w(jI,T.SilentHandlerLoadFrame,t,e,o)(n,i,e,o):rt(eE,T.SilentHandlerLoadFrameSync,t,e,o)(n)}async function ZI(n,e,t,o,i,a,l){return o.addQueueMeasurement(T.SilentHandlerMonitorIframeForHash,a),new Promise((c,u)=>{e<Po&&i.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${e}ms) than the default (${Po}ms). This may result in timeouts.`);const d=window.setTimeout(()=>{window.clearInterval(h),u(k(yl))},e),h=window.setInterval(()=>{let f="";const p=n.contentWindow;try{f=p?p.location.href:""}catch{}if(!f||f==="about:blank")return;let m="";p&&(l===$t.QUERY?m=p.location.search:m=p.location.hash),window.clearTimeout(d),window.clearInterval(h),c(m)},t)}).finally(()=>{rt(tE,T.RemoveHiddenIframe,i,o,a)(n)})}function jI(n,e,t,o){return t.addQueueMeasurement(T.SilentHandlerLoadFrame,o),new Promise((i,a)=>{const l=ec();window.setTimeout(()=>{if(!l){a("Unable to load iframe");return}l.src=n,i(l)},e)})}function eE(n){const e=ec();return e.src=n,e}function ec(){const n=document.createElement("iframe");return n.className="msalSilentIframe",n.style.visibility="hidden",n.style.position="absolute",n.style.width=n.style.height="0",n.style.border="0",n.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(n),n}function tE(n){document.body===n.parentNode&&document.body.removeChild(n)}/*! @azure/msal-browser v3.30.0 2025-08-05 */class nE extends bt{constructor(e,t,o,i,a,l,c,u,d,h,f){super(e,t,o,i,a,l,u,h,f),this.apiId=c,this.nativeStorage=d}async acquireToken(e){this.performanceClient.addQueueMeasurement(T.SilentIframeClientAcquireToken,e.correlationId),!e.loginHint&&!e.sid&&(!e.account||!e.account.username)&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");const t={...e};t.prompt?t.prompt!==ie.NONE&&t.prompt!==ie.NO_SESSION&&(this.logger.warning(`SilentIframeClient. Replacing invalid prompt ${t.prompt} with ${ie.NONE}`),t.prompt=ie.NONE):t.prompt=ie.NONE;const o=await w(this.initializeAuthorizationRequest.bind(this),T.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,N.Silent);Yl(o.authority);const i=this.initializeServerTelemetryManager(this.apiId);let a;try{return a=await w(this.createAuthCodeClient.bind(this),T.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:i,requestAuthority:o.authority,requestAzureCloudOptions:o.azureCloudOptions,requestExtraQueryParameters:o.extraQueryParameters,account:o.account}),await w(this.silentTokenHelper.bind(this),T.SilentIframeClientTokenHelper,this.logger,this.performanceClient,e.correlationId)(a,o)}catch(l){if(l instanceof X&&(l.setCorrelationId(this.correlationId),i.cacheFailedRequest(l)),!a||!(l instanceof X)||l.errorCode!==ve.INVALID_GRANT_ERROR)throw l;this.performanceClient.addFields({retryError:l.errorCode},this.correlationId);const c=await w(this.initializeAuthorizationRequest.bind(this),T.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,N.Silent);return await w(this.silentTokenHelper.bind(this),T.SilentIframeClientTokenHelper,this.logger,this.performanceClient,this.correlationId)(a,c)}}logout(){return Promise.reject(k(Hn))}async silentTokenHelper(e,t){const o=t.correlationId;this.performanceClient.addQueueMeasurement(T.SilentIframeClientTokenHelper,o);const i=await w(this.initializeAuthorizationCodeRequest.bind(this),T.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,o)(t),a=await w(e.getAuthCodeUrl.bind(e),T.GetAuthCodeUrl,this.logger,this.performanceClient,o)({...t,nativeBroker:xe.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,t.authenticationScheme)}),l=new ki(e,this.browserStorage,i,this.logger,this.performanceClient),c=await w(XI,T.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,o)(a,this.performanceClient,this.logger,o,this.config.system.navigateFrameWait),u=this.config.auth.OIDCOptions.serverResponseType,d=await w(ZI,T.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,o)(c,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,o,u),h=rt(jl,T.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(d,u,this.logger);if(h.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw k(zt);const f=new Tt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.apiId,this.performanceClient,this.nativeMessageHandler,h.accountId,this.browserStorage,o),{userRequestState:p}=ke.parseRequestState(this.browserCrypto,t.state);return w(f.acquireToken.bind(f),T.NativeInteractionClientAcquireToken,this.logger,this.performanceClient,o)({...t,state:p,prompt:t.prompt||ie.NONE})}return w(l.handleCodeResponse.bind(l),T.HandleCodeResponse,this.logger,this.performanceClient,o)(h,t)}}/*! @azure/msal-browser v3.30.0 2025-08-05 */class oE extends bt{async acquireToken(e){this.performanceClient.addQueueMeasurement(T.SilentRefreshClientAcquireToken,e.correlationId);const t=await w(Ri,T.InitializeBaseRequest,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger),o={...e,...t};e.redirectUri&&(o.redirectUri=this.getRedirectUri(e.redirectUri));const i=this.initializeServerTelemetryManager(Q.acquireTokenSilent_silentFlow),a=await this.createRefreshTokenClient({serverTelemetryManager:i,authorityUrl:o.authority,azureCloudOptions:o.azureCloudOptions,account:o.account});return w(a.acquireTokenByRefreshToken.bind(a),T.RefreshTokenClientAcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(o).catch(l=>{throw l.setCorrelationId(this.correlationId),i.cacheFailedRequest(l),l})}logout(){return Promise.reject(k(Hn))}async createRefreshTokenClient(e){const t=await w(this.getClientConfiguration.bind(this),T.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new _o(t,this.performanceClient)}}/*! @azure/msal-browser v3.30.0 2025-08-05 */class iE{constructor(e,t,o,i){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=o,this.cryptoObj=i}loadExternalTokens(e,t,o){if(!this.isBrowserEnvironment)throw k(Bn);const i=e.correlationId||Ue(),a=t.id_token?it(t.id_token,Le):void 0,l={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},c=e.authority?new le(le.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,l,this.logger,e.correlationId||Ue()):void 0,u=this.loadAccount(e,o.clientInfo||t.client_info||"",i,a,c),d=this.loadIdToken(t,u.homeAccountId,u.environment,u.realm,i),h=this.loadAccessToken(e,t,u.homeAccountId,u.environment,u.realm,o,i),f=this.loadRefreshToken(t,u.homeAccountId,u.environment,i);return this.generateAuthenticationResult(e,{account:u,idToken:d,accessToken:h,refreshToken:f},a,c)}loadAccount(e,t,o,i,a){if(this.logger.verbose("TokenCache - loading account"),e.account){const d=te.createFromAccountInfo(e.account);return this.storage.setAccount(d,o),d}else if(!a||!t&&!i)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),k(Rl);const l=te.generateHomeAccountId(t,a.authorityType,this.logger,this.cryptoObj,i),c=i?.tid,u=ui(this.storage,a,l,Le,o,i,t,a.hostnameAndPort,c,void 0,void 0,this.logger);return this.storage.setAccount(u,o),u}loadIdToken(e,t,o,i,a){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");const l=bn(t,o,e.id_token,this.config.auth.clientId,i);return this.storage.setIdTokenCredential(l,a),l}loadAccessToken(e,t,o,i,a,l,c){if(t.access_token)if(t.expires_in){if(!t.scope&&(!e.scopes||!e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null}else return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;else return this.logger.verbose("TokenCache - no access token found in response"),null;this.logger.verbose("TokenCache - loading access token");const u=t.scope?ee.fromString(t.scope):new ee(e.scopes),d=l.expiresOn||t.expires_in+new Date().getTime()/1e3,h=l.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+new Date().getTime()/1e3,f=Nn(o,i,t.access_token,this.config.auth.clientId,a,u.printScopes(),d,h,Le);return this.storage.setAccessTokenCredential(f,c),f}loadRefreshToken(e,t,o,i){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");const a=Da(t,o,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return this.storage.setRefreshTokenCredential(a,i),a}generateAuthenticationResult(e,t,o,i){let a="",l=[],c=null,u;t?.accessToken&&(a=t.accessToken.secret,l=ee.fromString(t.accessToken.target).asArray(),c=new Date(Number(t.accessToken.expiresOn)*1e3),u=new Date(Number(t.accessToken.extendedExpiresOn)*1e3));const d=t.account;return{authority:i?i.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:l,account:d.getAccountInfo(),idToken:t.idToken?.secret||"",idTokenClaims:o||{},accessToken:a,fromCache:!0,expiresOn:c,correlationId:e.correlationId||"",requestId:"",extExpiresOn:u,familyId:t.refreshToken?.familyId||"",tokenType:t?.accessToken?.tokenType||"",state:e.state||"",cloudGraphHostName:d.cloudGraphHostName||"",msGraphHost:d.msGraphHost||"",fromNativeBroker:!1}}}/*! @azure/msal-browser v3.30.0 2025-08-05 */class rE extends al{constructor(e){super(e),this.includeRedirectUri=!1}}/*! @azure/msal-browser v3.30.0 2025-08-05 */class sE extends bt{constructor(e,t,o,i,a,l,c,u,d,h){super(e,t,o,i,a,l,u,d,h),this.apiId=c}async acquireToken(e){if(!e.code)throw k(kl);const t=await w(this.initializeAuthorizationRequest.bind(this),T.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(e,N.Silent),o=this.initializeServerTelemetryManager(this.apiId);try{const i={...t,code:e.code},a=await w(this.getClientConfiguration.bind(this),T.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:o,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),l=new rE(a);this.logger.verbose("Auth code client created");const c=new ki(l,this.browserStorage,i,this.logger,this.performanceClient);return await w(c.handleCodeResponseFromServer.bind(c),T.HandleCodeResponseFromServer,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(i){throw i instanceof X&&(i.setCorrelationId(this.correlationId),o.cacheFailedRequest(i)),i}}logout(){return Promise.reject(k(Hn))}}/*! @azure/msal-browser v3.30.0 2025-08-05 */function Pe(n){const e=n?.idTokenClaims;if(e?.tfp||e?.acr)return"B2C";if(e?.tid){if(e?.tid==="9188040d-6c67-4c5b-b112-36a304b66dad")return"MSA"}else return;return"AAD"}function sn(n,e){try{wi(n)}catch(t){throw e.end({success:!1},t),t}}class Gn{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new At(this.logger,this.performanceClient):mn,this.eventHandler=new NI(this.logger),this.browserStorage=this.isBrowserEnvironment?new No(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,yv(this.config.auth),this.performanceClient):AI(this.config.auth.clientId,this.logger);const t={cacheLocation:me.MemoryStorage,temporaryCacheLocation:me.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new No(this.config.auth.clientId,t,this.browserCrypto,this.logger,void 0,this.performanceClient),this.tokenCache=new iE(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this),this.listeningToStorageEvents=!1,this.handleAccountCacheChange=this.handleAccountCacheChange.bind(this)}static async createController(e,t){const o=new Gn(e);return await o.initialize(t),o}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e){if(this.logger.trace("initialize called"),this.initialized){this.logger.info("initialize has already been called, exiting early.");return}if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, exiting early."),this.initialized=!0,this.eventHandler.emitEvent(U.INITIALIZE_END);return}const t=e?.correlationId||this.getRequestCorrelationId(),o=this.config.system.allowNativeBroker,i=this.performanceClient.startMeasurement(T.InitializeClientApplication,t);if(this.eventHandler.emitEvent(U.INITIALIZE_START),o)try{this.nativeExtensionProvider=await xe.createProvider(this.logger,this.config.system.nativeBrokerHandshakeTimeout,this.performanceClient)}catch(a){this.logger.verbose(a)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),await w(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),T.ClearTokensAndKeysWithClaims,this.logger,this.performanceClient,t)(this.performanceClient,t)),this.initialized=!0,this.eventHandler.emitEvent(U.INITIALIZE_END),i.end({allowNativeBroker:o,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("handleRedirectPromise called"),zl(this.initialized),this.isBrowserEnvironment){const t=e||"";let o=this.redirectResponse.get(t);return typeof o>"u"?(o=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,o),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),o}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null}async handleRedirectPromiseInternal(e){const t=this.getAllAccounts(),o=this.browserStorage.getCachedNativeRequest(),i=o&&xe.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider)&&this.nativeExtensionProvider&&!e,a=i?o?.correlationId:this.browserStorage.getTemporaryCache(K.CORRELATION_ID,!0)||"",l=this.performanceClient.startMeasurement(T.AcquireTokenRedirect,a);this.eventHandler.emitEvent(U.HANDLE_REDIRECT_START,N.Redirect);let c;if(i&&this.nativeExtensionProvider){this.logger.trace("handleRedirectPromise - acquiring token from native platform");const u=new Tt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Q.handleRedirectPromise,this.performanceClient,this.nativeExtensionProvider,o.accountId,this.nativeInternalStorage,o.correlationId);c=w(u.handleRedirectPromise.bind(u),T.HandleNativeRedirectPromiseMeasurement,this.logger,this.performanceClient,l.event.correlationId)(this.performanceClient,l.event.correlationId)}else{this.logger.trace("handleRedirectPromise - acquiring token from web flow");const u=this.createRedirectClient(a);c=w(u.handleRedirectPromise.bind(u),T.HandleRedirectPromiseMeasurement,this.logger,this.performanceClient,l.event.correlationId)(e,l)}return c.then(u=>(u?(t.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(U.LOGIN_SUCCESS,N.Redirect,u),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(U.ACQUIRE_TOKEN_SUCCESS,N.Redirect,u),this.logger.verbose("handleRedirectResponse returned result, acquire token success")),l.end({success:!0,accountType:Pe(u.account)})):l.event.errorCode?l.end({success:!1}):l.discard(),this.eventHandler.emitEvent(U.HANDLE_REDIRECT_END,N.Redirect),u)).catch(u=>{const d=u;throw t.length>0?this.eventHandler.emitEvent(U.ACQUIRE_TOKEN_FAILURE,N.Redirect,null,d):this.eventHandler.emitEvent(U.LOGIN_FAILURE,N.Redirect,null,d),this.eventHandler.emitEvent(U.HANDLE_REDIRECT_END,N.Redirect),l.end({success:!1},d),u})}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t);const o=this.performanceClient.startMeasurement(T.AcquireTokenPreRedirect,t);o.add({accountType:Pe(e.account),scenarioId:e.scenarioId});const i=e.onRedirectNavigate;if(i)e.onRedirectNavigate=l=>{const c=typeof i=="function"?i(l):void 0;return c!==!1?o.end({success:!0}):o.discard(),c};else{const l=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=c=>{const u=typeof l=="function"?l(c):void 0;return u!==!1?o.end({success:!0}):o.discard(),u}}const a=this.getAllAccounts().length>0;try{Rs(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0),a?this.eventHandler.emitEvent(U.ACQUIRE_TOKEN_START,N.Redirect,e):this.eventHandler.emitEvent(U.LOGIN_START,N.Redirect,e);let l;return this.nativeExtensionProvider&&this.canUseNative(e)?l=new Tt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Q.acquireTokenRedirect,this.performanceClient,this.nativeExtensionProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,o).catch(u=>{if(u instanceof Ne&&dt(u))return this.nativeExtensionProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(u instanceof Ae)return this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createRedirectClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),u}):l=this.createRedirectClient(t).acquireToken(e),await l}catch(l){throw o.end({success:!1},l),a?this.eventHandler.emitEvent(U.ACQUIRE_TOKEN_FAILURE,N.Redirect,null,l):this.eventHandler.emitEvent(U.LOGIN_FAILURE,N.Redirect,null,l),l}}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),o=this.performanceClient.startMeasurement(T.AcquireTokenPopup,t);o.add({scenarioId:e.scenarioId,accountType:Pe(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),sn(this.initialized,o),this.browserStorage.setInteractionInProgress(!0)}catch(l){return Promise.reject(l)}const i=this.getAllAccounts();i.length>0?this.eventHandler.emitEvent(U.ACQUIRE_TOKEN_START,N.Popup,e):this.eventHandler.emitEvent(U.LOGIN_START,N.Popup,e);let a;return this.canUseNative(e)?a=this.acquireTokenNative({...e,correlationId:t},Q.acquireTokenPopup).then(l=>(this.browserStorage.setInteractionInProgress(!1),o.end({success:!0,isNativeBroker:!0,accountType:Pe(l.account)}),l)).catch(l=>{if(l instanceof Ne&&dt(l))return this.nativeExtensionProvider=void 0,this.createPopupClient(t).acquireToken(e);if(l instanceof Ae)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),l}):a=this.createPopupClient(t).acquireToken(e),a.then(l=>(i.length<this.getAllAccounts().length?this.eventHandler.emitEvent(U.LOGIN_SUCCESS,N.Popup,l):this.eventHandler.emitEvent(U.ACQUIRE_TOKEN_SUCCESS,N.Popup,l),o.end({success:!0,accessTokenSize:l.accessToken.length,idTokenSize:l.idToken.length,accountType:Pe(l.account)}),l)).catch(l=>(i.length>0?this.eventHandler.emitEvent(U.ACQUIRE_TOKEN_FAILURE,N.Popup,null,l):this.eventHandler.emitEvent(U.LOGIN_FAILURE,N.Popup,null,l),o.end({success:!1},l),Promise.reject(l)))}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}async ssoSilent(e){const t=this.getRequestCorrelationId(e),o={...e,prompt:e.prompt,correlationId:t};this.ssoSilentMeasurement=this.performanceClient.startMeasurement(T.SsoSilent,t),this.ssoSilentMeasurement?.add({scenarioId:e.scenarioId,accountType:Pe(e.account)}),sn(this.initialized,this.ssoSilentMeasurement),this.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",t),this.eventHandler.emitEvent(U.SSO_SILENT_START,N.Silent,o);let i;return this.canUseNative(o)?i=this.acquireTokenNative(o,Q.ssoSilent).catch(a=>{if(a instanceof Ne&&dt(a))return this.nativeExtensionProvider=void 0,this.createSilentIframeClient(o.correlationId).acquireToken(o);throw a}):i=this.createSilentIframeClient(o.correlationId).acquireToken(o),i.then(a=>(this.eventHandler.emitEvent(U.SSO_SILENT_SUCCESS,N.Silent,a),this.ssoSilentMeasurement?.end({success:!0,isNativeBroker:a.fromNativeBroker,accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length,accountType:Pe(a.account)}),a)).catch(a=>{throw this.eventHandler.emitEvent(U.SSO_SILENT_FAILURE,N.Silent,null,a),this.ssoSilentMeasurement?.end({success:!1},a),a}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("acquireTokenByCode called",t);const o=this.performanceClient.startMeasurement(T.AcquireTokenByCode,t);sn(this.initialized,o),this.eventHandler.emitEvent(U.ACQUIRE_TOKEN_BY_CODE_START,N.Silent,e),o.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw k(Pl);if(e.code){const i=e.code;let a=this.hybridAuthCodeResponses.get(i);return a?(this.logger.verbose("Existing acquireTokenByCode request found",t),o.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),a=this.acquireTokenByCodeAsync({...e,correlationId:t}).then(l=>(this.eventHandler.emitEvent(U.ACQUIRE_TOKEN_BY_CODE_SUCCESS,N.Silent,l),this.hybridAuthCodeResponses.delete(i),o.end({success:!0,isNativeBroker:l.fromNativeBroker,accessTokenSize:l.accessToken.length,idTokenSize:l.idToken.length,accountType:Pe(l.account)}),l)).catch(l=>{throw this.hybridAuthCodeResponses.delete(i),this.eventHandler.emitEvent(U.ACQUIRE_TOKEN_BY_CODE_FAILURE,N.Silent,null,l),o.end({success:!1},l),l}),this.hybridAuthCodeResponses.set(i,a)),await a}else if(e.nativeAccountId)if(this.canUseNative(e,e.nativeAccountId)){const i=await this.acquireTokenNative({...e,correlationId:t},Q.acquireTokenByCode,e.nativeAccountId).catch(a=>{throw a instanceof Ne&&dt(a)&&(this.nativeExtensionProvider=void 0),a});return o.end({accountType:Pe(i.account),success:!0}),i}else throw k(bl);else throw k(Ml)}catch(i){throw this.eventHandler.emitEvent(U.ACQUIRE_TOKEN_BY_CODE_FAILURE,N.Silent,null,i),o.end({success:!1},i),i}}async acquireTokenByCodeAsync(e){return this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(T.AcquireTokenByCodeAsync,e.correlationId),this.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),await this.createSilentAuthCodeClient(e.correlationId).acquireToken(e).then(i=>(this.acquireTokenByCodeAsyncMeasurement?.end({success:!0,fromCache:i.fromCache,isNativeBroker:i.fromNativeBroker}),i)).catch(i=>{throw this.acquireTokenByCodeAsyncMeasurement?.end({success:!1},i),i}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(e,t){switch(this.performanceClient.addQueueMeasurement(T.AcquireTokenFromCache,e.correlationId),t){case Te.Default:case Te.AccessToken:case Te.AccessTokenAndRefreshToken:const o=this.createSilentCacheClient(e.correlationId);return w(o.acquireToken.bind(o),T.SilentCacheClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw S(Fe)}}async acquireTokenByRefreshToken(e,t){switch(this.performanceClient.addQueueMeasurement(T.AcquireTokenByRefreshToken,e.correlationId),t){case Te.Default:case Te.AccessTokenAndRefreshToken:case Te.RefreshToken:case Te.RefreshTokenAndNetwork:const o=this.createSilentRefreshClient(e.correlationId);return w(o.acquireToken.bind(o),T.SilentRefreshClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw S(Fe)}}async acquireTokenBySilentIframe(e){this.performanceClient.addQueueMeasurement(T.AcquireTokenBySilentIframe,e.correlationId);const t=this.createSilentIframeClient(e.correlationId);return w(t.acquireToken.bind(t),T.SilentIframeClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e)}async logout(e){const t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect({correlationId:t,...e})}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);return Rs(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return wi(this.initialized),this.browserStorage.setInteractionInProgress(!0),this.createPopupClient(t).logout(e)}catch(t){return Promise.reject(t)}}async clearCache(e){if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, returning early.");return}const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){const t=this.getRequestCorrelationId();return wI(this.logger,this.browserStorage,this.isBrowserEnvironment,t,e)}getAccount(e){const t=this.getRequestCorrelationId();return _I(e,this.logger,this.browserStorage,t)}getAccountByUsername(e){const t=this.getRequestCorrelationId();return RI(e,this.logger,this.browserStorage,t)}getAccountByHomeId(e){const t=this.getRequestCorrelationId();return kI(e,this.logger,this.browserStorage,t)}getAccountByLocalId(e){const t=this.getRequestCorrelationId();return MI(e,this.logger,this.browserStorage,t)}setActiveAccount(e){const t=this.getRequestCorrelationId();PI(e,this.browserStorage,t)}getActiveAccount(){const e=this.getRequestCorrelationId();return bI(this.browserStorage,e)}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const o=te.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return this.browserStorage.setAccount(o,e.correlationId),e.fromNativeBroker?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,o){if(this.logger.trace("acquireTokenNative called"),!this.nativeExtensionProvider)throw k(zt);return new Tt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.nativeExtensionProvider,o||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e)}canUseNative(e,t){if(this.logger.trace("canUseNative called"),!xe.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case ie.NONE:case ie.CONSENT:case ie.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace(`canUseNative: prompt = ${e.prompt} is not compatible with native flow, returning false`),!1}return!t&&!this.getNativeAccountId(e)?(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),!1):!0}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new YI(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createRedirectClient(e){return new QI(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentIframeClient(e){return new nE(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Q.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentCacheClient(e){return new Zl(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentRefreshClient(e){return new oE(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentAuthCodeClient(e){return new sE(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Q.acquireTokenByCode,this.performanceClient,this.nativeExtensionProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return Jl(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?this.logger.verbose("Account storage listener already registered."):(this.logger.verbose("Adding account storage listener."),this.listeningToStorageEvents=!0,window.addEventListener("storage",this.handleAccountCacheChange)))}disableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?(this.logger.verbose("Removing account storage listener."),window.removeEventListener("storage",this.handleAccountCacheChange),this.listeningToStorageEvents=!1):this.logger.verbose("No account storage listener registered."))}handleAccountCacheChange(e){try{e.key?.includes(oe.ACTIVE_ACCOUNT_FILTERS)&&this.eventHandler.emitEvent(U.ACTIVE_ACCOUNT_CHANGED);const t=e.newValue||e.oldValue;if(!t)return;const o=JSON.parse(t);if(typeof o!="object"||!te.isAccountEntity(o))return;const a=It.toObject(new te,o).getAccountInfo();!e.oldValue&&e.newValue?(this.logger.info("Account was added to cache in a different window"),this.eventHandler.emitEvent(U.ACCOUNT_ADDED,void 0,a)):!e.newValue&&e.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.eventHandler.emitEvent(U.ACCOUNT_REMOVED,void 0,a))}catch{return}}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e?.correlationId?e.correlationId:this.isBrowserEnvironment?Ue():I.EMPTY_STRING}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect({correlationId:t,...e||As})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||As})}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),o=this.performanceClient.startMeasurement(T.AcquireTokenSilent,t);o.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),sn(this.initialized,o),this.logger.verbose("acquireTokenSilent called",t);const i=e.account||this.getActiveAccount();if(!i)throw k(El);o.add({accountType:Pe(i)});const a={clientId:this.config.auth.clientId,authority:e.authority||I.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:i.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,shrOptions:e.shrOptions},l=JSON.stringify(a),c=this.activeSilentTokenRequests.get(l);if(typeof c>"u"){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",t);const u=w(this.acquireTokenSilentAsync.bind(this),T.AcquireTokenSilentAsync,this.logger,this.performanceClient,t)({...e,correlationId:t},i).then(d=>(this.activeSilentTokenRequests.delete(l),o.end({success:!0,fromCache:d.fromCache,isNativeBroker:d.fromNativeBroker,cacheLookupPolicy:e.cacheLookupPolicy,accessTokenSize:d.accessToken.length,idTokenSize:d.idToken.length}),d)).catch(d=>{throw this.activeSilentTokenRequests.delete(l),o.end({success:!1},d),d});return this.activeSilentTokenRequests.set(l,u),{...await u,state:e.state}}else return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",t),o.discard(),{...await c,state:e.state}}async acquireTokenSilentAsync(e,t){const o=()=>this.trackPageVisibility(e.correlationId);this.performanceClient.addQueueMeasurement(T.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(U.ACQUIRE_TOKEN_START,N.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",o);const i=await w(OI,T.InitializeSilentRequest,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),a=e.cacheLookupPolicy||Te.Default;return this.acquireTokenSilentNoIframe(i,a).catch(async c=>{if(aE(c,a))if(this.activeIframeRequest)if(a!==Te.Skip){const[d,h]=this.activeIframeRequest;this.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${h}`,i.correlationId);const f=this.performanceClient.startMeasurement(T.AwaitConcurrentIframe,i.correlationId);f.add({awaitIframeCorrelationId:h});const p=await d;if(f.end({success:p}),p)return this.logger.verbose(`Parallel iframe request with correlationId: ${h} succeeded. Retrying cache and/or RT redemption`,i.correlationId),this.acquireTokenSilentNoIframe(i,a);throw this.logger.info(`Iframe request with correlationId: ${h} failed. Interaction is required.`),c}else return this.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",i.correlationId),w(this.acquireTokenBySilentIframe.bind(this),T.AcquireTokenBySilentIframe,this.logger,this.performanceClient,i.correlationId)(i);else{let d;return this.activeIframeRequest=[new Promise(h=>{d=h}),i.correlationId],this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",i.correlationId),w(this.acquireTokenBySilentIframe.bind(this),T.AcquireTokenBySilentIframe,this.logger,this.performanceClient,i.correlationId)(i).then(h=>(d(!0),h)).catch(h=>{throw d(!1),h}).finally(()=>{this.activeIframeRequest=void 0})}else throw c}).then(c=>(this.eventHandler.emitEvent(U.ACQUIRE_TOKEN_SUCCESS,N.Silent,c),e.correlationId&&this.performanceClient.addFields({fromCache:c.fromCache,isNativeBroker:c.fromNativeBroker},e.correlationId),c)).catch(c=>{throw this.eventHandler.emitEvent(U.ACQUIRE_TOKEN_FAILURE,N.Silent,null,c),c}).finally(()=>{document.removeEventListener("visibilitychange",o)})}async acquireTokenSilentNoIframe(e,t){return xe.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),this.acquireTokenNative(e,Q.acquireTokenSilent_silentFlow).catch(async o=>{throw o instanceof Ne&&dt(o)?(this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.nativeExtensionProvider=void 0,S(Fe)):o})):(this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),w(this.acquireTokenFromCache.bind(this),T.AcquireTokenFromCache,this.logger,this.performanceClient,e.correlationId)(e,t).catch(o=>{if(t===Te.AccessToken)throw o;return this.eventHandler.emitEvent(U.ACQUIRE_TOKEN_NETWORK_START,N.Silent,e),w(this.acquireTokenByRefreshToken.bind(this),T.AcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,t)}))}}function aE(n,e){const t=!(n instanceof Ae&&n.subError!==Un),o=n.errorCode===ve.INVALID_GRANT_ERROR||n.errorCode===Fe,i=t&&o||n.errorCode===In||n.errorCode===di,a=qv.includes(e);return i&&a}/*! @azure/msal-browser v3.30.0 2025-08-05 */async function lE(n,e){const t=new tt(n);return await t.initialize(),Gn.createController(t,e)}/*! @azure/msal-browser v3.30.0 2025-08-05 */class Mi{static async createPublicClientApplication(e){const t=await lE(e);return new Mi(e,t)}constructor(e,t){this.controller=t||new Gn(new tt(e))}async initialize(e){return this.controller.initialize(e)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/let an=null;async function cE(){return an||(an=await hc(),an)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/let Gt=!1,ue=null;const Lo={USER_READ:"User.Read",FILES_READ_ALL:"Files.Read.All"},dE={LOGIN:{scopes:[Lo.USER_READ,Lo.FILES_READ_ALL]}},Ns={ME:"https://graph.microsoft.com/v1.0/me",PHOTO:"https://graph.microsoft.com/v1.0/me/photo/$value"};async function uE(){const n=await cE();if(Gt=!!(n.clientId&&n.tenantId),!Gt){console.warn("MSAL configuration not found or incomplete from backend. Microsoft login will be disabled.");return}const e={auth:{clientId:n.clientId,authority:`https://login.microsoftonline.com/${n.tenantId}`,redirectUri:window.location.origin},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!1}};ue=new Mi(e),await ue.initialize(),ue.addEventCallback(t=>{if(t.eventType===U.LOGIN_SUCCESS&&t.payload.account){const o=t.payload.account;ue?.setActiveAccount(o)}})}function hE(){if(!ue)throw console.error("MSAL is not initialized. Check your environment variables."),new Error("MSAL not initialized.");ue.loginRedirect(dE.LOGIN)}function fE(){if(!ue)return;const n=qn();n&&ue.logoutRedirect({account:n})}function qn(){return ue?ue.getActiveAccount():null}async function gE(){if(!ue)return null;const n=await ue.handleRedirectPromise();return n?n.account:qn()}async function tc(n){if(!ue)throw new Error("MSAL not initialized.");const e=qn();if(!e)throw new Error("No active account.");const t={scopes:n,account:e};try{return(await ue.acquireTokenSilent(t)).accessToken}catch(o){if(o instanceof Ae){console.warn("Silent token acquisition failed. Trying popup.");try{const i=await ue.acquireTokenPopup(t);return ue.setActiveAccount(i.account),i.accessToken}catch(i){return console.error("Popup token acquisition failed.",i),Y("Could not get permission to access your files.","error"),null}}else return console.error("Token acquisition failed with an unexpected error.",o),Y("An error occurred while authenticating.","error"),null}}async function pE(){const n=await tc([Lo.USER_READ]);if(!n)throw new Error("Could not acquire token for Graph profile.");const e=await fetch(Ns.ME,{headers:{Authorization:`Bearer ${n}`}});if(!e.ok)throw new Error("Failed to fetch Graph profile.");const t=await e.json();let o="";try{const i=await fetch(Ns.PHOTO,{headers:{Authorization:`Bearer ${n}`}});if(i.ok){const a=await i.blob();o=URL.createObjectURL(a)}}catch(i){console.warn("Could not fetch user photo from Graph.",i)}return{firstName:t.givenName||"",lastName:t.surname||"",email:t.userPrincipalName||"",avatarUrl:o}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const mE="https://graph.microsoft.com/v1.0",CE={FILES_READ_ALL:"Files.Read.All"};async function Pi(n){const e=await tc([CE.FILES_READ_ALL]);if(!e)throw new Error("Authentication failed. Could not get access token for Microsoft Graph.");const t=await fetch(`${mE}${n}`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok){const o=await t.json();throw console.error("Graph API Error:",o),new Error(`Graph API request failed: ${o.error?.message||t.statusText}`)}return t}async function yE(){return(await(await Pi("/sites?search=*")).json()).value.map(t=>({id:t.id,name:t.displayName,url:t.webUrl}))}async function TE(n,e="root"){return(await(await Pi(`/sites/${n}/drive/items/${e}/children?$select=id,name,webUrl,file,folder,size`)).json()).value.map(i=>({id:i.id,name:i.name,isFolder:!!i.folder,size:i.size,mimeType:i.file?.mimeType}))}async function vE(n,e){const o=await(await Pi(`/sites/${n}/drive/items/${e}/content`)).blob();return _n(new File([o],"temp"))}async function nc(n,e,t,o,i){const a=await vE(n,e);return{name:t,type:o,size:i,uploadDate:new Date().toISOString(),base64Content:a}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const Vn=n=>{const e=document.documentElement;e.style.setProperty("--user-message-bg",n.userBg),e.style.setProperty("--user-message-text",n.userText),e.style.setProperty("--bot-message-bg",n.botBg),e.style.setProperty("--bot-message-text",n.botText),e.style.setProperty("--bg-gradient-start",n.bgGradientStart),e.style.setProperty("--bg-gradient-end",n.bgGradientEnd),e.style.setProperty("--sidebar-bg",n.sidebarBg),e.style.setProperty("--sidebar-text",n.sidebarText),e.style.setProperty("--sidebar-highlight-bg",n.sidebarHighlightBg)},oc=n=>{Vn(n.theme)},Do=(n,e,t)=>{e&&(e.style.setProperty("--preview-bg-start",n.bgGradientStart),e.style.setProperty("--preview-bg-end",n.bgGradientEnd),e.style.setProperty("--preview-user-bg",n.userBg),e.style.setProperty("--preview-user-text",n.userText),e.style.setProperty("--preview-bot-bg",n.botBg),e.style.setProperty("--preview-bot-text",n.botText),t&&(t.style.setProperty("--preview-sidebar-bg",n.sidebarBg),t.style.setProperty("--preview-sidebar-text",n.sidebarText),t.style.setProperty("--preview-sidebar-highlight-bg",n.sidebarHighlightBg)))},Uo=n=>{ge(),g.textElements.brandingPreviewTitle&&(g.textElements.brandingPreviewTitle.textContent=n.loginTitle),g.textElements.brandingPreviewSubtitle&&(g.textElements.brandingPreviewSubtitle.textContent=n.loginSubtitle),g.previews.brandingLogo&&(g.previews.brandingLogo.innerHTML=n.appLogo?`<img src="${n.appLogo}" alt="App Logo Preview">`:"")},IE=n=>n.startsWith("image/")?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>':n==="application/pdf"?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><path d="M10 12v-1h4v1"></path><path d="M10 15h4"></path><path d="M14 18h-4"></path></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>',xs=(n,e)=>{const t=document.createElement("div");if(t.setAttribute("role","button"),t.tabIndex=0,t.dataset.containerId=n.id,e){t.className="management-card",t.innerHTML=`
            <div class="management-card-bg"></div>
            <div class="management-card-overlay">
                <h3 class="management-card-title">${n.name}</h3>
                <p class="management-card-description">${n.description}</p>
            </div>
        `;const o=t.querySelector(".management-card-bg");o&&(o.style.backgroundImage=`url(${n.cardImageUrl})`)}else t.className="container-card",t.innerHTML=`
            <div class="container-icon">${n.icon.startsWith("<svg")?n.icon:`<img src="${n.icon}" alt="${n.name} icon">`}</div>
            <h3 class="container-title">${n.name}</h3>
            <p class="container-description">${n.description}</p>
        `;return t.addEventListener("keydown",o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),t.click())}),t},EE=()=>{ge();const{branding:n}=C;if(document.title=n.hubHeaderTitle,g.textElements.hubHeaderTitle&&(g.textElements.hubHeaderTitle.textContent=n.hubHeaderTitle),g.containers.hubAppLogo){const e=n.appLogo?`<img src="${n.appLogo}" alt="App Logo">`:Je[0].icon;g.containers.hubAppLogo.innerHTML=e}},Kn=()=>{const n=C.currentUser,e=document.getElementById("header-user-name"),t=document.getElementById("header-user-avatar"),o=document.getElementById("dropdown-user-name"),i=document.getElementById("dropdown-user-email");n&&(e&&(e.textContent=n.firstName),t&&(t.innerHTML=n.avatarUrl?`<img src="${n.avatarUrl}" alt="${n.firstName}'s avatar" class="user-avatar-img">`:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>'),o&&(o.textContent=`${n.firstName} ${n.lastName}`),i&&(i.textContent=n.email))},ic=(n=!1)=>{if(!C.currentSettingsContainerId||!C.draftSettingsContainer)return;const e=C.containers.find(o=>o.id===C.currentSettingsContainerId);if(!e)return;const t=JSON.stringify(e)!==JSON.stringify(C.draftSettingsContainer);g.buttons.saveSettings&&(g.buttons.saveSettings.disabled=!t||n)},Qe=(n=!1)=>{if(!C.draftBranding||!C.draftAvailableModels)return;const e=JSON.stringify(C.branding)!==JSON.stringify(C.draftBranding),t=JSON.stringify(C.availableModels)!==JSON.stringify(C.draftAvailableModels),o=e||t;g.buttons.saveGlobalSettings&&(g.buttons.saveGlobalSettings.disabled=!o||n)},SE=async n=>{try{const e=await fetch("src/modals/function-runner.html");if(!e.ok)throw new Error("Could not load modal content.");const t=await e.text();if(g.modals.functionRunner&&(g.modals.functionRunner.innerHTML=t),ge(),!g.modals.functionRunner||!g.textElements.functionRunnerTitle||!g.containers.functionRunnerBody||!g.forms.functionRunner)return;C.currentRunningFunction=n,g.textElements.functionRunnerTitle.textContent=n.name,g.containers.functionRunnerBody.innerHTML="",n.parameters.forEach(o=>{const i=document.createElement("div");i.className="form-group";const a=document.createElement("label");a.htmlFor=`param-${o.name.replace(/\s+/g,"-")}`,a.className="form-label",a.textContent=o.name;let l;o.type==="textarea"?(l=document.createElement("textarea"),l.rows=4):(l=document.createElement("input"),l.type=o.type==="number"?"number":"text"),l.id=`param-${o.name.replace(/\s+/g,"-")}`,l.name=o.name,l.className="form-input",l.placeholder=o.description,l.required=!0;const c=document.createElement("p");c.className="form-help-text",c.textContent=o.description,i.appendChild(a),i.appendChild(l),i.appendChild(c),g.containers.functionRunnerBody.appendChild(i)}),g.modals.functionRunner.classList.remove("hidden")}catch(e){console.error("Failed to open function runner modal:",e),Y("Error opening app.","error")}},AE={hub:()=>qt(),containerManagement:()=>qt(),department:n=>{const e=C.containers.find(t=>t.name===n&&t.id===C.currentContainerId);e&&(g.textElements.containerPageTitle&&(g.textElements.containerPageTitle.textContent=e.name),g.textElements.sidebarContainerTitle&&(g.textElements.sidebarContainerTitle.textContent=e.name),rc(),Wt(e.id),$n(e.id))},settingsDetail:n=>{g.textElements.settingsDetailTitle&&(g.textElements.settingsDetailTitle.textContent=n)},knowledge:()=>{}},j=async(n,e)=>{const t=e||(n.charAt(0).toUpperCase()+n.slice(1)).replace(/([A-Z])/g," $1").trim();document.title=`${C.branding.hubHeaderTitle} - ${t}`;let o=n;n==="department"?o="container-page":o=n.replace(/[A-Z]/g,i=>`-${i.toLowerCase()}`);try{const i=await fetch(`src/pages/${o}.html`);if(!i.ok)throw new Error(`Page not found: ${o}.html`);const a=await i.text(),l=document.getElementById("app-root");l&&(l.innerHTML=a),ge(),EE(),Kn(),(n==="globalSettings"||n==="settingsDetail"||n==="department")&&wE();const c=AE[n];c&&c(e)}catch(i){console.error("Error loading page:",i);const a=document.getElementById("app-root");a&&(a.innerHTML='<div class="page-view"><h2>Error</h2><p>Could not load page content.</p></div>')}},Y=(n,e="success")=>{g.containers.toast&&(g.containers.toast.textContent=n,g.containers.toast.className="toast",g.containers.toast.classList.add(e),g.containers.toast.classList.add("show"),setTimeout(()=>{g.containers.toast?.classList.remove("show")},3e3))},pe=n=>{n&&(n.classList.add("hidden"),n.innerHTML="")},ln=(n,e,t,o)=>{!n||!e||!t||(n.addEventListener("click",()=>e.click()),e.addEventListener("change",async()=>{if(e.files&&e.files[0])try{const i=await _n(e.files[0]);t.src=i,t.classList.contains("hidden")&&t.classList.remove("hidden"),o(i)}catch(i){console.error("Error converting file to base64",i),Y("Error uploading image.","error")}}))};function wE(){g.buttons.addCustomIcon&&ln(g.buttons.addCustomIcon,g.inputs.addCustomIconUpload,g.previews.addCustomIcon,()=>{}),g.buttons.editCustomIcon&&ln(g.buttons.editCustomIcon,g.inputs.editCustomIconUpload,g.previews.editCustomIcon,n=>{C.draftSettingsContainer&&(C.draftSettingsContainer.icon=n,ae())}),g.buttons.editCardImage&&ln(g.buttons.editCardImage,g.inputs.editCardImageUpload,g.previews.editCardImage,n=>{C.draftSettingsContainer&&(C.draftSettingsContainer.cardImageUrl=n,ae())}),g.buttons.editGlobalLogo&&ln(g.buttons.editGlobalLogo,g.inputs.editGlobalLogoUpload,g.previews.brandingLogo?.querySelector("img")||new Image,n=>{C.draftBranding&&(C.draftBranding.appLogo=n,Uo(C.draftBranding),Qe())})}const Lt=(n,e,t=!1)=>{const o=document.getElementById("chat-messages");if(!o)return null;const i=document.getElementById("chat-welcome");i&&!i.classList.contains("hidden")&&i.classList.add("hidden");const a=document.createElement("div");if(a.className=`chat-message ${e}-message`,t)a.classList.add("thinking"),a.id="thinking-indicator",a.innerHTML='<div class="dot"></div><div class="dot"></div><div class="dot"></div>';else{let l="";if(n.forEach(c=>{"text"in c&&typeof c.text=="string"&&(a.innerHTML+=Us(c.text),l+=c.text)}),l.length>0&&e==="bot"){const c=document.createElement("button");c.className="copy-btn",c.setAttribute("aria-label","Copy message"),c.innerHTML='<svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',c.addEventListener("click",()=>{navigator.clipboard.writeText(l).then(()=>{c.classList.add("copied"),setTimeout(()=>c.classList.remove("copied"),1500)})}),a.appendChild(c)}}return o.appendChild(a),o.scrollTop=o.scrollHeight,a},$n=n=>{const e=document.getElementById("chat-messages"),t=document.getElementById("chat-welcome");if(!e||!t)return;e.innerHTML="";const o=C.containers.find(l=>l.id===n);if(!o)return;const i=o.chats.find(l=>l.id===o.activeChatId),a=i?i.history:[];if(a.length===0){const l=document.getElementById("welcome-icon");l&&(l.innerHTML=o.icon.startsWith("<svg")?o.icon:`<img src="${o.icon}" alt="${o.name} icon">`);const c=document.getElementById("welcome-title");c&&(c.textContent=`Welcome to ${o.name}`);const u=document.getElementById("welcome-questions");u&&(u.innerHTML='<div><div class="spinner"></div></div>',Oy(o.knowledgeBase).then(d=>{const h=(d.length>0?d:o.quickQuestions).slice(0,4);u&&(u.innerHTML="",h.forEach(f=>{const p=document.createElement("button");p.className="quick-question",p.textContent=f,u.appendChild(p)}))})),t.classList.remove("hidden")}else t.classList.add("hidden"),a.forEach(l=>Lt(l.parts,l.role==="model"?"bot":"user"))},rc=()=>{const n=C.containers.find(o=>o.id===C.currentContainerId);if(!n||!g.containers.modelSelect||!g.containers.personaSelect)return;const e=C.availableModels.find(o=>o.id===n.selectedModel)||C.availableModels[0];g.containers.modelSelect.innerHTML=`
        <button class="select-trigger" aria-haspopup="listbox" aria-expanded="false">
            ${e.icon}
            <span>${e.id}</span>
        </button>
        <div class="select-options hidden" role="listbox">
            ${n.availableModels.map(o=>{const i=C.availableModels.find(a=>a.id===o);return i?`<div class="select-option ${o===n.selectedModel?"selected":""}" role="option" data-value="${i.id}">${i.icon} <span>${i.id}</span></div>`:""}).join("")}
        </div>
    `;const t='<svg class="select-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>';g.containers.personaSelect.innerHTML=`
        <button class="select-trigger" aria-haspopup="listbox" aria-expanded="false">
            ${t}
            <span>${n.selectedPersona}</span>
        </button>
        <div class="select-options hidden" role="listbox">
            ${n.availablePersonas.map(o=>`
                <div class="select-option ${o===n.selectedPersona?"selected":""}" role="option" data-value="${o}">${t} <span>${o}</span></div>
            `).join("")}
        </div>
    `},sc=()=>{if(!C.draftNewContainer)return;const n=document.getElementById("suggested-questions-list"),e=document.getElementById("suggested-personas-list"),t=document.getElementById("suggested-apps-list"),o=document.querySelector("#add-container-theme-preview .appearance-preview"),i=document.getElementById("container-desc-input"),a=document.getElementById("container-icon-selector"),l=C.draftNewContainer;if(i&&(i.value=l.description),a){const u=[...a.querySelectorAll("button")].find(d=>d.innerHTML===l.icon);u&&(a.querySelector(".selected")?.classList.remove("selected"),u.classList.add("selected"))}o&&Do(l.theme,o,null);const c=(u,d,h)=>{u&&(u.innerHTML="",d.forEach(f=>{const p=document.createElement("li");p.className="suggested-item",p.innerHTML=`<span>${f}</span><button type="button" aria-label="Remove this ${h}" data-item-type="${h}" data-item-value="${f}">&times;</button>`,u.appendChild(p)}))};c(n,l.quickQuestions,"question"),c(e,l.availablePersonas,"persona"),t&&(t.innerHTML="",l.functions.forEach(u=>{const d=document.createElement("li");d.className="suggested-item",d.innerHTML=`${u.icon} <span>${u.name}</span> <button type="button" aria-label="Remove this app" data-item-type="function" data-item-value="${u.name}">&times;</button>`,t?.appendChild(d)}))},bi=n=>({sharepoint:{name:"SharePoint",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="color: #0072C6;"><path d="M14.3,3.2H4.5C3.7,3.2,3,3.9,3,4.7v14.6C3,20.1,3.7,20.8,4.5,20.8h14.9c0.8,0,1.5-0.7,1.5-1.5V8.5L14.3,3.2z M17.2,17.2H6.8V6.8h6.9v3.6h3.6V17.2z"/></svg>'},brevo:{name:"Brevo",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="color: #009DFF;"><path d="M12,2C6.477,2,2,6.477,2,12s4.477,10,10,10s10-4.477,10-10S17.523,2,12,2z M15.6,15.6L12,12l3.6-3.6l-1.4-1.4L9.2,12l4.2,4.2L15.6,15.6z"/></svg>'},hubspot:{name:"HubSpot",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="color: #FF7A59;"><path d="M12.9,2.4c-0.2-0.2-0.5-0.2-0.7,0L3.7,10.9c-0.2,0.2-0.2,0.5,0,0.7l8.5,8.5c0.2,0.2,0.5,0.2,0.7,0l8.5-8.5c0.2-0.2,0.2-0.5,0-0.7L12.9,2.4z M12,16.5c-2.5,0-4.5-2,4.5-4.5s2-4.5,4.5-4.5s4.5,2,4.5,4.5S14.5,16.5,12,16.5z"/></svg>'},docusign:{name:"DocuSign",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="color: #FFC425;"><path d="M19,3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V5C21,3.9,20.1,3,19,3z M15,15H9v-2h6V15z M17,11H7V9h10V11z"/></svg>'},outlook:{name:"Outlook",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="color: #0078D4;"><path d="M21,4H3C1.9,4,1,4.9,1,6v12c0,1.1,0.9,2,2,2h18c1.1,0,2-0.9,2-2V6C23,4.9,22.1,4,21,4z M12,13.5L3.5,8H20.5L12,13.5z M3,6h1V7l8,5l8-5V6h1v12H3V6z"/></svg>'}})[n]||{name:n,icon:""},Wt=n=>{ge();const e=C.containers.find(t=>t.id===n);if(e){if(g.containers.sidebarKnowledgeLink?.parentElement&&g.containers.sidebarKnowledgeLink.parentElement.classList.toggle("hidden",!e.isKnowledgeBasePublic),g.containers.sidebarAppsSection){g.containers.sidebarAppsSection.innerHTML="";const t=e.functions.filter(o=>o.enabled);if(t.length>0){const o=document.createElement("h3");o.className="sidebar-section-title",o.textContent="Apps",g.containers.sidebarAppsSection.appendChild(o);const i=document.createElement("ul");t.forEach(a=>{const l=document.createElement("li"),c=document.createElement("button");c.className="sidebar-link",c.innerHTML=`${a.icon}<span>${a.name}</span>`,c.onclick=async u=>{u.preventDefault(),await SE(a)},l.appendChild(c),i.appendChild(l)}),g.containers.sidebarAppsSection.appendChild(i)}}if(g.containers.sidebarIntegrationsSection){g.containers.sidebarIntegrationsSection.innerHTML="";const t=e.enabledIntegrations;if(t.length>0){const o=document.createElement("h3");o.className="sidebar-section-title",o.textContent="Integrations",g.containers.sidebarIntegrationsSection.appendChild(o);const i=document.createElement("ul");t.forEach(a=>{const l=bi(a),c=document.createElement("li"),u=document.createElement("a");u.href="#",u.className="sidebar-link",u.innerHTML=`${l.icon}<span>${l.name}</span>`,c.appendChild(u),i.appendChild(c)}),g.containers.sidebarIntegrationsSection.appendChild(i)}}g.containers.sidebarHistoryList&&(g.containers.sidebarHistoryList.innerHTML="",[...e.chats].reverse().forEach(t=>{const o=document.createElement("li");o.innerHTML=`
                <button class="sidebar-link ${t.id===e.activeChatId?"active":""}" data-chat-id="${t.id}">
                    <span>${t.name}</span>
                </button>
                <button class="delete-chat-btn" data-chat-id="${t.id}" aria-label="Delete chat: ${t.name}">&times;</button>
            `,g.containers.sidebarHistoryList?.appendChild(o)}))}},qt=()=>{ge();const n=document.getElementById("container-grid");n&&(n.innerHTML="",C.containers.forEach(t=>{n.appendChild(xs(t,!1))}));const e=document.getElementById("container-management-grid");e&&(e.innerHTML="",C.containers.forEach(t=>{e.appendChild(xs(t,!0))}))},ac=()=>{ge();const{branding:n}=C;if(document.title=n.hubHeaderTitle,g.textElements.loginTitle&&(g.textElements.loginTitle.textContent=n.loginTitle),g.textElements.loginSubtitle&&(g.textElements.loginSubtitle.textContent=n.loginSubtitle),g.buttons.googleLogin&&(g.buttons.googleLogin.style.display=n.enableGoogleLogin?"flex":"none"),g.buttons.microsoftLogin){const t=n.enableMicrosoftLogin&&Gt;g.buttons.microsoftLogin.style.display=t?"flex":"none"}g.textElements.hubHeaderTitle&&(g.textElements.hubHeaderTitle.textContent=n.hubHeaderTitle),g.textElements.hubTitle&&(g.textElements.hubTitle.textContent=n.hubTitle),g.textElements.hubSubtitle&&(g.textElements.hubSubtitle.textContent=n.hubSubtitle);const e=n.appLogo?`<img src="${n.appLogo}" alt="App Logo">`:Je[0].icon;if(g.containers.loginAppLogo&&(g.containers.loginAppLogo.innerHTML=e),g.containers.hubAppLogo&&(g.containers.hubAppLogo.innerHTML=e),g.containers.cookieBanner){const t=localStorage.getItem("cookiesAccepted")==="true";g.containers.cookieBanner.classList.toggle("hidden",!n.enableCookieBanner||t)}g.textElements.privacyPolicyLink&&(n.privacyPolicyUrl?(g.textElements.privacyPolicyLink.href=n.privacyPolicyUrl,g.textElements.privacyPolicyLink.parentElement?.classList.remove("hidden")):g.textElements.privacyPolicyLink.parentElement?.classList.add("hidden"))},Vt=()=>{ge();const n=document.getElementById("knowledge-file-list");if(!n)return;const e=C.containers.find(t=>t.id===C.currentContainerId);if(!e){n.innerHTML="<p>No container selected.</p>";return}if(g.textElements.knowledgeSubtitle&&(g.textElements.knowledgeSubtitle.textContent=e.isKnowledgeBasePublic?"These files are used to ground the assistant and are available for all users to view and upload.":"These files are used to ground the assistant and are private to this container."),n.innerHTML="",e.knowledgeBase.length===0){n.innerHTML="<div>No files uploaded yet.</div>";return}e.knowledgeBase.forEach(t=>{const o=document.createElement("div");o.className="knowledge-file-item",o.innerHTML=`
            <div class="file-icon">${IE(t.type)}</div>
            <div class="file-details">
                <span class="file-name">${t.name}</span>
                <div class="file-meta">
                    <span>Uploaded: ${pc(t.uploadDate)}</span>
                    <span>Size: ${Os(t.size)}</span>
                </div>
            </div>
            <button class="delete-file-btn" aria-label="Delete file ${t.name}">&times;</button>
        `,o.querySelector(".delete-file-btn")?.addEventListener("click",i=>{i.stopPropagation(),C.currentContainerId&&OE(C.currentContainerId,t.name)}),n.appendChild(o)})},Zn=(n,e,t)=>{n&&(n.innerHTML="",e.forEach(o=>{const i=document.createElement("li");i.className="managed-list-item",i.innerHTML=`
            <span>${o}</span>
            <button type="button" class="delete-item-btn" aria-label="Delete ${o}">&times;</button>
        `,i.querySelector(".delete-item-btn")?.addEventListener("click",()=>t(o)),n.appendChild(i)}))},Oe=n=>{ge();const e=C.containers.find(i=>i.id===n);if(!e)return;C.currentSettingsContainerId=n,C.draftSettingsContainer=JSON.parse(JSON.stringify(e));const t=C.draftSettingsContainer;if(g.inputs.editContainerName&&(g.inputs.editContainerName.value=t.name,g.inputs.editContainerName.addEventListener("input",i=>{if(C.draftSettingsContainer){const a=i.target.value;C.draftSettingsContainer.name=a,g.textElements.settingsDetailTitle&&(g.textElements.settingsDetailTitle.textContent=`Edit ${a}`),ae()}})),g.inputs.editContainerDesc&&(g.inputs.editContainerDesc.value=t.description),g.containers.editContainerIconSelector&&(g.containers.editContainerIconSelector.innerHTML="",uc.forEach(i=>{const a=document.createElement("button");a.type="button",a.className=`icon-option ${t.icon===i?"selected":""}`,a.innerHTML=i,a.addEventListener("click",()=>{g.containers.editContainerIconSelector?.querySelector(".selected")?.classList.remove("selected"),a.classList.add("selected"),g.previews.editCustomIcon&&(g.previews.editCustomIcon.src="",g.previews.editCustomIcon.classList.add("hidden")),t.icon=i,ae()}),g.containers.editContainerIconSelector.appendChild(a)})),g.previews.editCustomIcon){const i=t.icon.startsWith("data:image");g.previews.editCustomIcon.src=i?t.icon:"",g.previews.editCustomIcon.classList.toggle("hidden",!i)}if(g.containers.cardImageOptionsList&&(g.containers.cardImageOptionsList.className="image-selector-grid",g.containers.cardImageOptionsList.innerHTML="",oo.forEach(i=>{const a=document.createElement("div");a.className=`icon-option ${t.cardImageUrl===i.url?"selected":""}`,a.innerHTML=`<img src="${i.url}" alt="${i.description}">`,a.addEventListener("click",()=>{g.containers.cardImageOptionsList?.querySelector(".selected")?.classList.remove("selected"),a.classList.add("selected"),g.previews.editCardImage&&(g.previews.editCardImage.src="",g.previews.editCardImage.classList.add("hidden")),t.cardImageUrl=i.url,ae()}),g.containers.cardImageOptionsList.appendChild(a)})),g.previews.editCardImage){const i=oo.some(a=>a.url===t.cardImageUrl);g.previews.editCardImage.src=i?"":t.cardImageUrl,g.previews.editCardImage.classList.toggle("hidden",i||!t.cardImageUrl)}g.inputs.isKnowledgePublic&&(g.inputs.isKnowledgePublic.checked=t.isKnowledgeBasePublic),Zn(g.containers.quickQuestionsList,t.quickQuestions,VE),Zn(g.containers.personasList,t.availablePersonas,KE),Zn(g.containers.accessControlList,t.accessControl,$E),g.containers.availableModelsList&&(g.containers.availableModelsList.innerHTML="",C.availableModels.forEach(i=>{const a=document.createElement("label"),l=t.availableModels.includes(i.id);a.innerHTML=`
                <input type="checkbox" ${l?"checked":""}>
                ${i.icon}
                <span>${i.id}</span>
            `,a.querySelector("input")?.addEventListener("change",c=>{c.target.checked?t.availableModels.push(i.id):t.availableModels=t.availableModels.filter(u=>u!==i.id),ae()}),g.containers.availableModelsList.appendChild(a)})),[{input:g.inputs.userBgColor,key:"userBg"},{input:g.inputs.userTextColor,key:"userText"},{input:g.inputs.botBgColor,key:"botBg"},{input:g.inputs.botTextColor,key:"botText"},{input:g.inputs.bgGradientStartColor,key:"bgGradientStart"},{input:g.inputs.bgGradientEndColor,key:"bgGradientEnd"},{input:g.inputs.sidebarBgColor,key:"sidebarBg"},{input:g.inputs.sidebarTextColor,key:"sidebarText"},{input:g.inputs.sidebarHighlightBgColor,key:"sidebarHighlightBg"}].forEach(({input:i,key:a})=>{i&&(i.value=t.theme[a],i.addEventListener("input",l=>{t.theme[a]=l.target.value,Do(t.theme,g.containers.appearancePreview,g.containers.sidebarPreview),ae()}))}),Do(t.theme,g.containers.appearancePreview,g.containers.sidebarPreview),g.containers.containerIntegrationsList&&(g.containers.containerIntegrationsList.innerHTML="",Object.entries(C.branding.integrations).forEach(([i,a])=>{if(!a)return;const l=bi(i),c=t.enabledIntegrations.includes(i),u=document.createElement("div");u.className="form-group-row",u.innerHTML=`
                 <div style="display: flex; align-items: center; gap: 1rem;">
                    ${l.icon}
                    <label for="int-toggle-${i}" class="toggle-switch-label">${l.name}</label>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="int-toggle-${i}" ${c?"checked":""}>
                  <span class="slider"></span>
                </label>
            `,u.querySelector("input")?.addEventListener("change",d=>{d.target.checked?t.enabledIntegrations.push(i):t.enabledIntegrations=t.enabledIntegrations.filter(h=>h!==i),ae()}),g.containers.containerIntegrationsList.appendChild(u)})),g.containers.functionsList&&(g.containers.functionsList.innerHTML="",t.functions.forEach(i=>{const a=document.createElement("li");a.className="managed-list-item function-item",a.innerHTML=`
                <div class="function-item-icon">${i.icon}</div>
                <div class="function-item-details">
                    <strong>${i.name}</strong>
                    <p>${i.description}</p>
                </div>
                <div class="function-controls">
                    <label class="toggle-switch">
                      <input type="checkbox" ${i.enabled?"checked":""}>
                      <span class="slider"></span>
                    </label>
                    <button type="button" class="delete-func-btn" aria-label="Delete function">&times;</button>
                </div>
            `,a.querySelector('input[type="checkbox"]')?.addEventListener("change",l=>{const c=t.functions.find(u=>u.id===i.id);c&&(c.enabled=l.target.checked),ae()}),a.querySelector(".delete-func-btn")?.addEventListener("click",()=>JE(i.id)),g.containers.functionsList?.appendChild(a)})),ic(!0)},jn=n=>{ge(),g.inputs.editLoginTitle&&(g.inputs.editLoginTitle.value=n.loginTitle),g.inputs.editLoginSubtitle&&(g.inputs.editLoginSubtitle.value=n.loginSubtitle),g.inputs.editHubHeaderTitle&&(g.inputs.editHubHeaderTitle.value=n.hubHeaderTitle),g.inputs.editHubTitle&&(g.inputs.editHubTitle.value=n.hubTitle),g.inputs.editHubSubtitle&&(g.inputs.editHubSubtitle.value=n.hubSubtitle),g.inputs.enableGoogleLogin&&(g.inputs.enableGoogleLogin.checked=n.enableGoogleLogin),g.inputs.googleClientId&&(g.inputs.googleClientId.value=n.googleClientId),g.inputs.googleClientSecret&&(g.inputs.googleClientSecret.value=n.googleClientSecret),g.inputs.enableMicrosoftLogin&&(g.inputs.enableMicrosoftLogin.checked=n.enableMicrosoftLogin),g.inputs.microsoftClientId&&(g.inputs.microsoftClientId.value=n.microsoftClientId),g.inputs.microsoftClientSecret&&(g.inputs.microsoftClientSecret.value=n.microsoftClientSecret),g.inputs.enableCookieBanner&&(g.inputs.enableCookieBanner.checked=n.enableCookieBanner),g.inputs.privacyPolicyUrl&&(g.inputs.privacyPolicyUrl.value=n.privacyPolicyUrl);const e=(t,o)=>{if(!t)return;const i=t instanceof HTMLInputElement&&t.type==="checkbox"?"change":"input",a=l=>{if(!C.draftBranding)return;const c=l.target,u=c.type==="checkbox"?c.checked:c.value;if(o.startsWith("integrations.")){const d=o.split(".")[1];C.draftBranding.integrations[d]=u}else C.draftBranding[o]=u;Uo(C.draftBranding),Qe()};t.removeEventListener(i,t._handler),t._handler=a,t.addEventListener(i,a)};e(g.inputs.editLoginTitle,"loginTitle"),e(g.inputs.editLoginSubtitle,"loginSubtitle"),e(g.inputs.editHubHeaderTitle,"hubHeaderTitle"),e(g.inputs.editHubTitle,"hubTitle"),e(g.inputs.editHubSubtitle,"hubSubtitle"),e(g.inputs.enableGoogleLogin,"enableGoogleLogin"),e(g.inputs.googleClientId,"googleClientId"),e(g.inputs.googleClientSecret,"googleClientSecret"),e(g.inputs.enableMicrosoftLogin,"enableMicrosoftLogin"),e(g.inputs.microsoftClientId,"microsoftClientId"),e(g.inputs.microsoftClientSecret,"microsoftClientSecret"),e(g.inputs.enableCookieBanner,"enableCookieBanner"),e(g.inputs.privacyPolicyUrl,"privacyPolicyUrl"),g.containers.integrationsGrid&&(g.containers.integrationsGrid.innerHTML="",Object.keys(n.integrations).forEach(t=>{const o=t,i=bi(o),a=document.createElement("div");a.className="integration-card",a.innerHTML=`
                <div class="integration-icon">${i.icon}</div>
                <span class="integration-name">${i.name}</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="global-int-${o}" ${n.integrations[o]?"checked":""}>
                    <span class="slider"></span>
                </label>
            `;const l=a.querySelector("input");e(l,`integrations.${o}`),g.containers.integrationsGrid?.appendChild(a)})),Uo(n)},An=()=>{ge(),!(!g.containers.modelManagementList||!C.draftAvailableModels)&&(g.containers.modelManagementList.innerHTML="",C.draftAvailableModels.forEach(n=>{const e=document.createElement("li");e.className="managed-list-item",e.innerHTML=`
            <div class="model-management-item-icon">${n.icon}</div>
            <span>${n.id}</span>
            <button class="delete-item-btn" aria-label="Delete ${n.id}">&times;</button>
        `,e.querySelector(".delete-item-btn")?.addEventListener("click",()=>eS(n.id)),g.containers.modelManagementList?.appendChild(e)}))};async function Ls(n){if(!g.modals.sharepointPicker)return;const e={folder:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>',file:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>',site:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>'};try{const t=await fetch("src/modals/sharepoint-picker.html");if(!t.ok)throw new Error("Could not load SharePoint picker modal.");g.modals.sharepointPicker.innerHTML=await t.text(),g.modals.sharepointPicker.classList.remove("hidden");const o=g.modals.sharepointPicker,i=o.querySelector("#sp-breadcrumbs"),a=o.querySelector("#sp-file-list"),l=o.querySelector("#sp-loading-spinner"),c=o.querySelector("#sp-add-btn"),u=o.querySelector("#sp-cancel-btn"),d=o.querySelector(".modal-close-btn"),h=c.querySelector(".btn-text");let f=null,p=[],m=[];const v=_=>{l.classList.toggle("hidden",!_),_&&(a.innerHTML="")},y=_=>{v(!1),a.innerHTML=`<li class="sp-message-item">${_}</li>`},E=()=>{c.disabled=m.length===0,h&&(h.textContent=m.length>0?`Add Selected (${m.length})`:"Add Selected")},A=(_,H)=>{n.mode==="single"?(a.querySelectorAll('input[type="checkbox"]').forEach(D=>{D!==H&&(D.checked=!1)}),m=H.checked?[_]:[]):H.checked?m.some(D=>D.id===_.id)||m.push(_):m=m.filter(D=>D.id!==_.id),E()},R=()=>{i.innerHTML="";const _=document.createElement("button");_.className="sp-breadcrumb-item",_.textContent="Sites",_.onclick=()=>L(),i.appendChild(_),p.forEach((H,D)=>{const F=document.createElement("span");F.className="sp-breadcrumb-separator",F.textContent="/",i.appendChild(F);const x=document.createElement("button");x.className="sp-breadcrumb-item",x.textContent=H.name,x.onclick=()=>{f&&(p=p.slice(0,D+1),M(f,H.id))},i.appendChild(x)})},M=async(_,H)=>{v(!0),f=_,R();try{const D=await TE(_,H);if(v(!1),D.length===0){y("This folder is empty.");return}D.forEach(F=>{const x=document.createElement("li");x.className="sp-list-item";const $=m.some(ne=>ne.id===F.id),q=document.createElement("div");if(q.className="sp-item-selector",!F.isFolder){const ne=document.createElement("input");ne.type="checkbox",ne.className="sp-item-checkbox",ne.checked=$,ne.setAttribute("aria-label",`Select file ${F.name}`),ne.onchange=()=>A(F,ne),q.appendChild(ne)}x.appendChild(q);const he=document.createElement("div");he.className="sp-item-name-col";const st=document.createElement("div");st.className="sp-item-icon",st.innerHTML=F.isFolder?e.folder:e.file,he.appendChild(st);const Me=document.createElement("button");Me.type="button",Me.className="sp-item-name-btn",Me.title=F.name,Me.textContent=F.name,F.isFolder?Me.onclick=()=>{p.push({id:F.id,name:F.name}),M(_,F.id)}:Me.onclick=()=>{const ne=x.querySelector('input[type="checkbox"]');ne&&(ne.checked=!ne.checked,ne.dispatchEvent(new Event("change")))},he.appendChild(Me),x.appendChild(he);const Ce=document.createElement("div");Ce.className="sp-item-size-col",Ce.textContent=F.isFolder?"":Os(F.size),x.appendChild(Ce),a.appendChild(x)})}catch(D){y(D instanceof Error?D.message:"Could not load items.")}},L=async()=>{v(!0),p=[],f=null,R();try{const _=await yE();if(v(!1),_.length===0){y("No SharePoint sites found.");return}_.forEach(H=>{const D=document.createElement("li");D.className="sp-list-item",D.innerHTML=`
                        <div class="sp-item-selector"></div>
                        <div class="sp-item-name-col">
                            <div class="sp-item-icon">${e.site}</div>
                            <button type="button" class="sp-item-name-btn" title="${H.name}">${H.name}</button>
                        </div>
                        <div class="sp-item-size-col"></div>
                    `,D.querySelector("button")?.addEventListener("click",()=>{p=[{id:"root",name:H.name}],M(H.id,"root")}),a.appendChild(D)})}catch(_){y(_ instanceof Error?_.message:"Could not load SharePoint sites.")}};d.onclick=()=>pe(g.modals.sharepointPicker),u.onclick=()=>pe(g.modals.sharepointPicker),c.onclick=()=>{n.onSelect(m.map(_=>({siteId:f,itemId:_.id,name:_.name,mimeType:_.mimeType,size:_.size}))),pe(g.modals.sharepointPicker)},await L()}catch(t){console.error("Failed to open SharePoint picker:",t),Y("Could not open SharePoint picker.","error"),pe(g.modals.sharepointPicker)}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const eo=n=>{document.querySelectorAll('.user-profile-trigger[aria-expanded="true"]').forEach(e=>{(!n||!e.parentElement?.contains(n))&&(e.setAttribute("aria-expanded","false"),e.nextElementSibling?.classList.add("hidden"))}),document.querySelectorAll(".custom-select.open").forEach(e=>{(!n||!e.contains(n))&&(e.classList.remove("open"),e.querySelector(".select-trigger")?.setAttribute("aria-expanded","false"),e.querySelector(".select-options")?.classList.add("hidden"))}),(!n||!g.buttons.attachment?.contains(n))&&g.containers.attachmentOptions?.classList.add("hidden")},_E=(n,e,t)=>{const i=t.target.closest(".tab-link");if(!i||i.classList.contains("active"))return;const a=i.dataset.tab;a&&(n.querySelector(".active")?.classList.remove("active"),i.classList.add("active"),e.forEach(l=>{l.classList.toggle("active",l.id===`tab-panel-${a}`)}))},RE=async()=>{C.currentUser={firstName:"Alex",lastName:"Thorne",email:"alex.thorne@example.com",avatarUrl:""},Vn(wn),await j("hub"),Kn()},kE=()=>{if(!Gt){Y("Microsoft login service is unavailable. Please contact an administrator.","error");return}hE()},ME=async()=>{fE(),C.currentUser=null,await j("login")},PE=async n=>{const e=C.containers.find(t=>t.id===n);e&&(C.currentContainerId=n,oc(e),await j("department",e.name),Kn())},bE=async()=>{if(!C.currentContainerId)return;const n=C.containers.find(e=>e.id===C.currentContainerId);n&&(n.activeChatId=null,await _e(),Wt(C.currentContainerId),$n(C.currentContainerId))},to=async()=>{if(!g.inputs.chat||!C.currentContainerId)return;const n=C.containers.find(a=>a.id===C.currentContainerId);if(!n)return;const e=g.inputs.chat.value.trim();if(!e&&!C.attachedFile)return;g.forms.chat?.classList.add("thinking"),g.buttons.sendChat&&(g.buttons.sendChat.disabled=!0),g.loaders.sendChat?.classList.remove("hidden");const t=[];e&&t.push({text:e}),C.attachedFile&&t.push({inlineData:{mimeType:C.attachedFile.type,data:C.attachedFile.base64.split(",")[1]}});let o=n.chats.find(a=>a.id===n.activeChatId);o||(o={id:`chat-${Date.now()}`,name:"New Conversation",history:[]},n.chats.push(o),n.activeChatId=o.id),o.history.push({role:"user",parts:t}),Lt(t,"user"),g.inputs.chat.value="",g.inputs.chat.style.height="auto",lc();const i=Lt([],"bot",!0);try{const a=await Uy(n.selectedModel,n.selectedPersona,n.knowledgeBase,t);let l="",c=i;for await(const u of a)i&&c===i&&(i.remove(),c=Lt([{text:""}],"bot")),c&&(l+=u.text,c.innerHTML=Us(l));c&&o.history.push({role:"model",parts:[{text:l}]}),o.history.length===2&&(o.name=await Dy(o.history)),await _e(),Wt(C.currentContainerId)}catch(a){console.error("Chat error:",a),i&&i.remove(),Lt([{text:"Sorry, I encountered an error. Please try again."}],"bot")}finally{g.forms.chat?.classList.remove("thinking"),g.buttons.sendChat&&(g.buttons.sendChat.disabled=!0),g.loaders.sendChat?.classList.add("hidden")}},NE=async(n,e)=>{const t=C.containers.find(o=>o.id===n);t&&(t.activeChatId=e,await _e(),Wt(n),$n(n))},xE=async n=>{if(!n||n.length===0)return;const e=n[0];try{const t=await _n(e);C.attachedFile={name:e.name,type:e.type,base64:t},g.containers.attachmentPreview&&g.textElements.attachmentFilename&&(g.containers.attachmentPreview.classList.remove("hidden"),g.textElements.attachmentFilename.textContent=e.name),g.buttons.sendChat&&(g.buttons.sendChat.disabled=!1)}catch{Y("Error reading file.","error")}},LE=async n=>{if(n.length===0)return;const e=n[0];Y(`Downloading "${e.name}"...`);try{const t=await nc(e.siteId,e.itemId,e.name,e.mimeType,e.size);C.attachedFile={name:t.name,type:t.type,base64:t.base64Content},g.containers.attachmentPreview&&g.textElements.attachmentFilename&&(g.containers.attachmentPreview.classList.remove("hidden"),g.textElements.attachmentFilename.textContent=t.name),g.buttons.sendChat&&(g.buttons.sendChat.disabled=!1),pe(g.modals.sharepointPicker)}catch(t){console.error("Error downloading SharePoint file for chat:",t),Y(t instanceof Error?t.message:"Failed to download file.","error")}},lc=()=>{C.attachedFile=null,g.containers.attachmentPreview&&g.containers.attachmentPreview.classList.add("hidden"),g.inputs.fileUpload&&(g.inputs.fileUpload.value=""),g.inputs.chat&&g.buttons.sendChat&&(g.buttons.sendChat.disabled=g.inputs.chat.value.trim().length===0)},Ni=async(n,e)=>{try{const t=await fetch("src/modals/delete-confirm.html");if(!t.ok)throw new Error("Could not load modal content.");const o=await t.text();if(g.modals.deleteConfirm&&(g.modals.deleteConfirm.innerHTML=o),ge(),!g.modals.deleteConfirm||!g.textElements.deleteItemName||!g.textElements.deleteConfirmDescription)return;g.textElements.deleteItemName.textContent=n,g.textElements.deleteConfirmDescription.textContent=e,g.modals.deleteConfirm.classList.remove("hidden")}catch(t){console.error("Failed to open delete modal:",t),Y("Error opening modal.","error")}},DE=async()=>{if(!C.currentSettingsContainerId)return;const n=C.containers.find(e=>e.id===C.currentSettingsContainerId);n&&(C.itemToDelete={type:"container",containerId:n.id,chatId:null,fileName:null},await Ni(n.name,"This action cannot be undone. All associated chats and knowledge will be permanently deleted."))},UE=async(n,e)=>{const o=C.containers.find(i=>i.id===n)?.chats.find(i=>i.id===e);o&&(C.itemToDelete={type:"chat",containerId:n,chatId:e,fileName:null},await Ni(`chat "${o.name}"`,"This will permanently delete the chat history."))},OE=async(n,e)=>{C.itemToDelete={type:"knowledgeFile",containerId:n,chatId:null,fileName:e},await Ni(`file "${e}"`,"This will permanently delete the file from the knowledge base.")},HE=async()=>{if(!C.itemToDelete)return;const{type:n,containerId:e,chatId:t,fileName:o}=C.itemToDelete;let i;switch(n){case"container":C.containers=C.containers.filter(a=>a.id!==e),Y("Container deleted."),await j("containerManagement"),qt();break;case"chat":if(i=C.containers.find(a=>a.id===e),i){const a=i.activeChatId===t;i.chats=i.chats.filter(l=>l.id!==t),Wt(i.id),a&&(i.activeChatId=null,$n(i.id))}break;case"knowledgeFile":i=C.containers.find(a=>a.id===e),i&&(i.knowledgeBase=i.knowledgeBase.filter(a=>a.name!==o),Vt());break}await _e(),C.itemToDelete=null,pe(g.modals.deleteConfirm)},BE=async()=>{try{const n=await fetch("src/modals/add-container.html");if(!n.ok)throw new Error("Could not load modal content.");const e=await n.text();g.modals.addContainer&&(g.modals.addContainer.innerHTML=e),ge(),g.forms.addContainer?.reset(),g.buttons.createContainer&&(g.buttons.createContainer.disabled=!0),g.buttons.generateAi&&(g.buttons.generateAi.disabled=!0),C.draftNewContainer=null,g.containers.aiSuggestions?.classList.add("hidden"),g.modals.addContainer?.classList.remove("hidden"),g.previews.addCustomIcon&&(g.previews.addCustomIcon.classList.add("hidden"),g.previews.addCustomIcon.src="")}catch(n){console.error("Failed to open add container modal:",n),Y("Error opening modal.","error")}},FE=()=>{if(g.inputs.containerName&&g.buttons.generateAi&&g.buttons.createContainer){const n=g.inputs.containerName.value.trim().length>2;g.buttons.generateAi.disabled=!n,g.buttons.createContainer.disabled=!n}},GE=async()=>{if(!g.inputs.containerName||!g.inputs.containerType)return;const n=g.inputs.containerName.value,e=g.inputs.containerType.value,t=g.inputs.containerWebsite?.value;g.textElements.aiStatusSpinner&&g.textElements.aiStatusSpinner.classList.remove("hidden"),g.textElements.aiStatusText&&(g.textElements.aiStatusText.textContent="Generating creative ideas..."),g.buttons.generateAi&&(g.buttons.generateAi.disabled=!0),g.loaders.aiGenerate?.classList.remove("hidden");try{const o=await Ly(n,e,t);C.draftNewContainer={...o,name:n,functions:o.functions.map(i=>({...i,id:`func-draft-${Math.random()}`,enabled:!0}))},sc(),g.containers.aiSuggestions?.classList.remove("hidden")}catch(o){Y(o instanceof Error?o.message:"An unknown error occurred.","error")}finally{g.textElements.aiStatusSpinner&&g.textElements.aiStatusSpinner.classList.add("hidden"),g.textElements.aiStatusText&&(g.textElements.aiStatusText.textContent="AI suggestions are ready!"),g.buttons.generateAi&&(g.buttons.generateAi.disabled=!1),g.loaders.aiGenerate?.classList.add("hidden")}},qE=async n=>{if(n.preventDefault(),!g.inputs.containerName||!g.inputs.containerDesc||!g.containers.containerIconSelector)return;const e=g.inputs.containerName.value,t=g.inputs.containerDesc.value,o=g.containers.containerIconSelector.querySelector(".selected"),i=g.previews.addCustomIcon?.src;let a=o?o.innerHTML:Oo[0];i&&!g.previews.addCustomIcon?.classList.contains("hidden")&&(a=i);const l=C.draftNewContainer,c={id:`cont-${Date.now()}`,name:e,description:t,icon:a,cardImageUrl:l?.cardImageUrl||"",theme:l?.theme||wn,quickQuestions:l?.quickQuestions||[],availablePersonas:l?.availablePersonas||["Helpful Assistant"],functions:l?.functions.map(u=>({...u,id:`func-${Date.now()}-${Math.random()}`,enabled:!0}))||[],availableModels:[...C.availableModels.map(u=>u.id)],selectedModel:C.availableModels[0]?.id||"",selectedPersona:l?.availablePersonas[0]||"Helpful Assistant",enabledIntegrations:[],accessControl:["admin@company.com"],chats:[],activeChatId:null,knowledgeBase:[],isKnowledgeBasePublic:!0};C.containers.push(c),await _e(),qt(),pe(g.modals.addContainer),Y("Container created successfully!")},ae=()=>{ic()},xi=n=>e=>{C.draftSettingsContainer&&(C.draftSettingsContainer[n]=C.draftSettingsContainer[n].filter(t=>t!==e),Oe(C.draftSettingsContainer.id),ae())},VE=xi("quickQuestions"),KE=xi("availablePersonas"),$E=xi("accessControl"),JE=n=>{C.draftSettingsContainer&&(C.draftSettingsContainer.functions=C.draftSettingsContainer.functions.filter(e=>e.id!==n),Oe(C.draftSettingsContainer.id),ae())},zE=n=>{if(n.preventDefault(),C.draftSettingsContainer&&g.inputs.newQuickQuestion){const e=g.inputs.newQuickQuestion.value.trim();e&&!C.draftSettingsContainer.quickQuestions.includes(e)&&(C.draftSettingsContainer.quickQuestions.push(e),Oe(C.draftSettingsContainer.id),ae()),n.target.reset()}},YE=n=>{if(n.preventDefault(),C.draftSettingsContainer&&g.inputs.newPersona){const e=g.inputs.newPersona.value.trim();e&&!C.draftSettingsContainer.availablePersonas.includes(e)&&(C.draftSettingsContainer.availablePersonas.push(e),Oe(C.draftSettingsContainer.id),ae()),n.target.reset()}},WE=n=>{if(n.preventDefault(),C.draftSettingsContainer&&g.inputs.newAccessor){const e=g.inputs.newAccessor.value.trim();e&&!C.draftSettingsContainer.accessControl.includes(e)&&(C.draftSettingsContainer.accessControl.push(e),Oe(C.draftSettingsContainer.id),ae()),n.target.reset()}},QE=async()=>{if(!(!C.draftSettingsContainer||!g.buttons.suggestQuestions)){g.buttons.suggestQuestions.disabled=!0,g.buttons.suggestQuestions.innerHTML='<div class="spinner"></div>';try{const n=await ga(C.draftSettingsContainer.name,"questions");C.draftSettingsContainer.quickQuestions.push(...n),Oe(C.draftSettingsContainer.id),ae()}catch(n){Y(n instanceof Error?n.message:"An unknown error occurred.","error")}finally{g.buttons.suggestQuestions.disabled=!1,g.buttons.suggestQuestions.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path d="M12 3c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM5 12c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM19 12c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg> Suggest with AI'}}},XE=async()=>{if(!(!C.draftSettingsContainer||!g.buttons.suggestPersonas)){g.buttons.suggestPersonas.disabled=!0,g.buttons.suggestPersonas.innerHTML='<div class="spinner"></div>';try{const n=await ga(C.draftSettingsContainer.name,"personas");C.draftSettingsContainer.availablePersonas.push(...n),Oe(C.draftSettingsContainer.id),ae()}catch(n){Y(n instanceof Error?n.message:"An unknown error occurred.","error")}finally{g.buttons.suggestPersonas.disabled=!1,g.buttons.suggestPersonas.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path d="M12 3c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM5 12c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM19 12c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg> Suggest with AI'}}},ZE=async()=>{if(!C.draftSettingsContainer||!g.inputs.newFunction||!g.buttons.generateFunction)return;const n=g.inputs.newFunction.value.trim();if(n){g.buttons.generateFunction.disabled=!0,g.buttons.generateFunction.innerHTML='<div class="spinner"></div> Generating...';try{const t={...await xy(n),id:`func-${Date.now()}`,enabled:!0};C.draftSettingsContainer.functions.push(t),Oe(C.draftSettingsContainer.id),ae(),g.inputs.newFunction.value=""}catch(e){Y(e instanceof Error?e.message:"Failed to generate function.","error")}finally{g.buttons.generateFunction.disabled=!1,g.buttons.generateFunction.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path d="M12 3c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM5 12c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM19 12c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg> Generate with AI'}}},jE=n=>{if(n.preventDefault(),!C.draftAvailableModels||!g.inputs.newModelId||!g.inputs.newModelApi||!g.inputs.newModelIcon)return;const e={id:g.inputs.newModelId.value.trim(),api:g.inputs.newModelApi.value.trim(),icon:g.inputs.newModelIcon.value.trim()};e.id&&e.api&&e.icon&&!C.draftAvailableModels.some(t=>t.id===e.id)&&(C.draftAvailableModels.push(e),An(),Qe()),n.target.reset()},eS=n=>{C.draftAvailableModels&&(C.draftAvailableModels=C.draftAvailableModels.filter(e=>e.id!==n),An(),Qe())},cc=async n=>{if(!n||n.length===0||!C.currentContainerId)return;const e=C.containers.find(t=>t.id===C.currentContainerId);if(e){Y(`Uploading ${n.length} file(s)...`);for(const t of Array.from(n)){if(e.knowledgeBase.some(o=>o.name===t.name)){Y(`File "${t.name}" already exists.`);continue}try{const o=await _n(t),i={name:t.name,type:t.type,size:t.size,uploadDate:new Date().toISOString(),base64Content:o};e.knowledgeBase.push(i)}catch{Y(`Could not process file: ${t.name}`,"error")}}await _e(),Vt()}},tS=async n=>{if(n.length===0||!C.currentContainerId)return;const e=C.containers.find(t=>t.id===C.currentContainerId);if(e){Y(`Downloading ${n.length} file(s)...`),pe(g.modals.sharepointPicker);for(const t of n){if(e.knowledgeBase.some(o=>o.name===t.name)){Y(`File "${t.name}" already exists.`);continue}try{const o=await nc(t.siteId,t.itemId,t.name,t.mimeType,t.size);e.knowledgeBase.push(o)}catch(o){console.error(`Error downloading SharePoint file ${t.name}:`,o),Y(o instanceof Error?o.message:`Failed to download ${t.name}.`,"error")}}await _e(),Vt()}},nS=async n=>await cc(n),oS=async n=>await cc(n||null);/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const no=()=>new Date().toISOString(),re={log:(n,...e)=>{console.log(`[${no()}] HubApp Info: ${n}`,...e)},warn:(n,...e)=>{console.warn(`[${no()}] HubApp Warn: ${n}`,...e)},error:(n,e)=>{console.error(`[${no()}] HubApp Error: ${n}`,e)}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const iS=()=>{const n=document.getElementById("root");n&&(document.body.addEventListener("click",()=>eo()),n.addEventListener("click",async e=>{const t=e.target;if(t.closest("#google-login")&&await RE(),t.closest("#microsoft-login")&&kE(),t.closest("#settings-btn")&&await j("settingsHub"),t.closest("#container-management-card")&&await j("containerManagement"),t.closest("#global-settings-card")&&(await j("globalSettings"),C.draftBranding=JSON.parse(JSON.stringify(C.branding)),C.draftAvailableModels=JSON.parse(JSON.stringify(C.availableModels)),jn(C.draftBranding),An(),Qe(!0)),t.closest(".back-to-hub-btn")&&await j("hub"),(t.closest("#back-to-settings-hub-btn-1")||t.closest("#back-to-settings-hub-btn-2"))&&await j("settingsHub"),t.closest("#back-to-container-management-btn")&&await j("containerManagement"),t.closest("#back-to-assistant-btn")){const y=C.containers.find(E=>E.id===C.currentContainerId);await j("department",y?.name||"Assistant")}if(t.closest("#back-from-knowledge-btn")){const y=C.containers.find(E=>E.id===C.currentContainerId);C.knowledgeBaseSourcePage==="settings"&&y?(await j("settingsDetail",`Edit ${y.name}`),Oe(y.id)):await j("department",y?.name||"Assistant")}if(t.closest("#sidebar-assistant-link")){e.preventDefault();const y=C.containers.find(E=>E.id===C.currentContainerId);await j("department",y?.name||"Assistant")}if(t.closest("#sidebar-knowledge-link")){e.preventDefault();const y=C.containers.find(E=>E.id===C.currentContainerId);y&&(C.knowledgeBaseSourcePage="chat",await j("knowledge",`${y.name} Knowledge`),g.textElements.knowledgeTitle&&(g.textElements.knowledgeTitle.textContent=`Knowledge for ${y.name}`),Vt())}const a=t.closest("#container-grid [data-container-id]");a&&await PE(a.dataset.containerId);const l=t.closest("#container-management-grid [data-container-id]");if(l){const y=l.dataset.containerId,E=C.containers.find(A=>A.id===y);E&&(await j("settingsDetail",`Edit ${E.name}`),Oe(y))}const c=t.closest(".tab-link");if(c){const y=c.parentElement,E=y?.closest(".settings-container");if(y&&E){const A=E.querySelectorAll(".tab-panel");_E(y,A,e)}}t.closest("#new-chat-btn")&&await bE();const u=t.closest(".quick-question");u&&g.inputs.chat&&(g.inputs.chat.value=u.textContent||"",await to());const d=t.closest(".sidebar-link[data-chat-id]");d&&C.currentContainerId&&await NE(C.currentContainerId,d.dataset.chatId);const h=t.closest(".delete-chat-btn[data-chat-id]");h&&C.currentContainerId&&(e.stopPropagation(),await UE(C.currentContainerId,h.dataset.chatId));const f=t.closest(".select-trigger");if(f){e.stopPropagation();const y=f.closest(".custom-select"),E=f.getAttribute("aria-expanded")==="true";document.querySelectorAll(".custom-select.open").forEach(A=>{A!==y&&(A.classList.remove("open"),A.querySelector(".select-trigger")?.setAttribute("aria-expanded","false"),A.querySelector(".select-options")?.classList.add("hidden"))}),y?.classList.toggle("open",!E),f.setAttribute("aria-expanded",String(!E)),y?.querySelector(".select-options")?.classList.toggle("hidden",E)}const p=t.closest(".select-option");if(p){const y=C.containers.find(R=>R.id===C.currentContainerId);if(!y)return;const E=p.dataset.value;if(!E)return;const A=p.closest(".custom-select");A?.id==="model-select-container"?y.selectedModel=E:A?.id==="persona-select-container"&&(y.selectedPersona=E),await _e(),rc(),A?.classList.remove("open"),A?.querySelector(".select-trigger")?.setAttribute("aria-expanded","false"),A?.querySelector(".select-options")?.classList.add("hidden")}t.closest("#attachment-btn")&&(e.stopPropagation(),eo(g.containers.attachmentOptions),g.containers.attachmentOptions?.classList.toggle("hidden")),t.closest("#upload-computer-btn")&&g.inputs.fileUpload?.click(),t.closest("#upload-sharepoint-btn")&&Ls({mode:"single",onSelect:LE}),t.closest("#remove-attachment-btn")&&lc();const m=t.closest(".user-profile-trigger");if(m){e.stopPropagation();const y=m.nextElementSibling,E=m.getAttribute("aria-expanded")==="true";eo(m.parentElement),E||(y?.classList.remove("hidden"),m.setAttribute("aria-expanded","true"))}t.closest('.dropdown-link[data-action="logout"]')&&await ME(),t.closest("#add-container-btn")&&await BE(),t.closest("#close-modal-btn")&&pe(g.modals.addContainer),t.closest("#cancel-container-btn")&&pe(g.modals.addContainer),t.closest("#close-function-runner-btn")&&pe(g.modals.functionRunner),t.closest("#cancel-function-runner-btn")&&pe(g.modals.functionRunner),t.closest("#close-delete-modal-btn")&&pe(g.modals.deleteConfirm),t.closest("#cancel-delete-btn")&&pe(g.modals.deleteConfirm);const v=t.closest(".suggested-item button[data-item-type]");if(v&&C.draftNewContainer){e.stopPropagation();const y=v.dataset.itemType,E=v.dataset.itemValue;if(!y||!E)return;switch(y){case"question":C.draftNewContainer.quickQuestions=C.draftNewContainer.quickQuestions.filter(A=>A!==E);break;case"persona":C.draftNewContainer.availablePersonas=C.draftNewContainer.availablePersonas.filter(A=>A!==E);break;case"function":C.draftNewContainer.functions=C.draftNewContainer.functions.filter(A=>A.name!==E);break}sc()}if(t.closest("#confirm-delete-btn")&&await HE(),t.closest("#delete-container-btn")&&await DE(),t.closest("#generate-ai-btn")&&await GE(),t.closest("#sidebar-toggle-btn")&&g.pageViews.department?.classList.toggle("sidebar-open"),t.closest("#generate-function-btn")&&await ZE(),t.closest("#suggest-questions-btn")&&await QE(),t.closest("#suggest-personas-btn")&&await XE(),t.closest("#manage-knowledge-btn")){if(!C.currentSettingsContainerId)return;C.currentContainerId=C.currentSettingsContainerId;const y=C.containers.find(E=>E.id===C.currentContainerId);y&&(C.knowledgeBaseSourcePage="settings",await j("knowledge",`${y.name} Knowledge`),g.textElements.knowledgeTitle&&(g.textElements.knowledgeTitle.textContent=`Knowledge for ${y.name}`),Vt())}if(t.closest("#knowledge-upload-btn")&&g.inputs.knowledgeFile?.click(),t.closest("#knowledge-add-sharepoint-btn")&&Ls({mode:"multiple",onSelect:tS}),t.closest("#save-settings-btn")){if(!C.currentSettingsContainerId||!C.draftSettingsContainer)return;const y=C.containers.findIndex(E=>E.id===C.currentSettingsContainerId);y>-1&&(C.containers[y]=C.draftSettingsContainer,await _e(),qt(),oc(C.draftSettingsContainer),Y("Settings saved successfully!"),await j("containerManagement"))}if(t.closest("#cancel-settings-btn")&&await j("containerManagement"),t.closest("#save-global-settings-btn")){if(!C.draftBranding||!C.draftAvailableModels)return;C.branding=C.draftBranding,C.availableModels=C.draftAvailableModels,await _e(),ac(),Vn(wn),jn(C.branding),Y("Global settings saved!"),Qe(!0)}t.closest("#cancel-global-settings-btn")&&(C.draftBranding=JSON.parse(JSON.stringify(C.branding)),C.draftAvailableModels=JSON.parse(JSON.stringify(C.availableModels)),jn(C.draftBranding),An(),Qe(!0))}),n.addEventListener("submit",async e=>{const t=e.target;t.closest("#chat-form")&&(e.preventDefault(),await to()),t.closest("#add-container-form")&&await qE(e),t.closest("#add-quick-question-form")&&zE(e),t.closest("#add-persona-form")&&YE(e),t.closest("#add-accessor-form")&&WE(e),t.closest("#add-model-form")&&jE(e)}),n.addEventListener("input",e=>{const t=e.target;if(t.closest("#chat-input")){if(!g.inputs.chat)return;g.buttons.sendChat.disabled=g.inputs.chat.value.trim().length===0&&!C.attachedFile,g.inputs.chat.style.height="auto",g.inputs.chat.style.height=`${g.inputs.chat.scrollHeight}px`}t.closest("#container-name-input")&&FE()}),n.addEventListener("change",async e=>{const t=e.target;t.id==="file-upload-input"&&await xE(t.files),t.id==="knowledge-file-input"&&await nS(t.files),t.id==="container-type-select"&&g.containers.containerWebsiteGroup&&g.containers.containerWebsiteGroup.classList.toggle("hidden",t.value!=="product")}),n.addEventListener("keydown",async e=>{e.target===g.inputs.chat&&e.key==="Enter"&&!e.shiftKey&&!g.buttons.sendChat?.disabled&&(e.preventDefault(),await to())}),n.addEventListener("dragover",e=>{e.target.closest("#file-dropzone")&&(e.preventDefault(),e.target.closest("#file-dropzone")?.classList.add("dragover"))}),n.addEventListener("dragleave",e=>{const t=e.target.closest("#file-dropzone");t&&t.classList.remove("dragover")}),n.addEventListener("drop",async e=>{const t=e.target.closest("#file-dropzone");t&&(e.preventDefault(),t.classList.remove("dragover"),await oS(e.dataTransfer?.files))}),g.buttons.acceptCookies?.addEventListener("click",()=>{localStorage.setItem("cookiesAccepted","true"),g.containers.cookieBanner?.classList.add("hidden")}))},rS=async()=>{re.log("Application initialization started.");try{if(re.log("Re-querying DOM elements."),ge(),re.log("Initializing MSAL..."),await uE(),re.log("MSAL initialized."),re.log("Loading application state..."),await mc(),re.log("Application state loaded.",{containers:C.containers.length}),C.branding.enableMicrosoftLogin&&!Gt){const e="Microsoft login is enabled but not configured. Please contact an administrator.";re.warn(e),Y(e,"error")}re.log("Rendering global branding."),ac(),re.log("Binding event listeners."),iS(),re.log("Handling auth redirect..."),await gE();const n=qn();if(re.log(`Auth redirect handled. Active account found: ${!!n}`),n){re.log("Fetching user profile from Graph API.");const e=await pE();C.currentUser=e,re.log("User profile loaded.",{user:e.email}),Vn(wn),await j("hub"),Kn(),re.log("User logged in. Hub page displayed.")}else await j("login"),re.log("No active user session. Login page displayed.");re.log("Application initialization completed successfully.")}catch(n){re.error("A critical error occurred during initialization:",n),ge();const e=n instanceof Error?n.message:"Application failed to initialize.";Y(e,"error")}};document.addEventListener("DOMContentLoaded",rS);
